<html lang="en-us"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Elasticsearch Reference [1.7]
      | Elastic
    </title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Elasticsearch Reference [1.7]"><link rel="next" href="getting-started.html" title="Getting Started"><meta name="description" content="Get started with the documentation for Elasticsearch, Kibana, Logstash, Beats, X-Pack, Elastic Cloud, Elasticsearch for Apache Hadoop, and our language clients."><meta name="DC.type" content="Docs/Elasticsearch/Reference/1.7">

    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ffffff">
<meta name="apple-mobile-web-app-title" content="Elastic">
<meta name="application-name" content="Elastic">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#ffffff">

<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<link rel="schema.DCTERMS" href="http://purl.org/dc/terms/">

	<meta name="description" content="">

			<meta property="og:image" content="https://www.elastic.co/static/images/elastic-logo-200.png">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <link rel="apple-touch-icon-precomposed" sizes="64x64" href="/favicon_64x64_16bit.png">

    <link rel="apple-touch-icon-precomposed" sizes="32x32" href="/favicon_32x32.png">

    <link rel="apple-touch-icon-precomposed" sizes="16x16" href="/favicon_16x16.png">

    <link href="https://static-www.elastic.co/static/css/main.css?q=623" rel="stylesheet">

	<link type="text/css" rel="stylesheet" href="https://static-www.elastic.co/static/css/guide.css?q=623">

<link rel="stylesheet" type="text/css" href="https://static-www.elastic.co/static/css/horizon-swiper.min.css?q=623">

</head>
  <body>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="navheader"><span class="prev">
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="getting-started.html">Getting Started
              &nbsp;»
            </a></span></div><div class="book" lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="id-1"></a>Elasticsearch Reference</h1></div></div><hr></div>

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-node">Getting Started</span></div><div class="navheader"><span class="prev">
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_basic_concepts.html">Basic Concepts
              &nbsp;»
            </a></span></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="getting-started"></a>Getting Started<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><div class="partintro"><div></div><p>Elasticsearch is a highly scalable open-source full-text search and analytics engine. It allows you to store, search, and analyze big volumes of data quickly and in near real time. It is generally used as the underlying engine/technology that powers applications that have complex search features and requirements.</p><p>Here are a few sample use-cases that Elasticsearch could be used for:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
You run an online web store where you allow your customers to search for products that you sell. In this case, you can use Elasticsearch to store your entire product catalog and inventory and provide search and autocomplete suggestions for them.
</li><li class="listitem">
You want to collect log or transaction data and you want to analyze and mine this data to look for trends, statistics, summarizations, or anomalies. In this case, you can use Logstash (part of the Elasticsearch/Logstash/Kibana stack) to collect, aggregate, and parse your data, and then have Logstash feed this data into Elasticsearch. Once the data is in Elasticsearch, you can run searches and aggregations to mine any information that is of interest to you.
</li><li class="listitem">
You run a price alerting platform which allows price-savvy customers to specify a rule like "I am interested in buying a specific electronic gadget and I want to be notified if the price of gadget falls below $X from any vendor within the next month". In this case you can scrape vendor prices, push them into Elasticsearch and use its reverse-search (Percolator) capability to match price movements against customer queries and eventually push the alerts out to the customer once matches are found.
</li><li class="listitem">
You have analytics/business-intelligence needs and want to quickly investigate, analyze, visualize, and ask ad-hoc questions on a lot of data (think millions or billions of records). In this case, you can use Elasticsearch to store your data and then use Kibana (part of the Elasticsearch/Logstash/Kibana stack) to build custom dashboards that can visualize aspects of your data that are important to you. Additionally, you can use the Elasticsearch aggregations functionality to perform complex business intelligence queries against your data.
</li></ul></div><p>For the rest of this tutorial, I will guide you through the process of getting Elasticsearch up and running, taking a peek inside it, and performing basic operations like indexing, searching, and modifying your data. At the end of this tutorial, you should have a good idea of what Elasticsearch is, how it works, and hopefully be inspired to see how you can use it to either build sophisticated search applications or to mine intelligence from your data.</p></div></div><div class="navfooter"><span class="prev">
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_basic_concepts.html">Basic Concepts
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-node">Basic Concepts</span></div><div class="navheader"><span class="prev"><a href="getting-started.html">
              «&nbsp;
              Getting Started</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_installation.html">Installation
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_basic_concepts"></a>Basic Concepts<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>There are a few concepts that are core to Elasticsearch. Understanding these concepts from the outset will tremendously help ease the learning process.</p><h3><a id="_near_realtime_nrt"></a>Near Realtime (NRT)<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Elasticsearch is a near real time search platform. What this means is there is a slight latency (normally one second) from the time you index a document until the time it becomes searchable.</p><h3><a id="_cluster"></a>Cluster<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>A cluster is a collection of one or more nodes (servers) that together holds your entire data and provides federated indexing and search capabilities across all nodes. A cluster is identified by a unique name which by default is "elasticsearch". This name is important because a node can only be part of a cluster if the node is set up to join the cluster by its name.</p><p>Make sure that you don’t reuse the same cluster names in different
environments, otherwise you might end up with nodes joining the wrong cluster.
For instance you could use <code class="literal">logging-dev</code>, <code class="literal">logging-stage</code>, and <code class="literal">logging-prod</code>
for the development, staging, and production clusters.</p><p>Note that it is valid and perfectly fine to have a cluster with only a single node in it. Furthermore, you may also have multiple independent clusters each with its own unique cluster name.</p><h3><a id="_node"></a>Node<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>A node is a single server that is part of your cluster, stores your data, and participates in the cluster’s indexing and search capabilities. Just like a cluster, a node is identified by a name which by default is a random Marvel character name that is assigned to the node at startup. You can define any node name you want if you do not want the default.  This name is important for administration purposes where you want to identify which servers in your network correspond to which nodes in your Elasticsearch cluster.</p><p>A node can be configured to join a specific cluster by the cluster name. By default, each node is set up to join a cluster named <code class="literal">elasticsearch</code> which means that if you start up a number of nodes on your network and—assuming they can discover each other—they will all automatically form and join a single cluster named <code class="literal">elasticsearch</code>.</p><p>In a single cluster, you can have as many nodes as you want. Furthermore, if there are no other Elasticsearch nodes currently running on your network, starting a single node will by default form a new single-node cluster named <code class="literal">elasticsearch</code>.</p><h3><a id="_index"></a>Index<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>An index is a collection of documents that have somewhat similar characteristics. For example, you can have an index for customer data, another index for a product catalog, and yet another index for order data. An index is identified by a name (that must be all lowercase) and this name is used to refer to the index when performing indexing, search, update, and delete operations against the documents in it.</p><p>In a single cluster, you can define as many indexes as you want.</p><h3><a id="_type"></a>Type<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Within an index, you can define one or more types. A type is a logical category/partition of your index whose semantics is completely up to you. In general, a type is defined for documents that have a set of common fields. For example, let’s assume you run a blogging platform and store all your data in a single index. In this index, you may define a type for user data, another type for blog data, and yet another type for comments data.</p><h3><a id="_document"></a>Document<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>A document is a basic unit of information that can be indexed. For example, you can have a document for a single customer, another document for a single product, and yet another for a single order. This document is expressed in <a class="ulink" href="http://json.org/" target="_top">JSON</a> (JavaScript Object Notation) which is an ubiquitous internet data interchange format.</p><p>Within an index/type, you can store as many documents as you want. Note that although a document physically resides in an index, a document actually must be indexed/assigned to a type inside an index.</p><h3><a id="_shards_amp_replicas"></a>Shards &amp; Replicas<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>An index can potentially store a large amount of data that can exceed the hardware limits of a single node. For example, a single index of a billion documents taking up 1TB of disk space may not fit on the disk of a single node or may be too slow to serve search requests from a single node alone.</p><p>To solve this problem, Elasticsearch provides the ability to subdivide your index into multiple pieces called shards. When you create an index, you can simply define the number of shards that you want. Each shard is in itself a fully-functional and independent "index" that can be hosted on any node in the cluster.</p><p>Sharding is important for two primary reasons:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
It allows you to horizontally split/scale your content volume
</li><li class="listitem">
It allows you to distribute and parallelize operations across shards (potentially on multiple nodes) thus increasing performance/throughput
</li></ul></div><p>The mechanics of how a shard is distributed and also how its documents are aggregated back into search requests are completely managed by Elasticsearch and is transparent to you as the user.</p><p>In a network/cloud environment where failures can be expected anytime, it is very useful and highly recommended to have a failover mechanism in case a shard/node somehow goes offline or disappears for whatever reason. To this end, Elasticsearch allows you to make one or more copies of your index’s shards into what are called replica shards, or replicas for short.</p><p>Replication is important for two primary reasons:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
It provides high availability in case a shard/node fails. For this reason, it is important to note that a replica shard is never allocated on the same node as the original/primary shard that it was copied from.
</li><li class="listitem">
It allows you to scale out your search volume/throughput since searches can be executed on all replicas in parallel.
</li></ul></div><p>To summarize, each index can be split into multiple shards. An index can also be replicated zero (meaning no replicas) or more times. Once replicated, each index will have primary shards (the original shards that were replicated from) and replica shards (the copies of the primary shards).
The number of shards and replicas can be defined per index at the time the index is created. After the index is created, you may change the number of replicas dynamically anytime but you cannot change the number shards after-the-fact.</p><p>By default, each index in Elasticsearch is allocated 5 primary shards and 1 replica which means that if you have at least two nodes in your cluster, your index will have 5 primary shards and another 5 replica shards (1 complete replica) for a total of 10 shards per index.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Each Elasticsearch shard is a Lucene index.  There is a maximum number of documents you can have in a single Lucene index.  As of <a class="ulink" href="https://issues.apache.org/jira/browse/LUCENE-5843" target="_top"><code class="literal">LUCENE-5843</code></a>, the limit is <code class="literal">2,147,483,519</code> (= Integer.MAX_VALUE - 128) documents.
You can monitor shard sizes using the <a class="link" href="cat-shards.html" title="cat shards"><code class="literal">_cat/shards</code></a> api.</p></div></div><p>With that out of the way, let’s get started with the fun part…</p></div><div class="navfooter"><span class="prev"><a href="getting-started.html">
              «&nbsp;
              Getting Started</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_installation.html">Installation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-node">Installation</span></div><div class="navheader"><span class="prev"><a href="_basic_concepts.html">
              «&nbsp;
              Basic Concepts</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_exploring_your_cluster.html">Exploring Your Cluster
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_installation"></a>Installation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Elasticsearch requires at least Java 7. Specifically as of this writing, it is recommended that you use the Oracle JDK version 1.8.0_25. Java installation varies from platform to platform so we won’t go into those details here. Oracle’s recommended installation documentation can be found on <a class="ulink" href="http://docs.oracle.com/javase/8/docs/technotes/guides/install/install_overview.html" target="_top">Oracle’s website</a>. Suffice to say, before you install Elasticsearch, please check your Java version first by running (and then install/upgrade accordingly if needed):</p><div class="pre_wrapper"><pre class="programlisting">java -version
echo $JAVA_HOME</pre></div><p>Once we have Java set up, we can then download and run Elasticsearch. The binaries are available from <a class="ulink" href="http://www.elastic.co/downloads" target="_top"><code class="literal">www.elastic.co/downloads</code></a> along with all the releases that have been made in the past. For each release, you have a choice among a <code class="literal">zip</code> or <code class="literal">tar</code> archive, or a <code class="literal">DEB</code> or <code class="literal">RPM</code> package. For simplicity, let’s use the tar file.</p><p>Let’s download the Elasticsearch 1.7.6 tar as follows (Windows users should download the zip package):</p><div class="pre_wrapper"><pre class="programlisting">curl -L -O https://download.elastic.co/elasticsearch/elasticsearch/elasticsearch-1.7.6.tar.gz</pre></div><p>Then extract it as follows (Windows users should unzip the zip package):</p><div class="pre_wrapper"><pre class="programlisting">tar -xvf elasticsearch-1.7.6.tar.gz</pre></div><p>It will then create a bunch of files and folders in your current directory. We then go into the bin directory as follows:</p><div class="pre_wrapper"><pre class="programlisting">cd elasticsearch-1.7.6/bin</pre></div><p>And now we are ready to start our node and single cluster (Windows users should run the elasticsearch.bat file):</p><div class="pre_wrapper"><pre class="programlisting">./elasticsearch</pre></div><p>If everything goes well, you should see a bunch of messages that look like below:</p><div class="pre_wrapper"><pre class="programlisting">./elasticsearch
[2014-03-13 13:42:17,218][INFO ][node           ] [New Goblin] version[1.7.6], pid[2085], build[5c03844/2014-02-25T15:52:53Z]
[2014-03-13 13:42:17,219][INFO ][node           ] [New Goblin] initializing ...
[2014-03-13 13:42:17,223][INFO ][plugins        ] [New Goblin] loaded [], sites []
[2014-03-13 13:42:19,831][INFO ][node           ] [New Goblin] initialized
[2014-03-13 13:42:19,832][INFO ][node           ] [New Goblin] starting ...
[2014-03-13 13:42:19,958][INFO ][transport      ] [New Goblin] bound_address {inet[/0:0:0:0:0:0:0:0:9300]}, publish_address {inet[/192.168.8.112:9300]}
[2014-03-13 13:42:23,030][INFO ][cluster.service] [New Goblin] new_master [New Goblin][rWMtGj3dQouz2r6ZFL9v4g][mwubuntu1][inet[/192.168.8.112:9300]], reason: zen-disco-join (elected_as_master)
[2014-03-13 13:42:23,100][INFO ][discovery      ] [New Goblin] elasticsearch/rWMtGj3dQouz2r6ZFL9v4g
[2014-03-13 13:42:23,125][INFO ][http           ] [New Goblin] bound_address {inet[/0:0:0:0:0:0:0:0:9200]}, publish_address {inet[/192.168.8.112:9200]}
[2014-03-13 13:42:23,629][INFO ][gateway        ] [New Goblin] recovered [1] indices into cluster_state
[2014-03-13 13:42:23,630][INFO ][node           ] [New Goblin] started</pre></div><p>Without going too much into detail, we can see that our node named "New Goblin" (which will be a different Marvel character in your case) has started and elected itself as a master in a single cluster. Don’t worry yet at the moment what master means. The main thing that is important here is that we have started one node within one cluster.</p><p>As mentioned previously, we can override either the cluster or node name. This can be done from the command line when starting Elasticsearch as follows:</p><div class="pre_wrapper"><pre class="programlisting">./elasticsearch --cluster.name my_cluster_name --node.name my_node_name</pre></div><p>Also note the line marked http with information about the HTTP address (<code class="literal">192.168.8.112</code>) and port (<code class="literal">9200</code>) that our node is reachable from. By default, Elasticsearch uses port <code class="literal">9200</code> to provide access to its REST API. This port is configurable if necessary.</p></div><div class="navfooter"><span class="prev"><a href="_basic_concepts.html">
              «&nbsp;
              Basic Concepts</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_exploring_your_cluster.html">Exploring Your Cluster
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-node">Exploring Your Cluster</span></div><div class="navheader"><span class="prev"><a href="_installation.html">
              «&nbsp;
              Installation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_cluster_health.html">Cluster Health
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_exploring_your_cluster"></a>Exploring Your Cluster<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><h3><a id="_the_rest_api"></a>The REST API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Now that we have our node (and cluster) up and running, the next step is to understand how to communicate with it. Fortunately, Elasticsearch provides a very comprehensive and powerful REST API that you can use to interact with your cluster. Among the few things that can be done with the API are as follows:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Check your cluster, node, and index health, status, and statistics
</li><li class="listitem">
Administer your cluster, node, and index data and metadata
</li><li class="listitem">
Perform CRUD (Create, Read, Update, and Delete) and search operations against your indexes
</li><li class="listitem">
Execute advanced search operations such as paging, sorting, filtering, scripting, faceting, aggregations, and many others
</li></ul></div></div><div class="navfooter"><span class="prev"><a href="_installation.html">
              «&nbsp;
              Installation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_cluster_health.html">Cluster Health
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-link"><a href="_exploring_your_cluster.html">Exploring Your Cluster</a></span> » <span class="breadcrumb-node">Cluster Health</span></div><div class="navheader"><span class="prev"><a href="_exploring_your_cluster.html">
              «&nbsp;
              Exploring Your Cluster</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_list_all_indices.html">List All Indices
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_cluster_health"></a>Cluster Health<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Let’s start with a basic health check, which we can use to see how our cluster is doing. We’ll be using curl to do this but you can use any tool that allows you to make HTTP/REST calls. Let’s assume that we are still on the same node where we started Elasticsearch on and open another command shell window.</p><p>To check the cluster health, we will be using the <a class="link" href="cat.html" title="cat APIs"><code class="literal">_cat</code> API</a>. Remember previously that our node HTTP endpoint is available at port <code class="literal">9200</code>:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/_cat/health?v'</pre></div><p>And the response:</p><div class="pre_wrapper"><pre class="programlisting">epoch      timestamp cluster       status node.total node.data shards pri relo init unassign
1394735289 14:28:09  elasticsearch green           1         1      0   0    0    0        0</pre></div><p>We can see that our cluster named "elasticsearch" is up with a green status.</p><p>Whenever we ask for the cluster health, we either get green, yellow, or red. Green means everything is good (cluster is fully functional), yellow means all data is available but some replicas are not yet allocated (cluster is fully functional), and red means some data is not available for whatever reason. Note that even if a cluster is red, it still is partially functional (i.e. it will continue to serve search requests from the available shards) but you will likely need to fix it ASAP since you have missing data.</p><p>Also from the above response, we can see a total of 1 node and that we have 0 shards since we have no data in it yet. Note that since we are using the default cluster name (elasticsearch) and since Elasticsearch uses multicast network discovery by default to find other nodes, it is possible that you could accidentally start up more than one node in your network and have them all join a single cluster. In this scenario, you may see more than 1 node in the above response.</p><p>We can also get a list of nodes in our cluster as follows:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/_cat/nodes?v'</pre></div><p>And the response:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/_cat/nodes?v'
host         ip        heap.percent ram.percent load node.role master name
mwubuntu1    127.0.1.1            8           4 0.00 d         *      New Goblin</pre></div><p>Here, we can see our one node named "New Goblin", which is the single node that is currently in our cluster.</p></div><div class="navfooter"><span class="prev"><a href="_exploring_your_cluster.html">
              «&nbsp;
              Exploring Your Cluster</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_list_all_indices.html">List All Indices
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-link"><a href="_exploring_your_cluster.html">Exploring Your Cluster</a></span> » <span class="breadcrumb-node">List All Indices</span></div><div class="navheader"><span class="prev"><a href="_cluster_health.html">
              «&nbsp;
              Cluster Health</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_create_an_index.html">Create an Index
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_list_all_indices"></a>List All Indices<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Now let’s take a peek at our indices:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/_cat/indices?v'</pre></div><p>And the response:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/_cat/indices?v'
health index pri rep docs.count docs.deleted store.size pri.store.size</pre></div><p>Which simply means we have no indices yet in the cluster.</p></div><div class="navfooter"><span class="prev"><a href="_cluster_health.html">
              «&nbsp;
              Cluster Health</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_create_an_index.html">Create an Index
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-link"><a href="_exploring_your_cluster.html">Exploring Your Cluster</a></span> » <span class="breadcrumb-node">Create an Index</span></div><div class="navheader"><span class="prev"><a href="_list_all_indices.html">
              «&nbsp;
              List All Indices</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_index_and_query_a_document.html">Index and Query a Document
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_create_an_index"></a>Create an Index<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Now let’s create an index named "customer" and then list all the indexes again:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'localhost:9200/customer?pretty'
curl 'localhost:9200/_cat/indices?v'</pre></div><p>The first command creates the index named "customer" using the PUT verb. We simply append <code class="literal">pretty</code> to the end of the call to tell it to pretty-print the JSON response (if any).</p><p>And the response:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'localhost:9200/customer?pretty'
{
  "acknowledged" : true
}

curl 'localhost:9200/_cat/indices?v'
health index    pri rep docs.count docs.deleted store.size pri.store.size
yellow customer   5   1          0            0       495b           495b</pre></div><p>The results of the second command tells us that we now have 1 index named customer and it has 5 primary shards and 1 replica (the defaults) and it contains 0 documents in it.</p><p>You might also notice that the customer index has a yellow health tagged to it. Recall from our previous discussion that yellow means that some replicas are not (yet) allocated. The reason this happens for this index is because Elasticsearch by default created one replica for this index. Since we only have one node running at the moment, that one replica cannot yet be allocated (for high availability) until a later point in time when another node joins the cluster. Once that replica gets allocated onto a second node, the health status for this index will turn to green.</p></div><div class="navfooter"><span class="prev"><a href="_list_all_indices.html">
              «&nbsp;
              List All Indices</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_index_and_query_a_document.html">Index and Query a Document
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-link"><a href="_exploring_your_cluster.html">Exploring Your Cluster</a></span> » <span class="breadcrumb-node">Index and Query a Document</span></div><div class="navheader"><span class="prev"><a href="_create_an_index.html">
              «&nbsp;
              Create an Index</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_delete_an_index.html">Delete an Index
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_index_and_query_a_document"></a>Index and Query a Document<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Let’s now put something into our customer index. Remember previously that in order to index a document, we must tell Elasticsearch which type in the index it should go to.</p><p>Let’s index a simple customer document into the customer index, "external" type, with an ID of 1 as follows:</p><p>Our JSON document: { "name": "John Doe" }</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'localhost:9200/customer/external/1?pretty' -d '
{
  "name": "John Doe"
}'</pre></div><p>And the response:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'localhost:9200/customer/external/1?pretty' -d '
{
  "name": "John Doe"
}'
{
  "_index" : "customer",
  "_type" : "external",
  "_id" : "1",
  "_version" : 1,
  "created" : true
}</pre></div><p>From the above, we can see that a new customer document was successfully created inside the customer index and the external type. The document also has an internal id of 1 which we specified at index time.</p><p>It is important to note that Elasticsearch does not require you to explicitly create an index first before you can index documents into it. In the previous example, Elasticsearch will automatically create the customer index if it didn’t already exist beforehand.</p><p>Let’s now retrieve that document that we just indexed:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/customer/external/1?pretty'</pre></div><p>And the response:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/customer/external/1?pretty'
{
  "_index" : "customer",
  "_type" : "external",
  "_id" : "1",
  "_version" : 1,
  "found" : true,
  "_source" : { "name": "John Doe" }
}</pre></div><p>Nothing out of the ordinary here other than a field, <code class="literal">found</code>, stating that we found a document with the requested ID 1 and another field, <code class="literal">_source</code>, which returns the full JSON document that we indexed from the previous step.</p></div><div class="navfooter"><span class="prev"><a href="_create_an_index.html">
              «&nbsp;
              Create an Index</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_delete_an_index.html">Delete an Index
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-link"><a href="_exploring_your_cluster.html">Exploring Your Cluster</a></span> » <span class="breadcrumb-node">Delete an Index</span></div><div class="navheader"><span class="prev"><a href="_index_and_query_a_document.html">
              «&nbsp;
              Index and Query a Document</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_modifying_your_data.html">Modifying Your Data
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_delete_an_index"></a>Delete an Index<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Now let’s delete the index that we just created and then list all the indexes again:</p><div class="pre_wrapper"><pre class="programlisting">curl -XDELETE 'localhost:9200/customer?pretty'
curl 'localhost:9200/_cat/indices?v'</pre></div><p>And the response:</p><div class="pre_wrapper"><pre class="programlisting">curl -XDELETE 'localhost:9200/customer?pretty'
{
  "acknowledged" : true
}
curl 'localhost:9200/_cat/indices?v'
health index pri rep docs.count docs.deleted store.size pri.store.size</pre></div><p>Which means that the index was deleted successfully and we are now back to where we started with nothing in our cluster.</p><p>Before we move on, let’s take a closer look again at some of the API commands that we have learned so far:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'localhost:9200/customer'
curl -XPUT 'localhost:9200/customer/external/1' -d '
{
  "name": "John Doe"
}'
curl 'localhost:9200/customer/external/1'
curl -XDELETE 'localhost:9200/customer'</pre></div><p>If we study the above commands carefully, we can actually see a pattern of how we access data in Elasticsearch. That pattern can be summarized as follows:</p><div class="pre_wrapper"><pre class="programlisting">curl -X&lt;REST Verb&gt; &lt;Node&gt;:&lt;Port&gt;/&lt;Index&gt;/&lt;Type&gt;/&lt;ID&gt;</pre></div><p>This REST access pattern is pervasive throughout all the API commands that if you can simply remember it, you will have a good head start at mastering Elasticsearch.</p></div><div class="navfooter"><span class="prev"><a href="_index_and_query_a_document.html">
              «&nbsp;
              Index and Query a Document</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_modifying_your_data.html">Modifying Your Data
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-node">Modifying Your Data</span></div><div class="navheader"><span class="prev"><a href="_delete_an_index.html">
              «&nbsp;
              Delete an Index</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_updating_documents.html">Updating Documents
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_modifying_your_data"></a>Modifying Your Data<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Elasticsearch provides data manipulation and search capabilities in near real time. By default, you can expect a one second delay (refresh interval) from the time you index/update/delete your data until the time that it appears in your search results. This is an important distinction from other platforms like SQL wherein data is immediately available after a transaction is completed.</p><h3><a id="_indexing_replacing_documents"></a>Indexing/Replacing Documents<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>We’ve previously seen how we can index a single document. Let’s recall that command again:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'localhost:9200/customer/external/1?pretty' -d '
{
  "name": "John Doe"
}'</pre></div><p>Again, the above will index the specified document into the customer index, external type, with the ID of 1. If we then executed the above command again with a different (or same) document, Elasticsearch will replace (i.e. reindex) a new document on top of the existing one with the ID of 1:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'localhost:9200/customer/external/1?pretty' -d '
{
  "name": "Jane Doe"
}'</pre></div><p>The above changes the name of the document with the ID of 1 from "John Doe" to "Jane Doe". If, on the other hand, we use a different ID, a new document will be indexed and the existing document(s) already in the index remains untouched.</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'localhost:9200/customer/external/2?pretty' -d '
{
  "name": "Jane Doe"
}'</pre></div><p>The above indexes a new document with an ID of 2.</p><p>When indexing, the ID part is optional. If not specified, Elasticsearch will generate a random ID and then use it to index the document. The actual ID Elasticsearch generates (or whatever we specified explicitly in the previous examples) is returned as part of the index API call.</p><p>This example shows how to index a document without an explicit ID:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/customer/external?pretty' -d '
{
  "name": "Jane Doe"
}'</pre></div><p>Note that in the above case, we are using the POST verb instead of PUT since we didn’t specify an ID.</p></div><div class="navfooter"><span class="prev"><a href="_delete_an_index.html">
              «&nbsp;
              Delete an Index</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_updating_documents.html">Updating Documents
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-link"><a href="_modifying_your_data.html">Modifying Your Data</a></span> » <span class="breadcrumb-node">Updating Documents</span></div><div class="navheader"><span class="prev"><a href="_modifying_your_data.html">
              «&nbsp;
              Modifying Your Data</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_deleting_documents.html">Deleting Documents
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_updating_documents"></a>Updating Documents<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>In addition to being able to index and replace documents, we can also update documents. Note though that Elasticsearch does not actually do in-place updates under the hood. Whenever we do an update, Elasticsearch deletes the old document and then indexes a new document with the update applied to it in one shot.</p><p>This example shows how to update our previous document (ID of 1) by changing the name field to "Jane Doe":</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/customer/external/1/_update?pretty' -d '
{
  "doc": { "name": "Jane Doe" }
}'</pre></div><p>This example shows how to update our previous document (ID of 1) by changing the name field to "Jane Doe" and at the same time add an age field to it:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/customer/external/1/_update?pretty' -d '
{
  "doc": { "name": "Jane Doe", "age": 20 }
}'</pre></div><p>Updates can also be performed by using simple scripts. Note that dynamic scripts like the following are disabled by default as of <code class="literal">1.4.3</code>, have a look at the <a class="link" href="modules-scripting.html" title="Scripting">scripting docs</a> for more details. This example uses a script to increment the age by 5:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/customer/external/1/_update?pretty' -d '
{
  "script" : "ctx._source.age += 5"
}'</pre></div><p>In the above example, <code class="literal">ctx._source</code> refers to the current source document that is about to be updated.</p><p>Note that as of this writing, updates can only be performed on a single document at a time. In the future, Elasticsearch might provide the ability to update multiple documents given a query condition (like an <code class="literal">SQL UPDATE-WHERE</code> statement).</p></div><div class="navfooter"><span class="prev"><a href="_modifying_your_data.html">
              «&nbsp;
              Modifying Your Data</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_deleting_documents.html">Deleting Documents
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-link"><a href="_modifying_your_data.html">Modifying Your Data</a></span> » <span class="breadcrumb-node">Deleting Documents</span></div><div class="navheader"><span class="prev"><a href="_updating_documents.html">
              «&nbsp;
              Updating Documents</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_batch_processing.html">Batch Processing
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_deleting_documents"></a>Deleting Documents<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Deleting a document is fairly straightforward. This example shows how to delete our previous customer with the ID of 2:</p><div class="pre_wrapper"><pre class="programlisting">curl -XDELETE 'localhost:9200/customer/external/2?pretty'</pre></div><p>We also have the ability to delete multiple documents that match a query condition. This example shows how to delete all customers whose names contain "John":</p><div class="pre_wrapper"><pre class="programlisting">curl -XDELETE 'localhost:9200/customer/external/_query?pretty' -d '
{
  "query": { "match": { "name": "John" } }
}'</pre></div><p>Note above that the URI has changed to <code class="literal">/_query</code> to signify a delete-by-query API with the delete query criteria in the body, but we are still using the DELETE verb. Don’t worry yet about the query syntax as we will cover that later in this tutorial.</p></div><div class="navfooter"><span class="prev"><a href="_updating_documents.html">
              «&nbsp;
              Updating Documents</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_batch_processing.html">Batch Processing
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-link"><a href="_modifying_your_data.html">Modifying Your Data</a></span> » <span class="breadcrumb-node">Batch Processing</span></div><div class="navheader"><span class="prev"><a href="_deleting_documents.html">
              «&nbsp;
              Deleting Documents</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_exploring_your_data.html">Exploring Your Data
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_batch_processing"></a>Batch Processing<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>In addition to being able to index, update, and delete individual documents, Elasticsearch also provides the ability to perform any of the above operations in batches using the <a class="link" href="docs-bulk.html" title="Bulk API"><code class="literal">_bulk</code> API</a>. This functionality is important in that it provides a very efficient mechanism to do multiple operations as fast as possible with as little network roundtrips as possible.</p><p>As a quick example, the following call indexes two documents (ID 1 - John Doe and ID 2 - Jane Doe) in one bulk operation:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/customer/external/_bulk?pretty' -d '
{"index":{"_id":"1"}}
{"name": "John Doe" }
{"index":{"_id":"2"}}
{"name": "Jane Doe" }
'</pre></div><p>This example updates the first document (ID of 1) and then deletes the second document (ID of 2) in one bulk operation:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/customer/external/_bulk?pretty' -d '
{"update":{"_id":"1"}}
{"doc": { "name": "John Doe becomes Jane Doe" } }
{"delete":{"_id":"2"}}
'</pre></div><p>Note above that for the delete action, there is no corresponding source document after it since deletes only require the ID of the document to be deleted.</p><p>The bulk API executes all the actions sequentially and in order. If a single action fails for whatever reason, it will continue to process the remainder of the actions after it. When the bulk API returns, it will provide a status for each action (in the same order it was sent in) so that you can check if a specific action failed or not.</p></div><div class="navfooter"><span class="prev"><a href="_deleting_documents.html">
              «&nbsp;
              Deleting Documents</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_exploring_your_data.html">Exploring Your Data
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-node">Exploring Your Data</span></div><div class="navheader"><span class="prev"><a href="_batch_processing.html">
              «&nbsp;
              Batch Processing</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_the_search_api.html">The Search API
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_exploring_your_data"></a>Exploring Your Data<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><h3><a id="_sample_dataset"></a>Sample Dataset<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Now that we’ve gotten a glimpse of the basics, let’s try to work on a more realistic dataset. I’ve prepared a sample of fictitious JSON documents of customer bank account information. Each document has the following schema:</p><div class="pre_wrapper"><pre class="programlisting">{
    "account_number": 0,
    "balance": 16623,
    "firstname": "Bradshaw",
    "lastname": "Mckenzie",
    "age": 29,
    "gender": "F",
    "address": "244 Columbus Place",
    "employer": "Euron",
    "email": "bradshawmckenzie@euron.com",
    "city": "Hobucken",
    "state": "CO"
}</pre></div><p>For the curious, I generated this data from <a class="ulink" href="http://www.json-generator.com/" target="_top"><code class="literal">www.json-generator.com/</code></a> so please ignore the actual values and semantics of the data as these are all randomly generated.</p><h3><a id="_loading_the_sample_dataset"></a>Loading the Sample Dataset<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>You can download the sample dataset (accounts.json) from <a class="ulink" href="https://github.com/bly2k/files/blob/master/accounts.zip?raw=true" target="_top">here</a>. Extract it to our current directory and let’s load it into our cluster as follows:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/account/_bulk?pretty' --data-binary "@accounts.json"
curl 'localhost:9200/_cat/indices?v'</pre></div><p>And the response:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/_cat/indices?v'
health index pri rep docs.count docs.deleted store.size pri.store.size
yellow bank    5   1       1000            0    424.4kb        424.4kb</pre></div><p>Which means that we just successfully bulk indexed 1000 documents into the bank index (under the account type).</p></div><div class="navfooter"><span class="prev"><a href="_batch_processing.html">
              «&nbsp;
              Batch Processing</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_the_search_api.html">The Search API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-link"><a href="_exploring_your_data.html">Exploring Your Data</a></span> » <span class="breadcrumb-node">The Search API</span></div><div class="navheader"><span class="prev"><a href="_exploring_your_data.html">
              «&nbsp;
              Exploring Your Data</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_introducing_the_query_language.html">Introducing the Query Language
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_the_search_api"></a>The Search API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Now let’s start with some simple searches. There are two basic ways to run searches: one is by sending search parameters through the <a class="link" href="search-uri-request.html" title="URI Search">REST request URI</a> and the other by sending them through the <a class="link" href="search-request-body.html" title="Request Body Search">REST request body</a>. The request body method allows you to be more expressive and also to define your searches in a more readable JSON format. We’ll try one example of the request URI method but for the remainder of this tutorial, we will exclusively be using the request body method.</p><p>The REST API for search is accessible from the <code class="literal">_search</code> endpoint. This example returns all documents in the bank index:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/bank/_search?q=*&amp;pretty'</pre></div><p>Let’s first dissect the search call. We are searching (<code class="literal">_search</code> endpoint) in the bank index, and the <code class="literal">q=*</code> parameter instructs Elasticsearch to match all documents in the index. The <code class="literal">pretty</code> parameter, again, just tells Elasticsearch to return pretty-printed JSON results.</p><p>And the response (partially shown):</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/bank/_search?q=*&amp;pretty'
{
  "took" : 63,
  "timed_out" : false,
  "_shards" : {
    "total" : 5,
    "successful" : 5,
    "failed" : 0
  },
  "hits" : {
    "total" : 1000,
    "max_score" : 1.0,
    "hits" : [ {
      "_index" : "bank",
      "_type" : "account",
      "_id" : "1",
      "_score" : 1.0, "_source" : {"account_number":1,"balance":39225,"firstname":"Amber","lastname":"Duke","age":32,"gender":"M","address":"880 Holmes Lane","employer":"Pyrami","email":"amberduke@pyrami.com","city":"Brogan","state":"IL"}
    }, {
      "_index" : "bank",
      "_type" : "account",
      "_id" : "6",
      "_score" : 1.0, "_source" : {"account_number":6,"balance":5686,"firstname":"Hattie","lastname":"Bond","age":36,"gender":"M","address":"671 Bristol Street","employer":"Netagy","email":"hattiebond@netagy.com","city":"Dante","state":"TN"}
    }, {
      "_index" : "bank",
      "_type" : "account",</pre></div><p>As for the response, we see the following parts:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">took</code> – time in milliseconds for Elasticsearch to execute the search
</li><li class="listitem">
<code class="literal">timed_out</code> – tells us if the search timed out or not
</li><li class="listitem">
<code class="literal">_shards</code> – tells us how many shards were searched, as well as a count of the successful/failed searched shards
</li><li class="listitem">
<code class="literal">hits</code> – search results
</li><li class="listitem">
<code class="literal">hits.total</code> – total number of documents matching our search criteria
</li><li class="listitem">
<code class="literal">hits.hits</code> – actual array of search results (defaults to first 10 documents)
</li><li class="listitem">
<code class="literal">_score</code> and <code class="literal">max_score</code> - ignore these fields for now
</li></ul></div><p>Here is the same exact search above using the alternative request body method:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match_all": {} }
}'</pre></div><p>The difference here is that instead of passing <code class="literal">q=*</code> in the URI, we POST a JSON-style query request body to the <code class="literal">_search</code> API. We’ll discuss this JSON query in the next section.</p><p>And the response (partially shown):</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match_all": {} }
}'
{
  "took" : 26,
  "timed_out" : false,
  "_shards" : {
    "total" : 5,
    "successful" : 5,
    "failed" : 0
  },
  "hits" : {
    "total" : 1000,
    "max_score" : 1.0,
    "hits" : [ {
      "_index" : "bank",
      "_type" : "account",
      "_id" : "1",
      "_score" : 1.0, "_source" : {"account_number":1,"balance":39225,"firstname":"Amber","lastname":"Duke","age":32,"gender":"M","address":"880 Holmes Lane","employer":"Pyrami","email":"amberduke@pyrami.com","city":"Brogan","state":"IL"}
    }, {
      "_index" : "bank",
      "_type" : "account",
      "_id" : "6",
      "_score" : 1.0, "_source" : {"account_number":6,"balance":5686,"firstname":"Hattie","lastname":"Bond","age":36,"gender":"M","address":"671 Bristol Street","employer":"Netagy","email":"hattiebond@netagy.com","city":"Dante","state":"TN"}
    }, {
      "_index" : "bank",
      "_type" : "account",
      "_id" : "13",</pre></div><p>It is important to understand that once you get your search results back, Elasticsearch is completely done with the request and does not maintain any kind of server-side resources or open cursors into your results. This is in stark contrast to many other platforms such as SQL wherein you may initially get a partial subset of your query results up-front and then you have to continuously go back to the server if you want to fetch (or page through) the rest of the results using some kind of stateful server-side cursor.</p></div><div class="navfooter"><span class="prev"><a href="_exploring_your_data.html">
              «&nbsp;
              Exploring Your Data</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_introducing_the_query_language.html">Introducing the Query Language
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-link"><a href="_exploring_your_data.html">Exploring Your Data</a></span> » <span class="breadcrumb-node">Introducing the Query Language</span></div><div class="navheader"><span class="prev"><a href="_the_search_api.html">
              «&nbsp;
              The Search API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_executing_searches.html">Executing Searches
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_introducing_the_query_language"></a>Introducing the Query Language<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Elasticsearch provides a JSON-style domain-specific language that you can use to execute queries. This is referred to as the <a class="link" href="query-dsl.html" title="Query DSL">Query DSL</a>. The query language is quite comprehensive and can be intimidating at first glance but the best way to actually learn it is to start with a few basic examples.</p><p>Going back to our last example, we executed this query:</p><div class="pre_wrapper"><pre class="programlisting">{
  "query": { "match_all": {} }
}</pre></div><p>Dissecting the above, the <code class="literal">query</code> part tells us what our query definition is and the <code class="literal">match_all</code> part is simply the type of query that we want to run. The <code class="literal">match_all</code> query is simply a search for all documents in the specified index.</p><p>In addition to the <code class="literal">query</code> parameter, we also can pass other parameters to influence the search results. For example, the following does a <code class="literal">match_all</code> and returns only the first document:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match_all": {} },
  "size": 1
}'</pre></div><p>Note that if <code class="literal">size</code> is not specified, it defaults to 10.</p><p>This example does a <code class="literal">match_all</code> and returns documents 11 through 20:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match_all": {} },
  "from": 10,
  "size": 10
}'</pre></div><p>The <code class="literal">from</code> parameter (0-based) specifies which document index to start from and the <code class="literal">size</code> parameter specifies how many documents to return starting at the from parameter. This feature is useful when implementing paging of search results. Note that if <code class="literal">from</code> is not specified, it defaults to 0.</p><p>This example does a <code class="literal">match_all</code> and sorts the results by account balance in descending order and returns the top 10 (default size) documents.</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match_all": {} },
  "sort": { "balance": { "order": "desc" } }
}'</pre></div></div><div class="navfooter"><span class="prev"><a href="_the_search_api.html">
              «&nbsp;
              The Search API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_executing_searches.html">Executing Searches
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-link"><a href="_exploring_your_data.html">Exploring Your Data</a></span> » <span class="breadcrumb-node">Executing Searches</span></div><div class="navheader"><span class="prev"><a href="_introducing_the_query_language.html">
              «&nbsp;
              Introducing the Query Language</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_executing_filters.html">Executing Filters
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_executing_searches"></a>Executing Searches<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Now that we have seen a few of the basic search parameters, let’s dig in some more into the Query DSL. Let’s first take a look at the returned document fields. By default, the full JSON document is returned as part of all searches. This is referred to as the source (<code class="literal">_source</code> field in the search hits). If we don’t want the entire source document returned, we have the ability to request only a few fields from within source to be returned.</p><p>This example shows how to return two fields, <code class="literal">account_number</code> and <code class="literal">balance</code> (inside of <code class="literal">_source</code>), from the search:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match_all": {} },
  "_source": ["account_number", "balance"]
}'</pre></div><p>Note that the above example simply reduces the <code class="literal">_source</code> field. It will still only return one field named <code class="literal">_source</code> but within it, only the fields <code class="literal">account_number</code> and <code class="literal">balance</code> are included.</p><p>If you come from a SQL background, the above is somewhat similar in concept to the <code class="literal">SQL SELECT FROM</code> field list.</p><p>Now let’s move on to the query part. Previously, we’ve seen how the <code class="literal">match_all</code> query is used to match all documents. Let’s now introduce a new query called the <a class="link" href="query-dsl-match-query.html" title="Match Query"><code class="literal">match</code> query</a>, which can be thought of as a basic fielded search query (i.e. a search done against a specific field or set of fields).</p><p>This example returns the account numbered 20:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match": { "account_number": 20 } }
}'</pre></div><p>This example returns all accounts containing the term "mill" in the address:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match": { "address": "mill" } }
}'</pre></div><p>This example returns all accounts containing the term "mill" or "lane" in the address:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match": { "address": "mill lane" } }
}'</pre></div><p>This example is a variant of <code class="literal">match</code> (<code class="literal">match_phrase</code>) that returns all accounts containing the phrase "mill lane" in the address:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": { "match_phrase": { "address": "mill lane" } }
}'</pre></div><p>Let’s now introduce the <a class="link" href="query-dsl-bool-query.html" title="Bool Query"><code class="literal">bool</code>(ean) query</a>. The <code class="literal">bool</code> query allows us to compose smaller queries into bigger queries using boolean logic.</p><p>This example composes two <code class="literal">match</code> queries and returns all accounts containing "mill" and "lane" in the address:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": {
    "bool": {
      "must": [
        { "match": { "address": "mill" } },
        { "match": { "address": "lane" } }
      ]
    }
  }
}'</pre></div><p>In the above example, the <code class="literal">bool must</code> clause specifies all the queries that must be true for a document to be considered a match.</p><p>In contrast, this example composes two <code class="literal">match</code> queries and returns all accounts containing "mill" or "lane" in the address:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": {
    "bool": {
      "should": [
        { "match": { "address": "mill" } },
        { "match": { "address": "lane" } }
      ]
    }
  }
}'</pre></div><p>In the above example, the <code class="literal">bool should</code> clause specifies a list of queries either of which must be true for a document to be considered a match.</p><p>This example composes two <code class="literal">match</code> queries and returns all accounts that contain neither "mill" nor "lane" in the address:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": {
    "bool": {
      "must_not": [
        { "match": { "address": "mill" } },
        { "match": { "address": "lane" } }
      ]
    }
  }
}'</pre></div><p>In the above example, the <code class="literal">bool must_not</code> clause specifies a list of queries none of which must be true for a document to be considered a match.</p><p>We can combine <code class="literal">must</code>, <code class="literal">should</code>, and <code class="literal">must_not</code> clauses simultaneously inside a <code class="literal">bool</code> query. Furthermore, we can compose <code class="literal">bool</code> queries inside any of these <code class="literal">bool</code> clauses to mimic any complex multi-level boolean logic.</p><p>This example returns all accounts of anybody who is 40 years old but don’t live in ID(aho):</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": {
    "bool": {
      "must": [
        { "match": { "age": "40" } }
      ],
      "must_not": [
        { "match": { "state": "ID" } }
      ]
    }
  }
}'</pre></div></div><div class="navfooter"><span class="prev"><a href="_introducing_the_query_language.html">
              «&nbsp;
              Introducing the Query Language</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_executing_filters.html">Executing Filters
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-link"><a href="_exploring_your_data.html">Exploring Your Data</a></span> » <span class="breadcrumb-node">Executing Filters</span></div><div class="navheader"><span class="prev"><a href="_executing_searches.html">
              «&nbsp;
              Executing Searches</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_executing_aggregations.html">Executing Aggregations
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_executing_filters"></a>Executing Filters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>In the previous section, we skipped over a little detail called the document score (<code class="literal">_score</code> field in the search results). The score is a numeric value that is a relative measure of how well the document matches the search query that we specified. The higher the score, the more relevant the document is, the lower the score, the less relevant the document is.</p><p>All queries in Elasticsearch trigger computation of the relevance scores. In cases where we do not need the relevance scores, Elasticsearch provides another query capability in the form of <a class="link" href="query-dsl-filters.html" title="Filters">filters</a>. Filters are similar in concept to queries except that they are optimized for much faster execution speeds for two primary reasons:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Filters do not score so they are faster to execute than queries
</li><li class="listitem">
Filters can be <a class="ulink" href="http://www.elastic.co/blog/all-about-elasticsearch-filter-bitsets/" target="_top">cached in memory</a> allowing repeated search executions to be significantly faster than queries
</li></ul></div><p>To understand filters, let’s first introduce the <a class="link" href="query-dsl-filtered-query.html" title="Filtered Query"><code class="literal">filtered</code> query</a>, which allows you to combine a query (like <code class="literal">match_all</code>, <code class="literal">match</code>, <code class="literal">bool</code>, etc.) together with a filter. As an example, let’s introduce the <a class="link" href="query-dsl-range-filter.html" title="Range Filter"><code class="literal">range</code> filter</a>, which allows us to filter documents by a range of values. This is generally used for numeric or date filtering.</p><p>This example uses a filtered query to return all accounts with balances between 20000 and 30000, inclusive. In other words, we want to find accounts with a balance that is greater than or equal to 20000 and less than or equal to 30000.</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "query": {
    "filtered": {
      "query": { "match_all": {} },
      "filter": {
        "range": {
          "balance": {
            "gte": 20000,
            "lte": 30000
          }
        }
      }
    }
  }
}'</pre></div><p>Dissecting the above, the filtered query contains a <code class="literal">match_all</code> query (the query part) and a <code class="literal">range</code> filter (the filter part). We can substitute any other query into the query part as well as any other filter into the filter part. In the above case, the range filter makes perfect sense since documents falling into the range all match "equally", i.e., no document is more relevant than another.</p><p>In general, the easiest way to decide whether you want a filter or a query is to ask yourself if you care about the relevance score or not. If relevance is not important, use filters, otherwise, use queries. If you come from a SQL background, queries and filters are similar in concept to the <code class="literal">SELECT WHERE</code> clause, although more so for filters than queries.</p><p>In addition to the <code class="literal">match_all</code>, <code class="literal">match</code>, <code class="literal">bool</code>, <code class="literal">filtered</code>, and <code class="literal">range</code> queries, there are a lot of other query/filter types that are available and we won’t go into them here. Since we already have a basic understanding of how they work, it shouldn’t be too difficult to apply this knowledge in learning and experimenting with the other query/filter types.</p></div><div class="navfooter"><span class="prev"><a href="_executing_searches.html">
              «&nbsp;
              Executing Searches</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_executing_aggregations.html">Executing Aggregations
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-link"><a href="_exploring_your_data.html">Exploring Your Data</a></span> » <span class="breadcrumb-node">Executing Aggregations</span></div><div class="navheader"><span class="prev"><a href="_executing_filters.html">
              «&nbsp;
              Executing Filters</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_conclusion.html">Conclusion
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_executing_aggregations"></a>Executing Aggregations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Aggregations provide the ability to group and extract statistics from your data. The easiest way to think about aggregations is by roughly equating it to the SQL GROUP BY and the SQL aggregate functions. In Elasticsearch, you have the ability to execute searches returning hits and at the same time return aggregated results separate from the hits all in one response. This is very powerful and efficient in the sense that you can run queries and multiple aggregations and get the results back of both (or either) operations in one shot avoiding network roundtrips using a concise and simplified API.</p><p>To start with, this example groups all the accounts by state, and then returns the top 10 (default) states sorted by count descending (also default):</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "size": 0,
  "aggs": {
    "group_by_state": {
      "terms": {
        "field": "state"
      }
    }
  }
}'</pre></div><p>In SQL, the above aggregation is similar in concept to:</p><div class="pre_wrapper"><pre class="programlisting">SELECT state, COUNT(*) FROM bank GROUP BY state ORDER BY COUNT(*) DESC</pre></div><p>And the response (partially shown):</p><div class="pre_wrapper"><pre class="programlisting">  "hits" : {
    "total" : 1000,
    "max_score" : 0.0,
    "hits" : [ ]
  },
  "aggregations" : {
    "group_by_state" : {
      "buckets" : [ {
        "key" : "al",
        "doc_count" : 21
      }, {
        "key" : "tx",
        "doc_count" : 17
      }, {
        "key" : "id",
        "doc_count" : 15
      }, {
        "key" : "ma",
        "doc_count" : 15
      }, {
        "key" : "md",
        "doc_count" : 15
      }, {
        "key" : "pa",
        "doc_count" : 15
      }, {
        "key" : "dc",
        "doc_count" : 14
      }, {
        "key" : "me",
        "doc_count" : 14
      }, {
        "key" : "mo",
        "doc_count" : 14
      }, {
        "key" : "nd",
        "doc_count" : 14
      } ]
    }
  }
}</pre></div><p>We can see that there are 21 accounts in AL(abama), followed by 17 accounts in TX, followed by 15 accounts in ID(aho), and so forth.</p><p>Note that we set <code class="literal">size=0</code> to not show search hits because we only want to see the aggregation results in the response.</p><p>Building on the previous aggregation, this example calculates the average account balance by state (again only for the top 10 states sorted by count in descending order):</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "size": 0,
  "aggs": {
    "group_by_state": {
      "terms": {
        "field": "state"
      },
      "aggs": {
        "average_balance": {
          "avg": {
            "field": "balance"
          }
        }
      }
    }
  }
}'</pre></div><p>Notice how we nested the <code class="literal">average_balance</code> aggregation inside the <code class="literal">group_by_state</code> aggregation. This is a common pattern for all the aggregations. You can nest aggregations inside aggregations arbitrarily to extract pivoted summarizations that you require from your data.</p><p>Building on the previous aggregation, let’s now sort on the average balance in descending order:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "size": 0,
  "aggs": {
    "group_by_state": {
      "terms": {
        "field": "state",
        "order": {
          "average_balance": "desc"
        }
      },
      "aggs": {
        "average_balance": {
          "avg": {
            "field": "balance"
          }
        }
      }
    }
  }
}'</pre></div><p>This example demonstrates how we can group by age brackets (ages 20-29, 30-39, and 40-49), then by gender, and then finally get the average account balance, per age bracket, per gender:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/bank/_search?pretty' -d '
{
  "size": 0,
  "aggs": {
    "group_by_age": {
      "range": {
        "field": "age",
        "ranges": [
          {
            "from": 20,
            "to": 30
          },
          {
            "from": 30,
            "to": 40
          },
          {
            "from": 40,
            "to": 50
          }
        ]
      },
      "aggs": {
        "group_by_gender": {
          "terms": {
            "field": "gender"
          },
          "aggs": {
            "average_balance": {
              "avg": {
                "field": "balance"
              }
            }
          }
        }
      }
    }
  }
}'</pre></div><p>There are a many other aggregations capabilities that we won’t go into detail here. The <a class="link" href="search-aggregations.html" title="Aggregations">aggregations reference guide</a> is a great starting point if you want to do further experimentation.</p></div><div class="navfooter"><span class="prev"><a href="_executing_filters.html">
              «&nbsp;
              Executing Filters</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_conclusion.html">Conclusion
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="getting-started.html">Getting Started</a></span> » <span class="breadcrumb-node">Conclusion</span></div><div class="navheader"><span class="prev"><a href="_executing_aggregations.html">
              «&nbsp;
              Executing Aggregations</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="setup.html">Setup
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="_conclusion"></a>Conclusion<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/getting-started.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Elasticsearch is both a simple and complex product. We’ve so far learned the basics of what it is, how to look inside of it, and how to work with it using some of the REST APIs. I hope that this tutorial has given you a better understanding of what Elasticsearch is and more importantly, inspired you to further experiment with the rest of its great features!</p></div><div class="navfooter"><span class="prev"><a href="_executing_aggregations.html">
              «&nbsp;
              Executing Aggregations</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="setup.html">Setup
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-node">Setup</span></div><div class="navheader"><span class="prev"><a href="_conclusion.html">
              «&nbsp;
              Conclusion</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="setup-configuration.html">Configuration
              &nbsp;»
            </a></span></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="setup"></a>Setup<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><div class="partintro"><div></div><p>This section includes information on how to setup <span class="strong emphasis"><strong>elasticsearch</strong></span> and
get it running. If you haven’t already, <a class="ulink" href="http://www.elastic.co/downloads" target="_top">download</a> it, and
then check the <a class="link" href="setup.html#setup-installation" title="Installationedit">installation</a> docs.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Elasticsearch can also be installed from our repositories using <code class="literal">apt</code> or <code class="literal">yum</code>.
See <a class="xref" href="setup-repositories.html" title="Repositories"><em>Repositories</em></a>.</p></div></div><h2><a id="setup-installation"></a>Installation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><p>After <a class="ulink" href="/download" target="_top">downloading</a> the latest release and extracting it,
<span class="strong emphasis"><strong>elasticsearch</strong></span> can be started using:</p><div class="pre_wrapper"><pre class="programlisting">$ bin/elasticsearch</pre></div><p>Under *nix system, the command will start the process in the foreground.
To run it in the background, add the <code class="literal">-d</code> switch to it:</p><div class="pre_wrapper"><pre class="programlisting">$ bin/elasticsearch -d</pre></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>*NIX</strong></p></div></div></div><p>There are added features when using the <code class="literal">elasticsearch</code> shell script.
The first, which was explained earlier, is the ability to easily run the
process either in the foreground or the background.</p><p>Another feature is the ability to pass <code class="literal">-X</code> and <code class="literal">-D</code> or getopt long style
configuration parameters directly to the script. When set, all override
anything set using either <code class="literal">JAVA_OPTS</code> or <code class="literal">ES_JAVA_OPTS</code>. For example:</p><div class="pre_wrapper"><pre class="programlisting">$ bin/elasticsearch -Xmx2g -Xms2g -Des.index.store.type=memory --node.name=my-node</pre></div></div><h2><a id="jvm-version"></a>Java (JVM) version<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><p>Elasticsearch is built using Java, and requires at least
<a class="ulink" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_top">Java 7</a> in
order to run. Only Oracle’s Java and the OpenJDK are supported. The same JVM
version should be used on all Elasticsearch nodes and clients.</p><p>We recommend installing the <span class="strong emphasis"><strong>Java 8 update 20 or later</strong></span>, or <span class="strong emphasis"><strong>Java 7 update 55
or later</strong></span>.  Previous versions of Java 7 are known to have bugs that can cause
index corruption and data loss.  Elasticsearch will refuse to start if a
known-bad version of Java is used.</p><p>The version of Java to use can be configured by setting the <code class="literal">JAVA_HOME</code>
environment variable.</p></div></div><div class="navfooter"><span class="prev"><a href="_conclusion.html">
              «&nbsp;
              Conclusion</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="setup-configuration.html">Configuration
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="setup.html">Setup</a></span> » <span class="breadcrumb-node">Configuration</span></div><div class="navheader"><span class="prev"><a href="setup.html">
              «&nbsp;
              Setup</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="setup-service.html">Running as a Service on Linux
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="setup-configuration"></a>Configuration<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/configuration.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><h3><a id="_environment_variables"></a>Environment Variables<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/configuration.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Within the scripts, Elasticsearch comes with built in <code class="literal">JAVA_OPTS</code> passed
to the JVM started. The most important setting for that is the <code class="literal">-Xmx</code> to
control the maximum allowed memory for the process, and <code class="literal">-Xms</code> to
control the minimum allocated memory for the process (<span class="emphasis"><em>in general, the
more memory allocated to the process, the better</em></span>).</p><p>Most times it is better to leave the default <code class="literal">JAVA_OPTS</code> as they are,
and use the <code class="literal">ES_JAVA_OPTS</code> environment variable in order to set / change
JVM settings or arguments.</p><p>The <code class="literal">ES_HEAP_SIZE</code> environment variable allows to set the heap memory
that will be allocated to elasticsearch java process. It will allocate
the same value to both min and max values, though those can be set
explicitly (not recommended) by setting <code class="literal">ES_MIN_MEM</code> (defaults to
<code class="literal">256m</code>), and <code class="literal">ES_MAX_MEM</code> (defaults to <code class="literal">1g</code>).</p><p>It is recommended to set the min and max memory to the same value, and
enable <a class="link" href="setup-configuration.html#setup-configuration-memory" title="Memory Settingsedit"><code class="literal">mlockall</code></a>.</p><h3><a id="system"></a>System Configuration<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/configuration.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><h4><a id="file-descriptors"></a>File Descriptors<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/configuration.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Make sure to increase the number of open files descriptors on the
machine (or for the user running elasticsearch). Setting it to 32k or
even 64k is recommended.</p><p>In order to test how many open files the process can open, start it with
<code class="literal">-Des.max-open-files</code> set to <code class="literal">true</code>. This will print the number of open
files the process can open on startup.</p><p>Alternatively, you can retrieve the <code class="literal">max_file_descriptors</code> for each node
using the <a class="xref" href="cluster-nodes-info.html" title="Nodes Info"><em>Nodes Info</em></a> API, with:</p><div class="pre_wrapper"><pre class="programlisting">curl localhost:9200/_nodes/process?pretty</pre></div><h4><a id="vm-max-map-count"></a>Virtual memory<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/configuration.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Elasticsearch uses a <a class="link" href="index-modules-store.html#default_fs" title="Hybrid MMap / NIO FSedit"><code class="literal">hybrid mmapfs / niofs</code></a> directory by default to store its indices.  The default
operating system limits on mmap counts is likely to be too low, which may
result in out of memory exceptions.  On Linux, you can increase the limits by
running the following command as <code class="literal">root</code>:</p><div class="pre_wrapper"><pre class="programlisting">sysctl -w vm.max_map_count=262144</pre></div><p>To set this value permanently, update the <code class="literal">vm.max_map_count</code> setting in
<code class="literal">/etc/sysctl.conf</code>.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>If you installed Elasticsearch using a package (.deb, .rpm) this setting will be changed automatically.  To verify, run <code class="literal">sysctl vm.max_map_count</code>.</p></div></div><h4><a id="setup-configuration-memory"></a>Memory Settings<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/configuration.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Most operating systems try to use as much memory as possible for file system
caches and eagerly swap out unused application memory, possibly resulting
in the elasticsearch process being swapped. Swapping is very bad for
performance and for node stability, so it should be avoided at all costs.</p><p>There are three options:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
<span class="strong emphasis"><strong>Disable swap</strong></span>
</p><p class="simpara">The simplest option is to completely disable swap. Usually Elasticsearch
is the only service running on a box, and its memory usage is controlled
by the <code class="literal">ES_HEAP_SIZE</code> environment variable.  There should be no need
to have swap enabled.</p><p class="simpara">On Linux systems, you can disable swap temporarily
by running: <code class="literal">sudo swapoff -a</code>. To disable it permanently, you will need
to edit the <code class="literal">/etc/fstab</code> file and comment out any lines that contain the
word <code class="literal">swap</code>.</p><p class="simpara">On Windows, the equivalent can be achieved by disabling the paging file entirely
via <code class="literal">System Properties → Advanced → Performance → Advanced → Virtual memory</code>.</p></li><li class="listitem"><p class="simpara">
<span class="strong emphasis"><strong>Configure <code class="literal">swappiness</code></strong></span>
</p><p class="simpara">The second option is to ensure that the sysctl value <code class="literal">vm.swappiness</code> is set
to <code class="literal">0</code>. This reduces the kernel’s tendency to swap and should not lead to
swapping under normal circumstances, while still allowing the whole system
to swap in emergency conditions.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>From kernel version 3.5-rc1 and above, a <code class="literal">swappiness</code> of <code class="literal">0</code> will
cause the OOM killer to kill the process instead of allowing swapping.
You will need to set <code class="literal">swappiness</code> to <code class="literal">1</code> to still allow swapping in
emergencies.</p></div></div></li><li class="listitem"><p class="simpara">
<span class="strong emphasis"><strong><code class="literal">mlockall</code></strong></span>
</p><p class="simpara">The third option is to use
<a class="ulink" href="http://opengroup.org/onlinepubs/007908799/xsh/mlockall.html" target="_top">mlockall</a> on Linux/Unix systems, or <a class="ulink" href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa366895%28v=vs.85%29.aspx" target="_top">VirtualLock</a> on Windows, to
try to lock the process address space into RAM, preventing any Elasticsearch
memory from being swapped out.  This can be done, by adding this line
to the <code class="literal">config/elasticsearch.yml</code> file:</p><div class="pre_wrapper"><pre class="programlisting">bootstrap.mlockall: true</pre></div><p class="simpara">After starting Elasticsearch, you can see whether this setting was applied
successfully by checking the value of <code class="literal">mlockall</code> in the output from this
request:</p><div class="pre_wrapper"><pre class="programlisting">curl http://localhost:9200/_nodes/process?pretty</pre></div><p class="simpara">If you see that <code class="literal">mlockall</code> is <code class="literal">false</code>, then it means that the the <code class="literal">mlockall</code>
request has failed.  The most probable reason, on Linux/Unix systems, is that
the user running Elasticsearch doesn’t have permission to lock memory.  This can
be granted by running <code class="literal">ulimit -l unlimited</code> as <code class="literal">root</code> before starting Elasticsearch.</p><p class="simpara">Another possible reason why <code class="literal">mlockall</code> can fail is that the temporary directory
(usually <code class="literal">/tmp</code>) is mounted with the <code class="literal">noexec</code> option. This can be solved by
specifying a new temp directory, by starting Elasticsearch with:</p><div class="pre_wrapper"><pre class="programlisting">./bin/elasticsearch -Djna.tmpdir=/path/to/new/dir</pre></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p><code class="literal">mlockall</code> might cause the JVM or shell session to exit if it tries
to allocate more memory than is available!</p></div></div></li></ul></div><h3><a id="settings"></a>Elasticsearch Settings<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/configuration.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p><span class="strong emphasis"><strong>elasticsearch</strong></span> configuration files can be found under <code class="literal">ES_HOME/config</code>
folder. The folder comes with two files, the <code class="literal">elasticsearch.yml</code> for
configuring Elasticsearch different
<a class="link" href="modules.html" title="Modules">modules</a>, and <code class="literal">logging.yml</code> for
configuring the Elasticsearch logging.</p><p>The configuration format is <a class="ulink" href="http://www.yaml.org/" target="_top">YAML</a>. Here is an
example of changing the address all network based modules will use to
bind and publish to:</p><div class="pre_wrapper"><pre class="programlisting">network :
    host : 10.0.0.4</pre></div><h4><a id="paths"></a>Paths<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/configuration.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>In production use, you will almost certainly want to change paths for
data and log files:</p><div class="pre_wrapper"><pre class="programlisting">path:
  logs: /var/log/elasticsearch
  data: /var/data/elasticsearch</pre></div><h4><a id="cluster-name"></a>Cluster name<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/configuration.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Also, don’t forget to give your production cluster a name, which is used
to discover and auto-join other nodes:</p><div class="pre_wrapper"><pre class="programlisting">cluster:
  name: &lt;NAME OF YOUR CLUSTER&gt;</pre></div><p>Make sure that you don’t reuse the same cluster names in different
environments, otherwise you might end up with nodes joining the wrong cluster.
For instance you could use <code class="literal">logging-dev</code>, <code class="literal">logging-stage</code>, and <code class="literal">logging-prod</code>
for the development, staging, and production clusters.</p><h4><a id="node-name"></a>Node name<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/configuration.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>You may also want to change the default node name for each node to
something like the display hostname. By default Elasticsearch will
randomly pick a Marvel character name from a list of around 3000 names
when your node starts up.</p><div class="pre_wrapper"><pre class="programlisting">node:
  name: &lt;NAME OF YOUR NODE&gt;</pre></div><p>The hostname of the machine is provided in the environment
variable <code class="literal">HOSTNAME</code>. If on your machine you only run a
single elasticsearch node for that cluster, you can set
the node name to the hostname using the <code class="literal">${...}</code> notation:</p><div class="pre_wrapper"><pre class="programlisting">node:
  name: ${HOSTNAME}</pre></div><p>Internally, all settings are collapsed into "namespaced" settings. For
example, the above gets collapsed into <code class="literal">node.name</code>. This means that
its easy to support other configuration formats, for example,
<a class="ulink" href="http://www.json.org" target="_top">JSON</a>. If JSON is a preferred configuration format,
simply rename the <code class="literal">elasticsearch.yml</code> file to <code class="literal">elasticsearch.json</code> and
add:</p><h4><a id="styles"></a>Configuration styles<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/configuration.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="pre_wrapper"><pre class="programlisting">{
    "network" : {
        "host" : "10.0.0.4"
    }
}</pre></div><p>It also means that its easy to provide the settings externally either
using the <code class="literal">ES_JAVA_OPTS</code> or as parameters to the <code class="literal">elasticsearch</code>
command, for example:</p><div class="pre_wrapper"><pre class="programlisting">$ elasticsearch -Des.network.host=10.0.0.4</pre></div><p>Another option is to set <code class="literal">es.default.</code> prefix instead of <code class="literal">es.</code> prefix,
which means the default setting will be used only if not explicitly set
in the configuration file.</p><p>Another option is to use the <code class="literal">${...}</code> notation within the configuration
file which will resolve to an environment setting, for example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "network" : {
        "host" : "${ES_NET_HOST}"
    }
}</pre></div><p>Additionally, for settings that you do not wish to store in the configuration
file, you can use the value <code class="literal">${prompt.text}</code> or <code class="literal">${prompt.secret}</code> and start
Elasticsearch in the foreground. <code class="literal">${prompt.secret}</code> has echoing disabled so
that the value entered will not be shown in your terminal; <code class="literal">${prompt.text}</code>
will allow you to see the value as you type it in. For example:</p><div class="pre_wrapper"><pre class="programlisting">node:
  name: ${prompt.text}</pre></div><p>On execution of the <code class="literal">elasticsearch</code> command, you will be prompted to enter
the actual value like so:</p><div class="pre_wrapper"><pre class="programlisting">Enter value for [node.name]:</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Elasticsearch will not start if <code class="literal">${prompt.text}</code> or <code class="literal">${prompt.secret}</code>
is used in the settings and the process is run as a service or in the background.</p></div></div><p>The location of the configuration file can be set externally using a
system property:</p><div class="pre_wrapper"><pre class="programlisting">$ elasticsearch -Des.config=/path/to/config/file</pre></div><h3><a id="configuration-index-settings"></a>Index Settings<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/configuration.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Indices created within the cluster can provide their own settings. For
example, the following creates an index with memory based storage
instead of the default file system based one (the format can be either
YAML or JSON):</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPUT http://localhost:9200/kimchy/ -d \
'
index :
    store:
        type: memory
'</pre></div><p>Index level settings can be set on the node level as well, for example,
within the <code class="literal">elasticsearch.yml</code> file, the following can be set:</p><div class="pre_wrapper"><pre class="programlisting">index :
    store:
        type: memory</pre></div><p>This means that every index that gets created on the specific node
started with the mentioned configuration will store the index in memory
<span class="strong emphasis"><strong>unless the index explicitly sets it</strong></span>. In other words, any index level
settings override what is set in the node configuration. Of course, the
above can also be set as a "collapsed" setting, for example:</p><div class="pre_wrapper"><pre class="programlisting">$ elasticsearch -Des.index.store.type=memory</pre></div><p>All of the index level configuration can be found within each
<a class="link" href="index-modules.html" title="Index Modules">index module</a>.</p><h3><a id="logging"></a>Logging<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/configuration.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Elasticsearch uses an internal logging abstraction and comes, out of the
box, with <a class="ulink" href="http://logging.apache.org/log4j/1.2/" target="_top">log4j</a>. It tries to simplify
log4j configuration by using <a class="ulink" href="http://www.yaml.org/" target="_top">YAML</a> to configure it,
and the logging configuration file is <code class="literal">config/logging.yml</code>. The
<a class="ulink" href="http://en.wikipedia.org/wiki/JSON" target="_top">JSON</a> and
<a class="ulink" href="http://en.wikipedia.org/wiki/.properties" target="_top">properties</a> formats are also
supported. Multiple configuration files can be loaded, in which case they will
get merged, as long as they start with the <code class="literal">logging.</code> prefix and end with one
of the supported suffixes (either <code class="literal">.yml</code>, <code class="literal">.yaml</code>, <code class="literal">.json</code> or <code class="literal">.properties</code>)
The logger section contains the java packages and their corresponding log
level, where it is possible to omit the <code class="literal">org.elasticsearch</code> prefix. The
appender section contains the destinations for the logs. Extensive information
on how to customize logging and all the supported appenders can be found on
the <a class="ulink" href="http://logging.apache.org/log4j/1.2/manual.html" target="_top">log4j documentation</a>.</p><p>Additional Appenders and other logging classes provided by
<a class="ulink" href="http://logging.apache.org/log4j/extras/" target="_top">log4j-extras</a> are also available,
out of the box.</p></div><div class="navfooter"><span class="prev"><a href="setup.html">
              «&nbsp;
              Setup</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="setup-service.html">Running as a Service on Linux
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="setup.html">Setup</a></span> » <span class="breadcrumb-node">Running as a Service on Linux</span></div><div class="navheader"><span class="prev"><a href="setup-configuration.html">
              «&nbsp;
              Configuration</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="setup-service-win.html">Running as a Service on Windows
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="setup-service"></a>Running as a Service on Linux<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/as-a-service.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>In order to run elasticsearch as a service on your operating system, the provided packages try to make it as easy as possible for you to start and stop elasticsearch during reboot and upgrades.</p><h3><a id="_linux"></a>Linux<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/as-a-service.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Currently our build automatically creates a debian package and an RPM package, which is available on the download page. The package itself does not have any dependencies, but you have to make sure that you installed a JDK.</p><p>Each package features a configuration file, which allows you to set the following parameters</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">ES_USER</code>
</p>
</td><td class="entry" valign="top">
<p>
The user to run as, defaults to <code class="literal">elasticsearch</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">ES_GROUP</code>
</p>
</td><td class="entry" valign="top">
<p>
The group to run as, defaults to <code class="literal">elasticsearch</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">ES_HEAP_SIZE</code>
</p>
</td><td class="entry" valign="top">
<p>
The heap size to start with
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">ES_HEAP_NEWSIZE</code>
</p>
</td><td class="entry" valign="top">
<p>
The size of the new generation heap
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">ES_DIRECT_SIZE</code>
</p>
</td><td class="entry" valign="top">
<p>
The maximum size of the direct memory
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">MAX_OPEN_FILES</code>
</p>
</td><td class="entry" valign="top">
<p>
Maximum number of open files, defaults to <code class="literal">65535</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">MAX_LOCKED_MEMORY</code>
</p>
</td><td class="entry" valign="top">
<p>
Maximum locked memory size. Set to "unlimited" if you use the bootstrap.mlockall option in elasticsearch.yml. You must also set ES_HEAP_SIZE.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">MAX_MAP_COUNT</code>
</p>
</td><td class="entry" valign="top">
<p>
Maximum number of memory map areas a process may have. If you use <code class="literal">mmapfs</code> as index store type, make sure this is set to a high value. For more information, check the <a class="ulink" href="https://github.com/torvalds/linux/blob/master/Documentation/sysctl/vm.txt" target="_top">linux kernel documentation</a> about <code class="literal">max_map_count</code>. This is set via <code class="literal">sysctl</code> before starting elasticsearch. Defaults to <code class="literal">65535</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">LOG_DIR</code>
</p>
</td><td class="entry" valign="top">
<p>
Log directory, defaults to <code class="literal">/var/log/elasticsearch</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">DATA_DIR</code>
</p>
</td><td class="entry" valign="top">
<p>
Data directory, defaults to <code class="literal">/var/lib/elasticsearch</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">WORK_DIR</code>
</p>
</td><td class="entry" valign="top">
<p>
Work directory, defaults to <code class="literal">/tmp/elasticsearch</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">CONF_DIR</code>
</p>
</td><td class="entry" valign="top">
<p>
Configuration file directory (which needs to include <code class="literal">elasticsearch.yml</code> and <code class="literal">logging.yml</code> files), defaults to <code class="literal">/etc/elasticsearch</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">CONF_FILE</code>
</p>
</td><td class="entry" valign="top">
<p>
Path to configuration file, defaults to <code class="literal">/etc/elasticsearch/elasticsearch.yml</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">ES_JAVA_OPTS</code>
</p>
</td><td class="entry" valign="top">
<p>
Any additional java options you may want to apply. This may be useful, if you need to set the <code class="literal">node.name</code> property, but do not want to change the <code class="literal">elasticsearch.yml</code> configuration file, because it is distributed via a provisioning system like puppet or chef. Example: <code class="literal">ES_JAVA_OPTS="-Des.node.name=search-01"</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">RESTART_ON_UPGRADE</code>
</p>
</td><td class="entry" valign="top">
<p>
Configure restart on package upgrade, defaults to <code class="literal">false</code>. This means you will have to restart your elasticsearch instance after installing a package manually. The reason for this is to ensure, that upgrades in a cluster do not result in a continuous shard reallocation resulting in high network traffic and reducing the response times of your cluster.
</p>
</td></tr></tbody></table></div><h4><a id="_debian_ubuntu"></a>Debian/Ubuntu<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/as-a-service.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The debian package ships with everything you need as it uses standard debian tools like update <code class="literal">update-rc.d</code> to define the runlevels it runs on. The init script is placed at <code class="literal">/etc/init.d/elasticsearch</code> as you would expect it. The configuration file is placed at <code class="literal">/etc/default/elasticsearch</code>.</p><p>The debian package does not start up the service by default. The reason for this is to prevent the instance to accidentally join a cluster, without being configured appropriately. After installing using <code class="literal">dpkg -i</code> you can use the following commands to ensure, that elasticsearch starts when the system is booted and then start up elasticsearch:</p><div class="pre_wrapper"><pre class="programlisting">sudo update-rc.d elasticsearch defaults 95 10
sudo /etc/init.d/elasticsearch start</pre></div><h5><a id="_installing_the_oracle_jdk"></a>Installing the oracle JDK<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/as-a-service.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>The usual recommendation is to run the Oracle JDK with elasticsearch. However Ubuntu and Debian only ship the OpenJDK due to license issues. You can easily install the oracle installer package though. In case you are missing the <code class="literal">add-apt-repository</code> command under Debian GNU/Linux, make sure have at least Debian Wheezy and the package <code class="literal">python-software-properties</code> installed</p><div class="pre_wrapper"><pre class="programlisting">sudo add-apt-repository ppa:webupd8team/java
sudo apt-get update
sudo apt-get install oracle-java7-installer
java -version</pre></div><p>The last command should verify a successful installation of the Oracle JDK. If you want to install java8, you can call <code class="literal">apt-get install oracle-java8-installer</code></p><h4><a id="_rpm_based_distributions"></a>RPM based distributions<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/as-a-service.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><h5><a id="_using_chkconfig"></a>Using chkconfig<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/as-a-service.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Some RPM based distributions are using <code class="literal">chkconfig</code> to enable and disable services. The init script is located at <code class="literal">/etc/init.d/elasticsearch</code>, where as the configuration file is placed at <code class="literal">/etc/sysconfig/elasticsearch</code>. Like the debian package the RPM package is not started by default after installation, you have to do this manually by entering the following commands</p><div class="pre_wrapper"><pre class="programlisting">sudo /sbin/chkconfig --add elasticsearch
sudo service elasticsearch start</pre></div><h5><a id="_using_systemd"></a>Using systemd<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/as-a-service.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Distributions like SUSE do not use the <code class="literal">chkconfig</code> tool to register services, but rather <code class="literal">systemd</code> and its command <code class="literal">/bin/systemctl</code> to start and stop services (at least in newer versions, otherwise use the <code class="literal">chkconfig</code> commands above). The configuration file is also placed at <code class="literal">/etc/sysconfig/elasticsearch</code>. After installing the RPM, you have to change the systemd configuration and then start up elasticsearch</p><div class="pre_wrapper"><pre class="programlisting">sudo /bin/systemctl daemon-reload
sudo /bin/systemctl enable elasticsearch.service
sudo /bin/systemctl start elasticsearch.service</pre></div><p>Also note that changing the <code class="literal">MAX_MAP_COUNT</code> setting in <code class="literal">/etc/sysconfig/elasticsearch</code> does not have any effect, you will have to change it in <code class="literal">/usr/lib/sysctl.d/elasticsearch.conf</code> in order to have it applied at startup.</p></div><div class="navfooter"><span class="prev"><a href="setup-configuration.html">
              «&nbsp;
              Configuration</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="setup-service-win.html">Running as a Service on Windows
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="setup.html">Setup</a></span> » <span class="breadcrumb-node">Running as a Service on Windows</span></div><div class="navheader"><span class="prev"><a href="setup-service.html">
              «&nbsp;
              Running as a Service on Linux</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="setup-dir-layout.html">Directory Layout
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="setup-service-win"></a>Running as a Service on Windows<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/as-a-service-win.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Windows users can configure Elasticsearch to run as a service to run in the background or start automatically
at startup without any user interaction.
This can be achieved through <code class="literal">service.bat</code> script under <code class="literal">bin/</code> folder which allows one to install,
remove, manage or configure the service and potentially start and stop the service, all from the command-line.</p><div class="pre_wrapper"><pre class="programlisting">c:\elasticsearch-1.7.6\bin&gt;service

Usage: service.bat install|remove|start|stop|manager [SERVICE_ID]</pre></div><p>The script requires one parameter (the command to execute) followed by an optional one indicating the service
id (useful when installing multiple Elasticsearch services).</p><p>The commands available are:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">install</code>
</p>
</td><td class="entry" valign="top">
<p>
Install Elasticsearch as a service
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">remove</code>
</p>
</td><td class="entry" valign="top">
<p>
Remove the installed Elasticsearch service (and stop the service if started)
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">start</code>
</p>
</td><td class="entry" valign="top">
<p>
Start the Elasticsearch service (if installed)
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">stop</code>
</p>
</td><td class="entry" valign="top">
<p>
Stop the Elasticsearch service (if started)
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">manager</code>
</p>
</td><td class="entry" valign="top">
<p>
Start a GUI for managing the installed service
</p>
</td></tr></tbody></table></div><p>Note that the environment configuration options available during the installation are copied and will be used during
the service lifecycle. This means any changes made to them after the installation will not be picked up unless
the service is reinstalled.</p><p>Based on the architecture of the available JDK/JRE (set through <code class="literal">JAVA_HOME</code>), the appropriate 64-bit(x64) or 32-bit(x86)
service will be installed. This information is made available during install:</p><div class="pre_wrapper"><pre class="programlisting">c:\elasticsearch-{version}bin&gt;service install
Installing service      :  "elasticsearch-service-x64"
Using JAVA_HOME (64-bit):  "c:\jvm\jdk1.7"
The service 'elasticsearch-service-x64' has been installed.</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>While a JRE can be used for the Elasticsearch service, due to its use of a client VM (as oppose to a server JVM which
offers better performance for long-running applications) its usage is discouraged and a warning will be issued.</p></div></div><h3><a id="_customizing_service_settings"></a>Customizing service settings<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/as-a-service-win.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>There are two ways to customize the service settings:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Manager GUI
</span></dt><dd>
accessible through <code class="literal">manager</code> command, the GUI offers insight into the installed service including its status, startup type,
JVM, start and stop settings among other things. Simply invoking <code class="literal">service.bat</code> from the command-line with the aforementioned option
will open up the manager window:
</dd></dl></div><div class="informalfigure"><div class="mediaobject" align="center"><img src="images/service-manager-win.png" align="middle" alt="Windows Service Manager GUI"></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Customizing <code class="literal">service.bat</code>
</span></dt><dd>
at its core, <code class="literal">service.bat</code> relies on <a class="ulink" href="http://commons.apache.org/proper/commons-daemon/" target="_top">Apache Commons Daemon</a> project
to install the services. For full flexibility such as customizing the user under which the service runs, one can modify the installation
parameters to tweak all the parameters accordingly. Do note that this requires reinstalling the service for the new settings to be applied.
</dd></dl></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>There is also a community supported customizable MSI installer available: <a class="ulink" href="https://github.com/salyh/elasticsearch-msi-installer" target="_top">https://github.com/salyh/elasticsearch-msi-installer</a> (by Hendrik Saly).</p></div></div></div><div class="navfooter"><span class="prev"><a href="setup-service.html">
              «&nbsp;
              Running as a Service on Linux</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="setup-dir-layout.html">Directory Layout
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="setup.html">Setup</a></span> » <span class="breadcrumb-node">Directory Layout</span></div><div class="navheader"><span class="prev"><a href="setup-service-win.html">
              «&nbsp;
              Running as a Service on Windows</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="setup-repositories.html">Repositories
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="setup-dir-layout"></a>Directory Layout<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/dir-layout.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The directory layout of an installation is as follows:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"><col class="col_4"></colgroup><thead><tr><th class="entry" align="left" valign="top"> Type </th><th class="entry" align="left" valign="top"> Description </th><th class="entry" align="left" valign="top"> Default Location </th><th class="entry" align="left" valign="top"> Setting</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>home</strong></span></p></td><td class="entry" align="left" valign="top"><p>Home of elasticsearch installation.</p></td><td class="entry" align="left" valign="top"><p><code class="literal"></code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">path.home</code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>bin</strong></span></p></td><td class="entry" align="left" valign="top"><p>Binary scripts including <code class="literal">elasticsearch</code> to start a node.</p></td><td class="entry" align="left" valign="top"><p><code class="literal">{path.home}/bin</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal"></code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>conf</strong></span></p></td><td class="entry" align="left" valign="top"><p>Configuration files including <code class="literal">elasticsearch.yml</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">{path.home}/config</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">path.conf</code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>data</strong></span></p></td><td class="entry" align="left" valign="top"><p>The location of the data files of each index / shard allocated
on the node. Can hold multiple locations.</p></td><td class="entry" align="left" valign="top"><p><code class="literal">{path.home}/data</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">path.data</code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>logs</strong></span></p></td><td class="entry" align="left" valign="top"><p>Log files location.</p></td><td class="entry" align="left" valign="top"><p><code class="literal">{path.home}/logs</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">path.logs</code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>plugins</strong></span></p></td><td class="entry" align="left" valign="top"><p>Plugin files location. Each plugin will be contained in a subdirectory.</p></td><td class="entry" align="left" valign="top"><p><code class="literal">{path.home}/plugins</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">path.plugins</code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>repo</strong></span></p></td><td class="entry" align="left" valign="top"><p>Shared file system repository locations. Can hold multiple locations. A file system repository can be placed in to any subdirectory of any directory specified here.</p></td><td class="entry" align="left" valign="top"><p><code class="literal">empty</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">path.repo</code></p></td></tr></tbody></table></div><p>The multiple data locations allows to stripe it. The striping is simple,
placing whole files in one of the locations, and deciding where to place
the file based on the value of the <code class="literal">index.store.distributor</code> setting:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">least_used</code> (default) always selects the directory with the most
available space
</li><li class="listitem">
<code class="literal">random</code> selects directories at random. The probability of selecting
a particular directory is proportional to amount of available space in
this directory.
</li></ul></div><p>Note, there are no multiple copies of the same data, in that, its
similar to RAID 0. Though simple, it should provide a good solution for
people that don’t want to mess with RAID. Here is how it is configured:</p><pre class="screen">path.data: /mnt/first,/mnt/second</pre><p>Or the in an array format:</p><pre class="screen">path.data: ["/mnt/first", "/mnt/second"]</pre><h3><a id="default-paths"></a>Default Paths<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/dir-layout.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Below are the default paths that elasticsearch will use, if not explictly changed.</p><h4><a id="_deb_and_rpm"></a>deb and rpm<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/dir-layout.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"><col class="col_4"></colgroup><thead><tr><th class="entry" align="left" valign="top"> Type </th><th class="entry" align="left" valign="top"> Description </th><th class="entry" align="left" valign="top"> Location Debian/Ubuntu </th><th class="entry" align="left" valign="top"> Location RHEL/CentOS</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>home</strong></span></p></td><td class="entry" align="left" valign="top"><p>Home of elasticsearch installation.</p></td><td class="entry" align="left" valign="top"><p><code class="literal">/usr/share/elasticsearch</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">/usr/share/elasticsearch</code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>bin</strong></span></p></td><td class="entry" align="left" valign="top"><p>Binary scripts including <code class="literal">elasticsearch</code> to start a node.</p></td><td class="entry" align="left" valign="top"><p><code class="literal">/usr/share/elasticsearch/bin</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">/usr/share/elasticsearch/bin</code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>conf</strong></span></p></td><td class="entry" align="left" valign="top"><p>Configuration files <code class="literal">elasticsearch.yml</code> and <code class="literal">logging.yml</code>.</p></td><td class="entry" align="left" valign="top"><p><code class="literal">/etc/elasticsearch</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">/etc/elasticsearch</code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>conf</strong></span></p></td><td class="entry" align="left" valign="top"><p>Environment variables including heap size, file descriptors.</p></td><td class="entry" align="left" valign="top"><p><code class="literal">/etc/default/elasticseach</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">/etc/sysconfig/elasticsearch</code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>data</strong></span></p></td><td class="entry" align="left" valign="top"><p>The location of the data files of each index / shard allocated
on the node.</p></td><td class="entry" align="left" valign="top"><p><code class="literal">/var/lib/elasticsearch/data</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">/var/lib/elasticsearch</code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>logs</strong></span></p></td><td class="entry" align="left" valign="top"><p>Log files location</p></td><td class="entry" align="left" valign="top"><p><code class="literal">/var/log/elasticsearch</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">/var/log/elasticsearch</code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>plugins</strong></span></p></td><td class="entry" align="left" valign="top"><p>Plugin files location. Each plugin will be contained in a subdirectory.</p></td><td class="entry" align="left" valign="top"><p><code class="literal">/usr/share/elasticsearch/plugins</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">/usr/share/elasticsearch/plugins</code></p></td></tr></tbody></table></div><h4><a id="_zip_and_tar_gz"></a>zip and tar.gz<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/dir-layout.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th class="entry" align="left" valign="top"> Type </th><th class="entry" align="left" valign="top"> Description </th><th class="entry" align="left" valign="top"> Location</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>home</strong></span></p></td><td class="entry" align="left" valign="top"><p>Home of elasticsearch installation</p></td><td class="entry" align="left" valign="top"><p><code class="literal">{extract.path}</code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>bin</strong></span></p></td><td class="entry" align="left" valign="top"><p>Binary scripts including <code class="literal">elasticsearch</code> to start a node</p></td><td class="entry" align="left" valign="top"><p><code class="literal">{extract.path}/bin</code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>conf</strong></span></p></td><td class="entry" align="left" valign="top"><p>Configuration files <code class="literal">elasticsearch.yml</code> and <code class="literal">logging.yml</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">{extract.path}/config</code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>conf</strong></span></p></td><td class="entry" align="left" valign="top"><p>Environment variables including heap size, file descriptors</p></td><td class="entry" align="left" valign="top"><p><code class="literal">{extract.path}/config</code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>data</strong></span></p></td><td class="entry" align="left" valign="top"><p>The location of the data files of each index / shard allocated
on the node</p></td><td class="entry" align="left" valign="top"><p><code class="literal">{extract.path}/data</code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>logs</strong></span></p></td><td class="entry" align="left" valign="top"><p>Log files location</p></td><td class="entry" align="left" valign="top"><p><code class="literal">{extract.path}/logs</code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><span class="strong emphasis"><strong>plugins</strong></span></p></td><td class="entry" align="left" valign="top"><p>Plugin files location. Each plugin will be contained in a subdirectory</p></td><td class="entry" align="left" valign="top"><p><code class="literal">{extract.path}/plugins</code></p></td></tr></tbody></table></div></div><div class="navfooter"><span class="prev"><a href="setup-service-win.html">
              «&nbsp;
              Running as a Service on Windows</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="setup-repositories.html">Repositories
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="setup.html">Setup</a></span> » <span class="breadcrumb-node">Repositories</span></div><div class="navheader"><span class="prev"><a href="setup-dir-layout.html">
              «&nbsp;
              Directory Layout</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="setup-upgrade.html">Upgrading
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="setup-repositories"></a>Repositories<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/repositories.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>We also have repositories available for APT and YUM based distributions. Note that we only provide
binary packages, but no source packages, as the packages are created as part of the Elasticsearch
build.</p><p>We have split the major versions in separate urls to avoid accidental upgrades across major version.
For all 0.90.x releases use 0.90 as version number, for 1.0.x use 1.0, for 1.1.x use 1.1 etc.</p><p>We use the PGP key <a class="ulink" href="http://pgp.mit.edu/pks/lookup?op=vindex&amp;search=0xD27D666CD88E42B4" target="_top">D88E42B4</a>,
Elasticsearch Signing Key, with fingerprint</p><pre class="literallayout">4609 5ACC 8548 582C 1A26 99A9 D27D 666C D88E 42B4</pre><p>to sign all our packages. It is available from <a class="ulink" href="http://pgp.mit.edu" target="_top">http://pgp.mit.edu</a>.</p><h3><a id="_apt"></a>APT<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/repositories.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Download and install the Public Signing Key:</p><div class="pre_wrapper"><pre class="programlisting">wget -qO - https://packages.elastic.co/GPG-KEY-elasticsearch | sudo apt-key add -</pre></div><p>Save the repository definition to  <code class="literal">/etc/apt/sources.list.d/elasticsearch-{branch}.list</code>:</p><div class="pre_wrapper"><pre class="programlisting">echo "deb http://packages.elastic.co/elasticsearch/1.7/debian stable main" | sudo tee -a /etc/apt/sources.list.d/elasticsearch-1.7.list</pre></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Use the <code class="literal">echo</code> method described above to add the Elasticsearch repository.  Do not use <code class="literal">add-apt-repository</code>
as it will add a <code class="literal">deb-src</code> entry as well, but we do not provide a source package.
If you have added the <code class="literal">deb-src</code> entry, you will see an error like
the following:</p><pre class="literallayout">Unable to find expected entry 'main/source/Sources' in Release file (Wrong sources.list entry or malformed file)</pre><p>Just delete the <code class="literal">deb-src</code> entry from the <code class="literal">/etc/apt/sources.list</code> file and the installation should work as expected.</p></div></div><p>Run apt-get update and the repository is ready for use. You can install it with:</p><div class="pre_wrapper"><pre class="programlisting">sudo apt-get update &amp;&amp; sudo apt-get install elasticsearch</pre></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>If two entries exist for the same Elasticsearch repository, you will see an error like this during <code class="literal">apt-get update</code>:</p><pre class="literallayout">Duplicate sources.list entry http://packages.elastic.co/elasticsearch/1.7/debian/ ...`</pre><p>Examine <code class="literal">/etc/apt/sources.list.d/elasticsearch-1.7.list</code> for the duplicate entry or locate the duplicate entry amongst the files in <code class="literal">/etc/apt/sources.list.d/</code> and the <code class="literal">/etc/apt/sources.list</code> file.</p></div></div><p>Configure Elasticsearch to automatically start during bootup. If your
distribution is using SysV init, then you will need to run:</p><div class="pre_wrapper"><pre class="programlisting">sudo update-rc.d elasticsearch defaults 95 10</pre></div><p>Otherwise if your distribution is using systemd:</p><div class="pre_wrapper"><pre class="programlisting">sudo /bin/systemctl daemon-reload
sudo /bin/systemctl enable elasticsearch.service</pre></div><h3><a id="_yum"></a>YUM<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/repositories.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Download and install the public signing key:</p><div class="pre_wrapper"><pre class="programlisting">rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch</pre></div><p>Add the following in your <code class="literal">/etc/yum.repos.d/</code> directory
in a file with a <code class="literal">.repo</code> suffix, for example <code class="literal">elasticsearch.repo</code></p><div class="pre_wrapper"><pre class="programlisting">[elasticsearch-1.7]
name=Elasticsearch repository for 1.7.x packages
baseurl=http://packages.elastic.co/elasticsearch/1.7/centos
gpgcheck=1
gpgkey=http://packages.elastic.co/GPG-KEY-elasticsearch
enabled=1</pre></div><p>And your repository is ready for use. You can install it with:</p><div class="pre_wrapper"><pre class="programlisting">yum install elasticsearch</pre></div><p>Configure Elasticsearch to automatically start during bootup. If your
distribution is using SysV <code class="literal">init</code> (check with <code class="literal">ps -p 1</code>), then you will need to run:</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>The repositories do not work with older rpm based distributions
         that still use RPM v3, like CentOS5.</p></div></div><div class="pre_wrapper"><pre class="programlisting">chkconfig --add elasticsearch</pre></div><p>Otherwise if your distribution is using <code class="literal">systemd</code>:</p><div class="pre_wrapper"><pre class="programlisting">sudo /bin/systemctl daemon-reload
sudo /bin/systemctl enable elasticsearch.service</pre></div></div><div class="navfooter"><span class="prev"><a href="setup-dir-layout.html">
              «&nbsp;
              Directory Layout</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="setup-upgrade.html">Upgrading
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="setup.html">Setup</a></span> » <span class="breadcrumb-node">Upgrading</span></div><div class="navheader"><span class="prev"><a href="setup-repositories.html">
              «&nbsp;
              Repositories</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="breaking-changes.html">Breaking changes
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="setup-upgrade"></a>Upgrading<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/upgrade.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Elasticsearch can usually be upgraded using a rolling upgrade process, resulting in no interruption of service.  This section details how to perform both rolling and restart upgrades.</p><p>To determine whether a rolling upgrade is supported for your release, please
consult this table:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th class="entry" align="left" valign="top">Upgrade From   </th><th class="entry" align="left" valign="top">Upgrade To     </th><th class="entry" align="left" valign="top">Supported Upgrade Type</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">0.90.x</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">1.x</code></p></td><td class="entry" align="left" valign="top"><p><a class="link" href="setup-upgrade.html#restart-upgrade" title="Cluster restart upgrade processedit">Full cluster restart</a></p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">&lt; 0.90.7</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">0.90.x</code></p></td><td class="entry" align="left" valign="top"><p><a class="link" href="setup-upgrade.html#restart-upgrade" title="Cluster restart upgrade processedit">Full cluster restart</a></p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">&gt;= 0.90.7</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">0.90.x</code></p></td><td class="entry" align="left" valign="top"><p><a class="link" href="setup-upgrade.html#rolling-upgrades" title="Rolling upgrade processedit">Rolling upgrade</a></p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">1.0.0 - 1.3.1</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">1.x</code></p></td><td class="entry" align="left" valign="top"><p><a class="link" href="setup-upgrade.html#rolling-upgrades" title="Rolling upgrade processedit">Rolling upgrade</a> (if <a class="link" href="modules-indices.html#recovery" title="Recoveryedit"><code class="literal">indices.recovery.compress</code></a> set to <code class="literal">false</code>)</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">&gt;= 1.3.2</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">1.x</code></p></td><td class="entry" align="left" valign="top"><p><a class="link" href="setup-upgrade.html#rolling-upgrades" title="Rolling upgrade processedit">Rolling upgrade</a></p></td></tr></tbody></table></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p>Before upgrading Elasticsearch, it is a good idea to consult the
<a class="link" href="breaking-changes.html" title="Breaking changes">breaking changes</a> docs.</p></div></div><h3><a id="backup"></a>Back Up Your Data!<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/upgrade.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Before performing an upgrade, it’s a good idea to back up the data on your system.  This will allow you to roll back in the event of a problem with the upgrade.  The upgrades sometimes include upgrades to the Lucene libraries used by Elasticsearch to access the index files, and after an index file has been updated to work with a new version of Lucene, it may not be accessible to the versions of Lucene present in earlier Elasticsearch releases.</p><h4><a id="_0_90_x_and_earlier"></a>0.90.x and earlier<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/upgrade.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>To back up a running 0.90.x system, first disable index flushing.  This will prevent indices from being flushed to disk while the backup is in process:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPUT 'http://localhost:9200/_all/_settings' -d '{
    "index": {
        "translog.disable_flush": "true"
    }
}'</pre></div><p>Then disable reallocation.  This will prevent the cluster from moving data files from one node to another while the backup is in process:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPUT 'http://localhost:9200/_cluster/settings' -d '{
    "transient" : {
        "cluster.routing.allocation.disable_allocation": "true"
    }
}'</pre></div><p>After reallocation and index flushing are disabled, initiate a backup of Elasticsearch’s data path using your favorite backup method (tar, storage array snapshots, backup software).  When the backup is complete and data no longer needs to be read from the Elasticsearch data path, reallocation and index flushing must be re-enabled:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPUT 'http://localhost:9200/_all/_settings' -d '{
    "index": {
        "translog.disable_flush": "false"
    }
}'

$ curl -XPUT 'http://localhost:9200/_cluster/settings' -d '{
    "transient" : {
        "cluster.routing.allocation.disable_allocation": "false"
    }
}'</pre></div><h4><a id="_1_0_and_later"></a>1.0 and later<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/upgrade.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>To back up a running 1.0 or later system, it is simplest to use the snapshot feature.  See the complete instructions for <a class="link" href="modules-snapshots.html" title="Snapshot And Restore">backup and restore with snapshots</a>.</p><h3><a id="rolling-upgrades"></a>Rolling upgrade process<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/upgrade.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>A rolling upgrade allows the ES cluster to be upgraded one node at a time, with no observable downtime for end users.  Running multiple versions of Elasticsearch in the same cluster for any length of time beyond that required for an upgrade is not supported, as shard replication from the more recent version to the previous versions will not work.</p><p>Within minor or maintenance releases after release 1.0, rolling upgrades are supported.  To perform a rolling upgrade:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Disable shard reallocation (optional).  This is done to allow for a faster startup after cluster shutdown.  If this step is not performed, the nodes will immediately start trying to replicate shards to each other on startup and will spend a lot of time on wasted I/O.  With shard reallocation disabled, the nodes will join the cluster with their indices intact, without attempting to rebalance.  After startup is complete, reallocation will be turned back on.
</li></ul></div><p>This syntax applies to Elasticsearch 1.0 and later:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/_cluster/settings -d '{
        "transient" : {
            "cluster.routing.allocation.enable" : "none"
        }
}'</pre></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
(Only applicable to upgrades from ES 1.6.0 to a higher version) There is no problem continuing to index while doing the upgrade. However, you can speed the process considerably
by <span class="strong emphasis"><strong>temporarily</strong></span> stopping non-essential indexing and issuing a manual <a class="link" href="indices-synced-flush.html" title="Synced Flush">synced flush</a>.
A synced flush is special kind of flush which can seriously speed up recovery of shards. Elasticsearch automatically
uses it when an index has been inactive for a while (default is <code class="literal">5m</code>) but you can manually trigger it using the following command:
</li></ul></div><div class="pre_wrapper"><pre class="programlisting">curl -XPOST localhost:9200/_all/_flush/synced</pre></div><p>Note that a synced flush call is a best effort operation. It will fail there are any pending indexing operations. It is safe to issue
it multiple times if needed.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Shut down a single node within the cluster.
</li></ul></div><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'http://localhost:9200/_cluster/nodes/_local/_shutdown'</pre></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Confirm that all shards are correctly reallocated to the remaining running nodes.
</li><li class="listitem"><p class="simpara">
Upgrade the stopped node.  To upgrade using a zip or compressed tarball from elastic.co:
</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
Extract the zip or tarball to a new directory, usually in the same volume as the current Elasticsearch installation.  Do not overwrite the existing installation, as the downloaded archive will contain a default elasticsearch.yml file and will overwrite your existing configuration.
</li><li class="listitem">
Copy the configuration files from the old Elasticsearch installation’s config directory to the new Elasticsearch installation’s config directory.  Move data files from the old Elasticsesarch installation’s data directory if necessary.  If data files are not located within the tarball’s extraction directory, they will not have to be moved.
</li><li class="listitem">
The simplest solution for moving from one version to another is to have a symbolic link for <span class="emphasis"><em>elasticsearch</em></span> that points to the currently running version.  This link can be easily updated and will provide a stable access point to the most recent version.  Update this symbolic link if it is being used.
</li></ul></div></li><li class="listitem"><p class="simpara">
To upgrade using a <code class="literal">.deb</code> or <code class="literal">.rpm</code> package:
</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
Use <code class="literal">rpm</code> or <code class="literal">dpkg</code> to install the new package.  All files should be placed in their proper locations, and config files should not be overwritten.
</li></ul></div></li><li class="listitem">
Start the now upgraded node.  Confirm that it joins the cluster.
</li><li class="listitem">
Re-enable shard reallocation:
</li></ul></div><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/_cluster/settings -d '{
        "transient" : {
            "cluster.routing.allocation.enable" : "all"
        }
}'</pre></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Observe that all shards are properly allocated on all nodes.  Balancing may take some time.
</li><li class="listitem">
Repeat this process for all remaining nodes.
</li></ul></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png"></div><div class="admon_content"><p>During a rolling upgrade, primary shards assigned to a node with the higher
version will never have their replicas assigned to a node with the lower
version, because the newer version may have a different data format which is
not understood by the older version.</p><p>If it is not possible to assign the replica shards to another node with the
higher version — e.g. if there is only one node with the higher version in
the cluster — then the replica shards will remain unassigned, i.e. the
cluster health will be status <code class="literal">yellow</code>.  As soon as another node with the
higher version joins the cluster, the replicas should be assigned and the
cluster health will reach status <code class="literal">green</code>.</p></div></div><p>It may be possible to perform the upgrade by installing the new software while the service is running.  This would reduce downtime by ensuring the service was ready to run on the new version as soon as it is stopped on the node being upgraded.  This can be done by installing the new version in its own directory and using the symbolic link method outlined above.  It is important to test this procedure first to be sure that site-specific configuration data and production indices will not be overwritten during the upgrade process.</p><h3><a id="restart-upgrade"></a>Cluster restart upgrade process<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/upgrade.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Elasticsearch releases prior to 1.0 and releases after 1.0 are not compatible with each other, so a rolling upgrade is not possible.  In order to upgrade a pre-1.0 system to 1.0 or later, a full cluster stop and start is required.  In order to perform this upgrade:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Disable shard reallocation (optional).  This is done to allow for a faster startup after cluster shutdown.  If this step is not performed, the nodes will immediately start trying to replicate shards to each other on startup and will spend a lot of time on wasted I/O.  With shard reallocation disabled, the nodes will join the cluster with their indices intact, without attempting to rebalance.  After startup is complete, reallocation will be turned back on.
</li></ul></div><p>This syntax is from versions prior to 1.0:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/_cluster/settings -d '{
    "persistent" : {
    "cluster.routing.allocation.disable_allocation" : true
    }
}'</pre></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Stop all Elasticsearch services on all nodes in the cluster.
</li></ul></div><div class="pre_wrapper"><pre class="programlisting">        curl -XPOST 'http://localhost:9200/_shutdown'</pre></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
On the first node to be upgraded, extract the archive or install the new package as described above in the Rolling Upgrades section.  Repeat for all nodes.
</li><li class="listitem"><p class="simpara">
After upgrading Elasticsearch on all nodes is complete, the cluster can be started by starting each node individually.
</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
Start master-eligible nodes first, one at a time.  Verify that a quorum has been reached and a master has been elected before proceeding.
</li><li class="listitem">
Start data nodes and then client nodes one at a time, verifying that they successfully join the cluster.
</li></ul></div></li><li class="listitem">
When the cluster is running and reaches a yellow state, shard reallocation can be enabled.
</li></ul></div><p>This syntax is from release 1.0 and later:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/_cluster/settings -d '{
        "persistent" : {
    "cluster.routing.allocation.disable_allocation": false,
        "cluster.routing.allocation.enable" : "all"
        }
}'</pre></div><p>The cluster upgrade can be streamlined by installing the software before stopping cluster services.  If this is done, testing must be performed to ensure that no production data or configuration files are overwritten prior to restart.</p></div><div class="navfooter"><span class="prev"><a href="setup-repositories.html">
              «&nbsp;
              Repositories</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="breaking-changes.html">Breaking changes
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-node">Breaking changes</span></div><div class="navheader"><span class="prev"><a href="setup-upgrade.html">
              «&nbsp;
              Upgrading</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="breaking-changes-1.6.html">Breaking changes in 1.6
              &nbsp;»
            </a></span></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="breaking-changes"></a>Breaking changes<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/index.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><div class="partintro"><div></div><p>This section discusses the changes that you need to be aware of when migrating
your application from one version of Elasticsearch to another.</p><p>As a general rule:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Migration between major versions — e.g. <code class="literal">1.x</code> to <code class="literal">2.x</code> —   requires a <a class="link" href="setup-upgrade.html#restart-upgrade" title="Cluster restart upgrade processedit">full cluster restart</a>.
</li><li class="listitem">
Migration between minor versions — e.g. <code class="literal">1.x</code> to <code class="literal">1.y</code> — can be
  performed by <a class="link" href="setup-upgrade.html#rolling-upgrades" title="Rolling upgrade processedit">upgrading one node at a time</a>.
</li></ul></div><p>See <a class="xref" href="setup-upgrade.html" title="Upgrading"><em>Upgrading</em></a> for more info.</p></div></div><div class="navfooter"><span class="prev"><a href="setup-upgrade.html">
              «&nbsp;
              Upgrading</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="breaking-changes-1.6.html">Breaking changes in 1.6
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="breaking-changes.html">Breaking changes</a></span> » <span class="breadcrumb-node">Breaking changes in 1.6</span></div><div class="navheader"><span class="prev"><a href="breaking-changes.html">
              «&nbsp;
              Breaking changes</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="breaking-changes-1.5.html">Breaking changes in 1.5
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="breaking-changes-1.6"></a>Breaking changes in 1.6<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_6.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>This section discusses the changes that you need to be aware of when migrating
your application from Elasticsearch 1.x to Elasticsearch 1.6.</p><h3><a id="_more_like_this_api"></a>More Like This API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_6.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The More Like This API query has been deprecated and will be removed in 2.0. Instead use the <a class="link" href="query-dsl-mlt-query.html" title="More Like This Query">More Like This Query</a>.</p><h3><a id="_literal_top_children_literal_query"></a><code class="literal">top_children</code> query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_6.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The <code class="literal">top_children</code> query has been deprecated and will be removed in 2.0. Instead the <code class="literal">has_child</code> query should be used.
The <code class="literal">top_children</code> query isn’t always faster than the <code class="literal">has_child</code> query and the <code class="literal">top_children</code> query is often inaccurate.
The total hits and any aggregations in the same search request will likely be off.</p><h3><a id="_snapshot_and_restore"></a>Snapshot and Restore<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_6.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Locations of file system repositories has to be now registered using <code class="literal">path.repo</code> setting. The <code class="literal">path.repo</code>
setting can contain one or more repository locations:</p><div class="pre_wrapper"><pre class="programlisting">path.repo: ["/mnt/daily", "/mnt/weekly"]</pre></div><p>If the file system repository location is specified as an absolute path it has to start with one of the locations
specified in <code class="literal">path.repo</code>. If the location is specified as a relative path, it will be resolved against the first
location specified in the <code class="literal">path.repo</code> setting.</p><p>Starting with version 1.6.1 URL repositories with <code class="literal">http:</code>, <code class="literal">https:</code>, and <code class="literal">ftp:</code> URLs has to be whitelisted by specifying allowed URLs in the
<code class="literal">repositories.url.allowed_urls</code> setting. This setting supports wildcards in the place of host, path, query, and
fragment. For example:</p><div class="pre_wrapper"><pre class="programlisting">repositories.url.allowed_urls: ["http://www.example.org/root/*", "https://*.mydomain.com/*?*#*"]</pre></div></div><div class="navfooter"><span class="prev"><a href="breaking-changes.html">
              «&nbsp;
              Breaking changes</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="breaking-changes-1.5.html">Breaking changes in 1.5
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="breaking-changes.html">Breaking changes</a></span> » <span class="breadcrumb-node">Breaking changes in 1.5</span></div><div class="navheader"><span class="prev"><a href="breaking-changes-1.6.html">
              «&nbsp;
              Breaking changes in 1.6</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="breaking-changes-1.4.html">Breaking changes in 1.4
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="breaking-changes-1.5"></a>Breaking changes in 1.5<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_5.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>This section discusses the changes that you need to be aware of when migrating
your application from Elasticsearch 1.x to Elasticsearch 1.5.</p><h4><a id="_aggregations"></a>Aggregations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_5.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">date_histogram</code> aggregation now support a simplified <code class="literal">offset</code> option that replaces the previous <code class="literal">pre_offset</code> and
<code class="literal">post_offset</code> which are deprecated in 1.5. Instead of having to specify two separate offset shifts of the underlying buckets, the <code class="literal">offset</code> option
moves the bucket boundaries in positive or negative direction depending on its argument.</p><p>Also for <code class="literal">date_histogram</code>, options for <code class="literal">pre_zone</code> and <code class="literal">post_zone</code> options and the <code class="literal">pre_zone_adjust_large_interval</code> parameter
are deprecated in 1.5 and replaced by the already existing <code class="literal">time_zone</code> option. The behavior of <code class="literal">time_zone</code> is equivalent to the former
<code class="literal">pre_zone</code> option.</p></div><div class="navfooter"><span class="prev"><a href="breaking-changes-1.6.html">
              «&nbsp;
              Breaking changes in 1.6</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="breaking-changes-1.4.html">Breaking changes in 1.4
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="breaking-changes.html">Breaking changes</a></span> » <span class="breadcrumb-node">Breaking changes in 1.4</span></div><div class="navheader"><span class="prev"><a href="breaking-changes-1.5.html">
              «&nbsp;
              Breaking changes in 1.5</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="breaking-changes-1.0.html">Breaking changes in 1.0
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="breaking-changes-1.4"></a>Breaking changes in 1.4<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_4.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>This section discusses the changes that you need to be aware of when migrating
your application from Elasticsearch 1.x to Elasticsearch 1.4.</p><h3><a id="_percolator"></a>Percolator<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_4.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>In indices created with version <code class="literal">1.4.0</code> or later, percolation queries can only
refer to fields that already exist in the mappings in that index. There are
two ways to make sure that a field mapping exist:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Add or update a mapping via the <a class="link" href="indices-create-index.html" title="Create Index">create index</a> or
  <a class="link" href="indices-put-mapping.html" title="Put Mapping">put mapping</a> apis.
</li><li class="listitem">
Percolate a document before registering a query. Percolating a document can
  add field mappings dynamically, in the same way as happens when indexing a
  document.
</li></ul></div><h3><a id="_aliases"></a>Aliases<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_4.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p><a class="link" href="indices-aliases.html" title="Index Aliases">Aliases</a> can include <a class="link" href="query-dsl-filters.html" title="Filters">filters</a> which
are automatically applied to any search performed via the alias.
<a class="link" href="indices-aliases.html#filtered" title="Filtered Aliasesedit">Filtered aliases</a> created with version <code class="literal">1.4.0</code> or later can only
refer to field names which exist in the mappings of the index (or indices)
pointed to by the alias.</p><p>Add or update a mapping via the <a class="link" href="indices-create-index.html" title="Create Index">create index</a> or
<a class="link" href="indices-put-mapping.html" title="Put Mapping">put mapping</a> apis.</p><h3><a id="_indices_apis"></a>Indices APIs<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_4.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The <a class="link" href="indices-warmers.html#warmer-retrieving" title="GETting Warmeredit">get warmer api</a> will return a section for <code class="literal">warmers</code> even if there are
no warmers.  This ensures that the following two examples are equivalent:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/_all/_warmers'

curl -XGET 'http://localhost:9200/_warmers'</pre></div><p>The <a class="link" href="indices-aliases.html#alias-retrieving" title="Retrieving existing aliasesedit">get alias api</a> will return a section for <code class="literal">aliases</code> even if there are
no aliases.  This ensures that the following two examples are equivalent:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/_all/_aliases'

curl -XGET 'http://localhost:9200/_aliases'</pre></div><p>The <a class="link" href="indices-get-mapping.html" title="Get Mapping">get mapping api</a> will return a section for <code class="literal">mappings</code> even if there are
no mappings.  This ensures that the following two examples are equivalent:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/_all/_mappings'

curl -XGET 'http://localhost:9200/_mappings'</pre></div><h3><a id="_bulk_udp"></a>Bulk UDP<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_4.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p><a class="link" href="docs-bulk-udp.html" title="Bulk UDP API">Bulk UDP</a> has been deprecated and will be removed in 2.0.
You should use <a class="link" href="docs-bulk.html" title="Bulk API">the standard bulk API</a> instead.
Each cluster must have an elected master node in order to be fully operational. Once a node loses its elected master
node it will reject some or all operations.</p><h3><a id="_zen_discovery"></a>Zen discovery<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_4.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>On versions before <code class="literal">1.4.0.Beta1</code> all operations are rejected when a node loses its elected master. From <code class="literal">1.4.0.Beta1</code>
only write operations will be rejected by default. Read operations will still be served based on the information available
to the node, which may result in being partial and possibly also stale. If the default is undesired then the
pre <code class="literal">1.4.0.Beta1</code> behaviour can be enabled, see: <a class="link" href="modules-discovery-zen.html" title="Zen Discovery">no-master-block</a></p><h3><a id="_more_like_this_field"></a>More Like This Field<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_4.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The More Like This Field query has been deprecated in favor of the <a class="link" href="query-dsl-mlt-query.html" title="More Like This Query">More Like This Query</a>
restrained set to a specific <code class="literal">field</code>. It will be removed in 2.0.</p><h3><a id="_mvel_is_deprecated"></a>MVEL is deprecated<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_4.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Groovy is the new default scripting language in Elasticsearch, and is enabled in <code class="literal">sandbox</code> mode
by default.  MVEL has been removed from core, but is available as a plugin:
<a class="ulink" href="https://github.com/elasticsearch/elasticsearch-lang-mvel" target="_top">https://github.com/elasticsearch/elasticsearch-lang-mvel</a></p></div><div class="navfooter"><span class="prev"><a href="breaking-changes-1.5.html">
              «&nbsp;
              Breaking changes in 1.5</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="breaking-changes-1.0.html">Breaking changes in 1.0
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="breaking-changes.html">Breaking changes</a></span> » <span class="breadcrumb-node">Breaking changes in 1.0</span></div><div class="navheader"><span class="prev"><a href="breaking-changes-1.4.html">
              «&nbsp;
              Breaking changes in 1.4</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_system_and_settings.html">System and settings
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="breaking-changes-1.0"></a>Breaking changes in 1.0<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_0.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>This section discusses the changes that you need to be aware of when migrating
your application to Elasticsearch 1.0.</p></div><div class="navfooter"><span class="prev"><a href="breaking-changes-1.4.html">
              «&nbsp;
              Breaking changes in 1.4</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_system_and_settings.html">System and settings
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="breaking-changes.html">Breaking changes</a></span> » <span class="breadcrumb-link"><a href="breaking-changes-1.0.html">Breaking changes in 1.0</a></span> » <span class="breadcrumb-node">System and settings</span></div><div class="navheader"><span class="prev"><a href="breaking-changes-1.0.html">
              «&nbsp;
              Breaking changes in 1.0</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_stats_and_info_apis.html">Stats and Info APIs
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_system_and_settings"></a>System and settings<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_0.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Elasticsearch now runs in the foreground by default.  There is no more <code class="literal">-f</code>
  flag on the command line.  Instead, to run elasticsearch as a daemon, use
  the <code class="literal">-d</code> flag:
</li></ul></div><div class="pre_wrapper"><pre class="programlisting">./bin/elasticsearch -d</pre></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Command line settings can now be passed without the <code class="literal">-Des.</code> prefix, for
  instance:
</li></ul></div><div class="pre_wrapper"><pre class="programlisting">./bin/elasticsearch --node.name=search_1 --cluster.name=production</pre></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Elasticsearch on 64 bit Linux now uses <a class="link" href="index-modules-store.html#mmapfs" title="MMap FSedit"><code class="literal">mmapfs</code></a> by default.  Make
  sure that you set <a class="link" href="setup-service.html" title="Running as a Service on Linux"><code class="literal">MAX_MAP_COUNT</code></a> to a sufficiently high
  number.  The RPM and Debian packages default this value to <code class="literal">262144</code>.
</li><li class="listitem">
The RPM and Debian packages no longer start Elasticsearch by default.
</li><li class="listitem"><p class="simpara">
The <code class="literal">cluster.routing.allocation</code> settings (<code class="literal">disable_allocation</code>,
  <code class="literal">disable_new_allocation</code> and <code class="literal">disable_replica_location</code>) have been
  <a class="link" href="modules-cluster.html" title="Cluster">replaced by the single setting</a>:
</p><div class="pre_wrapper"><pre class="programlisting">cluster.routing.allocation.enable: all|primaries|new_primaries|none</pre></div></li></ul></div></div><div class="navfooter"><span class="prev"><a href="breaking-changes-1.0.html">
              «&nbsp;
              Breaking changes in 1.0</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_stats_and_info_apis.html">Stats and Info APIs
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="breaking-changes.html">Breaking changes</a></span> » <span class="breadcrumb-link"><a href="breaking-changes-1.0.html">Breaking changes in 1.0</a></span> » <span class="breadcrumb-node">Stats and Info APIs</span></div><div class="navheader"><span class="prev"><a href="_system_and_settings.html">
              «&nbsp;
              System and settings</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_indices_apis_2.html">Indices APIs
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_stats_and_info_apis"></a>Stats and Info APIs<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_0.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <a class="link" href="cluster-state.html" title="Cluster State"><code class="literal">cluster_state</code></a>, <a class="link" href="cluster-nodes-info.html" title="Nodes Info"><code class="literal">nodes_info</code></a>,
<a class="link" href="cluster-nodes-stats.html" title="Nodes Stats"><code class="literal">nodes_stats</code></a> and <a class="link" href="indices-stats.html" title="Indices Stats"><code class="literal">indices_stats</code></a>
APIs have all been changed to make their format more RESTful and less clumsy.</p><p>For instance, if you just want the <code class="literal">nodes</code> section of the the <code class="literal">cluster_state</code>,
instead of:</p><div class="pre_wrapper"><pre class="programlisting">GET /_cluster/state?filter_metadata&amp;filter_routing_table&amp;filter_blocks</pre></div><p>you now use:</p><div class="pre_wrapper"><pre class="programlisting">GET /_cluster/state/nodes</pre></div><p>Similarly for the <code class="literal">nodes_stats</code> API, if you want the <code class="literal">transport</code> and <code class="literal">http</code>
metrics only, instead of:</p><div class="pre_wrapper"><pre class="programlisting">GET /_nodes/stats?clear&amp;transport&amp;http</pre></div><p>you now use:</p><div class="pre_wrapper"><pre class="programlisting">GET /_nodes/stats/transport,http</pre></div><p>See the links above for full details.</p></div><div class="navfooter"><span class="prev"><a href="_system_and_settings.html">
              «&nbsp;
              System and settings</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_indices_apis_2.html">Indices APIs
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="breaking-changes.html">Breaking changes</a></span> » <span class="breadcrumb-link"><a href="breaking-changes-1.0.html">Breaking changes in 1.0</a></span> » <span class="breadcrumb-node">Indices APIs</span></div><div class="navheader"><span class="prev"><a href="_stats_and_info_apis.html">
              «&nbsp;
              Stats and Info APIs</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_index_request.html">Index request
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_indices_apis_2"></a>Indices APIs<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_0.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">mapping</code>, <code class="literal">alias</code>, <code class="literal">settings</code>, and <code class="literal">warmer</code> index APIs are all similar
but there are subtle differences in the order of the URL and the response
body.  For instance, adding a mapping and a warmer look slightly different:</p><div class="pre_wrapper"><pre class="programlisting">PUT /{index}/{type}/_mapping
PUT /{index}/_warmer/{name}</pre></div><p>These URLs have been unified as:</p><div class="pre_wrapper"><pre class="programlisting">PUT /{indices}/_mapping/{type}
PUT /{indices}/_alias/{name}
PUT /{indices}/_warmer/{name}

GET /{indices}/_mapping/{types}
GET /{indices}/_alias/{names}
GET /{indices}/_settings/{names}
GET /{indices}/_warmer/{names}

DELETE /{indices}/_mapping/{types}
DELETE /{indices}/_alias/{names}
DELETE /{indices}/_warmer/{names}</pre></div><p>All of the <code class="literal">{indices}</code>, <code class="literal">{types}</code> and <code class="literal">{names}</code> parameters can be replaced by:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">_all</code>, <code class="literal">*</code> or blank (ie left out altogether), all of which mean “all”
</li><li class="listitem">
wildcards like <code class="literal">test*</code>
</li><li class="listitem">
comma-separated lists: <code class="literal">index_1,test_*</code>
</li></ul></div><p>The only exception is <code class="literal">DELETE</code> which doesn’t accept blank (missing)
parameters. If you want to delete something, you should be specific.</p><p>Similarly, the return values for <code class="literal">GET</code> have been unified with the following
rules:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Only return values that exist.  If you try to <code class="literal">GET</code> a mapping which doesn’t
  exist, then the result will be an empty object: <code class="literal">{}</code>. We no longer throw a
  <code class="literal">404</code> if the requested mapping/warmer/alias/setting doesn’t exist.
</li><li class="listitem"><p class="simpara">
The response format always has the index name, then the section, then the
  element name, for instance:
</p><div class="pre_wrapper"><pre class="programlisting">{
    "my_index": {
        "mappings": {
            "my_type": {...}
        }
    }
}</pre></div><p class="simpara">This is a breaking change for the <code class="literal">get_mapping</code> API.</p></li></ul></div><p>In the future we will also provide plural versions to allow putting multiple mappings etc in a single request.</p><p>See <a class="link" href="indices-put-mapping.html" title="Put Mapping"><code class="literal">put-mapping</code></a>, <a class="link" href="indices-get-mapping.html" title="Get Mapping"><code class="literal">get-mapping</code></a>, <a class="link" href="indices-get-field-mapping.html" title="Get Field Mapping"><code class="literal">get-field-mapping</code></a>,
<a class="link" href="indices-delete-mapping.html" title="Delete Mapping"><code class="literal">delete-mapping</code></a>,
<a class="link" href="indices-update-settings.html" title="Update Indices Settings"><code class="literal">update-settings</code></a>, <a class="link" href="indices-get-settings.html" title="Get Settings"><code class="literal">get-settings</code></a>,
<a class="link" href="indices-warmers.html" title="Warmers"><code class="literal">warmers</code></a>, and <a class="link" href="indices-aliases.html" title="Index Aliases"><code class="literal">aliases</code></a> for more details.</p></div><div class="navfooter"><span class="prev"><a href="_stats_and_info_apis.html">
              «&nbsp;
              Stats and Info APIs</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_index_request.html">Index request
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="breaking-changes.html">Breaking changes</a></span> » <span class="breadcrumb-link"><a href="breaking-changes-1.0.html">Breaking changes in 1.0</a></span> » <span class="breadcrumb-node">Index request</span></div><div class="navheader"><span class="prev"><a href="_indices_apis_2.html">
              «&nbsp;
              Indices APIs</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_search_requests.html">Search requests
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_index_request"></a>Index request<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_0.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Previously a document could be indexed as itself, or wrapped in an outer
object which specified the <code class="literal">type</code> name:</p><div class="pre_wrapper"><pre class="programlisting">PUT /my_index/my_type/1
{
  "my_type": {
     ... doc fields ...
  }
}</pre></div><p>This led to some ambiguity when a document also included a field with the same
name as the <code class="literal">type</code>.  We no longer accept the outer <code class="literal">type</code> wrapper, but this
behaviour can be reenabled on an index-by-index basis with the setting:
<code class="literal">index.mapping.allow_type_wrapper</code>.</p></div><div class="navfooter"><span class="prev"><a href="_indices_apis_2.html">
              «&nbsp;
              Indices APIs</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_search_requests.html">Search requests
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="breaking-changes.html">Breaking changes</a></span> » <span class="breadcrumb-link"><a href="breaking-changes-1.0.html">Breaking changes in 1.0</a></span> » <span class="breadcrumb-node">Search requests</span></div><div class="navheader"><span class="prev"><a href="_index_request.html">
              «&nbsp;
              Index request</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_multi_fields.html">Multi-fields
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_search_requests"></a>Search requests<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_0.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>While the <code class="literal">search</code> API takes a top-level <code class="literal">query</code> parameter, the
<a class="link" href="search-count.html" title="Count API"><code class="literal">count</code></a>, <a class="link" href="docs-delete-by-query.html" title="Delete By Query API"><code class="literal">delete-by-query</code></a> and
<a class="link" href="search-validate.html" title="Validate API"><code class="literal">validate-query</code></a> requests expected the whole body to be a
query. These now <span class="emphasis"><em>require</em></span> a top-level <code class="literal">query</code> parameter:</p><div class="pre_wrapper"><pre class="programlisting">GET /_count
{
    "query": {
        "match": {
            "title": "Interesting stuff"
        }
    }
}</pre></div><p>Also, the top-level <code class="literal">filter</code> parameter in search has been renamed to
<a class="link" href="search-request-post-filter.html" title="Post filter"><code class="literal">post_filter</code></a>, to indicate that it should not
be used as the primary way to filter search results (use a
<a class="link" href="query-dsl-filtered-query.html" title="Filtered Query"><code class="literal">filtered</code> query</a> instead), but only to filter
results AFTER facets/aggregations have been calculated.</p><p>This example counts the top colors in all matching docs, but only returns docs
with color <code class="literal">red</code>:</p><div class="pre_wrapper"><pre class="programlisting">GET /_search
{
    "query": {
        "match_all": {}
    },
    "aggs": {
        "colors": {
            "terms": { "field": "color" }
        }
    },
    "post_filter": {
        "term": {
            "color": "red"
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="_index_request.html">
              «&nbsp;
              Index request</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_multi_fields.html">Multi-fields
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="breaking-changes.html">Breaking changes</a></span> » <span class="breadcrumb-link"><a href="breaking-changes-1.0.html">Breaking changes in 1.0</a></span> » <span class="breadcrumb-node">Multi-fields</span></div><div class="navheader"><span class="prev"><a href="_search_requests.html">
              «&nbsp;
              Search requests</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_stopwords.html">Stopwords
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_multi_fields"></a>Multi-fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_0.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Multi-fields are dead! Long live multi-fields!  Well, the field type
<code class="literal">multi_field</code> has been removed.  Instead, any of the core field types
(excluding <code class="literal">object</code> and <code class="literal">nested</code>) now accept a <code class="literal">fields</code> parameter.  It’s the
same thing, but nicer. Instead of:</p><div class="pre_wrapper"><pre class="programlisting">"title": {
    "type": "multi_field",
    "fields": {
        "title": { "type": "string" },
        "raw":   { "type": "string", "index": "not_analyzed" }
    }
}</pre></div><p>you can now write:</p><div class="pre_wrapper"><pre class="programlisting">"title": {
    "type": "string",
    "fields": {
        "raw":   { "type": "string", "index": "not_analyzed" }
    }
}</pre></div><p>Existing multi-fields will be upgraded to the new format automatically.</p><p>Also, instead of having to use the arcane <code class="literal">path</code> and <code class="literal">index_name</code> parameters
in order to index multiple fields into a single “custom <code class="literal">_all</code> field”, you
can now use the <a class="link" href="mapping-core-types.html#copy-to" title="Copy to fieldedit"><code class="literal">copy_to</code> parameter</a>.</p></div><div class="navfooter"><span class="prev"><a href="_search_requests.html">
              «&nbsp;
              Search requests</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_stopwords.html">Stopwords
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="breaking-changes.html">Breaking changes</a></span> » <span class="breadcrumb-link"><a href="breaking-changes-1.0.html">Breaking changes in 1.0</a></span> » <span class="breadcrumb-node">Stopwords</span></div><div class="navheader"><span class="prev"><a href="_multi_fields.html">
              «&nbsp;
              Multi-fields</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_dates_without_years.html">Dates without years
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_stopwords"></a>Stopwords<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_0.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Previously, the <a class="link" href="analysis-standard-analyzer.html" title="Standard Analyzer"><code class="literal">standard</code></a> and
<a class="link" href="analysis-pattern-analyzer.html" title="Pattern Analyzer"><code class="literal">pattern</code></a> analyzers used the list of English stopwords
by default, which caused some hard to debug indexing issues.  Now they are set to
use the empty stopwords list (ie <code class="literal">_none_</code>) instead.</p></div><div class="navfooter"><span class="prev"><a href="_multi_fields.html">
              «&nbsp;
              Multi-fields</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_dates_without_years.html">Dates without years
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="breaking-changes.html">Breaking changes</a></span> » <span class="breadcrumb-link"><a href="breaking-changes-1.0.html">Breaking changes in 1.0</a></span> » <span class="breadcrumb-node">Dates without years</span></div><div class="navheader"><span class="prev"><a href="_stopwords.html">
              «&nbsp;
              Stopwords</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_parameters.html">Parameters
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_dates_without_years"></a>Dates without years<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_0.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>When dates are specified without a year, for example: <code class="literal">Dec 15 10:00:00</code> they
are treated as dates in 2000 during indexing and range searches… except for
the upper included bound <code class="literal">lte</code> where they were treated as dates in 1970!  Now,
all <a class="ulink" href="https://github.com/elasticsearch/elasticsearch/issues/4451" target="_top">dates without years</a>
use <code class="literal">1970</code> as the default.</p></div><div class="navfooter"><span class="prev"><a href="_stopwords.html">
              «&nbsp;
              Stopwords</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_parameters.html">Parameters
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="breaking-changes.html">Breaking changes</a></span> » <span class="breadcrumb-link"><a href="breaking-changes-1.0.html">Breaking changes in 1.0</a></span> » <span class="breadcrumb-node">Parameters</span></div><div class="navheader"><span class="prev"><a href="_dates_without_years.html">
              «&nbsp;
              Dates without years</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_return_values.html">Return values
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_parameters"></a>Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_0.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Geo queries used to use <code class="literal">miles</code> as the default unit.  And we
  <a class="ulink" href="http://en.wikipedia.org/wiki/Mars_Climate_Orbiter" target="_top">all know what
  happened at NASA</a> because of that decision.  The new default unit is
  <a class="ulink" href="https://github.com/elasticsearch/elasticsearch/issues/4515" target="_top"><code class="literal">meters</code></a>.
</li><li class="listitem">
For all queries that support <span class="emphasis"><em>fuzziness</em></span>, the <code class="literal">min_similarity</code>, <code class="literal">fuzziness</code>
  and <code class="literal">edit_distance</code> parameters have been unified as the single parameter
  <code class="literal">fuzziness</code>.  See <a class="xref" href="common-options.html#fuzziness" title="Fuzzinessedit">the section called “Fuzziness</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>” for details of accepted values.
</li><li class="listitem">
The <code class="literal">ignore_missing</code> parameter has been replaced by the <code class="literal">expand_wildcards</code>,
  <code class="literal">ignore_unavailable</code> and <code class="literal">allow_no_indices</code> parameters, all of which have
  sensible defaults.  See <a class="link" href="multi-index.html" title="Multiple Indices">the multi-index docs</a> for more.
</li><li class="listitem"><p class="simpara">
An index name (or pattern) is now required for destructive operations like
  deleting indices:
</p><div class="pre_wrapper"><pre class="programlisting"># v0.90 - delete all indices:
DELETE /

# v1.0 - delete all indices:
DELETE /_all
DELETE /*</pre></div><p class="simpara">Setting <code class="literal">action.destructive_requires_name</code> to <code class="literal">true</code> provides further safety
by disabling wildcard expansion on destructive actions.</p></li></ul></div></div><div class="navfooter"><span class="prev"><a href="_dates_without_years.html">
              «&nbsp;
              Dates without years</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_return_values.html">Return values
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="breaking-changes.html">Breaking changes</a></span> » <span class="breadcrumb-link"><a href="breaking-changes-1.0.html">Breaking changes in 1.0</a></span> » <span class="breadcrumb-node">Return values</span></div><div class="navheader"><span class="prev"><a href="_parameters.html">
              «&nbsp;
              Parameters</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_deprecations.html">Deprecations
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_return_values"></a>Return values<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_0.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The <code class="literal">ok</code> return value has been removed from all response bodies as it added
  no useful information.
</li><li class="listitem">
The <code class="literal">found</code>, <code class="literal">not_found</code> and <code class="literal">exists</code> return values have been unified as
  <code class="literal">found</code> on all relevant APIs.
</li><li class="listitem"><p class="simpara">
Field values, in response to the <a class="link" href="search-request-fields.html" title="Fields"><code class="literal">fields</code></a>
  parameter, are now always returned as arrays.  A field could have single or
  multiple values, which meant that sometimes they were returned as scalars
  and sometimes as arrays.  By always returning arrays, this simplifies user
  code.  The only exception to this rule is when <code class="literal">fields</code> is used to retrieve
  metadata like the <code class="literal">routing</code> value, which are always singular.  Metadata
  fields are always returned as scalars.
</p><p class="simpara">The <code class="literal">fields</code> parameter is intended to be used for retrieving stored fields,
rather than for fields extracted from the <code class="literal">_source</code>. That means that it can no
longer be used to return whole objects and it no longer accepts the
<code class="literal">_source.fieldname</code> format. For these you should use the
<a class="link" href="search-request-source-filtering.html" title="Source filtering"><code class="literal">_source</code>  <code class="literal">_source_include</code> and <code class="literal">_source_exclude</code></a>
parameters instead.</p></li><li class="listitem"><p class="simpara">
Settings, like <code class="literal">index.analysis.analyzer.default</code> are now returned as proper
  nested JSON objects, which makes them easier to work with programatically:
</p><div class="pre_wrapper"><pre class="programlisting">{
    "index": {
        "analysis": {
            "analyzer": {
                "default": xxx
            }
        }
    }
}</pre></div><p class="simpara">You can choose to return them in flattened format by passing <code class="literal">?flat_settings</code>
in the query string.</p></li><li class="listitem">
The <a class="link" href="indices-analyze.html" title="Analyze"><code class="literal">analyze</code></a> API no longer supports the text response
  format, but does support JSON and YAML.
</li></ul></div></div><div class="navfooter"><span class="prev"><a href="_parameters.html">
              «&nbsp;
              Parameters</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_deprecations.html">Deprecations
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="breaking-changes.html">Breaking changes</a></span> » <span class="breadcrumb-link"><a href="breaking-changes-1.0.html">Breaking changes in 1.0</a></span> » <span class="breadcrumb-node">Deprecations</span></div><div class="navheader"><span class="prev"><a href="_return_values.html">
              «&nbsp;
              Return values</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_percolator_2.html">Percolator
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_deprecations"></a>Deprecations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_0.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The <code class="literal">text</code> query has been removed.  Use the
  <a class="link" href="query-dsl-match-query.html" title="Match Query"><code class="literal">match</code></a> query instead.
</li><li class="listitem">
The <code class="literal">field</code> query has been removed.  Use the
  <a class="link" href="query-dsl-query-string-query.html" title="Query String Query"><code class="literal">query_string</code></a> query instead.
</li><li class="listitem">
Per-document boosting with the <a class="link" href="mapping-boost-field.html" title="_boost"><code class="literal">_boost</code></a> field has
  been removed.  You can use the
  <a class="link" href="mapping-boost-field.html#function-score-instead-of-boost" title="Function score instead of boost"><code class="literal">function_score</code></a> instead.
</li><li class="listitem">
The <code class="literal">path</code> parameter in mappings has been deprecated. Use the
  <a class="link" href="mapping-core-types.html#copy-to" title="Copy to fieldedit"><code class="literal">copy_to</code></a> parameter instead.
</li><li class="listitem">
The <code class="literal">custom_score</code> and <code class="literal">custom_boost_score</code> is no longer supported. You can
  use <a class="link" href="query-dsl-function-score-query.html" title="Function Score Query"><code class="literal">function_score</code></a> instead.
</li></ul></div></div><div class="navfooter"><span class="prev"><a href="_return_values.html">
              «&nbsp;
              Return values</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_percolator_2.html">Percolator
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="breaking-changes.html">Breaking changes</a></span> » <span class="breadcrumb-link"><a href="breaking-changes-1.0.html">Breaking changes in 1.0</a></span> » <span class="breadcrumb-node">Percolator</span></div><div class="navheader"><span class="prev"><a href="_deprecations.html">
              «&nbsp;
              Deprecations</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="api-conventions.html">API Conventions
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_percolator_2"></a>Percolator<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/migration/migrate_1_0.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The percolator has been redesigned and because of this the dedicated <code class="literal">_percolator</code> index is no longer used by the percolator,
but instead the percolator works with a dedicated <code class="literal">.percolator</code> type. Read the <a class="ulink" href="http://www.elastic.co/blog/percolator-redesign-blog-post" target="_top">redesigned percolator</a>
blog post for the reasons why the percolator has been redesigned.</p><p>Elasticsearch will <span class="strong emphasis"><strong>not</strong></span> delete the <code class="literal">_percolator</code> index when upgrading, only the percolate api will not use the queries
stored in the <code class="literal">_percolator</code> index. In order to use the already stored queries, you can just re-index the queries from the
<code class="literal">_percolator</code> index into any index under the reserved <code class="literal">.percolator</code> type. The format in which the percolate queries
were stored has <span class="strong emphasis"><strong>not</strong></span> been changed. So a simple script that does a scan search to retrieve all the percolator queries
and then does a bulk request into another index should be sufficient.</p></div><div class="navfooter"><span class="prev"><a href="_deprecations.html">
              «&nbsp;
              Deprecations</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="api-conventions.html">API Conventions
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-node">API Conventions</span></div><div class="navheader"><span class="prev"><a href="_percolator_2.html">
              «&nbsp;
              Percolator</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="multi-index.html">Multiple Indices
              &nbsp;»
            </a></span></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="api-conventions"></a>API Conventions<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><div class="partintro"><div></div><p>The <span class="strong emphasis"><strong>elasticsearch</strong></span> REST APIs are exposed using <a class="link" href="modules-http.html" title="HTTP">JSON over HTTP</a>.</p><p>The conventions listed in this chapter can be applied throughout the REST
API, unless otherwise specified.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="multi-index.html" title="Multiple Indices"><em>Multiple Indices</em></a>
</li><li class="listitem">
<a class="xref" href="common-options.html" title="Common options"><em>Common options</em></a>
</li></ul></div></div></div><div class="navfooter"><span class="prev"><a href="_percolator_2.html">
              «&nbsp;
              Percolator</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="multi-index.html">Multiple Indices
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="api-conventions.html">API Conventions</a></span> » <span class="breadcrumb-node">Multiple Indices</span></div><div class="navheader"><span class="prev"><a href="api-conventions.html">
              «&nbsp;
              API Conventions</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="common-options.html">Common options
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="multi-index"></a>Multiple Indices<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Most APIs that refer to an <code class="literal">index</code> parameter support execution across multiple indices,
using simple <code class="literal">test1,test2,test3</code> notation (or <code class="literal">_all</code> for all indices). It also
support wildcards, for example: <code class="literal">test*</code>, and the ability to "add" (<code class="literal">+</code>)
and "remove" (<code class="literal">-</code>), for example: <code class="literal">+test*,-test3</code>.</p><p>All multi indices API support the following url query string parameters:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">ignore_unavailable</code>
</span></dt><dd>
Controls whether to ignore if any specified indices are unavailable, this
includes indices that don’t exist or closed indices. Either <code class="literal">true</code> or <code class="literal">false</code>
can be specified.
</dd><dt><span class="term">
<code class="literal">allow_no_indices</code>
</span></dt><dd>
Controls whether to fail if a wildcard indices expressions results into no
concrete indices. Either <code class="literal">true</code> or <code class="literal">false</code> can be specified. For example if
the wildcard expression <code class="literal">foo*</code> is specified and no indices are available that
start with <code class="literal">foo</code> then depending on this setting the request will fail. This
setting is also applicable when <code class="literal">_all</code>, <code class="literal">*</code> or no index has been specified. This
settings also applies for aliases, in case an alias points to a closed index.
</dd><dt><span class="term">
<code class="literal">expand_wildcards</code>
</span></dt><dd>
Controls to what kind of concrete indices wildcard indices expression expand
to. If <code class="literal">open</code> is specified then the wildcard expression is expanded to only
open indices and if <code class="literal">closed</code> is specified then the wildcard expression is
expanded only to closed indices. Also both values (<code class="literal">open,closed</code>) can be
specified to expand to all indices.
</dd></dl></div><p>If <code class="literal">none</code> is specified then wildcard expansion will be disabled and if <code class="literal">all</code>
is specified, wildcard expressions will expand to all indices (this is equivalent
to specifying <code class="literal">open,closed</code>).</p><p>The defaults settings for the above parameters depend on the api being used.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Single index APIs such as the <a class="xref" href="docs.html" title="Document APIs">Document APIs</a> and the
<a class="link" href="indices-aliases.html" title="Index Aliases">single-index <code class="literal">alias</code> APIs</a> do not support multiple indices.</p></div></div></div><div class="navfooter"><span class="prev"><a href="api-conventions.html">
              «&nbsp;
              API Conventions</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="common-options.html">Common options
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="api-conventions.html">API Conventions</a></span> » <span class="breadcrumb-node">Common options</span></div><div class="navheader"><span class="prev"><a href="multi-index.html">
              «&nbsp;
              Multiple Indices</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="url-access-control.html">URL-based access control
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="common-options"></a>Common options<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The following options can be applied to all of the REST APIs.</p><h3><a id="_pretty_results"></a>Pretty Results<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>When appending <code class="literal">?pretty=true</code> to any request made, the JSON returned
will be pretty formatted (use it for debugging only!). Another option is
to set <code class="literal">?format=yaml</code> which will cause the result to be returned in the
(sometimes) more readable yaml format.</p><h3><a id="_human_readable_output"></a>Human readable output<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Statistics are returned in a format suitable for humans
(eg <code class="literal">"exists_time": "1h"</code> or <code class="literal">"size": "1kb"</code>) and for computers
(eg <code class="literal">"exists_time_in_millis": 3600000</code> or <code class="literal">"size_in_bytes": 1024</code>).
The human readable values can be turned off by adding <code class="literal">?human=false</code>
to the query string. This makes sense when the stats results are
being consumed by a monitoring tool, rather than intended for human
consumption.  The default for the <code class="literal">human</code> flag is
<code class="literal">false</code>.</p><h3><a id="_response_filtering"></a>Response Filtering<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>All REST APIs accept a <code class="literal">filter_path</code> parameter that can be used to reduce
the response returned by elasticsearch. This parameter takes a comma
separated list of filters expressed with the dot notation:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/_search?pretty&amp;filter_path=took,hits.hits._id,hits.hits._score'
{
  "took" : 3,
  "hits" : {
    "hits" : [
      {
        "_id" : "3640",
        "_score" : 1.0
      },
      {
        "_id" : "3642",
        "_score" : 1.0
      }
    ]
  }
}</pre></div><p>It also supports the <code class="literal">*</code> wildcard character to match any field or part
of a field’s name:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/_nodes/stats?filter_path=nodes.*.ho*'
{
  "nodes" : {
    "lvJHed8uQQu4brS-SXKsNA" : {
      "host" : "portable"
    }
  }
}</pre></div><p>And the <code class="literal">**</code> wildcard can be used to include fields without knowing the
exact path of the field. For example, we can return the Lucene version
of every segment with this request:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/_segments?pretty&amp;filter_path=indices.**.version'
{
  "indices" : {
    "movies" : {
      "shards" : {
        "0" : [ {
          "segments" : {
            "_0" : {
              "version" : "5.2.0"
            }
          }
        } ],
        "2" : [ {
          "segments" : {
            "_0" : {
              "version" : "5.2.0"
            }
          }
        } ]
      }
    },
    "books" : {
      "shards" : {
        "0" : [ {
          "segments" : {
            "_0" : {
              "version" : "5.2.0"
            }
          }
        } ]
      }
    }
  }
}</pre></div><p>Note that elasticsearch sometimes returns directly the raw value of a field,
like the <code class="literal">_source</code> field. If you want to filter _source fields, you should
consider combining the already existing <code class="literal">_source</code> parameter (see
<a class="link" href="docs-get.html#get-source-filtering" title="Source filteringedit">Get API</a> for more details) with the <code class="literal">filter_path</code>
 parameter like this:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/_search?pretty&amp;filter_path=hits.hits._source&amp;_source=title'
{
  "hits" : {
    "hits" : [ {
      "_source":{"title":"Book #2"}
    }, {
      "_source":{"title":"Book #1"}
    }, {
      "_source":{"title":"Book #3"}
    } ]
  }
}</pre></div><h3><a id="_flat_settings"></a>Flat Settings<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The <code class="literal">flat_settings</code> flag affects rendering of the lists of settings. When
<code class="literal">flat_settings</code> flag is <code class="literal">true</code> settings are returned in a flat format:</p><div class="pre_wrapper"><pre class="programlisting">{
  "persistent" : { },
  "transient" : {
    "discovery.zen.minimum_master_nodes" : "1"
  }
}</pre></div><p>When the <code class="literal">flat_settings</code> flag is <code class="literal">false</code> settings are returned in a more
human readable structured format:</p><div class="pre_wrapper"><pre class="programlisting">{
  "persistent" : { },
  "transient" : {
    "discovery" : {
      "zen" : {
        "minimum_master_nodes" : "1"
      }
    }
  }
}</pre></div><p>By default the <code class="literal">flat_settings</code> is set to <code class="literal">false</code>.</p><h3><a id="_parameters_2"></a>Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Rest parameters (when using HTTP, map to HTTP URL parameters) follow the
convention of using underscore casing.</p><h3><a id="_boolean_values"></a>Boolean Values<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>All REST APIs parameters (both request parameters and JSON body) support
providing boolean "false" as the values: <code class="literal">false</code>, <code class="literal">0</code>, <code class="literal">no</code> and <code class="literal">off</code>.
All other values are considered "true". Note, this is not related to
fields within a document indexed treated as boolean fields.</p><h3><a id="_number_values"></a>Number Values<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>All REST APIs support providing numbered parameters as <code class="literal">string</code> on top
of supporting the native JSON number types.</p><h3><a id="time-units"></a>Time units<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Whenever durations need to be specified, eg for a <code class="literal">timeout</code> parameter, the duration
can be specified as a whole number representing time in milliseconds, or as a time value like <code class="literal">2d</code> for 2 days.  The supported units are:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">y</code>
</p>
</td><td class="entry" valign="top">
<p>
Year
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">M</code>
</p>
</td><td class="entry" valign="top">
<p>
Month
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">w</code>
</p>
</td><td class="entry" valign="top">
<p>
Week
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">d</code>
</p>
</td><td class="entry" valign="top">
<p>
Day
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">h</code>
</p>
</td><td class="entry" valign="top">
<p>
Hour
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">m</code>
</p>
</td><td class="entry" valign="top">
<p>
Minute
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">s</code>
</p>
</td><td class="entry" valign="top">
<p>
Second
</p>
</td></tr></tbody></table></div><h3><a id="distance-units"></a>Distance Units<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Wherever distances need to be specified, such as the <code class="literal">distance</code> parameter in
the <a class="xref" href="query-dsl-geo-distance-filter.html" title="Geo Distance Filter">Geo Distance Filter</a>), the default unit if none is specified is
the meter. Distances can be specified in other units, such as <code class="literal">"1km"</code> or
<code class="literal">"2mi"</code> (2 miles).</p><p>The full list of units is listed below:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
Mile
</p>
</td><td class="entry" valign="top">
<p>
<code class="literal">mi</code> or <code class="literal">miles</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
Yard
</p>
</td><td class="entry" valign="top">
<p>
<code class="literal">yd</code> or <code class="literal">yards</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
Feet
</p>
</td><td class="entry" valign="top">
<p>
<code class="literal">ft</code> or <code class="literal">feet</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
Inch
</p>
</td><td class="entry" valign="top">
<p>
<code class="literal">in</code> or <code class="literal">inch</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
Kilometer
</p>
</td><td class="entry" valign="top">
<p>
<code class="literal">km</code> or <code class="literal">kilometers</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
Meter
</p>
</td><td class="entry" valign="top">
<p>
<code class="literal">m</code> or <code class="literal">meters</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
Centimeter
</p>
</td><td class="entry" valign="top">
<p>
<code class="literal">cm</code> or <code class="literal">centimeters</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
Millimeter
</p>
</td><td class="entry" valign="top">
<p>
<code class="literal">mm</code> or <code class="literal">millimeters</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
Nautical mile
</p>
</td><td class="entry" valign="top">
<p>
<code class="literal">NM</code>, <code class="literal">nmi</code> or <code class="literal">nauticalmiles</code>
</p>
</td></tr></tbody></table></div><p>The <code class="literal">precision</code> parameter in the <a class="xref" href="query-dsl-geohash-cell-filter.html" title="Geohash Cell Filter">Geohash Cell Filter</a> accepts
distances with the above units, but if no unit is specified, then the
precision is interpreted as the length of the geohash.</p><h3><a id="fuzziness"></a>Fuzziness<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Some queries and APIs support parameters to allow inexact <span class="emphasis"><em>fuzzy</em></span> matching,
using the <code class="literal">fuzziness</code> parameter. The <code class="literal">fuzziness</code> parameter is context
sensitive which means that it depends on the type of the field being queried:</p><h4><a id="_numeric_date_and_ipv4_fields"></a>Numeric, date and IPv4 fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>When querying numeric, date and IPv4 fields, <code class="literal">fuzziness</code> is interpreted as a
<code class="literal">+/-</code> margin. It behaves like a <a class="xref" href="query-dsl-range-query.html" title="Range Query">Range Query</a> where:</p><pre class="literallayout">-fuzziness &lt;= field value &lt;= +fuzziness</pre><p>The <code class="literal">fuzziness</code> parameter should be set to a numeric value, eg <code class="literal">2</code> or <code class="literal">2.0</code>. A
<code class="literal">date</code> field interprets a long as milliseconds, but also accepts a string
containing a time value — <code class="literal">"1h"</code> — as explained in <a class="xref" href="common-options.html#time-units" title="Time unitsedit">the section called “Time units</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>”. An <code class="literal">ip</code>
field accepts a long or another IPv4 address (which will be converted into a
long).</p><h4><a id="_string_fields"></a>String fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>When querying <code class="literal">string</code> fields, <code class="literal">fuzziness</code> is interpreted as a
<a class="ulink" href="http://en.wikipedia.org/wiki/Levenshtein_distance" target="_top">Levenshtein Edit Distance</a> — the number of one character changes that need to be made to one string to
make it the same as another string.</p><p>The <code class="literal">fuzziness</code> parameter can be specified as:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">0</code>, <code class="literal">1</code>, <code class="literal">2</code>
</span></dt><dd>
the maximum allowed Levenshtein Edit Distance (or number of edits)
</dd><dt><span class="term">
<code class="literal">AUTO</code>
</span></dt><dd><p class="simpara">generates an edit distance based on the length of the term. For lengths:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">0..2</code>
</span></dt><dd>
must match exactly
</dd><dt><span class="term">
<code class="literal">3..5</code>
</span></dt><dd>
one edit allowed
</dd><dt><span class="term">
<code class="literal">&gt;5</code>
</span></dt><dd>
two edits allowed
</dd></dl></div><p class="simpara"><code class="literal">AUTO</code> should generally be the preferred value for <code class="literal">fuzziness</code>.</p></dd><dt><span class="term">
<code class="literal">0.0..1.0</code>
</span></dt><dd>
<span class="deprecated">
      [<span class="version">1.7.0</span>]
      <span class="detail">Deprecated in 1.7.0.
Support for similarity will be removed in Elasticsearch 2.0
</span></span>
converted into an edit distance using the formula: <code class="literal">length(term) * (1.0 -
fuzziness)</code>, eg a <code class="literal">fuzziness</code> of <code class="literal">0.6</code> with a term of length 10 would result
in an edit distance of <code class="literal">4</code>. Note: in all APIs except for the
<a class="xref" href="query-dsl-flt-query.html" title="Fuzzy Like This Query">Fuzzy Like This Query</a>, the maximum allowed edit distance is <code class="literal">2</code>.
</dd></dl></div><h3><a id="_result_casing"></a>Result Casing<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>All REST APIs accept the <code class="literal">case</code> parameter. When set to <code class="literal">camelCase</code>, all
field names in the result will be returned in camel casing, otherwise,
underscore casing will be used. Note, this does not apply to the source
document indexed.</p><h3><a id="_jsonp"></a>JSONP<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>When enabled, all REST APIs accept a <code class="literal">callback</code> parameter
resulting in a <a class="ulink" href="http://en.wikipedia.org/wiki/JSONP" target="_top">JSONP</a> result. You can enable
this behavior by adding the following to <code class="literal">config.yaml</code>:</p><pre class="literallayout">http.jsonp.enable: true</pre><p>Please note, when enabled, due to the architecture of Elasticsearch, this may pose
a security risk. Under some circumstances, an attacker may be able to exfiltrate
data in your Elasticsearch server if they’re able to force your browser to make a
JSONP request on your behalf (e.g. by including a &lt;script&gt; tag on an untrusted site
with a legitimate query against a local Elasticsearch server).</p><h3><a id="_request_body_in_query_string"></a>Request body in query string<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>For libraries that don’t accept a request body for non-POST requests,
you can pass the request body as the <code class="literal">source</code> query string parameter
instead.</p></div><div class="navfooter"><span class="prev"><a href="multi-index.html">
              «&nbsp;
              Multiple Indices</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="url-access-control.html">URL-based access control
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="api-conventions.html">API Conventions</a></span> » <span class="breadcrumb-node">URL-based access control</span></div><div class="navheader"><span class="prev"><a href="common-options.html">
              «&nbsp;
              Common options</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs.html">Document APIs
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="url-access-control"></a>URL-based access control<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Many users use a proxy with URL-based access control to secure access to
Elasticsearch indices. For <a class="link" href="search-multi-search.html" title="Multi Search API">multi-search</a>,
<a class="link" href="docs-multi-get.html" title="Multi Get API">multi-get</a> and <a class="link" href="docs-bulk.html" title="Bulk API">bulk</a> requests, the user has
the choice of specifying an index in the URL and on each individual request
within the request body. This can make URL-based access control challenging.</p><p>To prevent the user from overriding the index which has been specified in the
URL, add this setting to the <code class="literal">config.yml</code> file:</p><pre class="literallayout">rest.action.multi.allow_explicit_index: false</pre><p>The default value is <code class="literal">true</code>, but when set to <code class="literal">false</code>, Elasticsearch will
reject requests that have an explicit index specified in the request body.</p></div><div class="navfooter"><span class="prev"><a href="common-options.html">
              «&nbsp;
              Common options</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs.html">Document APIs
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-node">Document APIs</span></div><div class="navheader"><span class="prev"><a href="url-access-control.html">
              «&nbsp;
              URL-based access control</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-index_.html">Index API
              &nbsp;»
            </a></span></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="docs"></a>Document APIs<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><div class="partintro"><div></div><p>This section describes the following CRUD APIs:</p><div class="itemizedlist"><p class="title"><strong>Single document APIs</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="docs-index_.html" title="Index API"><em>Index API</em></a>
</li><li class="listitem">
<a class="xref" href="docs-get.html" title="Get API"><em>Get API</em></a>
</li><li class="listitem">
<a class="xref" href="docs-delete.html" title="Delete API"><em>Delete API</em></a>
</li><li class="listitem">
<a class="xref" href="docs-update.html" title="Update API"><em>Update API</em></a>
</li></ul></div><div class="itemizedlist"><p class="title"><strong>Multi-document APIs</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="docs-multi-get.html" title="Multi Get API"><em>Multi Get API</em></a>
</li><li class="listitem">
<a class="xref" href="docs-bulk.html" title="Bulk API"><em>Bulk API</em></a>
</li><li class="listitem">
<a class="xref" href="docs-bulk-udp.html" title="Bulk UDP API"><em>Bulk UDP API</em></a>
</li><li class="listitem">
<a class="xref" href="docs-delete-by-query.html" title="Delete By Query API"><em>Delete By Query API</em></a>
</li></ul></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>All CRUD APIs are single-index APIs. The <code class="literal">index</code> parameter accepts a single
index name, or an <code class="literal">alias</code> which points to a single index.</p></div></div></div></div><div class="navfooter"><span class="prev"><a href="url-access-control.html">
              «&nbsp;
              URL-based access control</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-index_.html">Index API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="docs.html">Document APIs</a></span> » <span class="breadcrumb-node">Index API</span></div><div class="navheader"><span class="prev"><a href="docs.html">
              «&nbsp;
              Document APIs</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-get.html">Get API
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-index_"></a>Index API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/index_.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The index API adds or updates a typed JSON document in a specific index,
making it searchable. The following example inserts the JSON document
into the "twitter" index, under a type called "tweet" with an id of 1:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPUT 'http://localhost:9200/twitter/tweet/1' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</pre></div><p>The result of the above index operation is:</p><div class="pre_wrapper"><pre class="programlisting">{
    "_index" : "twitter",
    "_type" : "tweet",
    "_id" : "1",
    "_version" : 1,
    "created" : true
}</pre></div><h3><a id="index-creation"></a>Automatic Index Creation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/index_.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The index operation automatically creates an index if it has not been
created before (check out the
<a class="link" href="indices-create-index.html" title="Create Index">create index API</a> for manually
creating an index), and also automatically creates a
dynamic type mapping for the specific type if one has not yet been
created (check out the <a class="link" href="indices-put-mapping.html" title="Put Mapping">put mapping</a>
API for manually creating a type mapping).</p><p>The mapping itself is very flexible and is schema-free. New fields and
objects will automatically be added to the mapping definition of the
type specified. Check out the <a class="link" href="mapping.html" title="Mapping">mapping</a>
section for more information on mapping definitions.</p><p>Note that the format of the JSON document can also include the type (very handy
when using JSON mappers) if the <code class="literal">index.mapping.allow_type_wrapper</code> setting is
set to true, for example:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPOST 'http://localhost:9200/twitter' -d '{
  "settings": {
    "index": {
      "mapping.allow_type_wrapper": true
    }
  }
}'
{"acknowledged":true}

$ curl -XPUT 'http://localhost:9200/twitter/tweet/1' -d '{
    "tweet" : {
        "user" : "kimchy",
        "post_date" : "2009-11-15T14:12:12",
        "message" : "trying out Elasticsearch"
    }
}'</pre></div><p>Automatic index creation can be disabled by setting
<code class="literal">action.auto_create_index</code> to <code class="literal">false</code> in the config file of all nodes.
Automatic mapping creation can be disabled by setting
<code class="literal">index.mapper.dynamic</code> to <code class="literal">false</code> in the config files of all nodes (or
on the specific index settings).</p><p>Automatic index creation can include a pattern based white/black list,
for example, set <code class="literal">action.auto_create_index</code> to <code class="literal">+aaa*,-bbb*,+ccc*,-*</code> (+
meaning allowed, and - meaning disallowed).</p><h3><a id="index-versioning"></a>Versioning<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/index_.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Each indexed document is given a version number. The associated
<code class="literal">version</code> number is returned as part of the response to the index API
request. The index API optionally allows for
<a class="ulink" href="http://en.wikipedia.org/wiki/Optimistic_concurrency_control" target="_top">optimistic
concurrency control</a> when the <code class="literal">version</code> parameter is specified. This
will control the version of the document the operation is intended to be
executed against. A good example of a use case for versioning is
performing a transactional read-then-update. Specifying a <code class="literal">version</code> from
the document initially read ensures no changes have happened in the
meantime (when reading in order to update, it is recommended to set
<code class="literal">preference</code> to <code class="literal">_primary</code>). For example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'localhost:9200/twitter/tweet/1?version=2' -d '{
    "message" : "elasticsearch now has versioning support, double cool!"
}'</pre></div><p><span class="strong emphasis"><strong>NOTE:</strong></span> versioning is completely real time, and is not affected by the
near real time aspects of search operations. If no version is provided,
then the operation is executed without any version checks.</p><p>By default, internal versioning is used that starts at 1 and increments
with each update, deletes included. Optionally, the version number can be
supplemented with an external value (for example, if maintained in a
database). To enable this functionality, <code class="literal">version_type</code> should be set to
<code class="literal">external</code>. The value provided must be a numeric, long value greater or equal to 0,
and less than around 9.2e+18. When using the external version type, instead
of checking for a matching version number, the system checks to see if
the version number passed to the index request is greater than the
version of the currently stored document. If true, the document will be
indexed and the new version number used. If the value provided is less
than or equal to the stored document’s version number, a version
conflict will occur and the index operation will fail.</p><p>A nice side effect is that there is no need to maintain strict ordering
of async indexing operations executed as a result of changes to a source
database, as long as version numbers from the source database are used.
Even the simple case of updating the elasticsearch index using data from
a database is simplified if external versioning is used, as only the
latest version will be used if the index operations are out of order for
whatever reason.</p><h4><a id="_version_types"></a>Version types<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/index_.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Next to the <code class="literal">internal</code> &amp; <code class="literal">external</code> version types explained above, Elasticsearch
also supports other types for specific use cases. Here is an overview of
the different version types and their semantics.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">internal</code>
</span></dt><dd>
only index the document if the given version is identical to the version
of the stored document.
</dd><dt><span class="term">
<code class="literal">external</code> or <code class="literal">external_gt</code>
</span></dt><dd>
only index the document if the given version is strictly higher
than the version of the stored document <span class="strong emphasis"><strong>or</strong></span> if there is no existing document. The given
version will be used as the new version and will be stored with the new document. The supplied
version must be a non-negative long number.
</dd><dt><span class="term">
<code class="literal">external_gte</code>
</span></dt><dd>
only index the document if the given version is <span class="strong emphasis"><strong>equal</strong></span> or higher
than the version of the stored document. If there is no existing document
the operation will succeed as well. The given version will be used as the new version
and will be stored with the new document. The supplied version must be a non-negative long number.
</dd><dt><span class="term">
<code class="literal">force</code>
</span></dt><dd>
the document will be indexed regardless of the version of the stored document or if there
is no existing document. The given version will be used as the new version and will be stored
with the new document. This version type is typically used for correcting errors.
</dd></dl></div><p><span class="strong emphasis"><strong>NOTE</strong></span>: The <code class="literal">external_gte</code> &amp; <code class="literal">force</code> version types are meant for special use cases and should be used
with care. If used incorrectly, they can result in loss of data.</p><h3><a id="operation-type"></a>Operation Type<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/index_.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The index operation also accepts an <code class="literal">op_type</code> that can be used to force
a <code class="literal">create</code> operation, allowing for "put-if-absent" behavior. When
<code class="literal">create</code> is used, the index operation will fail if a document by that id
already exists in the index.</p><p>Here is an example of using the <code class="literal">op_type</code> parameter:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPUT 'http://localhost:9200/twitter/tweet/1?op_type=create' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</pre></div><p>Another option to specify <code class="literal">create</code> is to use the following uri:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPUT 'http://localhost:9200/twitter/tweet/1/_create' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</pre></div><h3><a id="_automatic_id_generation"></a>Automatic ID Generation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/index_.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The index operation can be executed without specifying the id. In such a
case, an id will be generated automatically. In addition, the <code class="literal">op_type</code>
will automatically be set to <code class="literal">create</code>. Here is an example (note the
<span class="strong emphasis"><strong>POST</strong></span> used instead of <span class="strong emphasis"><strong>PUT</strong></span>):</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPOST 'http://localhost:9200/twitter/tweet/' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</pre></div><p>The result of the above index operation is:</p><div class="pre_wrapper"><pre class="programlisting">{
    "_index" : "twitter",
    "_type" : "tweet",
    "_id" : "6a8ca01c-7896-48e9-81cc-9f70661fcb32",
    "_version" : 1,
    "created" : true
}</pre></div><h3><a id="index-routing"></a>Routing<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/index_.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>By default, shard placement — or <code class="literal">routing</code> — is controlled by using a
hash of the document’s id value. For more explicit control, the value
fed into the hash function used by the router can be directly specified
on a per-operation basis using the <code class="literal">routing</code> parameter. For example:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPOST 'http://localhost:9200/twitter/tweet?routing=kimchy' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</pre></div><p>In the example above, the "tweet" document is routed to a shard based on
the <code class="literal">routing</code> parameter provided: "kimchy".</p><p>When setting up explicit mapping, the <code class="literal">_routing</code> field can be optionally
used to direct the index operation to extract the routing value from the
document itself. This does come at the (very minimal) cost of an
additional document parsing pass. If the <code class="literal">_routing</code> mapping is defined,
and set to be <code class="literal">required</code>, the index operation will fail if no routing
value is provided or extracted.</p><h3><a id="parent-children"></a>Parents &amp; Children<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/index_.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>A child document can be indexed by specifying its parent when indexing.
For example:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPUT localhost:9200/blogs/blog_tag/1122?parent=1111 -d '{
    "tag" : "something"
}'</pre></div><p>When indexing a child document, the routing value is automatically set
to be the same as its parent, unless the routing value is explicitly
specified using the <code class="literal">routing</code> parameter.</p><h3><a id="index-timestamp"></a>Timestamp<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/index_.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>A document can be indexed with a <code class="literal">timestamp</code> associated with it. The
<code class="literal">timestamp</code> value of a document can be set using the <code class="literal">timestamp</code>
parameter. For example:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPUT localhost:9200/twitter/tweet/1?timestamp=2009-11-15T14%3A12%3A12 -d '{
    "user" : "kimchy",
    "message" : "trying out Elasticsearch"
}'</pre></div><p>If the <code class="literal">timestamp</code> value is not provided externally or in the <code class="literal">_source</code>,
the <code class="literal">timestamp</code> will be automatically set to the date the document was
processed by the indexing chain. More information can be found on the
<a class="link" href="mapping-timestamp-field.html" title="_timestamp">_timestamp mapping page</a>.</p><h3><a id="index-ttl"></a>TTL<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/index_.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>A document can be indexed with a <code class="literal">ttl</code> (time to live) associated with
it. Expired documents will be expunged automatically. The expiration
date that will be set for a document with a provided <code class="literal">ttl</code> is relative
to the <code class="literal">timestamp</code> of the document, meaning it can be based on the time
of indexing or on any time provided. The provided <code class="literal">ttl</code> must be strictly
positive and can be a number (in milliseconds) or any valid time value
as shown in the following examples:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'http://localhost:9200/twitter/tweet/1?ttl=86400000' -d '{
    "user": "kimchy",
    "message": "Trying out elasticsearch, so far so good?"
}'</pre></div><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'http://localhost:9200/twitter/tweet/1?ttl=1d' -d '{
    "user": "kimchy",
    "message": "Trying out elasticsearch, so far so good?"
}'</pre></div><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'http://localhost:9200/twitter/tweet/1' -d '{
    "_ttl": "1d",
    "user": "kimchy",
    "message": "Trying out elasticsearch, so far so good?"
}'</pre></div><p>More information can be found on the
<a class="link" href="mapping-ttl-field.html" title="_ttl">_ttl mapping page</a>.</p><h3><a id="index-distributed"></a>Distributed<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/index_.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The index operation is directed to the primary shard based on its route
(see the Routing section above) and performed on the actual node
containing this shard. After the primary shard completes the operation,
if needed, the update is distributed to applicable replicas. The index
operation only returns after all shards within the
replication group have indexed the document (sync replication).</p><h3><a id="index-consistency"></a>Write Consistency<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/index_.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>To prevent writes from taking place on the "wrong" side of a network
partition, by default, index operations only succeed if a quorum
(&gt;replicas/2+1) of active shards are available. This default can be
overridden on a node-by-node basis using the <code class="literal">action.write_consistency</code>
setting. To alter this behavior per-operation, the <code class="literal">consistency</code> request
parameter can be used.</p><p>Valid write consistency values are <code class="literal">one</code>, <code class="literal">quorum</code>, and <code class="literal">all</code>.</p><p>Note, for the case where the number of replicas is 1 (total of 2 copies
of the data), then the default behavior is to succeed if 1 copy (the primary)
can perform the write.</p><h3><a id="index-refresh"></a>Refresh<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/index_.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>To refresh the shard (not the whole index) immediately after the operation
occurs, so that the document appears in search results immediately, the
<code class="literal">refresh</code> parameter can be set to <code class="literal">true</code>. Setting this option to <code class="literal">true</code> should
<span class="strong emphasis"><strong>ONLY</strong></span> be done after careful thought and verification that it does not lead to
poor performance, both from an indexing and a search standpoint. Note, getting
a document using the get API is completely realtime.</p><h3><a id="timeout"></a>Timeout<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/index_.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The primary shard assigned to perform the index operation might not be
available when the index operation is executed. Some reasons for this
might be that the primary shard is currently recovering from a gateway
or undergoing relocation. By default, the index operation will wait on
the primary shard to become available for up to 1 minute before failing
and responding with an error. The <code class="literal">timeout</code> parameter can be used to
explicitly specify how long it waits. Here is an example of setting it
to 5 minutes:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPUT 'http://localhost:9200/twitter/tweet/1?timeout=5m' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</pre></div></div><div class="navfooter"><span class="prev"><a href="docs.html">
              «&nbsp;
              Document APIs</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-get.html">Get API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="docs.html">Document APIs</a></span> » <span class="breadcrumb-node">Get API</span></div><div class="navheader"><span class="prev"><a href="docs-index_.html">
              «&nbsp;
              Index API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-delete.html">Delete API
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-get"></a>Get API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The get API allows to get a typed JSON document from the index based on
its id. The following example gets a JSON document from an index called
twitter, under a type called tweet, with id valued 1:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/tweet/1'</pre></div><p>The result of the above get operation is:</p><div class="pre_wrapper"><pre class="programlisting">{
    "_index" : "twitter",
    "_type" : "tweet",
    "_id" : "1",
    "_version" : 1,
    "found": true,
    "_source" : {
        "user" : "kimchy",
        "postDate" : "2009-11-15T14:12:12",
        "message" : "trying out Elasticsearch"
    }
}</pre></div><p>The above result includes the <code class="literal">_index</code>, <code class="literal">_type</code>, <code class="literal">_id</code> and <code class="literal">_version</code>
of the document we wish to retrieve, including the actual <code class="literal">_source</code>
of the document if it could be found (as indicated by the <code class="literal">found</code>
field in the response).</p><p>The API also allows to check for the existence of a document using
<code class="literal">HEAD</code>, for example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XHEAD -i 'http://localhost:9200/twitter/tweet/1'</pre></div><h3><a id="realtime"></a>Realtime<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>By default, the get API is realtime, and is not affected by the refresh
rate of the index (when data will become visible for search).</p><p>In order to disable realtime GET, one can either set <code class="literal">realtime</code>
parameter to <code class="literal">false</code>, or globally default it to by setting the
<code class="literal">action.get.realtime</code> to <code class="literal">false</code> in the node configuration.</p><p>When getting a document, one can specify <code class="literal">fields</code> to fetch from it. They
will, when possible, be fetched as stored fields (fields mapped as
stored in the mapping). When using realtime GET, there is no notion of
stored fields (at least for a period of time, basically, until the next
flush), so they will be extracted from the source itself (note, even if
source is not enabled). It is a good practice to assume that the fields
will be loaded from source when using realtime GET, even if the fields
are stored.</p><h3><a id="type"></a>Optional Type<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The get API allows for <code class="literal">_type</code> to be optional. Set it to <code class="literal">_all</code> in order
to fetch the first document matching the id across all types.</p><h3><a id="get-source-filtering"></a>Source filtering<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>By default, the get operation returns the contents of the <code class="literal">_source</code> field unless
you have used the <code class="literal">fields</code> parameter or if the <code class="literal">_source</code> field is disabled.
You can turn off <code class="literal">_source</code> retrieval by using the <code class="literal">_source</code> parameter:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/tweet/1?_source=false'</pre></div><p>If you only need one or two fields from the complete <code class="literal">_source</code>, you can use the <code class="literal">_source_include</code>
&amp; <code class="literal">_source_exclude</code> parameters to include or filter out that parts you need. This can be especially helpful
with large documents where partial retrieval can save on network overhead. Both parameters take a comma separated list
of fields or wildcard expressions. Example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/tweet/1?_source_include=*.id&amp;_source_exclude=entities'</pre></div><p>If you only want to specify includes, you can use a shorter notation:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/tweet/1?_source=*.id,retweeted'</pre></div><h3><a id="get-fields"></a>Fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The get operation allows specifying a set of stored fields that will be
returned by passing the <code class="literal">fields</code> parameter. For example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/tweet/1?fields=title,content'</pre></div><p>For backward compatibility, if the requested fields are not stored, they will be fetched
from the <code class="literal">_source</code> (parsed and extracted). This functionality has been replaced by the
<a class="link" href="docs-get.html#get-source-filtering" title="Source filteringedit">source filtering</a> parameter.</p><p>Field values fetched from the document it self are always returned as an array. Metadata fields like <code class="literal">_routing</code> and
<code class="literal">_parent</code> fields are never returned as an array.</p><p>Also only leaf fields can be returned via the <code class="literal">field</code> option. So object fields can’t be returned and such requests
will fail.</p><h3><a id="generated-fields"></a>Generated fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>If no refresh occurred between indexing and refresh, GET will access the transaction log to fetch the document. However, some fields are generated only when indexing.
If you try to access a field that is only generated when indexing, you will get an exception (default). You can choose to ignore field that are generated if the transaction log is accessed by setting <code class="literal">ignore_errors_on_generated_fields=true</code>.</p><h3><a id="_source"></a>Getting the _source directly<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Use the <code class="literal">/{index}/{type}/{id}/_source</code> endpoint to get
just the <code class="literal">_source</code> field of the document,
without any additional content around it. For example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/tweet/1/_source'</pre></div><p>You can also use the same source filtering parameters to control which parts of the <code class="literal">_source</code> will be returned:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/tweet/1/_source?_source_include=*.id&amp;_source_exclude=entities'</pre></div><p>Note, there is also a HEAD variant for the _source endpoint to efficiently test for document existence.
Curl example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XHEAD -i 'http://localhost:9200/twitter/tweet/1/_source'</pre></div><h3><a id="get-routing"></a>Routing<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>When indexing using the ability to control the routing, in order to get
a document, the routing value should also be provided. For example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/tweet/1?routing=kimchy'</pre></div><p>The above will get a tweet with id 1, but will be routed based on the
user. Note, issuing a get without the correct routing, will cause the
document not to be fetched.</p><h3><a id="preference"></a>Preference<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Controls a <code class="literal">preference</code> of which shard replicas to execute the get
request on. By default, the operation is randomized between the shard
replicas.</p><p>The <code class="literal">preference</code> can be set to:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">_primary</code>
</span></dt><dd>
        The operation will go and be executed only on the primary
        shards.
</dd><dt><span class="term">
<code class="literal">_local</code>
</span></dt><dd>
        The operation will prefer to be executed on a local
        allocated shard if possible.
</dd><dt><span class="term">
Custom (string) value
</span></dt><dd>
        A custom value will be used to guarantee that
        the same shards will be used for the same custom value. This can help
        with "jumping values" when hitting different shards in different refresh
        states. A sample value can be something like the web session id, or the
        user name.
</dd></dl></div><h3><a id="get-refresh"></a>Refresh<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The <code class="literal">refresh</code> parameter can be set to <code class="literal">true</code> in order to refresh the
relevant shard before the get operation and make it searchable. Setting
it to <code class="literal">true</code> should be done after careful thought and verification that
this does not cause a heavy load on the system (and slows down
indexing).</p><h3><a id="get-distributed"></a>Distributed<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The get operation gets hashed into a specific shard id. It then gets
redirected to one of the replicas within that shard id and returns the
result. The replicas are the primary shard and its replicas within that
shard id group. This means that the more replicas we will have, the
better GET scaling we will have.</p><h3><a id="get-versioning"></a>Versioning support<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>You can use the <code class="literal">version</code> parameter to retrieve the document only if
it’s current version is equal to the specified one. This behavior is the same
for all version types with the exception of version type <code class="literal">FORCE</code> which always
retrieves the document.</p><p>Internally, Elasticsearch has marked the old document as deleted and added an
entirely new document. The old version of the document doesn’t disappear
immediately, although you won’t be able to access it. Elasticsearch cleans up
deleted documents in the background as you continue to index more data.</p></div><div class="navfooter"><span class="prev"><a href="docs-index_.html">
              «&nbsp;
              Index API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-delete.html">Delete API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="docs.html">Document APIs</a></span> » <span class="breadcrumb-node">Delete API</span></div><div class="navheader"><span class="prev"><a href="docs-get.html">
              «&nbsp;
              Get API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-update.html">Update API
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-delete"></a>Delete API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/delete.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The delete API allows to delete a typed JSON document from a specific
index based on its id. The following example deletes the JSON document
from an index called twitter, under a type called tweet, with id valued
1:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XDELETE 'http://localhost:9200/twitter/tweet/1'</pre></div><p>The result of the above delete operation is:</p><div class="pre_wrapper"><pre class="programlisting">{
    "found" : true,
    "_index" : "twitter",
    "_type" : "tweet",
    "_id" : "1",
    "_version" : 2
}</pre></div><h3><a id="delete-versioning"></a>Versioning<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/delete.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Each document indexed is versioned. When deleting a document, the
<code class="literal">version</code> can be specified to make sure the relevant document we are
trying to delete is actually being deleted and it has not changed in the
meantime. Every write operation executed on a document, deletes included,
causes its version to be incremented.</p><h3><a id="delete-routing"></a>Routing<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/delete.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>When indexing using the ability to control the routing, in order to
delete a document, the routing value should also be provided. For
example:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XDELETE 'http://localhost:9200/twitter/tweet/1?routing=kimchy'</pre></div><p>The above will delete a tweet with id 1, but will be routed based on the
user. Note, issuing a delete without the correct routing, will cause the
document to not be deleted.</p><p>Many times, the routing value is not known when deleting a document. For
those cases, when specifying the <code class="literal">_routing</code> mapping as <code class="literal">required</code>, and
no routing value is specified, the delete will be broadcast
automatically to all shards.</p><h3><a id="delete-parent"></a>Parent<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/delete.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The <code class="literal">parent</code> parameter can be set, which will basically be the same as
setting the routing parameter.</p><p>Note that deleting a parent document does not automatically delete its
children. One way of deleting all child documents given a parent’s id is
to perform a <a class="link" href="docs-delete-by-query.html" title="Delete By Query API">delete by query</a> on the child
index with the automatically generated (and indexed)
field _parent, which is in the format parent_type#parent_id.</p><h3><a id="delete-index-creation"></a>Automatic index creation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/delete.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The delete operation automatically creates an index if it has not been
created before (check out the <a class="link" href="indices-create-index.html" title="Create Index">create index API</a>
for manually creating an index), and also automatically creates a
dynamic type mapping for the specific type if it has not been created
before (check out the <a class="link" href="indices-put-mapping.html" title="Put Mapping">put mapping</a>
API for manually creating type mapping).</p><h3><a id="delete-distributed"></a>Distributed<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/delete.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The delete operation gets hashed into a specific shard id. It then gets
redirected into the primary shard within that id group, and replicated
(if needed) to shard replicas within that id group.</p><h3><a id="delete-consistency"></a>Write Consistency<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/delete.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Control if the operation will be allowed to execute based on the number
of active shards within that partition (replication group). The values
allowed are <code class="literal">one</code>, <code class="literal">quorum</code>, and <code class="literal">all</code>. The parameter to set it is
<code class="literal">consistency</code>, and it defaults to the node level setting of
<code class="literal">action.write_consistency</code> which in turn defaults to <code class="literal">quorum</code>.</p><p>For example, in a N shards with 2 replicas index, there will have to be
at least 2 active shards within the relevant partition (<code class="literal">quorum</code>) for
the operation to succeed. In a N shards with 1 replica scenario, there
will need to be a single shard active (in this case, <code class="literal">one</code> and <code class="literal">quorum</code>
is the same).</p><h3><a id="delete-refresh"></a>Refresh<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/delete.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The <code class="literal">refresh</code> parameter can be set to <code class="literal">true</code> in order to refresh the relevant
primary and replica shards after the delete operation has occurred and make it
searchable. Setting it to <code class="literal">true</code> should be done after careful thought and
verification that this does not cause a heavy load on the system (and slows
down indexing).</p><h3><a id="delete-timeout"></a>Timeout<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/delete.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The primary shard assigned to perform the delete operation might not be
available when the delete operation is executed. Some reasons for this
might be that the primary shard is currently recovering from a gateway
or undergoing relocation. By default, the delete operation will wait on
the primary shard to become available for up to 1 minute before failing
and responding with an error. The <code class="literal">timeout</code> parameter can be used to
explicitly specify how long it waits. Here is an example of setting it
to 5 minutes:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XDELETE 'http://localhost:9200/twitter/tweet/1?timeout=5m'</pre></div></div><div class="navfooter"><span class="prev"><a href="docs-get.html">
              «&nbsp;
              Get API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-update.html">Update API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="docs.html">Document APIs</a></span> » <span class="breadcrumb-node">Update API</span></div><div class="navheader"><span class="prev"><a href="docs-delete.html">
              «&nbsp;
              Delete API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-multi-get.html">Multi Get API
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-update"></a>Update API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/update.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The update API allows to update a document based on a script provided.
The operation gets the document (collocated with the shard) from the
index, runs the script (with optional script language and parameters),
and index back the result (also allows to delete, or ignore the
operation). It uses versioning to make sure no updates have happened
during the "get" and "reindex".</p><p>Note, this operation still means full reindex of the document, it just
removes some network roundtrips and reduces chances of version conflicts
between the get and the index. The <code class="literal">_source</code> field need to be enabled
for this feature to work.</p><p>For example, lets index a simple doc:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/test/type1/1 -d '{
    "counter" : 1,
    "tags" : ["red"]
}'</pre></div><h3><a id="_scripted_updates"></a>Scripted updates<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/update.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Now, we can execute a script that would increment the counter:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "script" : "ctx._source.counter += count",
    "params" : {
        "count" : 4
    }
}'</pre></div><p>We can add a tag to the list of tags (note, if the tag exists, it
will still add it, since its a list):</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "script" : "ctx._source.tags += tag",
    "params" : {
        "tag" : "blue"
    }
}'</pre></div><p>In addition to <code class="literal">_source</code>, the following variables are available through
the <code class="literal">ctx</code> map: <code class="literal">_index</code>, <code class="literal">_type</code>, <code class="literal">_id</code>, <code class="literal">_version</code>, <code class="literal">_routing</code>,
<code class="literal">_parent</code>, <code class="literal">_timestamp</code>, <code class="literal">_ttl</code>.</p><p>We can also add a new field to the document:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "script" : "ctx._source.name_of_new_field = \"value_of_new_field\""
}'</pre></div><p>Or remove a field from the document:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "script" : "ctx._source.remove(\"name_of_field\")"
}'</pre></div><p>And, we can even change the operation that is executed.  This example deletes
the doc if the <code class="literal">tags</code> field contain <code class="literal">blue</code>, otherwise it does nothing
(<code class="literal">noop</code>):</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "script" : "ctx._source.tags.contains(tag) ? ctx.op = \"delete\" : ctx.op = \"none\"",
    "params" : {
        "tag" : "blue"
    }
}'</pre></div><h3><a id="_updates_with_a_partial_document"></a>Updates with a partial document<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/update.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The update API also support passing a partial document,
which will be merged into the existing document (simple recursive merge,
inner merging of objects, replacing core "keys/values" and arrays). For
example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "doc" : {
        "name" : "new_name"
    }
}'</pre></div><p>If both <code class="literal">doc</code> and <code class="literal">script</code> is specified, then <code class="literal">doc</code> is ignored. Best is
to put your field pairs of the partial document in the script itself.</p><h3><a id="_literal_detect_noop_literal"></a><code class="literal">detect_noop</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/update.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>By default if <code class="literal">doc</code> is specified then the document is always updated even
if the merging process doesn’t cause any changes.  Specifying <code class="literal">detect_noop</code>
as <code class="literal">true</code> will cause Elasticsearch to check if there are changes and, if
there aren’t, turn the update request into a noop. For example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "doc" : {
        "name" : "new_name"
    },
    "detect_noop": true
}'</pre></div><p>If <code class="literal">name</code> was <code class="literal">new_name</code> before the request was sent then the entire update
request is ignored.</p><h3><a id="upserts"></a>Upserts<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/update.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>If the document does not already exist, the contents of the <code class="literal">upsert</code> element
will be inserted as a new document.  If the document does exist, then the
<code class="literal">script</code> will be executed instead:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "script" : "ctx._source.counter += count",
    "params" : {
        "count" : 4
    },
    "upsert" : {
        "counter" : 1
    }
}'</pre></div><h4><a id="_literal_scripted_upsert_literal"></a><code class="literal">scripted_upsert</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/update.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>If you would like your script to run regardless of whether the document exists
or not — i.e. the script handles initializing the document instead of the
<code class="literal">upsert</code> element — then set <code class="literal">scripted_upsert</code> to <code class="literal">true</code>:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/sessions/session/dh3sgudg8gsrgl/_update' -d '{
    "script_id" : "my_web_session_summariser",
    "scripted_upsert":true,
    "params" : {
        "pageViewEvent" : {
                "url":"foo.com/bar",
                "response":404,
                "time":"2014-01-01 12:32"
        }
    },
    "upsert" : {}
}'</pre></div><h4><a id="_literal_doc_as_upsert_literal"></a><code class="literal">doc_as_upsert</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/update.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Instead of sending a partial <code class="literal">doc</code> plus an <code class="literal">upsert</code> doc, setting
<code class="literal">doc_as_upsert</code> to <code class="literal">true</code> will use the contents of <code class="literal">doc</code> as the <code class="literal">upsert</code>
value:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/test/type1/1/_update' -d '{
    "doc" : {
        "name" : "new_name"
    },
    "doc_as_upsert" : true
}'</pre></div><h3><a id="_parameters_3"></a>Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/update.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The update operation supports the following query-string parameters:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">retry_on_conflict</code>
</p>
</td><td class="entry" valign="top">
<p>
In between the get and indexing phases of the update, it is possible that
another process might have already updated the same document.  By default, the
update will fail with a version conflict exception.  The <code class="literal">retry_on_conflict</code>
parameter controls how many times to retry the update before finally throwing
an exception.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">routing</code>
</p>
</td><td class="entry" valign="top">
<p>
Routing is used to route the update request to the right shard and sets the
routing for the upsert request if the document being updated doesn’t exist.
Can’t be used to update the routing of an existing document.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">parent</code>
</p>
</td><td class="entry" valign="top">
<p>
Parent is used to route the update request to the right shard and sets the
parent for the upsert request if the document being updated doesn’t exist.
Can’t be used to update the <code class="literal">parent</code> of an existing document.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">timeout</code>
</p>
</td><td class="entry" valign="top">
<p>
Timeout waiting for a shard to become available.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">consistency</code>
</p>
</td><td class="entry" valign="top">
<p>
The write consistency of the index/delete operation.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">refresh</code>
</p>
</td><td class="entry" valign="top">
<p>
Refresh the relevant primary and replica shards (not the whole index)
immediately after the operation occurs, so that the updated document appears
in search results  immediately.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">fields</code>
</p>
</td><td class="entry" valign="top">
<p>
Return the relevant fields from the updated document. Specify <code class="literal">_source</code> to
return the full updated source.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">version</code> &amp; <code class="literal">version_type</code>
</p>
</td><td class="entry" valign="top">
<p>
The Update API uses the Elasticsearch’s versioning support internally to make
sure the document doesn’t change during the update. You can use the <code class="literal">version</code>
parameter to specify that the document should only be updated if it’s version
matches the one specified. By setting version type to <code class="literal">force</code> you can force
the new version of the document after update (use with care! with <code class="literal">force</code>
there is no guarantee the document didn’t change).Version types <code class="literal">external</code> &amp;
<code class="literal">external_gte</code> are not supported.
</p>
</td></tr></tbody></table></div></div><div class="navfooter"><span class="prev"><a href="docs-delete.html">
              «&nbsp;
              Delete API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-multi-get.html">Multi Get API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="docs.html">Document APIs</a></span> » <span class="breadcrumb-node">Multi Get API</span></div><div class="navheader"><span class="prev"><a href="docs-update.html">
              «&nbsp;
              Update API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-bulk.html">Bulk API
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-multi-get"></a>Multi Get API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/multi-get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Multi GET API allows to get multiple documents based on an index, type
(optional) and id (and possibly routing). The response includes a <code class="literal">docs</code>
array with all the fetched documents, each element similar in structure
to a document provided by the <a class="link" href="docs-get.html" title="Get API">get</a>
API. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/_mget' -d '{
    "docs" : [
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "1"
        },
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "2"
        }
    ]
}'</pre></div><p>The <code class="literal">mget</code> endpoint can also be used against an index (in which case it
is not required in the body):</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/test/_mget' -d '{
    "docs" : [
        {
            "_type" : "type",
            "_id" : "1"
        },
        {
            "_type" : "type",
            "_id" : "2"
        }
    ]
}'</pre></div><p>And type:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/test/type/_mget' -d '{
    "docs" : [
        {
            "_id" : "1"
        },
        {
            "_id" : "2"
        }
    ]
}'</pre></div><p>In which case, the <code class="literal">ids</code> element can directly be used to simplify the
request:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/test/type/_mget' -d '{
    "ids" : ["1", "2"]
}'</pre></div><h3><a id="mget-type"></a>Optional Type<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/multi-get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The mget API allows for <code class="literal">_type</code> to be optional. Set it to <code class="literal">_all</code> or leave it empty in order
to fetch the first document matching the id across all types.</p><p>If you don’t set the type and have many documents sharing the same <code class="literal">_id</code>, you will end up
getting only the first matching document.</p><p>For example, if you have a document 1 within typeA and typeB then following request
will give you back only the same document twice:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/test/_mget' -d '{
    "ids" : ["1", "1"]
}'</pre></div><p>You need in that case to explicitly set the <code class="literal">_type</code>:</p><div class="pre_wrapper"><pre class="programlisting">GET /test/_mget/
{
  "docs" : [
        {
            "_type":"typeA",
            "_id" : "1"
        },
        {
            "_type":"typeB",
            "_id" : "1"
        }
    ]
}</pre></div><h3><a id="mget-source-filtering"></a>Source filtering<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/multi-get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>By default, the <code class="literal">_source</code> field will be returned for every document (if stored).
Similar to the <a class="link" href="docs-get.html#get-source-filtering" title="Source filteringedit">get</a> API, you can retrieve only parts of
the <code class="literal">_source</code> (or not at all) by using the <code class="literal">_source</code> parameter. You can also use
the url parameters <code class="literal">_source</code>,<code class="literal">_source_include</code> &amp; <code class="literal">_source_exclude</code> to specify defaults,
which will be used when there are no per-document instructions.</p><p>For example:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/_mget' -d '{
    "docs" : [
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "1",
            "_source" : false
        },
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "2",
            "_source" : ["field3", "field4"]
        },
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "3",
            "_source" : {
                "include": ["user"],
                "exclude": ["user.location"]
            }
        }
    ]
}'</pre></div><h3><a id="mget-fields"></a>Fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/multi-get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Specific stored fields can be specified to be retrieved per document to get, similar to the <a class="link" href="docs-get.html#get-fields" title="Fieldsedit">fields</a> parameter of the Get API.
For example:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/_mget' -d '{
    "docs" : [
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "1",
            "fields" : ["field1", "field2"]
        },
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "2",
            "fields" : ["field3", "field4"]
        }
    ]
}'</pre></div><p>Alternatively, you can specify the <code class="literal">fields</code> parameter in the query string
as a default to be applied to all documents.</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/test/type/_mget?fields=field1,field2' -d '{
    "docs" : [
        {
            "_id" : "1" <a id="CO1-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
        },
        {
            "_id" : "2",
            "fields" : ["field3", "field4"] <a id="CO1-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
        }
    ]
}'</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Returns <code class="literal">field1</code> and <code class="literal">field2</code>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO1-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Returns <code class="literal">field3</code> and <code class="literal">field4</code>
</p></td></tr></tbody></table></div><h3><a id="_generated_fields"></a>Generated fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/multi-get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>See <a class="xref" href="docs-get.html#generated-fields" title="Generated fieldsedit">the section called “Generated fields</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>” for fields are generated only when indexing.</p><h3><a id="mget-routing"></a>Routing<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/multi-get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>You can also specify routing value as a parameter:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/_mget?routing=key1' -d '{
    "docs" : [
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "1",
            "_routing" : "key2"
        },
        {
            "_index" : "test",
            "_type" : "type",
            "_id" : "2"
        }
    ]
}'</pre></div><p>In this example, document <code class="literal">test/type/2</code> will be fetch from shard corresponding to routing key <code class="literal">key1</code> but
document <code class="literal">test/type/1</code> will be fetch from shard corresponding to routing key <code class="literal">key2</code>.</p><h3><a id="mget-security"></a>Security<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/multi-get.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>See <a class="xref" href="url-access-control.html" title="URL-based access control"><em>URL-based access control</em></a></p></div><div class="navfooter"><span class="prev"><a href="docs-update.html">
              «&nbsp;
              Update API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-bulk.html">Bulk API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="docs.html">Document APIs</a></span> » <span class="breadcrumb-node">Bulk API</span></div><div class="navheader"><span class="prev"><a href="docs-multi-get.html">
              «&nbsp;
              Multi Get API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-delete-by-query.html">Delete By Query API
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-bulk"></a>Bulk API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/bulk.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The bulk API makes it possible to perform many index/delete operations
in a single API call. This can greatly increase the indexing speed.</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Client support for bulk requests</strong></p></div></div></div><p>Some of the officially supported clients provide helpers to assist with
bulk requests and reindexing of documents from one index to another:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Perl
</span></dt><dd>
    See <a class="ulink" href="https://metacpan.org/pod/Search::Elasticsearch::Bulk" target="_top">Search::Elasticsearch::Bulk</a>
    and <a class="ulink" href="https://metacpan.org/pod/Search::Elasticsearch::Scroll" target="_top">Search::Elasticsearch::Scroll</a>
</dd><dt><span class="term">
Python
</span></dt><dd>
    See <a class="ulink" href="http://elasticsearch-py.readthedocs.org/en/master/helpers.html" target="_top">elasticsearch.helpers.*</a>
</dd></dl></div></div><p>The REST API endpoint is <code class="literal">/_bulk</code>, and it expects the following JSON
structure:</p><div class="pre_wrapper"><pre class="programlisting">action_and_meta_data\n
optional_source\n
action_and_meta_data\n
optional_source\n
....
action_and_meta_data\n
optional_source\n</pre></div><p><span class="strong emphasis"><strong>NOTE</strong></span>: the final line of data must end with a newline character <code class="literal">\n</code>.</p><p>The possible actions are <code class="literal">index</code>, <code class="literal">create</code>, <code class="literal">delete</code> and <code class="literal">update</code>.
<code class="literal">index</code> and <code class="literal">create</code> expect a source on the next
line, and have the same semantics as the <code class="literal">op_type</code> parameter to the
standard index API (i.e. create will fail if a document with the same
index and type exists already, whereas index will add or replace a
document as necessary). <code class="literal">delete</code> does not expect a source on the
following line, and has the same semantics as the standard delete API.
<code class="literal">update</code> expects that the partial doc, upsert and script and its options
are specified on the next line.</p><p>If you’re providing text file input to <code class="literal">curl</code>, you <span class="strong emphasis"><strong>must</strong></span> use the
<code class="literal">--data-binary</code> flag instead of plain <code class="literal">-d</code>. The latter doesn’t preserve
newlines. Example:</p><div class="pre_wrapper"><pre class="programlisting">$ cat requests
{ "index" : { "_index" : "test", "_type" : "type1", "_id" : "1" } }
{ "field1" : "value1" }
$ curl -s -XPOST localhost:9200/_bulk --data-binary "@requests"; echo
{"took":7,"items":[{"create":{"_index":"test","_type":"type1","_id":"1","_version":1}}]}</pre></div><p>Because this format uses literal <code class="literal">\n</code>'s as delimiters, please be sure
that the JSON actions and sources are not pretty printed. Here is an
example of a correct sequence of bulk commands:</p><div class="pre_wrapper"><pre class="programlisting">{ "index" : { "_index" : "test", "_type" : "type1", "_id" : "1" } }
{ "field1" : "value1" }
{ "delete" : { "_index" : "test", "_type" : "type1", "_id" : "2" } }
{ "create" : { "_index" : "test", "_type" : "type1", "_id" : "3" } }
{ "field1" : "value3" }
{ "update" : {"_id" : "1", "_type" : "type1", "_index" : "index1"} }
{ "doc" : {"field2" : "value2"} }</pre></div><p>In the above example <code class="literal">doc</code> for the <code class="literal">update</code> action is a partial
document, that will be merged with the already stored document.</p><p>The endpoints are <code class="literal">/_bulk</code>, <code class="literal">/{index}/_bulk</code>, and <code class="literal">{index}/{type}/_bulk</code>.
When the index or the index/type are provided, they will be used by
default on bulk items that don’t provide them explicitly.</p><p>A note on the format. The idea here is to make processing of this as
fast as possible. As some of the actions will be redirected to other
shards on other nodes, only <code class="literal">action_meta_data</code> is parsed on the
receiving node side.</p><p>Client libraries using this protocol should try and strive to do
something similar on the client side, and reduce buffering as much as
possible.</p><p>The response to a bulk action is a large JSON structure with the
individual results of each action that was performed. The failure of a
single action does not affect the remaining actions.</p><p>There is no "correct" number of actions to perform in a single bulk
call. You should experiment with different settings to find the optimum
size for your particular workload.</p><p>If using the HTTP API, make sure that the client does not send HTTP
chunks, as this will slow things down.</p><h3><a id="bulk-versioning"></a>Versioning<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/bulk.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Each bulk item can include the version value using the
<code class="literal">_version</code>/<code class="literal">version</code> field. It automatically follows the behavior of the
index / delete operation based on the <code class="literal">_version</code> mapping. It also
support the <code class="literal">version_type</code>/<code class="literal">_version_type</code> (see <a class="link" href="docs-index_.html#index-versioning" title="Versioningedit">versioning</a>)</p><h3><a id="bulk-routing"></a>Routing<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/bulk.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Each bulk item can include the routing value using the
<code class="literal">_routing</code>/<code class="literal">routing</code> field. It automatically follows the behavior of the
index / delete operation based on the <code class="literal">_routing</code> mapping.</p><h3><a id="bulk-parent"></a>Parent<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/bulk.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Each bulk item can include the parent value using the <code class="literal">_parent</code>/<code class="literal">parent</code>
field. It automatically follows the behavior of the index / delete
operation based on the <code class="literal">_parent</code> / <code class="literal">_routing</code> mapping.</p><h3><a id="bulk-timestamp"></a>Timestamp<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/bulk.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Each bulk item can include the timestamp value using the
<code class="literal">_timestamp</code>/<code class="literal">timestamp</code> field. It automatically follows the behavior of
the index operation based on the <code class="literal">_timestamp</code> mapping.</p><h3><a id="bulk-ttl"></a>TTL<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/bulk.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Each bulk item can include the ttl value using the <code class="literal">_ttl</code>/<code class="literal">ttl</code> field.
It automatically follows the behavior of the index operation based on
the <code class="literal">_ttl</code> mapping.</p><h3><a id="bulk-consistency"></a>Write Consistency<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/bulk.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>When making bulk calls, you can require a minimum number of active
shards in the partition through the <code class="literal">consistency</code> parameter. The values
allowed are <code class="literal">one</code>, <code class="literal">quorum</code>, and <code class="literal">all</code>. It defaults to the node level
setting of <code class="literal">action.write_consistency</code>, which in turn defaults to
<code class="literal">quorum</code>.</p><p>For example, in a N shards with 2 replicas index, there will have to be
at least 2 active shards within the relevant partition (<code class="literal">quorum</code>) for
the operation to succeed. In a N shards with 1 replica scenario, there
will need to be a single shard active (in this case, <code class="literal">one</code> and <code class="literal">quorum</code>
is the same).</p><h3><a id="bulk-refresh"></a>Refresh<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/bulk.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The <code class="literal">refresh</code> parameter can be set to <code class="literal">true</code> in order to refresh the relevant
primary and replica shards immediately after the bulk operation has occurred
and make it searchable, instead of waiting for the normal refresh interval to
expire. Setting it to <code class="literal">true</code> can trigger additional load, and may slow down
indexing. Due to its costly nature, the <code class="literal">refresh</code> parameter is set on the bulk request level
and is not supported on each individual bulk item.</p><h3><a id="bulk-update"></a>Update<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/bulk.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>When using <code class="literal">update</code> action <code class="literal">_retry_on_conflict</code> can be used as field in
the action itself (not in the extra payload line), to specify how many
times an update should be retried in the case of a version conflict.</p><p>The <code class="literal">update</code> action payload, supports the following options: <code class="literal">doc</code>
(partial document), <code class="literal">upsert</code>, <code class="literal">doc_as_upsert</code>, <code class="literal">script</code>, <code class="literal">params</code> (for
script), <code class="literal">lang</code> (for script). See update documentation for details on
the options. Curl example with update actions:</p><div class="pre_wrapper"><pre class="programlisting">{ "update" : {"_id" : "1", "_type" : "type1", "_index" : "index1", "_retry_on_conflict" : 3} }
{ "doc" : {"field" : "value"} }
{ "update" : { "_id" : "0", "_type" : "type1", "_index" : "index1", "_retry_on_conflict" : 3} }
{ "script" : "ctx._source.counter += param1", "lang" : "js", "params" : {"param1" : 1}, "upsert" : {"counter" : 1}}
{ "update" : {"_id" : "2", "_type" : "type1", "_index" : "index1", "_retry_on_conflict" : 3} }
{ "doc" : {"field" : "value"}, "doc_as_upsert" : true }</pre></div><h3><a id="bulk-security"></a>Security<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/bulk.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>See <a class="xref" href="url-access-control.html" title="URL-based access control"><em>URL-based access control</em></a></p></div><div class="navfooter"><span class="prev"><a href="docs-multi-get.html">
              «&nbsp;
              Multi Get API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-delete-by-query.html">Delete By Query API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="docs.html">Document APIs</a></span> » <span class="breadcrumb-node">Delete By Query API</span></div><div class="navheader"><span class="prev"><a href="docs-bulk.html">
              «&nbsp;
              Bulk API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-bulk-udp.html">Bulk UDP API
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-delete-by-query"></a>Delete By Query API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/delete-by-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><h3>Deprecated in 1.5.3. </h3>
 "Delete by Query will be removed in 2.0: it is problematic since it silently forces a refresh which can quickly cause OutOfMemoryError during concurrent indexing, and can also cause primary and replica to become inconsistent.  Instead, use the scroll/scan API to find all matching ids and then issue a bulk request to delete them.
</div></div><p>The delete by query API allows to delete documents from one or more
indices and one or more types based on a query. The query can either be
provided using a simple query string as a parameter, or using the
<a class="link" href="query-dsl.html" title="Query DSL">Query DSL</a> defined within the request
body. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XDELETE 'http://localhost:9200/twitter/tweet/_query?q=user:kimchy'

$ curl -XDELETE 'http://localhost:9200/twitter/tweet/_query' -d '{
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}
'</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The query being sent in the body must be nested in a <code class="literal">query</code> key, same as
the <a class="link" href="search-search.html" title="Search">search api</a> works</p></div></div><p>Both above examples end up doing the same thing, which is delete all
tweets from the twitter index for a certain user. The result of the
commands is:</p><div class="pre_wrapper"><pre class="programlisting">{
    "_indices" : {
        "twitter" : {
            "_shards" : {
                "total" : 5,
                "successful" : 5,
                "failed" : 0
            }
        }
    }
}</pre></div><p>Note, delete by query bypasses versioning support. Also, it is not
recommended to delete "large chunks of the data in an index", many
times, it’s better to simply reindex into a new index.</p><h3><a id="multiple-indices"></a>Multiple Indices and Types<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/delete-by-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The delete by query API can be applied to multiple types within an
index, and across multiple indices. For example, we can delete all
documents across all types within the twitter index:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XDELETE 'http://localhost:9200/twitter/_query?q=user:kimchy'</pre></div><p>We can also delete within specific types:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XDELETE 'http://localhost:9200/twitter/tweet,user/_query?q=user:kimchy'</pre></div><p>We can also delete all tweets with a certain tag across several indices
(for example, when each user has his own index):</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XDELETE 'http://localhost:9200/kimchy,elasticsearch/_query?q=tag:wow'</pre></div><p>Or even delete across all indices:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XDELETE 'http://localhost:9200/_all/_query?q=tag:wow'</pre></div><h3><a id="delete-by-query-parameters"></a>Request Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/delete-by-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>When executing a delete by query using the query parameter <code class="literal">q</code>, the
query passed is a query string using Lucene query parser. There are
additional parameters that can be passed:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th class="entry" align="left" valign="top">Name </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p>df</p></td><td class="entry" align="left" valign="top"><p>The default field to use when no field prefix is defined within the
query.</p></td></tr><tr><td class="entry" align="left" valign="top"><p>analyzer</p></td><td class="entry" align="left" valign="top"><p>The analyzer name to be used when analyzing the query string.</p></td></tr><tr><td class="entry" align="left" valign="top"><p>default_operator</p></td><td class="entry" align="left" valign="top"><p>The default operator to be used, can be <code class="literal">AND</code> or
<code class="literal">OR</code>. Defaults to <code class="literal">OR</code>.</p></td></tr></tbody></table></div><h3><a id="request-body"></a>Request Body<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/delete-by-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The delete by query can use the <a class="link" href="query-dsl.html" title="Query DSL">Query DSL</a> within its body in order to express the query that should be
executed and delete all documents. The body content can also be passed
as a REST parameter named <code class="literal">source</code>.</p><h3><a id="delete-by-query-distributed"></a>Distributed<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/delete-by-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The delete by query API is broadcast across all primary shards, and from
there, replicated across all shards replicas.</p><h3><a id="delete-by-query-routing"></a>Routing<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/delete-by-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The routing value (a comma separated list of the routing values) can be
specified to control which shards the delete by query request will be
executed on.</p><h3><a id="delete-by-query-consistency"></a>Write Consistency<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/delete-by-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Control if the operation will be allowed to execute based on the number
of active shards within that partition (replication group). The values
allowed are <code class="literal">one</code>, <code class="literal">quorum</code>, and <code class="literal">all</code>. The parameter to set it is
<code class="literal">consistency</code>, and it defaults to the node level setting of
<code class="literal">action.write_consistency</code> which in turn defaults to <code class="literal">quorum</code>.</p><p>For example, in a N shards with 2 replicas index, there will have to be
at least 2 active shards within the relevant partition (<code class="literal">quorum</code>) for
the operation to succeed. In a N shards with 1 replica scenario, there
will need to be a single shard active (in this case, <code class="literal">one</code> and <code class="literal">quorum</code>
is the same).</p><h3><a id="limitations"></a>Limitations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/delete-by-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The delete by query does not support the following queries and filters: <code class="literal">has_child</code>, <code class="literal">has_parent</code> and <code class="literal">top_children</code>.</p></div><div class="navfooter"><span class="prev"><a href="docs-bulk.html">
              «&nbsp;
              Bulk API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-bulk-udp.html">Bulk UDP API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="docs.html">Document APIs</a></span> » <span class="breadcrumb-node">Bulk UDP API</span></div><div class="navheader"><span class="prev"><a href="docs-delete-by-query.html">
              «&nbsp;
              Delete By Query API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-termvectors.html">Term Vectors
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-bulk-udp"></a>Bulk UDP API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/bulk-udp.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Bulk UDP has been deprecated and will be removed in Elasticsearch 2.0.
You should use <a class="link" href="docs-bulk.html" title="Bulk API">the standard bulk API</a> instead.</p></div></div><p>A Bulk UDP service is a service listening over UDP for bulk format
requests. The idea is to provide a low latency UDP service that allows
to easily index data that is not of critical nature.</p><p>The Bulk UDP service is disabled by default, but can be enabled by
setting <code class="literal">bulk.udp.enabled</code> to <code class="literal">true</code>.</p><p>The bulk UDP service performs internal bulk aggregation of the data and
then flushes it based on several parameters:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">bulk.udp.bulk_actions</code>
</span></dt><dd>
         The number of actions to flush a bulk after,
        defaults to <code class="literal">1000</code>.
</dd><dt><span class="term">
<code class="literal">bulk.udp.bulk_size</code>
</span></dt><dd>
         The size of the current bulk request to flush
        the request once exceeded, defaults to <code class="literal">5mb</code>.
</dd><dt><span class="term">
<code class="literal">bulk.udp.flush_interval</code>
</span></dt><dd>
         An interval after which the current
        request is flushed, regardless of the above limits. Defaults to <code class="literal">5s</code>.
</dd><dt><span class="term">
<code class="literal">bulk.udp.concurrent_requests</code>
</span></dt><dd>
         The number on max in flight bulk
        requests allowed. Defaults to <code class="literal">4</code>.
</dd></dl></div><p>The allowed network settings are:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">bulk.udp.host</code>
</span></dt><dd>
        The host to bind to, defaults to <code class="literal">network.host</code>
        which defaults to any.
</dd><dt><span class="term">
<code class="literal">bulk.udp.port</code>
</span></dt><dd>
        The port to use, defaults to <code class="literal">9700-9800</code>.
</dd><dt><span class="term">
<code class="literal">bulk.udp.receive_buffer_size</code>
</span></dt><dd>
        The receive buffer size, defaults to <code class="literal">10mb</code>.
</dd></dl></div><p>Here is an example of how it can be used:</p><div class="pre_wrapper"><pre class="programlisting">&gt; cat bulk.txt
{ "index" : { "_index" : "test", "_type" : "type1" } }
{ "field1" : "value1" }
{ "index" : { "_index" : "test", "_type" : "type1" } }
{ "field1" : "value1" }</pre></div><div class="pre_wrapper"><pre class="programlisting">&gt; cat bulk.txt | nc -w 0 -u localhost 9700</pre></div></div><div class="navfooter"><span class="prev"><a href="docs-delete-by-query.html">
              «&nbsp;
              Delete By Query API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-termvectors.html">Term Vectors
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="docs.html">Document APIs</a></span> » <span class="breadcrumb-node">Term Vectors</span></div><div class="navheader"><span class="prev"><a href="docs-bulk-udp.html">
              «&nbsp;
              Bulk UDP API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-multi-termvectors.html">Multi termvectors API
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-termvectors"></a>Term Vectors<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/termvectors.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Returns information and statistics on terms in the fields of a particular
document. The document could be stored in the index or artificially provided
by the user. Term vectors are <a class="link" href="docs-get.html#realtime" title="Realtimeedit">realtime</a> by default, not near
realtime. This can be changed by setting <code class="literal">realtime</code> parameter to <code class="literal">false</code>.</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/tweet/1/_termvector?pretty=true'</pre></div><p>Optionally, you can specify the fields for which the information is
retrieved either with a parameter in the url</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/tweet/1/_termvector?fields=text,...'</pre></div><p>or by adding the requested fields in the request body (see
example below). Fields can also be specified with wildcards
in similar way to the <a class="link" href="query-dsl-multi-match-query.html" title="Multi Match Query">multi match query</a>.</p><h3><a id="_return_values_2"></a>Return values<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/termvectors.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Three types of values can be requested: <span class="emphasis"><em>term information</em></span>, <span class="emphasis"><em>term statistics</em></span>
and <span class="emphasis"><em>field statistics</em></span>. By default, all term information and field
statistics are returned for all fields but no term statistics.</p><h4><a id="_term_information"></a>Term information<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/termvectors.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
term frequency in the field (always returned)
</li><li class="listitem">
term positions (<code class="literal">positions</code> : true)
</li><li class="listitem">
start and end offsets (<code class="literal">offsets</code> : true)
</li><li class="listitem">
term payloads (<code class="literal">payloads</code> : true), as base64 encoded bytes
</li></ul></div><p>If the requested information wasn’t stored in the index, it will be
computed on the fly if possible. Additionally, term vectors could be computed
for documents not even existing in the index, but instead provided by the user.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Start and end offsets assume UTF-16 encoding is being used. If you want to use
these offsets in order to get the original text that produced this token, you
should make sure that the string you are taking a sub-string of is also encoded
using UTF-16.</p></div></div><h4><a id="_term_statistics"></a>Term statistics<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/termvectors.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Setting <code class="literal">term_statistics</code> to <code class="literal">true</code> (default is <code class="literal">false</code>) will
return</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
total term frequency (how often a term occurs in all documents)
</li><li class="listitem">
document frequency (the number of documents containing the current
   term)
</li></ul></div><p>By default these values are not returned since term statistics can
have a serious performance impact.</p><h4><a id="_field_statistics"></a>Field statistics<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/termvectors.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Setting <code class="literal">field_statistics</code> to <code class="literal">false</code> (default is <code class="literal">true</code>) will
omit :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
document count (how many documents contain this field)
</li><li class="listitem">
sum of document frequencies (the sum of document frequencies for all
   terms in this field)
</li><li class="listitem">
sum of total term frequencies (the sum of total term frequencies of
   each term in this field)
</li></ul></div><h3><a id="_behaviour"></a>Behaviour<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/termvectors.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The term and field statistics are not accurate. Deleted documents
are not taken into account. The information is only retrieved for the
shard the requested document resides in. The term and field statistics
are therefore only useful as relative measures whereas the absolute
numbers have no meaning in this context. By default, when requesting
term vectors of artificial documents, a shard to get the statistics from
is randomly selected. Use <code class="literal">routing</code> only to hit a particular shard.</p><h3><a id="_example_1"></a>Example 1<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/termvectors.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>First, we create an index that stores term vectors, payloads etc. :</p><div class="pre_wrapper"><pre class="programlisting">curl -s -XPUT 'http://localhost:9200/twitter/' -d '{
  "mappings": {
    "tweet": {
      "properties": {
        "text": {
          "type": "string",
          "term_vector": "with_positions_offsets_payloads",
          "store" : true,
          "index_analyzer" : "fulltext_analyzer"
         },
         "fullname": {
          "type": "string",
          "term_vector": "with_positions_offsets_payloads",
          "index_analyzer" : "fulltext_analyzer"
        }
      }
    }
  },
  "settings" : {
    "index" : {
      "number_of_shards" : 1,
      "number_of_replicas" : 0
    },
    "analysis": {
      "analyzer": {
        "fulltext_analyzer": {
          "type": "custom",
          "tokenizer": "whitespace",
          "filter": [
            "lowercase",
            "type_as_payload"
          ]
        }
      }
    }
  }
}'</pre></div><p>Second, we add some documents:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'http://localhost:9200/twitter/tweet/1?pretty=true' -d '{
  "fullname" : "John Doe",
  "text" : "twitter test test test "
}'

curl -XPUT 'http://localhost:9200/twitter/tweet/2?pretty=true' -d '{
  "fullname" : "Jane Doe",
  "text" : "Another twitter test ..."
}'</pre></div><p>The following request returns all information and statistics for field
<code class="literal">text</code> in document <code class="literal">1</code> (John Doe):</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/tweet/1/_termvector?pretty=true' -d '{
  "fields" : ["text"],
  "offsets" : true,
  "payloads" : true,
  "positions" : true,
  "term_statistics" : true,
  "field_statistics" : true
}'</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    "_id": "1",
    "_index": "twitter",
    "_type": "tweet",
    "_version": 1,
    "found": true,
    "term_vectors": {
        "text": {
            "field_statistics": {
                "doc_count": 2,
                "sum_doc_freq": 6,
                "sum_ttf": 8
            },
            "terms": {
                "test": {
                    "doc_freq": 2,
                    "term_freq": 3,
                    "tokens": [
                        {
                            "end_offset": 12,
                            "payload": "d29yZA==",
                            "position": 1,
                            "start_offset": 8
                        },
                        {
                            "end_offset": 17,
                            "payload": "d29yZA==",
                            "position": 2,
                            "start_offset": 13
                        },
                        {
                            "end_offset": 22,
                            "payload": "d29yZA==",
                            "position": 3,
                            "start_offset": 18
                        }
                    ],
                    "ttf": 4
                },
                "twitter": {
                    "doc_freq": 2,
                    "term_freq": 1,
                    "tokens": [
                        {
                            "end_offset": 7,
                            "payload": "d29yZA==",
                            "position": 0,
                            "start_offset": 0
                        }
                    ],
                    "ttf": 2
                }
            }
        }
    }
}</pre></div><h3><a id="_example_2"></a>Example 2<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/termvectors.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Term vectors which are not explicitly stored in the index are automatically
computed on the fly. The following request returns all information and statistics for the
fields in document <code class="literal">1</code>, even though the terms haven’t been explicitly stored in the index.
Note that for the field <code class="literal">text</code>, the terms are not re-generated.</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/tweet/1/_termvector?pretty=true' -d '{
  "fields" : ["text", "some_field_without_term_vectors"],
  "offsets" : true,
  "positions" : true,
  "term_statistics" : true,
  "field_statistics" : true
}'</pre></div><h3><a id="docs-termvectors-artificial-doc"></a>Example 3<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/termvectors.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Term vectors can also be generated for artificial documents,
that is for documents not present in the index. The syntax is similar to the
<a class="link" href="search-percolate.html" title="Percolator">percolator</a> API. For example, the following request would
return the same results as in example 1. The mapping used is determined by the
<code class="literal">index</code> and <code class="literal">type</code>.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>If dynamic mapping is turned on (default), the document fields not in the original
mapping will be dynamically created.</p></div></div><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/tweet/_termvector' -d '{
  "doc" : {
    "fullname" : "John Doe",
    "text" : "twitter test test test"
  }
}'</pre></div><h3><a id="docs-termvectors-per-field-analyzer"></a>Example 4<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/termvectors.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Additionally, a different analyzer than the one at the field may be provided
by using the <code class="literal">per_field_analyzer</code> parameter. This is useful in order to
generate term vectors in any fashion, especially when using artificial
documents. When providing an analyzer for a field that already stores term
vectors, the term vectors will be re-generated.</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/tweet/_termvector' -d '{
  "doc" : {
    "fullname" : "John Doe",
    "text" : "twitter test test test"
  },
  "fields": ["fullname"],
  "per_field_analyzer" : {
    "fullname": "keyword"
  }
}'</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
  "_index": "twitter",
  "_type": "tweet",
  "_version": 0,
  "found": true,
  "term_vectors": {
    "fullname": {
       "field_statistics": {
          "sum_doc_freq": 1,
          "doc_count": 1,
          "sum_ttf": 1
       },
       "terms": {
          "John Doe": {
             "term_freq": 1,
             "tokens": [
                {
                   "position": 0,
                   "start_offset": 0,
                   "end_offset": 8
                }
             ]
          }
       }
    }
  }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="docs-bulk-udp.html">
              «&nbsp;
              Bulk UDP API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="docs-multi-termvectors.html">Multi termvectors API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="docs.html">Document APIs</a></span> » <span class="breadcrumb-node">Multi termvectors API</span></div><div class="navheader"><span class="prev"><a href="docs-termvectors.html">
              «&nbsp;
              Term Vectors</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search.html">Search APIs
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="docs-multi-termvectors"></a>Multi termvectors API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/docs/multi-termvectors.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Multi termvectors API allows to get multiple termvectors at once. The
documents from which to retrieve the term vectors are specified by an index,
type and id. But the documents could also be artificially provided.
The response includes a <code class="literal">docs</code>
array with all the fetched termvectors, each element having the structure
provided by the <a class="link" href="docs-termvectors.html" title="Term Vectors">termvectors</a>
API. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/_mtermvectors' -d '{
   "docs": [
      {
         "_index": "testidx",
         "_type": "test",
         "_id": "2",
         "term_statistics": true
      },
      {
         "_index": "testidx",
         "_type": "test",
         "_id": "1",
         "fields": [
            "text"
         ]
      }
   ]
}'</pre></div><p>See the <a class="link" href="docs-termvectors.html" title="Term Vectors">termvectors</a> API for a description of possible parameters.</p><p>The <code class="literal">_mtermvectors</code> endpoint can also be used against an index (in which case it
is not required in the body):</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/testidx/_mtermvectors' -d '{
   "docs": [
      {
         "_type": "test",
         "_id": "2",
         "fields": [
            "text"
         ],
         "term_statistics": true
      },
      {
         "_type": "test",
         "_id": "1"
      }
   ]
}'</pre></div><p>And type:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/testidx/test/_mtermvectors' -d '{
   "docs": [
      {
         "_id": "2",
         "fields": [
            "text"
         ],
         "term_statistics": true
      },
      {
         "_id": "1"
      }
   ]
}'</pre></div><p>If all requested documents are on same index and have same type and also the parameters are the same, the request can be simplified:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/testidx/test/_mtermvectors' -d '{
    "ids" : ["1", "2"],
    "parameters": {
        "fields": [
                "text"
        ],
        "term_statistics": true,
        …
    }
}'</pre></div><p>Additionally, just like for the <a class="link" href="docs-termvectors.html" title="Term Vectors">termvectors</a>
API, term vectors could be generated for user provided documents. The syntax
is similar to the <a class="link" href="search-percolate.html" title="Percolator">percolator</a> API. The mapping used is
determined by <code class="literal">_index</code> and <code class="literal">_type</code>.</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/_mtermvectors' -d '{
   "docs": [
      {
         "_index": "testidx",
         "_type": "test",
         "doc" : {
            "fullname" : "John Doe",
            "text" : "twitter test test test"
         }
      },
      {
         "_index": "testidx",
         "_type": "test",
         "doc" : {
           "fullname" : "Jane Doe",
           "text" : "Another twitter test ..."
         }
      }
   ]
}'</pre></div></div><div class="navfooter"><span class="prev"><a href="docs-termvectors.html">
              «&nbsp;
              Term Vectors</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search.html">Search APIs
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-node">Search APIs</span></div><div class="navheader"><span class="prev"><a href="docs-multi-termvectors.html">
              «&nbsp;
              Multi termvectors API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-search.html">Search
              &nbsp;»
            </a></span></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="search"></a>Search APIs<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><div class="partintro"><div></div><p>Most search APIs are <a class="link" href="search-search.html#search-multi-index-type" title="Multi-Index, Multi-Typeedit">multi-index, multi-type</a>, with the
exception of the <a class="xref" href="search-explain.html" title="Explain API"><em>Explain API</em></a> endpoints.</p><h2><a id="search-routing"></a>Routing<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><p>When executing a search, it will be broadcast to all the index/indices
shards (round robin between replicas). Which shards will be searched on
can be controlled by providing the <code class="literal">routing</code> parameter. For example,
when indexing tweets, the routing value can be the user name:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPOST 'http://localhost:9200/twitter/tweet?routing=kimchy' -d '{
    "user" : "kimchy",
    "postDate" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}
'</pre></div><p>In such a case, if we want to search only on the tweets for a specific
user, we can specify it as the routing, resulting in the search hitting
only the relevant shard:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/twitter/tweet/_search?routing=kimchy' -d '{
    "query": {
        "filtered" : {
            "query" : {
                "query_string" : {
                    "query" : "some query string here"
                }
            },
            "filter" : {
                "term" : { "user" : "kimchy" }
            }
        }
    }
}
'</pre></div><p>The routing parameter can be multi valued represented as a comma
separated string. This will result in hitting the relevant shards where
the routing values match to.</p><h2><a id="stats-groups"></a>Stats Groups<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><p>A search can be associated with stats groups, which maintains a
statistics aggregation per group. It can later be retrieved using the
<a class="link" href="indices-stats.html" title="Indices Stats">indices stats</a> API
specifically. For example, here is a search body request that associate
the request with two different groups:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "stats" : ["group1", "group2"]
}</pre></div></div></div><div class="navfooter"><span class="prev"><a href="docs-multi-termvectors.html">
              «&nbsp;
              Multi termvectors API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-search.html">Search
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-node">Search</span></div><div class="navheader"><span class="prev"><a href="search.html">
              «&nbsp;
              Search APIs</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-uri-request.html">URI Search
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-search"></a>Search<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/search.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The search API allows to execute a search query and get back search hits
that match the query. The query can either be provided using a simple
<a class="link" href="search-uri-request.html" title="URI Search">query string as a parameter</a>, or using a
<a class="link" href="search-request-body.html" title="Request Body Search">request body</a>.</p><h3><a id="search-multi-index-type"></a>Multi-Index, Multi-Type<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/search.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>All search APIs can be applied across multiple types within an index, and
across multiple indices with support for the
<a class="link" href="multi-index.html" title="Multiple Indices">multi index syntax</a>. For
example, we can search on all documents across all types within the
twitter index:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/twitter/_search?q=user:kimchy'</pre></div><p>We can also search within specific types:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/twitter/tweet,user/_search?q=user:kimchy'</pre></div><p>We can also search all tweets with a certain tag across several indices
(for example, when each user has his own index):</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/kimchy,elasticsearch/tweet/_search?q=tag:wow'</pre></div><p>Or we can search all tweets across all available indices using <code class="literal">_all</code>
placeholder:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/_all/tweet/_search?q=tag:wow'</pre></div><p>Or even search across all indices and all types:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/_search?q=tag:wow'</pre></div></div><div class="navfooter"><span class="prev"><a href="search.html">
              «&nbsp;
              Search APIs</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-uri-request.html">URI Search
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-node">URI Search</span></div><div class="navheader"><span class="prev"><a href="search-search.html">
              «&nbsp;
              Search</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-body.html">Request Body Search
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-uri-request"></a>URI Search<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/uri-request.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A search request can be executed purely using a URI by providing request
parameters. Not all search options are exposed when executing a search
using this mode, but it can be handy for quick "curl tests". Here is an
example:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/twitter/tweet/_search?q=user:kimchy'</pre></div><p>And here is a sample response:</p><div class="pre_wrapper"><pre class="programlisting">{
    "_shards":{
        "total" : 5,
        "successful" : 5,
        "failed" : 0
    },
    "hits":{
        "total" : 1,
        "hits" : [
            {
                "_index" : "twitter",
                "_type" : "tweet",
                "_id" : "1",
                "_source" : {
                    "user" : "kimchy",
                    "postDate" : "2009-11-15T14:12:12",
                    "message" : "trying out Elasticsearch"
                }
            }
        ]
    }
}</pre></div><h3><a id="_parameters_4"></a>Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/uri-request.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The parameters allowed in the URI are:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th class="entry" align="left" valign="top">Name </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">q</code></p></td><td class="entry" align="left" valign="top"><p>The query string (maps to the <code class="literal">query_string</code> query, see
<a class="link" href="query-dsl-query-string-query.html" title="Query String Query"><span class="emphasis"><em>Query String Query</em></span></a> for more details).</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">df</code></p></td><td class="entry" align="left" valign="top"><p>The default field to use when no field prefix is defined within the
query.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td class="entry" align="left" valign="top"><p>The analyzer name to be used when analyzing the query string.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">lowercase_expanded_terms</code></p></td><td class="entry" align="left" valign="top"><p>Should terms be automatically lowercased or
not. Defaults to <code class="literal">true</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">analyze_wildcard</code></p></td><td class="entry" align="left" valign="top"><p>Should wildcard and prefix queries be analyzed or
not. Defaults to <code class="literal">false</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">default_operator</code></p></td><td class="entry" align="left" valign="top"><p>The default operator to be used, can be <code class="literal">AND</code> or
<code class="literal">OR</code>. Defaults to <code class="literal">OR</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">lenient</code></p></td><td class="entry" align="left" valign="top"><p>If set to true will cause format based failures (like
providing text to a numeric field) to be ignored. Defaults to false.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">explain</code></p></td><td class="entry" align="left" valign="top"><p>For each hit, contain an explanation of how scoring of the
hits was computed.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">_source</code></p></td><td class="entry" align="left" valign="top"><p>Set to <code class="literal">false</code> to disable retrieval of the <code class="literal">_source</code> field. You can also retrieve
part of the document by using <code class="literal">_source_include</code> &amp; <code class="literal">_source_exclude</code> (see the <a class="link" href="search-request-source-filtering.html" title="Source filtering">request body</a>
documentation for more details)</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">fields</code></p></td><td class="entry" align="left" valign="top"><p>The selective stored fields of the document to return for each hit,
comma delimited. Not specifying any value will cause no fields to return.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">sort</code></p></td><td class="entry" align="left" valign="top"><p>Sorting to perform. Can either be in the form of <code class="literal">fieldName</code>, or
<code class="literal">fieldName:asc</code>/<code class="literal">fieldName:desc</code>. The fieldName can either be an actual
field within the document, or the special <code class="literal">_score</code> name to indicate
sorting based on scores. There can be several <code class="literal">sort</code> parameters (order
is important).</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">track_scores</code></p></td><td class="entry" align="left" valign="top"><p>When sorting, set to <code class="literal">true</code> in order to still track
scores and return them as part of each hit.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">timeout</code></p></td><td class="entry" align="left" valign="top"><p>A search timeout, bounding the search request to be executed
within the specified time value and bail with the hits accumulated up to
that point when expired. Defaults to no timeout.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">terminate_after</code></p></td><td class="entry" align="left" valign="top"><p><span class="experimental">
      [<span class="experimental_title">experimental</span>]
      <span class="detail">This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</span></span> The maximum number of documents to collect for
each shard, upon reaching which the query execution will terminate early.
If set, the response will have a boolean field <code class="literal">terminated_early</code> to
indicate whether the query execution has actually terminated_early.
Defaults to no terminate_after.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">from</code></p></td><td class="entry" align="left" valign="top"><p>The starting from index of the hits to return. Defaults to <code class="literal">0</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">size</code></p></td><td class="entry" align="left" valign="top"><p>The number of hits to return. Defaults to <code class="literal">10</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">search_type</code></p></td><td class="entry" align="left" valign="top"><p>The type of the search operation to perform. Can be
<code class="literal">dfs_query_then_fetch</code>, <code class="literal">dfs_query_and_fetch</code>, <code class="literal">query_then_fetch</code>,
<code class="literal">query_and_fetch</code>, <code class="literal">count</code>, <code class="literal">scan</code>. Defaults to <code class="literal">query_then_fetch</code>. See
<a class="link" href="search-request-search-type.html" title="Search Type"><span class="emphasis"><em>Search Type</em></span></a> for
more details on the different types of search that can be performed.</p></td></tr></tbody></table></div></div><div class="navfooter"><span class="prev"><a href="search-search.html">
              «&nbsp;
              Search</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-body.html">Request Body Search
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-node">Request Body Search</span></div><div class="navheader"><span class="prev"><a href="search-uri-request.html">
              «&nbsp;
              URI Search</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-query.html">Query
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-body"></a>Request Body Search<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request-body.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The search request can be executed with a search DSL, which includes the
<a class="link" href="query-dsl.html" title="Query DSL">Query DSL</a>, within its body. Here is an
example:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/twitter/tweet/_search' -d '{
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}
'</pre></div><p>And here is a sample response:</p><div class="pre_wrapper"><pre class="programlisting">{
    "_shards":{
        "total" : 5,
        "successful" : 5,
        "failed" : 0
    },
    "hits":{
        "total" : 1,
        "hits" : [
            {
                "_index" : "twitter",
                "_type" : "tweet",
                "_id" : "1",
                "_source" : {
                    "user" : "kimchy",
                    "postDate" : "2009-11-15T14:12:12",
                    "message" : "trying out Elasticsearch"
                }
            }
        ]
    }
}</pre></div><h3><a id="_parameters_5"></a>Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request-body.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">timeout</code>
</p>
</td><td class="entry" valign="top">
<p>
    A search timeout, bounding the search request to be executed within the
    specified time value and bail with the hits accumulated up to that point
    when expired. Defaults to no timeout. See <a class="xref" href="common-options.html#time-units" title="Time unitsedit">the section called “Time units</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>”.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">from</code>
</p>
</td><td class="entry" valign="top">
<p>
    The starting from index of the hits to return. Defaults to <code class="literal">0</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">size</code>
</p>
</td><td class="entry" valign="top">
<p>
    The number of hits to return. Defaults to <code class="literal">10</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">search_type</code>
</p>
</td><td class="entry" valign="top">
<p>
    The type of the search operation to perform. Can be
    <code class="literal">dfs_query_then_fetch</code>, <code class="literal">dfs_query_and_fetch</code>, <code class="literal">query_then_fetch</code>,
    <code class="literal">query_and_fetch</code>. Defaults to <code class="literal">query_then_fetch</code>. See
    <a class="link" href="search-request-search-type.html" title="Search Type"><span class="emphasis"><em>Search Type</em></span></a> for more.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">query_cache</code>
</p>
</td><td class="entry" valign="top">
<p>
    Set to <code class="literal">true</code> or <code class="literal">false</code> to enable or disable the caching
    of search results for requests where <code class="literal">?search_type=count</code>, ie
    aggregations and suggestions.  See <a class="xref" href="index-modules-shard-query-cache.html" title="Shard query cache"><em>Shard query cache</em></a>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">terminate_after</code>
</p>
</td><td class="entry" valign="top">
<p>
    <span class="experimental">
      [<span class="experimental_title">experimental</span>]
      <span class="detail">This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</span></span> The maximum number of documents to collect for each shard,
    upon reaching which the query execution will terminate early. If set, the
    response will have a boolean field <code class="literal">terminated_early</code> to indicate whether
    the query execution has actually terminated_early. Defaults to no
    terminate_after.
</p>
</td></tr></tbody></table></div><p>Out of the above, the <code class="literal">search_type</code> and the <code class="literal">query_cache</code> must be passed as
query-string parameters. The rest of the search request should be passed
within the body itself. The body content can also be passed as a REST
parameter named <code class="literal">source</code>.</p><p>Both HTTP GET and HTTP POST can be used to execute search with body. Since not
all clients support GET with body, POST is allowed as well.</p></div><div class="navfooter"><span class="prev"><a href="search-uri-request.html">
              «&nbsp;
              URI Search</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-query.html">Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">Query</span></div><div class="navheader"><span class="prev"><a href="search-request-body.html">
              «&nbsp;
              Request Body Search</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-from-size.html">From / Size
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-query"></a>Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The query element within the search request body allows to define a
query using the <a class="link" href="query-dsl.html" title="Query DSL">Query DSL</a>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="search-request-body.html">
              «&nbsp;
              Request Body Search</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-from-size.html">From / Size
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">From / Size</span></div><div class="navheader"><span class="prev"><a href="search-request-query.html">
              «&nbsp;
              Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-sort.html">Sort
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-from-size"></a>From / Size<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/from-size.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Pagination of results can be done by using the <code class="literal">from</code> and <code class="literal">size</code>
parameters. The <code class="literal">from</code> parameter defines the offset from the first
result you want to fetch. The <code class="literal">size</code> parameter allows you to configure
the maximum amount of hits to be returned.</p><p>Though <code class="literal">from</code> and <code class="literal">size</code> can be set as request parameters, they can also
be set within the search body. <code class="literal">from</code> defaults to <code class="literal">0</code>, and <code class="literal">size</code>
defaults to <code class="literal">10</code>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "from" : 0, "size" : 10,
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="search-request-query.html">
              «&nbsp;
              Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-sort.html">Sort
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">Sort</span></div><div class="navheader"><span class="prev"><a href="search-request-from-size.html">
              «&nbsp;
              From / Size</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-source-filtering.html">Source filtering
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-sort"></a>Sort<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/sort.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Allows to add one or more sort on specific fields. Each sort can be
reversed as well. The sort is defined on a per field level, with special
field name for <code class="literal">_score</code> to sort by score.</p><div class="pre_wrapper"><pre class="programlisting">{
    "sort" : [
        { "post_date" : {"order" : "asc"}},
        "user",
        { "name" : "desc" },
        { "age" : "desc" },
        "_score"
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_sort_values"></a>Sort Values<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/sort.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The sort values for each document returned are also returned as part of
the response.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_sort_order"></a>Sort Order<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/sort.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">order</code> option can have the following values:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">asc</code>
</p>
</td><td class="entry" valign="top">
<p>
Sort in ascending order
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">desc</code>
</p>
</td><td class="entry" valign="top">
<p>
Sort in descending order
</p>
</td></tr></tbody></table></div><p>The order defaults to <code class="literal">desc</code> when sorting on the <code class="literal">_score</code>, and defaults
to <code class="literal">asc</code> when sorting on anything else.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_sort_mode_option"></a>Sort mode option<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/sort.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Elasticsearch supports sorting by array or multi-valued fields. The <code class="literal">mode</code> option
controls what array value is picked for sorting the document it belongs
to. The <code class="literal">mode</code> option can have the following values:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">min</code>
</p>
</td><td class="entry" valign="top">
<p>
Pick the lowest value.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">max</code>
</p>
</td><td class="entry" valign="top">
<p>
Pick the highest value.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">sum</code>
</p>
</td><td class="entry" valign="top">
<p>
Use the sum of all values as sort value. Only applicable for
        number based array fields.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">avg</code>
</p>
</td><td class="entry" valign="top">
<p>
Use the average of all values as sort value. Only applicable
        for number based array fields.
</p>
</td></tr></tbody></table></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_sort_mode_example_usage"></a>Sort mode example usage<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/sort.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>In the example below the field price has multiple prices per document.
In this case the result hits will be sort by price ascending based on
the average price per document.</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/_search' -d '{
   "query" : {
    ...
   },
   "sort" : [
      {"price" : {"order" : "asc", "mode" : "avg"}}
   ]
}'</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_sorting_within_nested_objects"></a>Sorting within nested objects.<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/sort.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Elasticsearch also supports sorting by
fields that are inside one or more nested objects. The sorting by nested
field support has the following parameters on top of the already
existing sort options:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">nested_path</code>
</span></dt><dd>
    Defines the on what nested object to sort. The actual
    sort field must be a direct field inside this nested object. The default
    is to use the most immediate inherited nested object from the sort
    field.
</dd><dt><span class="term">
<code class="literal">nested_filter</code>
</span></dt><dd>
    A filter the inner objects inside the nested path
    should match with in order for its field values to be taken into account
    by sorting. Common case is to repeat the query / filter inside the
    nested filter or query. By default no <code class="literal">nested_filter</code> is active.
</dd></dl></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_nested_sorting_example"></a>Nested sorting example<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/sort.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>In the below example <code class="literal">offer</code> is a field of type <code class="literal">nested</code>. Because
<code class="literal">offer</code> is the closest inherited nested field, it is picked as
<code class="literal">nested_path</code>. Only the inner objects that have color blue will
participate in sorting.</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/_search' -d '{
   "query" : {
    ...
   },
   "sort" : [
       {
          "offer.price" : {
             "mode" :  "avg",
             "order" : "asc",
             "nested_filter" : {
                "term" : { "offer.color" : "blue" }
             }
          }
       }
    ]
}'</pre></div><p>Nested sorting is also supported when sorting by
scripts and sorting by geo distance.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_missing_values"></a>Missing Values<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/sort.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">missing</code> parameter specifies how docs which are missing
the field should be treated: The <code class="literal">missing</code> value can be
set to <code class="literal">_last</code>, <code class="literal">_first</code>, or a custom value (that
will be used for missing docs as the sort value). For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "sort" : [
        { "price" : {"missing" : "_last"} },
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>If a nested inner object doesn’t match with
the <code class="literal">nested_filter</code> then a missing value is used.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_ignoring_unmapped_fields"></a>Ignoring Unmapped Fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/sort.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Before 1.4.0 there was the <code class="literal">ignore_unmapped</code> boolean
parameter, which was not enough information to decide on the sort
values to emit, and didn’t work for cross-index search. It is still
supported but users are encouraged to migrate to the new
<code class="literal">unmapped_type</code> instead.</p><p>By default, the search request will fail if there is no mapping
associated with a field. The <code class="literal">unmapped_type</code> option allows to ignore
fields that have no mapping and not sort by them. The value of this
parameter is used to determine what sort values to emit. Here is an
example of how it can be used:</p><div class="pre_wrapper"><pre class="programlisting">{
    "sort" : [
        { "price" : {"unmapped_type" : "long"} },
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><p>If any of the indices that are queried doesn’t have a mapping for <code class="literal">price</code>
then Elasticsearch will handle it as if there was a mapping of type
<code class="literal">long</code>, with all documents in this index having no value for this field.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_geo_distance_sorting"></a>Geo Distance Sorting<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/sort.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Allow to sort by <code class="literal">_geo_distance</code>. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "sort" : [
        {
            "_geo_distance" : {
                "pin.location" : [-70, 40],
                "order" : "asc",
                "unit" : "km",
                "mode" : "min",
                "distance_type" : "sloppy_arc"
            }
        }
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">distance_type</code>
</span></dt><dd>
    How to compute the distance. Can either be <code class="literal">sloppy_arc</code> (default), <code class="literal">arc</code> (slightly more precise but significantly slower) or <code class="literal">plane</code> (faster, but inaccurate on long distances and close to the poles).
</dd></dl></div><p>Note: the geo distance sorting supports <code class="literal">sort_mode</code> options: <code class="literal">min</code>,
<code class="literal">max</code> and <code class="literal">avg</code>.</p><p>The following formats are supported in providing the coordinates:</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_lat_lon_as_properties"></a>Lat Lon as Properties<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/sort.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="pre_wrapper"><pre class="programlisting">{
    "sort" : [
        {
            "_geo_distance" : {
                "pin.location" : {
                    "lat" : 40,
                    "lon" : -70
                },
                "order" : "asc",
                "unit" : "km"
            }
        }
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_lat_lon_as_string"></a>Lat Lon as String<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/sort.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Format in <code class="literal">lat,lon</code>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "sort" : [
        {
            "_geo_distance" : {
                "pin.location" : "-70,40",
                "order" : "asc",
                "unit" : "km"
            }
        }
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_geohash"></a>Geohash<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/sort.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="pre_wrapper"><pre class="programlisting">{
    "sort" : [
        {
            "_geo_distance" : {
                "pin.location" : "drm3btev3e86",
                "order" : "asc",
                "unit" : "km"
            }
        }
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_lat_lon_as_array"></a>Lat Lon as Array<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/sort.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Format in <code class="literal">[lon, lat]</code>, note, the order of lon/lat here in order to
conform with <a class="ulink" href="http://geojson.org/" target="_top">GeoJSON</a>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "sort" : [
        {
            "_geo_distance" : {
                "pin.location" : [-70, 40],
                "order" : "asc",
                "unit" : "km"
            }
        }
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_multiple_reference_points"></a>Multiple reference points<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/sort.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Multiple geo points can be passed as an array containing any <code class="literal">geo_point</code> format, for example</p><div class="pre_wrapper"><pre class="programlisting">"pin.location" : [[-70, 40], [-71, 42]]
"pin.location" : [{"lat": -70, "lon": 40}, {"lat": -71, "lon": 42}]</pre></div><p>and so forth.</p><p>The final distance for a document will then be <code class="literal">min</code>/<code class="literal">max</code>/<code class="literal">avg</code> (defined via <code class="literal">mode</code>) distance of all points contained in the document to all points given in the sort request.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_based_sorting"></a>Script Based Sorting<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/sort.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Allow to sort based on custom scripts, here is an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        ....
    },
    "sort" : {
        "_script" : {
            "script" : "doc['field_name'].value * factor",
            "type" : "number",
            "params" : {
                "factor" : 1.1
            },
            "order" : "asc"
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_track_scores"></a>Track Scores<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/sort.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>When sorting on a field, scores are not computed. By setting
<code class="literal">track_scores</code> to true, scores will still be computed and tracked.</p><div class="pre_wrapper"><pre class="programlisting">{
    "track_scores": true,
    "sort" : [
        { "post_date" : {"reverse" : true} },
        { "name" : "desc" },
        { "age" : "desc" }
    ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_memory_considerations"></a>Memory Considerations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/sort.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>When sorting, the relevant sorted field values are loaded into memory.
This means that per shard, there should be enough memory to contain
them. For string based types, the field sorted on should not be analyzed
/ tokenized. For numeric types, if possible, it is recommended to
explicitly set the type to narrower types (like <code class="literal">short</code>, <code class="literal">integer</code> and
<code class="literal">float</code>).</p></div></div><div class="navfooter"><span class="prev"><a href="search-request-from-size.html">
              «&nbsp;
              From / Size</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-source-filtering.html">Source filtering
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">Source filtering</span></div><div class="navheader"><span class="prev"><a href="search-request-sort.html">
              «&nbsp;
              Sort</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-fields.html">Fields
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-source-filtering"></a>Source filtering<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/source-filtering.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Allows to control how the <code class="literal">_source</code> field is returned with every hit.</p><p>By default operations return the contents of the <code class="literal">_source</code> field unless
you have used the <code class="literal">fields</code> parameter or if the <code class="literal">_source</code> field is disabled.</p><p>You can turn off <code class="literal">_source</code> retrieval by using the <code class="literal">_source</code> parameter:</p><p>To disable <code class="literal">_source</code> retrieval set to <code class="literal">false</code>:</p><div class="pre_wrapper"><pre class="programlisting">{
    "_source": false,
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><p>The <code class="literal">_source</code> also accepts one or more wildcard patterns to control what parts of the <code class="literal">_source</code> should be returned:</p><p>For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "_source": "obj.*",
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><p>Or</p><div class="pre_wrapper"><pre class="programlisting">{
    "_source": [ "obj1.*", "obj2.*" ],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><p>Finally, for complete control, you can specify both include and exclude patterns:</p><div class="pre_wrapper"><pre class="programlisting">{
    "_source": {
        "include": [ "obj1.*", "obj2.*" ],
        "exclude": [ "*.description" ]
    },
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="search-request-sort.html">
              «&nbsp;
              Sort</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-fields.html">Fields
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">Fields</span></div><div class="navheader"><span class="prev"><a href="search-request-source-filtering.html">
              «&nbsp;
              Source filtering</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-script-fields.html">Script Fields
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-fields"></a>Fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/fields.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Allows to selectively load specific stored fields for each document represented
by a search hit.</p><div class="pre_wrapper"><pre class="programlisting">{
    "fields" : ["user", "postDate"],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><p><code class="literal">*</code> can be used to load all stored fields from the document.</p><p>An empty array will cause only the <code class="literal">_id</code> and <code class="literal">_type</code> for each hit to be
returned, for example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "fields" : [],
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><p>For backwards compatibility, if the fields parameter specifies fields which are not stored (<code class="literal">store</code> mapping set to
<code class="literal">false</code>), it will load the <code class="literal">_source</code> and extract it from it. This functionality has been replaced by the
<a class="link" href="search-request-source-filtering.html" title="Source filtering">source filtering</a> parameter.</p><p>Field values fetched from the document it self are always returned as an array. Metadata fields like <code class="literal">_routing</code> and
<code class="literal">_parent</code> fields are never returned as an array.</p><p>Also only leaf fields can be returned via the <code class="literal">field</code> option. So object fields can’t be returned and such requests
will fail.</p><p>Script fields can also be automatically detected and used as fields, so
things like <code class="literal">_source.obj1.field1</code> can be used, though not recommended, as
<code class="literal">obj1.field1</code> will work as well.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="partial"></a>Partial<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/fields.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>When loading data from <code class="literal">_source</code>, partial fields can be used to use
wildcards to control what part of the <code class="literal">_source</code> will be loaded based on
<code class="literal">include</code> and <code class="literal">exclude</code> patterns. For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "partial_fields" : {
        "partial1" : {
            "include" : "obj1.obj2.*"
        }
    }
}</pre></div><p>And one that will also exclude <code class="literal">obj1.obj3</code>:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "partial_fields" : {
        "partial1" : {
            "include" : "obj1.obj2.*",
            "exclude" : "obj1.obj3.*"
        }
    }
}</pre></div><p>Both <code class="literal">include</code> and <code class="literal">exclude</code> support multiple patterns:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "partial_fields" : {
        "partial1" : {
            "include" : ["obj1.obj2.*", "obj1.obj4.*"],
            "exclude" : "obj1.obj3.*"
        }
    }
}</pre></div></div></div><div class="navfooter"><span class="prev"><a href="search-request-source-filtering.html">
              «&nbsp;
              Source filtering</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-script-fields.html">Script Fields
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">Script Fields</span></div><div class="navheader"><span class="prev"><a href="search-request-fields.html">
              «&nbsp;
              Fields</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-fielddata-fields.html">Field Data Fields
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-script-fields"></a>Script Fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/script-fields.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Allows to return a <a class="link" href="modules-scripting.html" title="Scripting">script evaluation</a> (based on different fields) for each hit, for example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        ...
    },
    "script_fields" : {
        "test1" : {
            "script" : "doc['my_field_name'].value * 2"
        },
        "test2" : {
            "script" : "doc['my_field_name'].value * factor",
            "params" : {
                "factor"  : 2.0
            }
        }
    }
}</pre></div><p>Script fields can work on fields that are not stored (<code class="literal">my_field_name</code> in
the above case), and allow to return custom values to be returned (the
evaluated value of the script).</p><p>Script fields can also access the actual <code class="literal">_source</code> document indexed and
extract specific elements to be returned from it (can be an "object"
type). Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">    {
        "query" : {
            ...
        },
        "script_fields" : {
            "test1" : {
                "script" : "_source.obj1.obj2"
            }
        }
    }</pre></div><p>Note the <code class="literal">_source</code> keyword here to navigate the json-like model.</p><p>It’s important to understand the difference between
<code class="literal">doc['my_field'].value</code> and <code class="literal">_source.my_field</code>. The first, using the doc
keyword, will cause the terms for that field to be loaded to memory
(cached), which will result in faster execution, but more memory
consumption. Also, the <code class="literal">doc[...]</code> notation only allows for simple valued
fields (can’t return a json object from it) and make sense only on
non-analyzed or single term based fields.</p><p>The <code class="literal">_source</code> on the other hand causes the source to be loaded, parsed,
and then only the relevant part of the json is returned.</p></div><div class="navfooter"><span class="prev"><a href="search-request-fields.html">
              «&nbsp;
              Fields</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-fielddata-fields.html">Field Data Fields
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">Field Data Fields</span></div><div class="navheader"><span class="prev"><a href="search-request-script-fields.html">
              «&nbsp;
              Script Fields</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-post-filter.html">Post filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-fielddata-fields"></a>Field Data Fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/fielddata-fields.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Allows to return the field data representation of a field for each hit, for
example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        ...
    },
    "fielddata_fields" : ["test1", "test2"]
}</pre></div><p>Field data fields can work on fields that are not stored.</p><p>It’s important to understand that using the <code class="literal">fielddata_fields</code> parameter will
cause the terms for that field to be loaded to memory (cached), which will
result in more memory consumption.</p></div><div class="navfooter"><span class="prev"><a href="search-request-script-fields.html">
              «&nbsp;
              Script Fields</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-post-filter.html">Post filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">Post filter</span></div><div class="navheader"><span class="prev"><a href="search-request-fielddata-fields.html">
              «&nbsp;
              Field Data Fields</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-highlighting.html">Highlighting
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-post-filter"></a>Post filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/post-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">post_filter</code> is applied to the search <code class="literal">hits</code> at the very end of a search
request,  after aggregations have already been calculated. It’s purpose is
best explained by example:</p><p>Imagine that you are selling shirts, and the user has specified two filters:
<code class="literal">color:red</code> and <code class="literal">brand:gucci</code>.  You only want to show them red shirts made by
Gucci in the search results.  Normally you would do this with a
<a class="link" href="query-dsl-filtered-query.html" title="Filtered Query"><code class="literal">filtered</code> query</a>:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET localhost:9200/shirts/_search -d '
{
  "query": {
    "filtered": {
      "filter": {
        "bool": {
          "must": [
            { "term": { "color": "red"   }},
            { "term": { "brand": "gucci" }}
          ]
        }
      }
    }
  }
}
'</pre></div><p>However, you would also like to use <span class="emphasis"><em>faceted navigation</em></span> to display a list of
other options that the user could click on.  Perhaps you have a <code class="literal">model</code> field
that would allow the user to limit their search results to red Gucci
<code class="literal">t-shirts</code> or <code class="literal">dress-shirts</code>.</p><p>This can be done with a
<a class="link" href="search-aggregations-bucket-terms-aggregation.html" title="Terms Aggregation"><code class="literal">terms</code> aggregation</a>:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET localhost:9200/shirts/_search -d '
{
  "query": {
    "filtered": {
      "filter": {
        "bool": {
          "must": [
            { "term": { "color": "red"   }},
            { "term": { "brand": "gucci" }}
          ]
        }
      }
    }
  },
  "aggs": {
    "models": {
      "terms": { "field": "model" } <a id="CO2-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
    }
  }
}
'</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO2-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Returns the most popular models of red shirts by Gucci.
</p></td></tr></tbody></table></div><p>But perhaps you would also like to tell the user how many Gucci shirts are
available in <span class="strong emphasis"><strong>other colors</strong></span>. If you just add a <code class="literal">terms</code> aggregation on the
<code class="literal">color</code> field, you will only get back the color <code class="literal">red</code>, because your query
returns only red shirts by Gucci.</p><p>Instead, you want to include shirts of all colors during aggregation, then
apply the <code class="literal">colors</code> filter only to the search results.  This is the purpose of
the <code class="literal">post_filter</code>:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET localhost:9200/shirts/_search -d '
{
  "query": {
    "filtered": {
      "filter": {
        { "term": { "brand": "gucci" }} <a id="CO3-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
      }
    }
  },
  "aggs": {
    "colors": {
      "terms": { "field": "color" }, <a id="CO3-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
    },
    "color_red": {
      "filter": {
        "term": { "color": "red" } <a id="CO3-3"></a><span><img src="images/icons/callouts/3.png" alt=""></span>
      },
      "aggs": {
        "models": {
          "terms": { "field": "model" } <a id="CO3-4"></a><span><img src="images/icons/callouts/4.png" alt=""></span>
        }
      }
    }
  },
  "post_filter": { <a id="CO3-5"></a><span><img src="images/icons/callouts/5.png" alt=""></span>
    "term": { "color": "red" }
  }
}
'</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO3-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The main query now finds all shirts by Gucci, regardless of color.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO3-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">colors</code> agg returns popular colors for shirts by Gucci.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO3-3"><span><img src="images/icons/callouts/3.png" alt=""></span></a> <a href="#CO3-4"><span><img src="images/icons/callouts/4.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">color_red</code> agg limits the <code class="literal">models</code> sub-aggregation
    to <span class="strong emphasis"><strong>red</strong></span> Gucci shirts.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO3-5"><span><img src="images/icons/callouts/5.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Finally, the <code class="literal">post_filter</code> removes colors other than red
    from the search <code class="literal">hits</code>.
</p></td></tr></tbody></table></div></div><div class="navfooter"><span class="prev"><a href="search-request-fielddata-fields.html">
              «&nbsp;
              Field Data Fields</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-highlighting.html">Highlighting
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">Highlighting</span></div><div class="navheader"><span class="prev"><a href="search-request-post-filter.html">
              «&nbsp;
              Post filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-rescore.html">Rescoring
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-highlighting"></a>Highlighting<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/highlighting.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Allows to highlight search results on one or more fields. The
implementation uses either the lucene <code class="literal">highlighter</code>, <code class="literal">fast-vector-highlighter</code>
or <code class="literal">postings-highlighter</code>. The following is an example of the  search request
body:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "content" : {}
        }
    }
}</pre></div><p>In the above case, the <code class="literal">content</code> field will be highlighted for each
search hit (there will be another element in each search hit, called
<code class="literal">highlight</code>, which includes the highlighted fields and the highlighted
fragments).</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>In order to perform highlighting, the actual content of the field is
required. If the field in question is stored (has <code class="literal">store</code> set to <code class="literal">true</code>
in the mapping) it will be used, otherwise, the actual <code class="literal">_source</code> will
be loaded and the relevant field will be extracted from it.</p><p>The <code class="literal">_all</code> field cannot be extracted from <code class="literal">_source</code>, so it can only
be used for highlighting if it mapped to have <code class="literal">store</code> set to <code class="literal">true</code>.</p></div></div><p>The field name supports wildcard notation. For example, using <code class="literal">comment_*</code>
will cause all fields that match the expression to be highlighted.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="postings-highlighter"></a>Postings highlighter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/highlighting.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>If <code class="literal">index_options</code> is set to <code class="literal">offsets</code> in the mapping the postings highlighter
will be used instead of the plain highlighter. The postings highlighter:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Is faster since it doesn’t require to reanalyze the text to be highlighted:
the larger the documents the better the performance gain should be
</li><li class="listitem">
Requires less disk space than term_vectors, needed for the fast vector
highlighter
</li><li class="listitem">
Breaks the text into sentences and highlights them. Plays really well with
natural languages, not as well with fields containing for instance html markup
</li><li class="listitem">
Treats the document as the whole corpus, and scores individual sentences as
if they were documents in this corpus, using the  BM25 algorithm
</li></ul></div><p>Here is an example of setting the <code class="literal">content</code> field to allow for
highlighting using the postings highlighter on it:</p><div class="pre_wrapper"><pre class="programlisting">{
    "type_name" : {
        "content" : {"index_options" : "offsets"}
    }
}</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Note that the postings highlighter is meant to perform simple query terms
highlighting, regardless of their positions. That means that when used for
instance in combination with a phrase query, it will highlight all the terms
that the query is composed of, regardless of whether they are actually part of
a query match, effectively ignoring their positions.</p></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>The postings highlighter does support highlighting of multi term queries, like
prefix queries, wildcard queries and so on. On the other hand, this requires
the queries to be rewritten using a proper
<a class="link" href="query-dsl-multi-term-rewrite.html" title="Multi Term Query Rewrite">rewrite method</a> that supports multi term
extraction, which is a potentially expensive operation.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="fast-vector-highlighter"></a>Fast vector highlighter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/highlighting.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>If <code class="literal">term_vector</code> information is provided by setting <code class="literal">term_vector</code> to
<code class="literal">with_positions_offsets</code> in the mapping then the fast vector highlighter
will be used instead of the plain highlighter.  The fast vector highlighter:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Is faster especially for large fields (&gt; <code class="literal">1MB</code>)
</li><li class="listitem">
Can be customized with <code class="literal">boundary_chars</code>, <code class="literal">boundary_max_scan</code>, and
 <code class="literal">fragment_offset</code> (see <a class="link" href="search-request-highlighting.html#boundary-characters" title="Boundary Characters">below</a>)
</li><li class="listitem">
Requires setting <code class="literal">term_vector</code> to <code class="literal">with_positions_offsets</code> which
  increases the size of the index
</li><li class="listitem">
Can combine matches from multiple fields into one result.  See
  <code class="literal">matched_fields</code>
</li><li class="listitem">
Can assign different weights to matches at different positions allowing
  for things like phrase matches being sorted above term matches when
  highlighting a Boosting Query that boosts phrase matches over term matches
</li></ul></div><p>Here is an example of setting the <code class="literal">content</code> field to allow for
highlighting using the fast vector highlighter on it (this will cause
the index to be bigger):</p><div class="pre_wrapper"><pre class="programlisting">{
    "type_name" : {
        "content" : {"term_vector" : "with_positions_offsets"}
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_force_highlighter_type"></a>Force highlighter type<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/highlighting.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">type</code> field allows to force a specific highlighter type. This is useful
for instance when needing to use the plain highlighter on a field that has
<code class="literal">term_vectors</code> enabled. The allowed values are: <code class="literal">plain</code>, <code class="literal">postings</code> and <code class="literal">fvh</code>.
The following is an example that forces the use of the plain highlighter:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "content" : {"type" : "plain"}
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_force_highlighting_on_source"></a>Force highlighting on source<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/highlighting.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Forces the highlighting to highlight fields based on the source even if fields are
stored separately. Defaults to <code class="literal">false</code>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "content" : {"force_source" : true}
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="tags"></a>Highlighting Tags<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/highlighting.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>By default, the highlighting will wrap highlighted text in <code class="literal">&lt;em&gt;</code> and
<code class="literal">&lt;/em&gt;</code>. This can be controlled by setting <code class="literal">pre_tags</code> and <code class="literal">post_tags</code>,
for example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {...},
    "highlight" : {
        "pre_tags" : ["&lt;tag1&gt;"],
        "post_tags" : ["&lt;/tag1&gt;"],
        "fields" : {
            "_all" : {}
        }
    }
}</pre></div><p>Using the fast vector highlighter there can be more tags, and the "importance"
is ordered.</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {...},
    "highlight" : {
        "pre_tags" : ["&lt;tag1&gt;", "&lt;tag2&gt;"],
        "post_tags" : ["&lt;/tag1&gt;", "&lt;/tag2&gt;"],
        "fields" : {
            "_all" : {}
        }
    }
}</pre></div><p>There are also built in "tag" schemas, with currently a single schema
called <code class="literal">styled</code> with the following <code class="literal">pre_tags</code>:</p><div class="pre_wrapper"><pre class="programlisting">&lt;em class="hlt1"&gt;, &lt;em class="hlt2"&gt;, &lt;em class="hlt3"&gt;,
&lt;em class="hlt4"&gt;, &lt;em class="hlt5"&gt;, &lt;em class="hlt6"&gt;,
&lt;em class="hlt7"&gt;, &lt;em class="hlt8"&gt;, &lt;em class="hlt9"&gt;,
&lt;em class="hlt10"&gt;</pre></div><p>and <code class="literal">&lt;/em&gt;</code> as <code class="literal">post_tags</code>. If you think of more nice to have built in tag
schemas, just send an email to the mailing list or open an issue. Here
is an example of switching tag schemas:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {...},
    "highlight" : {
        "tags_schema" : "styled",
        "fields" : {
            "content" : {}
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_encoder"></a>Encoder<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/highlighting.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>An <code class="literal">encoder</code> parameter can be used to define how highlighted text will
be encoded. It can be either <code class="literal">default</code> (no encoding) or <code class="literal">html</code> (will
escape html, if you use html highlighting tags).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_highlighted_fragments"></a>Highlighted Fragments<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/highlighting.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Each field highlighted can control the size of the highlighted fragment
in characters (defaults to <code class="literal">100</code>), and the maximum number of fragments
to return (defaults to <code class="literal">5</code>).
For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "content" : {"fragment_size" : 150, "number_of_fragments" : 3}
        }
    }
}</pre></div><p>The <code class="literal">fragment_size</code> is ignored when using the postings highlighter, as it
outputs sentences regardless of their length.</p><p>On top of this it is possible to specify that highlighted fragments need
to be sorted by score:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {...},
    "highlight" : {
        "order" : "score",
        "fields" : {
            "content" : {"fragment_size" : 150, "number_of_fragments" : 3}
        }
    }
}</pre></div><p>If the <code class="literal">number_of_fragments</code> value is set to <code class="literal">0</code> then no fragments are
produced, instead the whole content of the field is returned, and of
course it is highlighted. This can be very handy if short texts (like
document title or address) need to be highlighted but no fragmentation
is required. Note that <code class="literal">fragment_size</code> is ignored in this case.</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "_all" : {},
            "bio.title" : {"number_of_fragments" : 0}
        }
    }
}</pre></div><p>When using <code class="literal">fast-vector-highlighter</code> one can use <code class="literal">fragment_offset</code>
parameter to control the margin to start highlighting from.</p><p>In the case where there is no matching fragment to highlight, the default is
to not return anything. Instead, we can return a snippet of text from the
beginning of the field by setting <code class="literal">no_match_size</code> (default <code class="literal">0</code>) to the length
of the text that you want returned. The actual length may be shorter than
specified as it tries to break on a word boundary. When using the postings
highlighter it is not possible to control the actual size of the snippet,
therefore the first sentence gets returned whenever <code class="literal">no_match_size</code> is
greater than <code class="literal">0</code>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {...},
    "highlight" : {
        "fields" : {
            "content" : {
                "fragment_size" : 150,
                "number_of_fragments" : 3,
                "no_match_size": 150
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_highlight_query"></a>Highlight query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/highlighting.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>It is also possible to highlight against a query other than the search
query by setting <code class="literal">highlight_query</code>.  This is especially useful if you
use a rescore query because those are not taken into account by
highlighting by default.  Elasticsearch does not validate that
<code class="literal">highlight_query</code> contains the search query in any way so it is possible
to define it so legitimate query results aren’t highlighted at all.
Generally it is better to include the search query in the
<code class="literal">highlight_query</code>.  Here is an example of including both the search
query and the rescore query in <code class="literal">highlight_query</code>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "fields": [ "_id" ],
    "query" : {
        "match": {
            "content": {
                "query": "foo bar"
            }
        }
    },
    "rescore": {
        "window_size": 50,
        "query": {
            "rescore_query" : {
                "match_phrase": {
                    "content": {
                        "query": "foo bar",
                        "phrase_slop": 1
                    }
                }
            },
            "rescore_query_weight" : 10
        }
    },
    "highlight" : {
        "order" : "score",
        "fields" : {
            "content" : {
                "fragment_size" : 150,
                "number_of_fragments" : 3,
                "highlight_query": {
                    "bool": {
                        "must": {
                            "match": {
                                "content": {
                                    "query": "foo bar"
                                }
                            }
                        },
                        "should": {
                            "match_phrase": {
                                "content": {
                                    "query": "foo bar",
                                    "phrase_slop": 1,
                                    "boost": 10.0
                                }
                            }
                        },
                        "minimum_should_match": 0
                    }
                }
            }
        }
    }
}</pre></div><p>Note that the score of text fragment in this case is calculated by the Lucene
highlighting framework. For implementation details you can check the
<code class="literal">ScoreOrderFragmentsBuilder.java</code> class. On the other hand when using the
postings highlighter the fragments are scored using, as mentioned above,
the BM25 algorithm.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="highlighting-settings"></a>Global Settings<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/highlighting.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Highlighting settings can be set on a global level and then overridden
at the field level.</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {...},
    "highlight" : {
        "number_of_fragments" : 3,
        "fragment_size" : 150,
        "tag_schema" : "styled",
        "fields" : {
            "_all" : { "pre_tags" : ["&lt;em&gt;"], "post_tags" : ["&lt;/em&gt;"] },
            "bio.title" : { "number_of_fragments" : 0 },
            "bio.author" : { "number_of_fragments" : 0 },
            "bio.content" : { "number_of_fragments" : 5, "order" : "score" }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="field-match"></a>Require Field Match<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/highlighting.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p><code class="literal">require_field_match</code> can be set to <code class="literal">true</code> which will cause a field to
be highlighted only if a query matched that field. <code class="literal">false</code> means that
terms are highlighted on all requested fields regardless if the query
matches specifically on them.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="boundary-characters"></a>Boundary Characters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/highlighting.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>When highlighting a field using the fast vector highlighter,
<code class="literal">boundary_chars</code> can be configured to define what constitutes a boundary
for highlighting. It’s a single string with each boundary character
defined in it. It defaults to <code class="literal">.,!? \t\n</code>.</p><p>The <code class="literal">boundary_max_scan</code> allows to control how far to look for boundary
characters, and defaults to <code class="literal">20</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="matched-fields"></a>Matched Fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/highlighting.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The Fast Vector Highlighter can combine matches on multiple fields to
highlight a single field using <code class="literal">matched_fields</code>.  This is most
intuitive for multifields that analyze the same string in different
ways.  All <code class="literal">matched_fields</code> must have <code class="literal">term_vector</code> set to
<code class="literal">with_positions_offsets</code> but only the field to which the matches are
combined is loaded so only that field would benefit from having
<code class="literal">store</code> set to <code class="literal">yes</code>.</p><p>In the following examples <code class="literal">content</code> is analyzed by the <code class="literal">english</code>
analyzer and <code class="literal">content.plain</code> is analyzed by the <code class="literal">standard</code> analyzer.</p><div class="pre_wrapper"><pre class="programlisting">{
    "query": {
        "query_string": {
            "query": "content.plain:running scissors",
            "fields": ["content"]
        }
    },
    "highlight": {
        "order": "score",
        "fields": {
            "content": {
                "matched_fields": ["content", "content.plain"],
                "type" : "fvh"
            }
        }
    }
}</pre></div><p>The above matches both "run with scissors" and "running with scissors"
and would highlight "running" and "scissors" but not "run". If both
phrases appear in a large document then "running with scissors" is
sorted above "run with scissors" in the fragments list because there
are more matches in that fragment.</p><div class="pre_wrapper"><pre class="programlisting">{
    "query": {
        "query_string": {
            "query": "running scissors",
            "fields": ["content", "content.plain^10"]
        }
    },
    "highlight": {
        "order": "score",
        "fields": {
            "content": {
                "matched_fields": ["content", "content.plain"],
                "type" : "fvh"
            }
        }
    }
}</pre></div><p>The above highlights "run" as well as "running" and "scissors" but
still sorts "running with scissors" above "run with scissors" because
the plain match ("running") is boosted.</p><div class="pre_wrapper"><pre class="programlisting">{
    "query": {
        "query_string": {
            "query": "running scissors",
            "fields": ["content", "content.plain^10"]
        }
    },
    "highlight": {
        "order": "score",
        "fields": {
            "content": {
                "matched_fields": ["content.plain"],
                "type" : "fvh"
            }
        }
    }
}</pre></div><p>The above query wouldn’t highlight "run" or "scissor" but shows that
it is just fine not to list the field to which the matches are combined
(<code class="literal">content</code>) in the matched fields.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Technically it is also fine to add fields to <code class="literal">matched_fields</code> that
don’t share the same underlying string as the field to which the matches
are combined.  The results might not make much sense and if one of the
matches is off the end of the text then the whole query will fail.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>There is a small amount of overhead involved with setting
<code class="literal">matched_fields</code> to a non-empty array so always prefer</p><div class="pre_wrapper"><pre class="programlisting">    "highlight": {
        "fields": {
            "content": {}
        }
    }</pre></div><p>to</p><div class="pre_wrapper"><pre class="programlisting">    "highlight": {
        "fields": {
            "content": {
                "matched_fields": ["content"],
                "type" : "fvh"
            }
        }
    }</pre></div></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="phrase-limit"></a>Phrase Limit<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/highlighting.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">fast-vector-highlighter</code> has a <code class="literal">phrase_limit</code> parameter that prevents
it from analyzing too many phrases and eating tons of memory.  It defaults
to 256 so only the first 256 matching phrases in the document scored
considered.  You can raise the limit with the <code class="literal">phrase_limit</code> parameter but
keep in mind that scoring more phrases consumes more time and memory.</p><p>If using <code class="literal">matched_fields</code> keep in mind that <code class="literal">phrase_limit</code> phrases per
matched field are considered.</p><h3><a id="explicit-field-order"></a>Field Highlight Order<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/highlighting.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Elasticsearch highlights the fields in the order that they are sent.  Per the
json spec objects are unordered but if you need to be explicit about the order
that fields are highlighted then you can use an array for <code class="literal">fields</code> like this:</p><div class="pre_wrapper"><pre class="programlisting">    "highlight": {
        "fields": [
            {"title":{ /*params*/ }},
            {"text":{ /*params*/ }}
        ]
    }</pre></div><p>None of the highlighters built into Elasticsearch care about the order that the
fields are highlighted but a plugin may.</p></div></div><div class="navfooter"><span class="prev"><a href="search-request-post-filter.html">
              «&nbsp;
              Post filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-rescore.html">Rescoring
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">Rescoring</span></div><div class="navheader"><span class="prev"><a href="search-request-highlighting.html">
              «&nbsp;
              Highlighting</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-search-type.html">Search Type
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-rescore"></a>Rescoring<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/rescore.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Rescoring can help to improve precision by reordering just the top (eg
100 - 500) documents returned by the
<a class="link" href="search-request-query.html" title="Query"><code class="literal">query</code></a> and
<a class="link" href="search-request-post-filter.html" title="Post filter"><code class="literal">post_filter</code></a> phases, using a
secondary (usually more costly) algorithm, instead of applying the
costly algorithm to all documents in the index.</p><p>A <code class="literal">rescore</code> request is executed on each shard before it returns its
results to be sorted by the node handling the overall search request.</p><p>Currently the rescore API has only one implementation: the query
rescorer, which uses a query to tweak the scoring. In the future,
alternative rescorers may be made available, for example, a pair-wise rescorer.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>the <code class="literal">rescore</code> phase is not executed when
<a class="link" href="search-request-search-type.html" title="Search Type"><code class="literal">search_type</code></a> is set
to <code class="literal">scan</code> or <code class="literal">count</code>.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>when exposing pagination to your users, you should not change
<code class="literal">window_size</code> as you step through each page (by passing different
<code class="literal">from</code> values) since that can alter the top hits causing results to
confusingly shift as the user steps through pages.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_query_rescorer"></a>Query rescorer<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/rescore.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The query rescorer executes a second query only on the Top-K results
returned by the <a class="link" href="search-request-query.html" title="Query"><code class="literal">query</code></a> and
<a class="link" href="search-request-post-filter.html" title="Post filter"><code class="literal">post_filter</code></a> phases. The
number of docs which will be examined on each shard can be controlled by
the <code class="literal">window_size</code> parameter, which defaults to
<a class="link" href="search-request-from-size.html" title="From / Size"><code class="literal">from</code> and <code class="literal">size</code></a>.</p><p>By default the scores from the original query and the rescore query are
combined linearly to produce the final <code class="literal">_score</code> for each document. The
relative importance of the original query and of the rescore query can
be controlled with the <code class="literal">query_weight</code> and <code class="literal">rescore_query_weight</code>
respectively. Both default to <code class="literal">1</code>.</p><p>For example:</p><div class="pre_wrapper"><pre class="programlisting">curl -s -XPOST 'localhost:9200/_search' -d '{
   "query" : {
      "match" : {
         "field1" : {
            "operator" : "or",
            "query" : "the quick brown",
            "type" : "boolean"
         }
      }
   },
   "rescore" : {
      "window_size" : 50,
      "query" : {
         "rescore_query" : {
            "match" : {
               "field1" : {
                  "query" : "the quick brown",
                  "type" : "phrase",
                  "slop" : 2
               }
            }
         },
         "query_weight" : 0.7,
         "rescore_query_weight" : 1.2
      }
   }
}
'</pre></div><p>The way the scores are combined can be controlled with the <code class="literal">score_mode</code>:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th class="entry" align="left" valign="top">Score Mode </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">total</code></p></td><td class="entry" align="left" valign="top"><p>Add the original score and the rescore query score.  The default.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">multiply</code></p></td><td class="entry" align="left" valign="top"><p>Multiply the original score by the rescore query score.  Useful
for <a class="link" href="query-dsl-function-score-query.html" title="Function Score Query"><code class="literal">function query</code></a> rescores.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">avg</code></p></td><td class="entry" align="left" valign="top"><p>Average the original score and the rescore query score.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">max</code></p></td><td class="entry" align="left" valign="top"><p>Take the max of original score and the rescore query score.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">min</code></p></td><td class="entry" align="left" valign="top"><p>Take the min of the original score and the rescore query score.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_multiple_rescores"></a>Multiple Rescores<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/rescore.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>It is also possible to execute multiple rescores in sequence:</p><div class="pre_wrapper"><pre class="programlisting">curl -s -XPOST 'localhost:9200/_search' -d '{
   "query" : {
      "match" : {
         "field1" : {
            "operator" : "or",
            "query" : "the quick brown",
            "type" : "boolean"
         }
      }
   },
   "rescore" : [ {
      "window_size" : 100,
      "query" : {
         "rescore_query" : {
            "match" : {
               "field1" : {
                  "query" : "the quick brown",
                  "type" : "phrase",
                  "slop" : 2
               }
            }
         },
         "query_weight" : 0.7,
         "rescore_query_weight" : 1.2
      }
   }, {
      "window_size" : 10,
      "query" : {
         "score_mode": "multiply",
         "rescore_query" : {
            "function_score" : {
               "script_score": {
                  "script": "log10(doc['numeric'].value + 2)"
               }
            }
         }
      }
   } ]
}
'</pre></div><p>The first one gets the results of the query then the second one gets the
results of the first, etc.  The second rescore will "see" the sorting done
by the first rescore so it is possible to use a large window on the first
rescore to pull documents into a smaller window for the second rescore.</p></div></div><div class="navfooter"><span class="prev"><a href="search-request-highlighting.html">
              «&nbsp;
              Highlighting</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-search-type.html">Search Type
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">Search Type</span></div><div class="navheader"><span class="prev"><a href="search-request-rescore.html">
              «&nbsp;
              Rescoring</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-scroll.html">Scroll
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-search-type"></a>Search Type<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/search-type.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>There are different execution paths that can be done when executing a
distributed search. The distributed search operation needs to be
scattered to all the relevant shards and then all the results are
gathered back. When doing scatter/gather type execution, there are
several ways to do that, specifically with search engines.</p><p>One of the questions when executing a distributed search is how much
results to retrieve from each shard. For example, if we have 10 shards,
the 1st shard might hold the most relevant results from 0 till 10, with
other shards results ranking below it. For this reason, when executing a
request, we will need to get results from 0 till 10 from all shards,
sort them, and then return the results if we want to ensure correct
results.</p><p>Another question, which relates to the search engine, is the fact that each
shard stands on its own. When a query is executed on a specific shard,
it does not take into account term frequencies and other search engine
information from the other shards. If we want to support accurate
ranking, we would need to first gather the term frequencies from all
shards to calculate global term frequencies, then execute the query on
each shard using these global frequencies.</p><p>Also, because of the need to sort the results, getting back a large
document set, or even scrolling it, while maintaining the correct sorting
behavior can be a very expensive operation. For large result set
scrolling without sorting, the <code class="literal">scan</code> search type (explained below) is
also available.</p><p>Elasticsearch is very flexible and allows to control the type of search
to execute on a <span class="strong emphasis"><strong>per search request</strong></span> basis. The type can be configured
by setting the <span class="strong emphasis"><strong>search_type</strong></span> parameter in the query string. The types
are:</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="query-then-fetch"></a>Query Then Fetch<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/search-type.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Parameter value: <span class="strong emphasis"><strong>query_then_fetch</strong></span>.</p><p>The request is processed in two phases. In the first phase, the query
is forwarded to <span class="strong emphasis"><strong>all involved shards</strong></span>. Each shard executes the search
and generates a sorted list of results, local to that shard. Each
shard returns <span class="strong emphasis"><strong>just enough information</strong></span> to the coordinating node
to allow it merge and re-sort the shard level results into a globally
sorted set of results, of maximum length <code class="literal">size</code>.</p><p>During the second phase, the coordinating node requests the document
content (and highlighted snippets, if any) from <span class="strong emphasis"><strong>only the relevant
shards</strong></span>.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>This is the default setting, if you do not specify a <code class="literal">search_type</code>
      in your request.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="dfs-query-then-fetch"></a>Dfs, Query Then Fetch<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/search-type.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Parameter value: <span class="strong emphasis"><strong>dfs_query_then_fetch</strong></span>.</p><p>Same as "Query Then Fetch", except for an initial scatter phase which
goes and computes the distributed term frequencies for more accurate
scoring.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="count"></a>Count<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/search-type.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Parameter value: <span class="strong emphasis"><strong>count</strong></span>.</p><p>A special search type that returns the count that matched the search
request without any docs (represented in <code class="literal">total_hits</code>), and possibly,
including facets as well. In general, this is preferable to the <code class="literal">count</code>
API as it provides more options.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="scan"></a>Scan<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/search-type.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Parameter value: <span class="strong emphasis"><strong>scan</strong></span>.</p><p>The <code class="literal">scan</code> search type disables sorting in order to allow very efficient
scrolling through large result sets.  See <a class="xref" href="search-request-scroll.html#scroll-scan" title="Efficient scrolling with Scroll-Scan">Efficient scrolling with Scroll-Scan</a> for more.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="query-and-fetch"></a>Query And Fetch<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/search-type.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Parameter value: <span class="strong emphasis"><strong>query_and_fetch</strong></span>.</p><p>The <code class="literal">query_and_fetch</code> mode is an <span class="strong emphasis"><strong>internal</strong></span> optimization which
is chosen automatically when a <code class="literal">query_then_fetch</code> request
targets a single shard only.  Both phases of <code class="literal">query_then_fetch</code>
are executed in a single pass.  This mode should not be
explicitly specified by the user.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="dfs-query-and-fetch"></a>Dfs, Query And Fetch<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/search-type.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Parameter value: <span class="strong emphasis"><strong>dfs_query_and_fetch</strong></span>.</p><p>Same as <code class="literal">query_and_fetch</code>, except for an initial scatter phase which
goes and computes the distributed term frequencies for more accurate
scoring. This mode should not be explicitly specified by the user.</p></div></div><div class="navfooter"><span class="prev"><a href="search-request-rescore.html">
              «&nbsp;
              Rescoring</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-scroll.html">Scroll
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">Scroll</span></div><div class="navheader"><span class="prev"><a href="search-request-search-type.html">
              «&nbsp;
              Search Type</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-preference.html">Preference
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-scroll"></a>Scroll<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/scroll.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>While a <code class="literal">search</code> request returns a single “page” of results, the <code class="literal">scroll</code>
API can be used to retrieve large numbers of results (or even all results)
from a single search request, in much the same way as you would use a cursor
on a traditional database.</p><p>Scrolling is not intended for real time user requests, but rather for
processing large amounts of data, e.g. in order to reindex the contents of one
index into a new index with a different configuration.</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Client support for scrolling and reindexing</strong></p></div></div></div><p>Some of the officially supported clients provide helpers to assist with
scrolled searches and reindexing of documents from one index to another:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Perl
</span></dt><dd>
    See <a class="ulink" href="https://metacpan.org/pod/Search::Elasticsearch::Bulk" target="_top">Search::Elasticsearch::Bulk</a>
    and <a class="ulink" href="https://metacpan.org/pod/Search::Elasticsearch::Scroll" target="_top">Search::Elasticsearch::Scroll</a>
</dd><dt><span class="term">
Python
</span></dt><dd>
    See <a class="ulink" href="http://elasticsearch-py.readthedocs.org/en/master/helpers.html" target="_top">elasticsearch.helpers.*</a>
</dd></dl></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The results that are returned from a scroll request reflect the state of
the index at the time that the initial <code class="literal">search</code> request was  made, like a
snapshot in time. Subsequent changes to documents (index, update or delete)
will only affect later search requests.</p></div></div><p>In order to use scrolling, the initial search request should specify the
<code class="literal">scroll</code> parameter in the query string, which tells Elasticsearch how long it
should keep the “search context” alive (see <a class="xref" href="search-request-scroll.html#scroll-search-context" title="Keeping the search context alive">Keeping the search context alive</a>), eg <code class="literal">?scroll=1m</code>.</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/twitter/tweet/_search?scroll=1m' -d '
{
    "query": {
        "match" : {
            "title" : "elasticsearch"
        }
    }
}
'</pre></div><p>The result from the above request includes a <code class="literal">_scroll_id</code>, which should
be passed to the <code class="literal">scroll</code> API in order to retrieve the next batch of
results.</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET <a id="CO4-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span> 'localhost:9200/_search/scroll?scroll=1m' <a id="CO4-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span> <a id="CO4-3"></a><span><img src="images/icons/callouts/3.png" alt=""></span> \
     -d       'c2Nhbjs2OzM0NDg1ODpzRlBLc0FXNlNyNm5JWUc1' <a id="CO4-4"></a><span><img src="images/icons/callouts/4.png" alt=""></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
<code class="literal">GET</code> or <code class="literal">POST</code> can be used.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The URL should not include the <code class="literal">index</code> or <code class="literal">type</code> name — these
    are specified in the original <code class="literal">search</code> request instead.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-3"><span><img src="images/icons/callouts/3.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">scroll</code> parameter tells Elasticsearch to keep the search context open
    for another <code class="literal">1m</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO4-4"><span><img src="images/icons/callouts/4.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The returned <code class="literal">_scroll_id</code> attribute can be passed in the request body or in the
    query string as <code class="literal">?scroll_id=....</code>
</p></td></tr></tbody></table></div><p>Each call to the <code class="literal">scroll</code> API returns the next batch of results until there
are no more results left to return, ie the <code class="literal">hits</code> array is empty.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png"></div><div class="admon_content"><p>The initial search request and each subsequent scroll request
returns a new <code class="literal">_scroll_id</code> — only the most recent <code class="literal">_scroll_id</code> should be
used.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>If the request specifies aggregations, only the initial search response
will contain the aggregations results.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="scroll-scan"></a>Efficient scrolling with Scroll-Scan<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/scroll.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Deep pagination with <a class="link" href="search-request-from-size.html" title="From / Size"><code class="literal">from</code> and <code class="literal">size</code></a> — e.g.
<code class="literal">?size=10&amp;from=10000</code> — is very inefficient as (in this example) 100,000
sorted results have to be retrieved from each shard and resorted in order to
return just 10 results.  This process has to be repeated for every page
requested.</p><p>The <code class="literal">scroll</code> API keeps track of which results have already been returned and
so is able to return sorted results more efficiently than with deep
pagination.  However, sorting results (which happens by default) still has a
cost.</p><p>Normally, you just want to retrieve all results and the order doesn’t matter.
Scrolling can be combined with the <a class="link" href="search-request-search-type.html#scan" title="Scan"><code class="literal">scan</code></a> search type to disable
any scoring or sorting and to return results in the most efficient way
possible.  All that is needed is to add <code class="literal">search_type=scan</code> to the query string
of the initial search request:</p><div class="pre_wrapper"><pre class="programlisting">curl 'localhost:9200/twitter/tweet/_search?scroll=1m&amp;search_type=scan' <a id="CO5-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span> -d '
{
    "query": {
        "match" : {
            "title" : "elasticsearch"
        }
    }
}
'</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO5-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Setting <code class="literal">search_type</code> to <code class="literal">scan</code> disables sorting and makes scrolling
    very efficient.
</p></td></tr></tbody></table></div><p>A scanning scroll request differs from a standard scroll request in four
ways:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
No score is calculated and sorting is disabled. Results are returned in
  the order they appear in the index.
</li><li class="listitem">
Aggregations are not supported.
</li><li class="listitem">
The response of the initial <code class="literal">search</code> request will not contain any results in
  the <code class="literal">hits</code> array. The first results will be returned by the first <code class="literal">scroll</code>
  request.
</li><li class="listitem">
The <a class="link" href="search-request-from-size.html" title="From / Size"><code class="literal">size</code> parameter</a> controls the number of
  results <span class="strong emphasis"><strong>per shard</strong></span>, not per request, so a <code class="literal">size</code> of <code class="literal">10</code> which hits 5
  shards will return a maximum of 50 results per <code class="literal">scroll</code> request.
</li></ul></div><p>If you want the scoring to happen, even without sorting on it, set the
<code class="literal">track_scores</code> parameter to <code class="literal">true</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="scroll-search-context"></a>Keeping the search context alive<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/scroll.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">scroll</code> parameter (passed to the <code class="literal">search</code> request and to every <code class="literal">scroll</code>
request) tells Elasticsearch how long it should keep the search context alive.
Its value (e.g. <code class="literal">1m</code>, see <a class="xref" href="common-options.html#time-units" title="Time unitsedit">the section called “Time units</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>”) does not need to be long enough to
process all data — it just needs to be long enough to process the previous
batch of results. Each <code class="literal">scroll</code> request (with the <code class="literal">scroll</code> parameter) sets a
new  expiry time.</p><p>Normally, the <a class="link" href="index-modules-merge.html" title="Merge">background merge process</a> optimizes the
index by merging together smaller segments to create new bigger segments, at
which time the smaller segments are deleted. This process continues during
scrolling, but an open search context prevents the old segments from being
deleted while they are still in use.  This is how Elasticsearch is able to
return the results of the initial search request, regardless of subsequent
changes to documents.</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p>Keeping older segments alive means that more file handles are needed.
Ensure that you have configured your nodes to have ample free file handles.
See <a class="xref" href="setup-configuration.html#file-descriptors" title="File Descriptorsedit">the section called “File Descriptors</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/setup/configuration.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>”.</p></div></div><p>You can check how many search contexts are open with the
<a class="link" href="cluster-nodes-stats.html" title="Nodes Stats">nodes stats API</a>:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET localhost:9200/_nodes/stats/indices/search?pretty</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_clear_scroll_api"></a>Clear scroll API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/scroll.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Search contexts are removed automatically either when all results have been
retrieved or when the <code class="literal">scroll</code> timeout has been exceeded.  However, you can
clear a search context manually with the <code class="literal">clear-scroll</code> API:</p><div class="pre_wrapper"><pre class="programlisting">curl -XDELETE localhost:9200/_search/scroll \
     -d 'c2Nhbjs2OzM0NDg1ODpzRlBLc0FXNlNyNm5JWUc1' <a id="CO6-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO6-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">scroll_id</code> can be passed in the request body or in the query string.
</p></td></tr></tbody></table></div><p>Multiple scroll IDs can be passed as comma separated values:</p><div class="pre_wrapper"><pre class="programlisting">curl -XDELETE localhost:9200/_search/scroll \
     -d 'c2Nhbjs2OzM0NDg1ODpzRlBLc0FXNlNyNm5JWUc1,aGVuRmV0Y2g7NTsxOnkxaDZ' <a id="CO7-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span></pre></div><p>All search contexts can be cleared with the <code class="literal">_all</code> parameter:</p><div class="pre_wrapper"><pre class="programlisting">curl -XDELETE localhost:9200/_search/scroll/_all</pre></div></div></div><div class="navfooter"><span class="prev"><a href="search-request-search-type.html">
              «&nbsp;
              Search Type</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-preference.html">Preference
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">Preference</span></div><div class="navheader"><span class="prev"><a href="search-request-scroll.html">
              «&nbsp;
              Scroll</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-explain.html">Explain
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-preference"></a>Preference<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/preference.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Controls a <code class="literal">preference</code> of which shard replicas to execute the search
request on. By default, the operation is randomized between the shard
replicas.</p><p>The <code class="literal">preference</code> is a query string parameter which can be set to:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">_primary</code>
</p>
</td><td class="entry" valign="top">
<p>
        The operation will go and be executed only on the primary
        shards.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">_primary_first</code>
</p>
</td><td class="entry" valign="top">
<p>
        The operation will go and be executed on the primary
        shard, and if not available (failover), will execute on other shards.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">_local</code>
</p>
</td><td class="entry" valign="top">
<p>
        The operation will prefer to be executed on a local
        allocated shard if possible.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">_only_node:xyz</code>
</p>
</td><td class="entry" valign="top">
<p>
        Restricts the search to execute only on a node with
        the provided node id (<code class="literal">xyz</code> in this case).
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">_prefer_node:xyz</code>
</p>
</td><td class="entry" valign="top">
<p>
        Prefers execution on the node with the provided
        node id (<code class="literal">xyz</code> in this case) if applicable.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">_shards:2,3</code>
</p>
</td><td class="entry" valign="top">
<p>
        Restricts the operation to the specified shards. (<code class="literal">2</code>
        and <code class="literal">3</code> in this case). This preference can be combined with other
        preferences but it has to appear first: <code class="literal">_shards:2,3;_primary</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">_only_nodes</code>
</p>
</td><td class="entry" valign="top">
<p>
    Restricts the operation to nodes specified in node specification
    <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster.html" target="_top">https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster.html</a> <span class="added">
      [<span class="version">1.7.0</span>]
      <span class="detail">Added in 1.7.0.
</span></span>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
Custom (string) value
</p>
</td><td class="entry" valign="top">
<p>
        A custom value will be used to guarantee that
        the same shards will be used for the same custom value. This can help
        with "jumping values" when hitting different shards in different refresh
        states. A sample value can be something like the web session id, or the
        user name.
</p>
</td></tr></tbody></table></div><p>For instance, use the user’s session ID to ensure consistent ordering of results
for the user:</p><div class="pre_wrapper"><pre class="programlisting">curl localhost:9200/_search?preference=xyzabc123 -d '
{
    "query": {
        "match": {
            "title": "elasticsearch"
        }
    }
}
'</pre></div></div><div class="navfooter"><span class="prev"><a href="search-request-scroll.html">
              «&nbsp;
              Scroll</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-explain.html">Explain
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">Explain</span></div><div class="navheader"><span class="prev"><a href="search-request-preference.html">
              «&nbsp;
              Preference</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-version.html">Version
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-explain"></a>Explain<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/explain.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Enables explanation for each hit on how its score was computed.</p><div class="pre_wrapper"><pre class="programlisting">{
    "explain": true,
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="search-request-preference.html">
              «&nbsp;
              Preference</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-version.html">Version
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">Version</span></div><div class="navheader"><span class="prev"><a href="search-request-explain.html">
              «&nbsp;
              Explain</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-index-boost.html">Index Boost
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-version"></a>Version<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/version.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Returns a version for each search hit.</p><div class="pre_wrapper"><pre class="programlisting">{
    "version": true,
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="search-request-explain.html">
              «&nbsp;
              Explain</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-index-boost.html">Index Boost
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">Index Boost</span></div><div class="navheader"><span class="prev"><a href="search-request-version.html">
              «&nbsp;
              Version</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-min-score.html">min_score
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-index-boost"></a>Index Boost<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/index-boost.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Allows to configure different boost level per index when searching
across more than one indices. This is very handy when hits coming from
one index matter more than hits coming from another index (think social
graph where each user has an index).</p><div class="pre_wrapper"><pre class="programlisting">{
    "indices_boost" : {
        "index1" : 1.4,
        "index2" : 1.3
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="search-request-version.html">
              «&nbsp;
              Version</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-min-score.html">min_score
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">min_score</span></div><div class="navheader"><span class="prev"><a href="search-request-index-boost.html">
              «&nbsp;
              Index Boost</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-named-queries-and-filters.html">Named Queries and Filters
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-min-score"></a>min_score<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/min-score.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Exclude documents which have a <code class="literal">_score</code> less than the minimum specified
in <code class="literal">min_score</code>:</p><div class="pre_wrapper"><pre class="programlisting">{
    "min_score": 0.5,
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}</pre></div><p>Note, most times, this does not make much sense, but is provided for
advanced use cases.</p></div><div class="navfooter"><span class="prev"><a href="search-request-index-boost.html">
              «&nbsp;
              Index Boost</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-named-queries-and-filters.html">Named Queries and Filters
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">Named Queries and Filters</span></div><div class="navheader"><span class="prev"><a href="search-request-min-score.html">
              «&nbsp;
              min_score</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-inner-hits.html">Inner hits
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-named-queries-and-filters"></a>Named Queries and Filters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/named-queries-and-filters.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Each filter and query can accept a <code class="literal">_name</code> in its top level definition.</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "bool" : {
                "should" : [
                    {"match" : { "name.first" : {"query" : "shay", "_name" : "first"} }},
                    {"match" : { "name.last" : {"query" : "banon", "_name" : "last"} }}
                ]
            }
        },
        "filter" : {
            "terms" : {
                "name.last" : ["banon", "kimchy"],
                "_name" : "test"
            }
        }
    }
}</pre></div><p>The search response will include for each hit the <code class="literal">matched_queries</code> it matched on. The tagging of queries and filters
only make sense for compound queries and filters (such as <code class="literal">bool</code> query and filter, <code class="literal">or</code> and <code class="literal">and</code> filter, <code class="literal">filtered</code> query etc.).</p><p>Note, the query filter had to be enhanced in order to support this. In
order to set a name, the <code class="literal">fquery</code> filter should be used, which wraps a
query (just so there will be a place to set a name for it), for example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "fquery" : {
                "query" : {
                    "term" : { "name.last" : "banon" }
                },
                "_name" : "test"
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_named_queries"></a>Named queries<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/named-queries-and-filters.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The support for the <code class="literal">_name</code> option on queries is available from version <code class="literal">0.90.4</code> and the support on filters is available
also in versions before <code class="literal">0.90.4</code>.</p></div></div><div class="navfooter"><span class="prev"><a href="search-request-min-score.html">
              «&nbsp;
              min_score</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-request-inner-hits.html">Inner hits
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-request-body.html">Request Body Search</a></span> » <span class="breadcrumb-node">Inner hits</span></div><div class="navheader"><span class="prev"><a href="search-request-named-queries-and-filters.html">
              «&nbsp;
              Named Queries and Filters</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-template.html">Search Template
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-request-inner-hits"></a>Inner hits<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/inner-hits.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p></div></div><p>The <a class="link" href="mapping-parent-field.html" title="_parent">parent/child</a> and <a class="link" href="mapping-nested-type.html" title="Nested Type">nested</a> features allow the return of documents that
have matches in a different scope. In the parent/child case, parent document are returned based on matches in child
documents or child document are returned based on matches in parent documents. In the nested case, documents are returned
based on matches in nested inner objects.</p><p>In both cases, the actual matches in the different scopes that caused a document to be returned is hidden. In many cases,
it’s very useful to know which inner nested objects (in the case of nested or children or parent documents), or (in the case
of parent/child) caused certain information to be returned. The inner hits feature can be used for this. This feature
returns per search hit in the search response additional nested hits that caused a search hit to match in a different scope.</p><p>Inner hits can be used by defining a <code class="literal">inner_hits</code> definition on a <code class="literal">nested</code>, <code class="literal">has_child</code> or <code class="literal">has_parent</code> query and filter.
The structure looks like this:</p><div class="pre_wrapper"><pre class="programlisting">"&lt;query&gt;" : {
    "inner_hits" : {
        &lt;inner_hits_options&gt;
    }
}</pre></div><p>If <code class="literal">_inner_hits</code> is defined on a query that supports it then each search hit will contain a <code class="literal">inner_hits</code> json object with the following structure:</p><div class="pre_wrapper"><pre class="programlisting">"hits": [
     {
        "_index": ...,
        "_type": ...,
        "_id": ...,
        "inner_hits": {
           "&lt;inner_hits_name&gt;": {
              "hits": {
                 "total": ...,
                 "hits": [
                    {
                       "_type": ...,
                       "_id": ...,
                       ...
                    },
                    ...
                 ]
              }
           }
        },
        ...
     },
     ...
]</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_options"></a>Options<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/inner-hits.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Inner hits support the following options:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">from</code>
</p>
</td><td class="entry" valign="top">
<p>
The offset from where the first hit to fetch for each <code class="literal">inner_hits</code> in the returned regular search hits.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">size</code>
</p>
</td><td class="entry" valign="top">
<p>
The maximum number of hits to return per <code class="literal">inner_hits</code>. By default the top three matching hits are returned.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">sort</code>
</p>
</td><td class="entry" valign="top">
<p>
How the inner hits should be sorted per <code class="literal">inner_hits</code>. By default the hits are sorted by the score.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">name</code>
</p>
</td><td class="entry" valign="top">
<p>
The name to be used for the particular inner hit definition in the response. Useful when multiple inner hits
         have been defined in a single search request. The default depends in which query the inner hit is defined.
         For <code class="literal">has_child</code> query and filter this is the child type, <code class="literal">has_parent</code> query and filter this is the parent type
         and the nested query and filter this is the nested path.
</p>
</td></tr></tbody></table></div><p>Inner hits also supports the following per document features:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="link" href="search-request-highlighting.html" title="Highlighting">Highlighting</a>
</li><li class="listitem">
<a class="link" href="search-request-explain.html" title="Explain">Explain</a>
</li><li class="listitem">
<a class="link" href="search-request-source-filtering.html" title="Source filtering">Source filtering</a>
</li><li class="listitem">
<a class="link" href="search-request-script-fields.html" title="Script Fields">Script fields</a>
</li><li class="listitem">
<a class="link" href="search-request-fielddata-fields.html" title="Field Data Fields">Fielddata fields</a>
</li><li class="listitem">
<a class="link" href="search-request-version.html" title="Version">Include versions</a>
</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="nested-inner-hits"></a>Nested inner hits<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/inner-hits.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The nested <code class="literal">inner_hits</code> can be used to include nested inner objects as inner hits to a search hit.</p><p>The example below assumes that there is a nested object field defined with the name <code class="literal">comments</code>:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "nested" : {
            "path" : "comments",
            "query" : {
                "match" : {"comments.message" : "[actual query]"}
            },
            "inner_hits" : {} <a id="CO7-2"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO7-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> <a href="#CO7-2"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The inner hit definition in the nested query. No other options need to be defined.
</p></td></tr></tbody></table></div><p>An example of a response snippet that could be generated from the above search request:</p><div class="pre_wrapper"><pre class="programlisting">...
"hits": {
  ...
  "hits": [
     {
        "_index": "my-index",
        "_type": "question",
        "_id": "1",
        "_source": ...,
        "inner_hits": {
           "comments": { <a id="CO8-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
              "hits": {
                 "total": ...,
                 "hits": [
                    {
                       "_type": "question",
                       "_id": "1",
                       "_nested": {
                          "field": "comments",
                          "offset": 2
                       },
                       "_source": ...
                    },
                    ...
                 ]
              }
           }
        }
     },
     ...</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO8-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The name used in the inner hit definition in the search request. A custom key can be used via the <code class="literal">name</code> option.
</p></td></tr></tbody></table></div><p>The <code class="literal">_nested</code> metadata is crucial in the above example, because it defines from what inner nested object this inner hit
came from. The <code class="literal">field</code> defines the object array field the nested hit is from and the <code class="literal">offset</code> relative to its location
in the <code class="literal">_source</code>. Due to sorting and scoring the actual location of the hit objects in the <code class="literal">inner_hits</code> is usually
different than the location a nested inner object was defined.</p><p>By default the <code class="literal">_source</code> is returned also for the hit objects in <code class="literal">inner_hits</code>, but this can be changed. Either via
<code class="literal">_source</code> filtering feature part of the source can be returned or be disabled. If stored fields are defined on the
nested level these can also be returned via the <code class="literal">fields</code> feature.</p><p>An important default is that the <code class="literal">_source</code> returned in hits inside <code class="literal">inner_hits</code> is relative to the <code class="literal">_nested</code> metadata.
So in the above example only the comment part is returned per nested hit and not the entire source of the top level
document that contained the the comment.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="hierarchical-nested-inner-hits"></a>Hierarchical levels of nested object fields and inner hits.<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/inner-hits.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>If a mapping has multiple levels of hierarchical nested object fields each level can be accessed via dot notated path.
For example if there is a <code class="literal">comments</code> nested field that contains a <code class="literal">votes</code> nested field and votes should directly be returned
with the the root hits then the following path can be defined:</p><div class="pre_wrapper"><pre class="programlisting">{
   "query" : {
      "nested" : {
         "path" : "comments.votes",
         "query" : { ... },
         "inner_hits" : {}
      }
    }
}</pre></div><p>This indirect referencing is only supported for nested inner hits.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="parent-child-inner-hits"></a>Parent/child inner hits<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/inner-hits.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The parent/child <code class="literal">inner_hits</code> can be used to include parent or child</p><p>The examples below assumes that there is a <code class="literal">_parent</code> field mapping in the <code class="literal">comment</code> type:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "has_child" : {
            "type" : "comment",
            "query" : {
                "match" : {"message" : "[actual query]"}
            },
            "inner_hits" : {} <a id="CO9-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO9-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The inner hit definition like in the nested example.
</p></td></tr></tbody></table></div><p>An example of a response snippet that could be generated from the above search request:</p><div class="pre_wrapper"><pre class="programlisting">...
"hits": {
  ...
  "hits": [
     {
        "_index": "my-index",
        "_type": "question",
        "_id": "1",
        "_source": ...,
        "inner_hits": {
           "comment": {
              "hits": {
                 "total": ...,
                 "hits": [
                    {
                       "_type": "comment",
                       "_id": "5",
                       "_source": ...
                    },
                    ...
                 ]
              }
           }
        }
     },
     ...</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="top-level-inner-hits"></a>top level inner hits<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/request/inner-hits.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Besides defining inner hits on query and filters, inner hits can also be defined as a top level construct alongside the
<code class="literal">query</code> and <code class="literal">aggregations</code> definition. The main reason for using the top level inner hits definition is to let the
inner hits return documents that don’t match with the main query. Also inner hits definitions can be nested via the
top level notation. Other then that the inner hit definition inside the query should be used, because that is the most
compact way for defining inner hits.</p><p>The following snippet explains the basic structure of inner hits defined at the top level of the search request body:</p><div class="pre_wrapper"><pre class="programlisting">"inner_hits" : {
    "&lt;inner_hits_name&gt;" : {
        "&lt;path|type&gt;" : {
            "&lt;path-to-nested-object-field|child-or-parent-type&gt;" : {
                &lt;inner_hits_body&gt;
                [,"inner_hits" : { [&lt;sub_inner_hits&gt;]+ } ]?
            }
        }
    }
    [,"&lt;inner_hits_name_2&gt;" : { ... } ]*
}</pre></div><p>Inside the <code class="literal">inner_hits</code> definition, first the name if the inner hit is defined then whether the inner_hit
is a nested by defining <code class="literal">path</code> or a parent/child based definition by defining <code class="literal">type</code>. The next object layer contains
the name of the nested object field if the inner_hits is nested or the parent or child type if the inner_hit definition
is parent/child based.</p><p>Multiple inner hit definitions can be defined in a single request. In the <code class="literal">&lt;inner_hits_body&gt;</code> any option for features
that <code class="literal">inner_hits</code> support can be defined. Optionally another <code class="literal">inner_hits</code> definition can be defined in the <code class="literal">&lt;inner_hits_body&gt;</code>.</p><p>An example that shows the use of nested inner hits via the top level notation:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "nested" : {
            "path" : "comments",
            "query" : {
                "match" : {"comments.message" : "[actual query]"}
            }
        }
    },
    "inner_hits" : {
        "comment" : {
            "path" : { <a id="CO10-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
                "comments" : { <a id="CO10-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
                    "query" : {
                        "match" : {"comments.message" : "[different query]"} <a id="CO10-3"></a><span><img src="images/icons/callouts/3.png" alt=""></span>
                    }
                }
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO10-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The inner hit definition is nested and requires the <code class="literal">path</code> option.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO10-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The path option refers to the nested object field <code class="literal">comments</code>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO10-3"><span><img src="images/icons/callouts/3.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
A query that runs to collect the nested inner documents for each search hit returned. If no query is defined all nested
    inner documents will be included belonging to a search hit. This shows that it only make sense to the top level
    inner hit definition if no query or a different query is specified.
</p></td></tr></tbody></table></div><p>Additional options that are only available when using the top level inner hits notation:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">path</code>
</p>
</td><td class="entry" valign="top">
<p>
Defines the nested scope where hits will be collected from.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">type</code>
</p>
</td><td class="entry" valign="top">
<p>
Defines the parent or child type score where hits will be collected from.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">query</code>
</p>
</td><td class="entry" valign="top">
<p>
Defines the query that will run in the defined nested, parent or child scope to collect and score hits. By default all document in the scope will be matched.
</p>
</td></tr></tbody></table></div><p>Either <code class="literal">path</code> or <code class="literal">type</code> must be defined. The <code class="literal">path</code> or <code class="literal">type</code> defines the scope from where hits are fetched and
used as inner hits.</p></div></div><div class="navfooter"><span class="prev"><a href="search-request-named-queries-and-filters.html">
              «&nbsp;
              Named Queries and Filters</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-template.html">Search Template
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-node">Search Template</span></div><div class="navheader"><span class="prev"><a href="search-request-inner-hits.html">
              «&nbsp;
              Inner hits</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-shards.html">Search Shards API
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-template"></a>Search Template<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/search-template.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">/_search/template</code> endpoint allows to use the mustache language to pre render search requests,
before they are executed and fill existing templates with template parameters.</p><div class="pre_wrapper"><pre class="programlisting">GET /_search/template
{
    "template" : {
      "query": { "match" : { "{{my_field}}" : "{{my_value}}" } },
      "size" : "{{my_size}}"
    },
    "params" : {
        "my_field" : "foo",
        "my_value" : "bar",
        "my_size" : 5
    }
}</pre></div><p>For more information on how Mustache templating and what kind of templating you
can do with it check out the <a class="ulink" href="http://mustache.github.io/mustache.5.html" target="_top">online
documentation of the mustache project</a>.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The mustache language is implemented in elasticsearch as a sandboxed
scripting language, hence it obeys settings that may be used to enable or
disable scripts per language, source and operation as described in
<a class="link" href="modules-scripting.html#enable-dynamic-scripting" title="Enabling dynamic scriptingedit">scripting docs</a> <span class="added">
      [<span class="version">1.6.0</span>]
      <span class="detail">Added in 1.6.0.
<code class="literal">mustache</code> scripts were always on before and it wasn’t possible to disable them
</span></span>.</p></div></div><h4><a id="_more_template_examples"></a>More template examples<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/search-template.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><h5><a id="_filling_in_a_query_string_with_a_single_value"></a>Filling in a query string with a single value<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/search-template.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><div class="pre_wrapper"><pre class="programlisting">GET /_search/template
{
    "template": {
        "query": {
            "match": {
                "title": "{{query_string}}"
            }
        }
    },
    "params": {
        "query_string": "search for these words"
    }
}</pre></div><h5><a id="_passing_an_array_of_strings"></a>Passing an array of strings<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/search-template.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><div class="pre_wrapper"><pre class="programlisting">GET /_search/template
{
  "template": {
    "query": {
      "terms": {
        "status": [
          "{{#status}}",
          "{{.}}",
          "{{/status}}"
        ]
      }
    }
  },
  "params": {
    "status": [ "pending", "published" ]
  }
}</pre></div><p>which is rendered as:</p><div class="pre_wrapper"><pre class="programlisting">{
"query": {
  "terms": {
    "status": [ "pending", "published" ]
  }
}</pre></div><h5><a id="_default_values"></a>Default values<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/search-template.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>A default value is written as <code class="literal">{{var}}{{^var}}default{{/var}}</code> for instance:</p><div class="pre_wrapper"><pre class="programlisting">{
  "template": {
    "query": {
      "range": {
        "line_no": {
          "gte": "{{start}}",
          "lte": "{{end}}{{^end}}20{{/end}}"
        }
      }
    }
  },
  "params": { ... }
}</pre></div><p>When <code class="literal">params</code> is <code class="literal">{ "start": 10, "end": 15 }</code> this query would be rendered as:</p><div class="pre_wrapper"><pre class="programlisting">{
    "range": {
        "line_no": {
            "gte": "10",
            "lte": "15"
        }
  }
}</pre></div><p>But when <code class="literal">params</code> is <code class="literal">{ "start": 10 }</code> this query would use the default value
for <code class="literal">end</code>:</p><div class="pre_wrapper"><pre class="programlisting">{
    "range": {
        "line_no": {
            "gte": "10",
            "lte": "20"
        }
    }
}</pre></div><h5><a id="_conditional_clauses"></a>Conditional clauses<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/search-template.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Conditional clauses cannot be expressed using the JSON form of the template.
Instead, the template <span class="strong emphasis"><strong>must</strong></span> be passed as a string.  For instance, let’s say
we wanted to run a <code class="literal">match</code> query on the <code class="literal">line</code> field, and optionally wanted
to filter by line numbers, where <code class="literal">start</code> and <code class="literal">end</code> are optional.</p><p>The <code class="literal">params</code> would look like:</p><div class="pre_wrapper"><pre class="programlisting">{
    "params": {
        "text":      "words to search for",
        "line_no": { <a id="CO11-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
            "start": 10, <a id="CO11-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
            "end":   20  <a id="CO11-3"></a><span><img src="images/icons/callouts/3.png" alt=""></span>
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO11-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> <a href="#CO11-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> <a href="#CO11-3"><span><img src="images/icons/callouts/3.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
All three of these elements are optional.
</p></td></tr></tbody></table></div><p>We could write the query as:</p><div class="pre_wrapper"><pre class="programlisting">{
  "query": {
    "filtered": {
      "query": {
        "match": {
          "line": "{{text}}" <a id="CO12-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
        }
      },
      "filter": {
        {{#line_no}} <a id="CO12-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
          "range": {
            "line_no": {
              {{#start}} <a id="CO12-3"></a><span><img src="images/icons/callouts/3.png" alt=""></span>
                "gte": "{{start}}" <a id="CO12-4"></a><span><img src="images/icons/callouts/4.png" alt=""></span>
                {{#end}},{{/end}} <a id="CO12-5"></a><span><img src="images/icons/callouts/5.png" alt=""></span>
              {{/start}} <a id="CO12-6"></a><span><img src="images/icons/callouts/6.png" alt=""></span>
              {{#end}} <a id="CO12-7"></a><span><img src="images/icons/callouts/7.png" alt=""></span>
                "lte": "{{end}}" <a id="CO12-8"></a><span><img src="images/icons/callouts/8.png" alt=""></span>
              {{/end}} <a id="CO12-9"></a><span><img src="images/icons/callouts/9.png" alt=""></span>
            }
          }
        {{/line_no}} <a id="CO12-10"></a><span><img src="images/icons/callouts/10.png" alt=""></span>
      }
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO12-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Fill in the value of param <code class="literal">text</code>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO12-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> <a href="#CO12-10"><span><img src="images/icons/callouts/10.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Include the <code class="literal">range</code> filter only if <code class="literal">line_no</code> is specified
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO12-3"><span><img src="images/icons/callouts/3.png" alt=""></span></a> <a href="#CO12-6"><span><img src="images/icons/callouts/6.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Include the <code class="literal">gte</code> clause only if <code class="literal">line_no.start</code> is specified
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO12-4"><span><img src="images/icons/callouts/4.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Fill in the value of param <code class="literal">line_no.start</code>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO12-5"><span><img src="images/icons/callouts/5.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Add a comma after the <code class="literal">gte</code> clause only if <code class="literal">line_no.start</code>
    AND <code class="literal">line_no.end</code> are specified
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO12-7"><span><img src="images/icons/callouts/7.png" alt=""></span></a> <a href="#CO12-9"><span><img src="images/icons/callouts/9.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Include the <code class="literal">lte</code> clause only if <code class="literal">line_no.end</code> is specified
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO12-8"><span><img src="images/icons/callouts/8.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Fill in the value of param <code class="literal">line_no.end</code>
</p></td></tr></tbody></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>As written above, this template is not valid JSON because it includes the
<span class="emphasis"><em>section</em></span> markers like <code class="literal">{{#line_no}}</code>.  For this reason, the template should
either be stored in a file (see <a class="xref" href="search-template.html#pre-registered-templates" title="Pre-registered templateedit">the section called “Pre-registered template</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/search-template.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>”) or, when used
via the REST API, should be written as a string:</p><div class="pre_wrapper"><pre class="programlisting">"template": "{\"query\":{\"filtered\":{\"query\":{\"match\":{\"line\":\"{{text}}\"}},\"filter\":{{{#line_no}}\"range\":{\"line_no\":{{{#start}}\"gte\":\"{{start}}\"{{#end}},{{/end}}{{/start}}{{#end}}\"lte\":\"{{end}}\"{{/end}}}}{{/line_no}}}}}}"</pre></div></div></div><h5><a id="pre-registered-templates"></a>Pre-registered template<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/search-template.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>You can register search templates by storing it in the <code class="literal">config/scripts</code> directory, in a file using the <code class="literal">.mustache</code> extension.
In order to execute the stored template, reference it by it’s name under the <code class="literal">template</code> key:</p><div class="pre_wrapper"><pre class="programlisting">GET /_search/template
{
    "template": {
        "file": "storedTemplate" <a id="CO13-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
    },
    "params": {
        "query_string": "search for these words"
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO13-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Name of the the query template in <code class="literal">config/scripts/</code>, i.e., <code class="literal">storedTemplate.mustache</code>.
</p></td></tr></tbody></table></div><p>You can also register search templates by storing it in the elasticsearch cluster in a special index named <code class="literal">.scripts</code>.
There are REST APIs to manage these indexed templates.</p><div class="pre_wrapper"><pre class="programlisting">POST /_search/template/&lt;templatename&gt;
{
    "template": {
        "query": {
            "match": {
                "title": "{{query_string}}"
            }
        }
    }
}</pre></div><p>This template can be retrieved by</p><div class="pre_wrapper"><pre class="programlisting">GET /_search/template/&lt;templatename&gt;</pre></div><p>which is rendered as:</p><div class="pre_wrapper"><pre class="programlisting">{
    "template": {
        "query": {
            "match": {
                "title": "{{query_string}}"
            }
        }
    }
}</pre></div><p>This template can be deleted by</p><div class="pre_wrapper"><pre class="programlisting">DELETE /_search/template/&lt;templatename&gt;</pre></div><p>To use an indexed template at search time use:</p><div class="pre_wrapper"><pre class="programlisting">GET /_search/template
{
    "template": {
        "id": "templateName" <a id="CO14-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
    },
    "params": {
        "query_string": "search for these words"
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO14-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Name of the the query template stored in the <code class="literal">.scripts</code> index.
</p></td></tr></tbody></table></div></div><div class="navfooter"><span class="prev"><a href="search-request-inner-hits.html">
              «&nbsp;
              Inner hits</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-shards.html">Search Shards API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-node">Search Shards API</span></div><div class="navheader"><span class="prev"><a href="search-template.html">
              «&nbsp;
              Search Template</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations.html">Aggregations
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-shards"></a>Search Shards API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/search-shards.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The search shards api returns the indices and shards that a search request would
be executed against. This can give useful feedback for working out issues or
planning optimizations with routing and shard preferences.</p><p>The <code class="literal">index</code> and <code class="literal">type</code> parameters may be single values, or comma-separated.</p><h3><a id="_usage"></a>Usage<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/search-shards.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Full example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/twitter/_search_shards'</pre></div><p>This will yield the following result:</p><div class="pre_wrapper"><pre class="programlisting">{
  "nodes": {
    "JklnKbD7Tyqi9TP3_Q_tBg": {
      "name": "Rl'nnd",
      "transport_address": "inet[/192.168.1.113:9300]"
    }
  },
  "shards": [
    [
      {
        "index": "twitter",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "relocating_node": null,
        "shard": 3,
        "state": "STARTED"
      }
    ],
    [
      {
        "index": "twitter",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "relocating_node": null,
        "shard": 4,
        "state": "STARTED"
      }
    ],
    [
      {
        "index": "twitter",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "relocating_node": null,
        "shard": 0,
        "state": "STARTED"
      }
    ],
    [
      {
        "index": "twitter",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "relocating_node": null,
        "shard": 2,
        "state": "STARTED"
      }
    ],
    [
      {
        "index": "twitter",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "relocating_node": null,
        "shard": 1,
        "state": "STARTED"
      }
    ]
  ]
}</pre></div><p>And specifying the same request, this time with a routing value:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/twitter/_search_shards?routing=foo,baz'</pre></div><p>This will yield the following result:</p><div class="pre_wrapper"><pre class="programlisting">{
  "nodes": {
    "JklnKbD7Tyqi9TP3_Q_tBg": {
      "name": "Rl'nnd",
      "transport_address": "inet[/192.168.1.113:9300]"
    }
  },
  "shards": [
    [
      {
        "index": "twitter",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "relocating_node": null,
        "shard": 2,
        "state": "STARTED"
      }
    ],
    [
      {
        "index": "twitter",
        "node": "JklnKbD7Tyqi9TP3_Q_tBg",
        "primary": true,
        "relocating_node": null,
        "shard": 4,
        "state": "STARTED"
      }
    ]
  ]
}</pre></div><p>This time the search will only be executed against two of the shards, because
routing values have been specified.</p><h3><a id="_all_parameters"></a>All parameters:<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/search-shards.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">routing</code>
</p>
</td><td class="entry" valign="top">
<p>
    A comma-separated list of routing values to take into account when
    determining which shards a request would be executed against.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">preference</code>
</p>
</td><td class="entry" valign="top">
<p>
    Controls a <code class="literal">preference</code> of which shard replicas to execute the search
    request on. By default, the operation is randomized between the shard
    replicas. See the <a class="ulink" href="search-request-preference.html" target="_top">preference</a>
    documentation for a list of all acceptable values.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">local</code>
</p>
</td><td class="entry" valign="top">
<p>
    A boolean value whether to read the cluster state locally in order to
    determine where shards are allocated instead of using the Master node’s
    cluster state.
</p>
</td></tr></tbody></table></div></div><div class="navfooter"><span class="prev"><a href="search-template.html">
              «&nbsp;
              Search Template</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations.html">Aggregations
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-node">Aggregations</span></div><div class="navheader"><span class="prev"><a href="search-shards.html">
              «&nbsp;
              Search Shards API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-min-aggregation.html">Min Aggregation
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations"></a>Aggregations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Aggregations grew out of the <a class="link" href="search-facets.html" title="Facets">facets</a> module and the long experience of how users use it
(and would like to use it) for real-time data analytics purposes. As such, it serves as the next generation
replacement for the functionality we currently refer to as "faceting".</p><p><a class="link" href="search-facets.html" title="Facets">Facets</a> provide a great way to aggregate data within a document set context.
This context is defined by the executed query in combination with the different levels of filters that can be defined
(filtered queries, top-level filters, and facet level filters). While powerful, their implementation is not designed
from the ground up to support complex aggregations and is thus limited.</p><p>The aggregations module breaks the barriers the current facet implementation put in place. The new name ("Aggregations")
also indicates the intention here - a generic yet extremely powerful framework for building aggregations - any types of
aggregations.</p><p>An aggregation can be seen as a <span class="emphasis"><em>unit-of-work</em></span> that builds analytic information over a set of documents. The context of
the execution defines what this document set is (e.g. a top-level aggregation executes within the context of the executed
query/filters of the search request).</p><p>There are many different types of aggregations, each with its own purpose and output. To better understand these types,
it is often easier to break them into two main families:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<span class="emphasis"><em>Bucketing</em></span>
</span></dt><dd>
                                A family of aggregations that build buckets, where each bucket is associated with a <span class="emphasis"><em>key</em></span> and a document
                                criterion. When the aggregation is executed, all the buckets criteria are evaluated on every document in
                                the context and when a criterion matches, the document is considered to "fall in" the relevant bucket.
                                By the end of the aggregation process, we’ll end up with a list of buckets - each one with a set of
                                documents that "belong" to it.
</dd><dt><span class="term">
<span class="emphasis"><em>Metric</em></span>
</span></dt><dd>
                                Aggregations that keep track and compute metrics over a set of documents.
</dd></dl></div><p>The interesting part comes next. Since each bucket effectively defines a document set (all documents belonging to
the bucket), one can potentially associate aggregations on the bucket level, and those will execute within the context
of that bucket. This is where the real power of aggregations kicks in: <span class="strong emphasis"><strong>aggregations can be nested!</strong></span></p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Bucketing aggregations can have sub-aggregations (bucketing or metric). The sub-aggregations will be computed for
                the buckets which their parent aggregation generates. There is no hard limit on the level/depth of nested
                aggregations (one can nest an aggregation under a "parent" aggregation, which is itself a sub-aggregation of
                another higher-level aggregation).</p></div></div><h3><a id="_structuring_aggregations"></a>Structuring Aggregations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The following snippet captures the basic structure of aggregations:</p><div class="pre_wrapper"><pre class="programlisting">"aggregations" : {
    "&lt;aggregation_name&gt;" : {
        "&lt;aggregation_type&gt;" : {
            &lt;aggregation_body&gt;
        }
        [,"aggregations" : { [&lt;sub_aggregation&gt;]+ } ]?
    }
    [,"&lt;aggregation_name_2&gt;" : { ... } ]*
}</pre></div><p>The <code class="literal">aggregations</code> object (the key <code class="literal">aggs</code> can also be used) in the JSON holds the aggregations to be computed. Each aggregation
is associated with a logical name that the user defines (e.g. if the aggregation computes the average price, then it would
make sense to name it <code class="literal">avg_price</code>). These logical names will also be used to uniquely identify the aggregations in the
response. Each aggregation has a specific type (<code class="literal">&lt;aggregation_type&gt;</code> in the above snippet) and is typically the first
key within the named aggregation body. Each type of aggregation defines its own body, depending on the nature of the
aggregation (e.g. an <code class="literal">avg</code> aggregation on a specific field will define the field on which the average will be calculated).
At the same level of the aggregation type definition, one can optionally define a set of additional aggregations,
though this only makes sense if the aggregation you defined is of a bucketing nature. In this scenario, the
sub-aggregations you define on the bucketing aggregation level will be computed for all the buckets built by the
bucketing aggregation. For example, if you define a set of aggregations under the <code class="literal">range</code> aggregation, the
sub-aggregations will be computed for the range buckets that are defined.</p><h4><a id="_values_source"></a>Values Source<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Some aggregations work on values extracted from the aggregated documents. Typically, the values will be extracted from
a specific document field which is set using the <code class="literal">field</code> key for the aggregations. It is also possible to define a
<a class="link" href="modules-scripting.html" title="Scripting"><code class="literal">script</code></a> which will generate the values (per document).</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p>The <code class="literal">script</code> parameter expects an inline script. Use <code class="literal">script_id</code> for indexed scripts and <code class="literal">script_file</code> for scripts in the <code class="literal">config/scripts/</code> directory.</p></div></div><p>When both <code class="literal">field</code> and <code class="literal">script</code> settings are configured for the aggregation, the script will be treated as a
<code class="literal">value script</code>.  While normal scripts are evaluated on a document level (i.e. the script has access to all the data
associated with the document), value scripts are evaluated on the <span class="strong emphasis"><strong>value</strong></span> level. In this mode, the values are extracted
from the configured <code class="literal">field</code> and the <code class="literal">script</code> is used to apply a "transformation" over these value/s.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><a id="aggs-script-note"></a><p>When working with scripts, the <code class="literal">lang</code> and <code class="literal">params</code> settings can also be defined. The former defines the scripting
language which is used (assuming the proper language is available in Elasticsearch, either by default or as a plugin). The latter
enables defining all the "dynamic" expressions in the script as parameters, which enables the script to keep itself static
between calls (this will ensure the use of the cached compiled scripts in Elasticsearch).</p></div></div><p>Scripts can generate a single value or multiple values per document. When generating multiple values, one can use the
<code class="literal">script_values_sorted</code> settings to indicate whether these values are sorted or not. Internally, Elasticsearch can
perform optimizations when dealing with sorted values (for example, with the <code class="literal">min</code> aggregations, knowing the values are
sorted, Elasticsearch will skip the iterations over all the values and rely on the first value in the list to be the
minimum value among all other values associated with the same document).</p><h3><a id="_metrics_aggregations"></a>Metrics Aggregations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The aggregations in this family compute metrics based on values extracted in one way or another from the documents that
are being aggregated. The values are typically extracted from the fields of the document (using the field data), but
can also be generated using scripts.</p><p>Numeric metrics aggregations are a special type of metrics aggregation which output numeric values. Some aggregations output
a single numeric metric (e.g. <code class="literal">avg</code>) and are called <code class="literal">single-value numeric metrics aggregation</code>, others generate multiple
metrics (e.g. <code class="literal">stats</code>) and are called <code class="literal">multi-value numeric metrics aggregation</code>. The distinction between single-value and
multi-value numeric metrics aggregations plays a role when these aggregations serve as direct sub-aggregations of some
bucket aggregations (some bucket aggregations enable you to sort the returned buckets based on the numeric metrics in each bucket).</p><h3><a id="_bucket_aggregations"></a>Bucket Aggregations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Bucket aggregations don’t calculate metrics over fields like the metrics aggregations do, but instead, they create
buckets of documents. Each bucket is associated with a criterion (depending on the aggregation type) which determines
whether or not a document in the current context "falls" into it. In other words, the buckets effectively define document
sets. In addition to the buckets themselves, the <code class="literal">bucket</code> aggregations also compute and return the number of documents
that "fell in" to each bucket.</p><p>Bucket aggregations, as opposed to <code class="literal">metrics</code> aggregations, can hold sub-aggregations. These sub-aggregations will be
aggregated for the buckets created by their "parent" bucket aggregation.</p><p>There are different bucket aggregators, each with a different "bucketing" strategy. Some define a single bucket, some
define fixed number of multiple buckets, and others dynamically create the buckets during the aggregation process.</p><h3><a id="_caching_heavy_aggregations"></a>Caching heavy aggregations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Frequently used aggregations (e.g. for display on the home page of a website)
can be cached for faster responses. These cached results are the same results
that would be returned by an uncached aggregation — you will never get stale
results.</p><p>See <a class="xref" href="index-modules-shard-query-cache.html" title="Shard query cache"><em>Shard query cache</em></a> for more details.</p><h3><a id="_returning_only_aggregation_results"></a>Returning only aggregation results<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>There are many occasions when aggregations are required but search hits are not.  For these cases the hits can be ignored by
adding <code class="literal">search_type=count</code> to the request URL parameters. For example:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/twitter/tweet/_search?search_type=count' -d '{
  "aggregations": {
    "my_agg": {
      "terms": {
        "field": "text"
      }
    }
  }
}
'</pre></div><p>Setting <code class="literal">search_type</code> to <code class="literal">count</code> avoids executing the fetch phase of the search making the request more efficient.  See
<a class="xref" href="search-request-search-type.html" title="Search Type">Search Type</a> for more information on the <code class="literal">search_type</code> parameter.</p></div><div class="navfooter"><span class="prev"><a href="search-shards.html">
              «&nbsp;
              Search Shards API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-min-aggregation.html">Min Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Min Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations.html">
              «&nbsp;
              Aggregations</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-max-aggregation.html">Max Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-min-aggregation"></a>Min Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/min-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A <code class="literal">single-value</code> metrics aggregation that keeps track and returns the minimum value among numeric values extracted from the aggregated documents. These values can be extracted either from specific numeric fields in the documents, or be generated by a provided script.</p><p>Computing the min price value across all documents:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "min_price" : { "min" : { "field" : "price" } }
    }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations": {
        "min_price": {
            "value": 10
        }
    }
}</pre></div><p>As can be seen, the name of the aggregation (<code class="literal">min_price</code> above) also serves as the key by which the aggregation result can be retrieved from the returned response.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script"></a>Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/min-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Computing the min price value across all document, this time using a script:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "min_price" : { "min" : { "script" : "doc['price'].value" } }
    }
}</pre></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p>The <code class="literal">script</code> parameter expects an inline script. Use <code class="literal">script_id</code> for indexed scripts and <code class="literal">script_file</code> for scripts in the <code class="literal">config/scripts/</code> directory.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_value_script"></a>Value Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/min-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Let’s say that the prices of the documents in our index are in USD, but we would like to compute the min in EURO (and for the sake of this example, lets say the conversion rate is 1.2). We can use a value script to apply the conversion rate to every value before it is aggregated:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "min_price_in_euros" : {
            "min" : {
                "field" : "price",
                "script" : "_value * conversion_rate",
                "params" : {
                    "conversion_rate" : 1.2
                }
            }
        }
    }
}</pre></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations.html">
              «&nbsp;
              Aggregations</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-max-aggregation.html">Max Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Max Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-metrics-min-aggregation.html">
              «&nbsp;
              Min Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-sum-aggregation.html">Sum Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-max-aggregation"></a>Max Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/max-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A <code class="literal">single-value</code> metrics aggregation that keeps track and returns the maximum value among the numeric values extracted from the aggregated documents. These values can be extracted either from specific numeric fields in the documents, or be generated by a provided script.</p><p>Computing the max price value across all documents</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "max_price" : { "max" : { "field" : "price" } }
    }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations": {
        "max_price": {
            "value": 35
        }
    }
}</pre></div><p>As can be seen, the name of the aggregation (<code class="literal">max_price</code> above) also serves as the key by which the aggregation result can be retrieved from the returned response.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_2"></a>Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/max-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Computing the max price value across all document, this time using a script:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "max_price" : { "max" : { "script" : "doc['price'].value" } }
    }
}</pre></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p>The <code class="literal">script</code> parameter expects an inline script. Use <code class="literal">script_id</code> for indexed scripts and <code class="literal">script_file</code> for scripts in the <code class="literal">config/scripts/</code> directory.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_value_script_2"></a>Value Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/max-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Let’s say that the prices of the documents in our index are in USD, but we would like to compute the max in EURO (and for the sake of this example, lets say the conversion rate is 1.2). We can use a value script to apply the conversion rate to every value before it is aggregated:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "max_price_in_euros" : {
            "max" : {
                "field" : "price",
                "script" : "_value * conversion_rate",
                "params" : {
                    "conversion_rate" : 1.2
                }
            }
        }
    }
}</pre></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-metrics-min-aggregation.html">
              «&nbsp;
              Min Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-sum-aggregation.html">Sum Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Sum Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-metrics-max-aggregation.html">
              «&nbsp;
              Max Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-avg-aggregation.html">Avg Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-sum-aggregation"></a>Sum Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/sum-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A <code class="literal">single-value</code> metrics aggregation that sums up numeric values that are extracted from the aggregated documents. These values can be extracted either from specific numeric fields in the documents, or be generated by a provided script.</p><p>Assuming the data consists of documents representing stock ticks, where each tick holds the change in the stock price from the previous tick.</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "filtered" : {
            "query" : { "match_all" : {}},
            "filter" : {
                "range" : { "timestamp" : { "from" : "now/1d+9.5h", "to" : "now/1d+16h" }}
            }
        }
    },
    "aggs" : {
        "intraday_return" : { "sum" : { "field" : "change" } }
    }
}</pre></div><p>The above aggregation sums up all changes in the today’s trading stock ticks which accounts for the intraday return. The aggregation type is <code class="literal">sum</code> and the <code class="literal">field</code> setting defines the numeric field of the documents of which values will be summed up. The above will return the following:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations": {
        "intraday_return": {
           "value": 2.18
        }
    }
}</pre></div><p>The name of the aggregation (<code class="literal">intraday_return</code> above) also serves as the key by which the aggregation result can be retrieved from the returned response.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_3"></a>Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/sum-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Computing the intraday return based on a script:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...,

    "aggs" : {
        "intraday_return" : { "sum" : { "script" : "doc['change'].value" } }
    }
}</pre></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p>The <code class="literal">script</code> parameter expects an inline script. Use <code class="literal">script_id</code> for indexed scripts and <code class="literal">script_file</code> for scripts in the <code class="literal">config/scripts/</code> directory.</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_value_script_3"></a>Value Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/sum-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Computing the sum of squares over all stock tick changes:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        ...

        "aggs" : {
            "daytime_return" : {
                "sum" : {
                    "field" : "change",
                    "script" : "_value * _value" }
            }
        }
    }
}</pre></div></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-metrics-max-aggregation.html">
              «&nbsp;
              Max Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-avg-aggregation.html">Avg Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Avg Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-metrics-sum-aggregation.html">
              «&nbsp;
              Sum Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-stats-aggregation.html">Stats Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-avg-aggregation"></a>Avg Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/avg-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A <code class="literal">single-value</code> metrics aggregation that computes the average of numeric values that are extracted from the aggregated documents. These values can be extracted either from specific numeric fields in the documents, or be generated by a provided script.</p><p>Assuming the data consists of documents representing exams grades (between 0 and 100) of students</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "avg_grade" : { "avg" : { "field" : "grade" } }
    }
}</pre></div><p>The above aggregation computes the average grade over all documents. The aggregation type is <code class="literal">avg</code> and the <code class="literal">field</code> setting defines the numeric field of the documents the average will be computed on. The above will return the following:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations": {
        "avg_grade": {
            "value": 75
        }
    }
}</pre></div><p>The name of the aggregation (<code class="literal">avg_grade</code> above) also serves as the key by which the aggregation result can be retrieved from the returned response.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_4"></a>Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/avg-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Computing the average grade based on a script:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...,

    "aggs" : {
        "avg_grade" : { "avg" : { "script" : "doc['grade'].value" } }
    }
}</pre></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p>The <code class="literal">script</code> parameter expects an inline script. Use <code class="literal">script_id</code> for indexed scripts and <code class="literal">script_file</code> for scripts in the <code class="literal">config/scripts/</code> directory.</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_value_script_4"></a>Value Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/avg-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>It turned out that the exam was way above the level of the students and a grade correction needs to be applied. We can use value script to get the new average:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        ...

        "aggs" : {
            "avg_corrected_grade" : {
                "avg" : {
                    "field" : "grade",
                    "script" : "_value * correction",
                    "params" : {
                        "correction" : 1.2
                    }
                }
            }
        }
    }
}</pre></div></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-metrics-sum-aggregation.html">
              «&nbsp;
              Sum Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-stats-aggregation.html">Stats Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Stats Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-metrics-avg-aggregation.html">
              «&nbsp;
              Avg Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-extendedstats-aggregation.html">Extended Stats Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-stats-aggregation"></a>Stats Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/stats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A <code class="literal">multi-value</code> metrics aggregation that computes stats over numeric values extracted from the aggregated documents. These values can be extracted either from specific numeric fields in the documents, or be generated by a provided script.</p><p>The stats that are returned consist of: <code class="literal">min</code>, <code class="literal">max</code>, <code class="literal">sum</code>, <code class="literal">count</code> and <code class="literal">avg</code>.</p><p>Assuming the data consists of documents representing exams grades (between 0 and 100) of students</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "grades_stats" : { "stats" : { "field" : "grade" } }
    }
}</pre></div><p>The above aggregation computes the grades statistics over all documents. The aggregation type is <code class="literal">stats</code> and the <code class="literal">field</code> setting defines the numeric field of the documents the stats will be computed on. The above will return the following:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations": {
        "grades_stats": {
            "count": 6,
            "min": 60,
            "max": 98,
            "avg": 78.5,
            "sum": 471
        }
    }
}</pre></div><p>The name of the aggregation (<code class="literal">grades_stats</code> above) also serves as the key by which the aggregation result can be retrieved from the returned response.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_5"></a>Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/stats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Computing the grades stats based on a script:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...,

    "aggs" : {
        "grades_stats" : { "stats" : { "script" : "doc['grade'].value" } }
    }
}</pre></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p>The <code class="literal">script</code> parameter expects an inline script. Use <code class="literal">script_id</code> for indexed scripts and <code class="literal">script_file</code> for scripts in the <code class="literal">config/scripts/</code> directory.</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_value_script_5"></a>Value Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/stats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>It turned out that the exam was way above the level of the students and a grade correction needs to be applied. We can use a value script to get the new stats:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        ...

        "aggs" : {
            "grades_stats" : {
                "stats" : {
                    "field" : "grade",
                    "script" : "_value * correction",
                    "params" : {
                        "correction" : 1.2
                    }
                }
            }
        }
    }
}</pre></div></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-metrics-avg-aggregation.html">
              «&nbsp;
              Avg Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-extendedstats-aggregation.html">Extended Stats Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Extended Stats Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-metrics-stats-aggregation.html">
              «&nbsp;
              Stats Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-valuecount-aggregation.html">Value Count Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-extendedstats-aggregation"></a>Extended Stats Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/extendedstats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A <code class="literal">multi-value</code> metrics aggregation that computes stats over numeric values extracted from the aggregated documents. These values can be extracted either from specific numeric fields in the documents, or be generated by a provided script.</p><p>The <code class="literal">extended_stats</code> aggregations is an extended version of the <a class="link" href="search-aggregations-metrics-stats-aggregation.html" title="Stats Aggregation"><code class="literal">stats</code></a> aggregation, where additional metrics are added such as <code class="literal">sum_of_squares</code>, <code class="literal">variance</code>, <code class="literal">std_deviation</code> and <code class="literal">std_deviation_bounds</code>.</p><p>Assuming the data consists of documents representing exams grades (between 0 and 100) of students</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "grades_stats" : { "extended_stats" : { "field" : "grade" } }
    }
}</pre></div><p>The above aggregation computes the grades statistics over all documents. The aggregation type is <code class="literal">extended_stats</code> and the <code class="literal">field</code> setting defines the numeric field of the documents the stats will be computed on. The above will return the following:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations": {
        "grade_stats": {
           "count": 9,
           "min": 72,
           "max": 99,
           "avg": 86,
           "sum": 774,
           "sum_of_squares": 67028,
           "variance": 51.55555555555556,
           "std_deviation": 7.180219742846005,
           "std_deviation_bounds": {
            "upper": 100.36043948569201,
            "lower": 71.63956051430799
           }
        }
    }
}</pre></div><p>The name of the aggregation (<code class="literal">grades_stats</code> above) also serves as the key by which the aggregation result can be retrieved from the returned response.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_standard_deviation_bounds"></a>Standard Deviation Bounds<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/extendedstats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>By default, the <code class="literal">extended_stats</code> metric will return an object called <code class="literal">std_deviation_bounds</code>, which provides an interval of plus/minus two standard
deviations from the mean.  This can be a useful way to visualize variance of your data.  If you want a different boundary, for example
three standard deviations, you can set <code class="literal">sigma</code> in the request:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "grades_stats" : {
            "extended_stats" : {
                "field" : "grade",
                "sigma" : 3 <a id="CO15-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO15-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
<code class="literal">sigma</code> controls how many standard deviations +/- from the mean should be displayed
</p></td></tr></tbody></table></div><p><code class="literal">sigma</code> can be any non-negative double, meaning you can request non-integer values such as <code class="literal">1.5</code>.  A value of <code class="literal">0</code> is valid, but will simply
return the average for both <code class="literal">upper</code> and <code class="literal">lower</code> bounds.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><h3>Standard Deviation and Bounds require normality</h3><p>The standard deviation and its bounds are displayed by default, but they are not always applicable to all data-sets.  Your data must
be normally distributed for the metrics to make sense.  The statistics behind standard deviations assumes normally distributed data, so
if your data is skewed heavily left or right, the value returned will be misleading.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_6"></a>Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/extendedstats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Computing the grades stats based on a script:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...,

    "aggs" : {
        "grades_stats" : { "extended_stats" : { "script" : "doc['grade'].value" } }
    }
}</pre></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p>The <code class="literal">script</code> parameter expects an inline script. Use <code class="literal">script_id</code> for indexed scripts and <code class="literal">script_file</code> for scripts in the <code class="literal">config/scripts/</code> directory.</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_value_script_6"></a>Value Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/extendedstats-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>It turned out that the exam was way above the level of the students and a grade correction needs to be applied. We can use value script to get the new stats:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        ...

        "aggs" : {
            "grades_stats" : {
                "extended_stats" : {
                    "field" : "grade",
                    "script" : "_value * correction",
                    "params" : {
                        "correction" : 1.2
                    }
                }
            }
        }
    }
}</pre></div></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-metrics-stats-aggregation.html">
              «&nbsp;
              Stats Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-valuecount-aggregation.html">Value Count Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Value Count Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-metrics-extendedstats-aggregation.html">
              «&nbsp;
              Extended Stats Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-percentile-aggregation.html">Percentiles Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-valuecount-aggregation"></a>Value Count Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/valuecount-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A <code class="literal">single-value</code> metrics aggregation that counts the number of values that are extracted from the aggregated documents.
These values can be extracted either from specific fields in the documents, or be generated by a provided script. Typically,
this aggregator will be used in conjunction with other single-value aggregations. For example, when computing the <code class="literal">avg</code>
one might be interested in the number of values the average is computed over.</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "grades_count" : { "value_count" : { "field" : "grade" } }
    }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations": {
        "grades_count": {
            "value": 10
        }
    }
}</pre></div><p>The name of the aggregation (<code class="literal">grades_count</code> above) also serves as the key by which the aggregation result can be
retrieved from the returned response.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_7"></a>Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/valuecount-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Counting the values generated by a script:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...,

    "aggs" : {
        "grades_count" : { "value_count" : { "script" : "doc['grade'].value" } }
    }
}</pre></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p>The <code class="literal">script</code> parameter expects an inline script. Use <code class="literal">script_id</code> for indexed scripts and <code class="literal">script_file</code> for scripts in the <code class="literal">config/scripts/</code> directory.</p></div></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-metrics-extendedstats-aggregation.html">
              «&nbsp;
              Extended Stats Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-percentile-aggregation.html">Percentiles Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Percentiles Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-metrics-valuecount-aggregation.html">
              «&nbsp;
              Value Count Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-percentile-rank-aggregation.html">Percentile Ranks Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-percentile-aggregation"></a>Percentiles Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/percentile-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A <code class="literal">multi-value</code> metrics aggregation that calculates one or more percentiles
over numeric values extracted from the aggregated documents.  These values
can be extracted either from specific numeric fields in the documents, or
be generated by a provided script.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p></div></div><p>Percentiles show the point at which a certain percentage of observed values
occur.  For example, the 95th percentile is the value which is greater than 95%
of the observed values.</p><p>Percentiles are often used to find outliers.  In normal distributions, the
0.13th and 99.87th percentiles represents three standard deviations from the
mean.  Any data which falls outside three standard deviations is often considered
an anomaly.</p><p>When a range of percentiles are retrieved, they can be used to estimate the
data distribution and determine if the data is skewed, bimodal, etc.</p><p>Assume your data consists of website load times.  The average and median
load times are not overly useful to an administrator.  The max may be interesting,
but it can be easily skewed by a single slow response.</p><p>Let’s look at a range of percentiles representing load time:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "load_time_outlier" : {
            "percentiles" : {
                "field" : "load_time" <a id="CO16-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO16-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The field <code class="literal">load_time</code> must be a numeric field
</p></td></tr></tbody></table></div><p>By default, the <code class="literal">percentile</code> metric will generate a range of
percentiles: <code class="literal">[ 1, 5, 25, 50, 75, 95, 99 ]</code>.  The response will look like this:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

   "aggregations": {
      "load_time_outlier": {
         "values" : {
            "1.0": 15,
            "5.0": 20,
            "25.0": 23,
            "50.0": 25,
            "75.0": 29,
            "95.0": 60,
            "99.0": 150
         }
      }
   }
}</pre></div><p>As you can see, the aggregation will return a calculated value for each percentile
in the default range.  If we assume response times are in milliseconds, it is
immediately obvious that the webpage normally loads in 15-30ms, but occasionally
spikes to 60-150ms.</p><p>Often, administrators are only interested in outliers — the extreme percentiles.
We can specify just the percents we are interested in (requested percentiles
must be a value between 0-100 inclusive):</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "load_time_outlier" : {
            "percentiles" : {
                "field" : "load_time",
                "percents" : [95, 99, 99.9] <a id="CO17-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO17-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Use the <code class="literal">percents</code> parameter to specify particular percentiles to calculate
</p></td></tr></tbody></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_8"></a>Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/percentile-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The percentile metric supports scripting.  For example, if our load times
are in milliseconds but we want percentiles calculated in seconds, we could use
a script to convert them on-the-fly:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "load_time_outlier" : {
            "percentiles" : {
                "script" : "doc['load_time'].value / timeUnit", <a id="CO18-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
                "params" : {
                    "timeUnit" : 1000   <a id="CO18-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
                }
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO18-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">field</code> parameter is replaced with a <code class="literal">script</code> parameter, which uses the
script to generate values which percentiles are calculated on
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO18-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Scripting supports parameterized input just like any other script
</p></td></tr></tbody></table></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p>The <code class="literal">script</code> parameter expects an inline script. Use <code class="literal">script_id</code> for indexed scripts and <code class="literal">script_file</code> for scripts in the <code class="literal">config/scripts/</code> directory.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="search-aggregations-metrics-percentile-aggregation-approximation"></a>Percentiles are (usually) approximate<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/percentile-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>There are many different algorithms to calculate percentiles.  The naive
implementation simply stores all the values in a sorted array.  To find the 50th
percentile, you simply find the value that is at <code class="literal">my_array[count(my_array) * 0.5]</code>.</p><p>Clearly, the naive implementation does not scale — the sorted array grows
linearly with the number of values in your dataset.  To calculate percentiles
across potentially billions of values in an Elasticsearch cluster, <span class="emphasis"><em>approximate</em></span>
percentiles are calculated.</p><p>The algorithm used by the <code class="literal">percentile</code> metric is called TDigest (introduced by
Ted Dunning in
<a class="ulink" href="https://github.com/tdunning/t-digest/blob/master/docs/t-digest-paper/histo.pdf" target="_top">Computing Accurate Quantiles using T-Digests</a>).</p><p>When using this metric, there are a few guidelines to keep in mind:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Accuracy is proportional to <code class="literal">q(1-q)</code>.  This means that extreme percentiles (e.g. 99%)
are more accurate than less extreme percentiles, such as the median
</li><li class="listitem">
For small sets of values, percentiles are highly accurate (and potentially
100% accurate if the data is small enough).
</li><li class="listitem">
As the quantity of values in a bucket grows, the algorithm begins to approximate
the percentiles.  It is effectively trading accuracy for memory savings.  The
exact level of inaccuracy is difficult to generalize, since it depends on your
data distribution and volume of data being aggregated
</li></ul></div><p>The following chart shows the relative error on a uniform distribution depending
on the number of collected values and the requested percentile:</p><p><span class="inlinemediaobject"><img src="images/percentiles_error.png" alt="images/percentiles_error.png"></span></p><p>It shows how precision is better for extreme percentiles. The reason why error diminishes
for large number of values is that the law of large numbers makes the distribution of
values more and more uniform and the t-digest tree can do a better job at summarizing
it. It would not be the case on more skewed distributions.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="search-aggregations-metrics-percentile-aggregation-compression"></a>Compression<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/percentile-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Approximate algorithms must balance memory utilization with estimation accuracy.
This balance can be controlled using a <code class="literal">compression</code> parameter:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "load_time_outlier" : {
            "percentiles" : {
                "field" : "load_time",
                "compression" : 200 <a id="CO19-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO19-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Compression controls memory usage and approximation error
</p></td></tr></tbody></table></div><p>The TDigest algorithm uses a number of "nodes" to approximate percentiles — the
more nodes available, the higher the accuracy (and large memory footprint) proportional
to the volume of data.  The <code class="literal">compression</code> parameter limits the maximum number of
nodes to <code class="literal">20 * compression</code>.</p><p>Therefore, by increasing the compression value, you can increase the accuracy of
your percentiles at the cost of more memory.  Larger compression values also
make the algorithm slower since the underlying tree data structure grows in size,
resulting in more expensive operations.  The default compression value is
<code class="literal">100</code>.</p><p>A "node" uses roughly 32 bytes of memory, so under worst-case scenarios (large amount
of data which arrives sorted and in-order) the default settings will produce a
TDigest roughly 64KB in size.  In practice data tends to be more random and
the TDigest will use less memory.</p></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-metrics-valuecount-aggregation.html">
              «&nbsp;
              Value Count Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-percentile-rank-aggregation.html">Percentile Ranks Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Percentile Ranks Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-metrics-percentile-aggregation.html">
              «&nbsp;
              Percentiles Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-cardinality-aggregation.html">Cardinality Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-percentile-rank-aggregation"></a>Percentile Ranks Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/percentile-rank-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A <code class="literal">multi-value</code> metrics aggregation that calculates one or more percentile ranks
over numeric values extracted from the aggregated documents.  These values
can be extracted either from specific numeric fields in the documents, or
be generated by a provided script.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Please see <a class="xref" href="search-aggregations-metrics-percentile-aggregation.html#search-aggregations-metrics-percentile-aggregation-approximation" title="Percentiles are (usually) approximate">Percentiles are (usually) approximate</a>
and <a class="xref" href="search-aggregations-metrics-percentile-aggregation.html#search-aggregations-metrics-percentile-aggregation-compression" title="Compression">Compression</a> for advice
regarding approximation and memory use of the percentile ranks aggregation</p></div></div><p>Percentile rank show the percentage of observed values which are below certain
value.  For example, if a value is greater than or equal to 95% of the observed values
it is said to be at the 95th percentile rank.</p><p>Assume your data consists of website load times.  You may have a service agreement that
95% of page loads completely within 15ms and 99% of page loads complete within 30ms.</p><p>Let’s look at a range of percentiles representing load time:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "load_time_outlier" : {
            "percentile_ranks" : {
                "field" : "load_time", <a id="CO20-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
                "values" : [15, 30]
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO20-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The field <code class="literal">load_time</code> must be a numeric field
</p></td></tr></tbody></table></div><p>The response will look like this:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

   "aggregations": {
      "load_time_outlier": {
         "values" : {
            "15": 92,
            "30": 100
         }
      }
   }
}</pre></div><p>From this information you can determine you are hitting the 99% load time target but not quite
hitting the 95% load time target</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_9"></a>Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/percentile-rank-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The percentile rank metric supports scripting.  For example, if our load times
are in milliseconds but we want to specify values in seconds, we could use
a script to convert them on-the-fly:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "load_time_outlier" : {
            "percentile_ranks" : {
                "values" : [3, 5],
                "script" : "doc['load_time'].value / timeUnit", <a id="CO21-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
                "params" : {
                    "timeUnit" : 1000   <a id="CO21-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
                }
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO21-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">field</code> parameter is replaced with a <code class="literal">script</code> parameter, which uses the
script to generate values which percentile ranks are calculated on
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO21-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Scripting supports parameterized input just like any other script
</p></td></tr></tbody></table></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p>The <code class="literal">script</code> parameter expects an inline script. Use <code class="literal">script_id</code> for indexed scripts and <code class="literal">script_file</code> for scripts in the <code class="literal">config/scripts/</code> directory.</p></div></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-metrics-percentile-aggregation.html">
              «&nbsp;
              Percentiles Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-cardinality-aggregation.html">Cardinality Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Cardinality Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-metrics-percentile-rank-aggregation.html">
              «&nbsp;
              Percentile Ranks Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-geobounds-aggregation.html">Geo Bounds Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-cardinality-aggregation"></a>Cardinality Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/cardinality-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A <code class="literal">single-value</code> metrics aggregation that calculates an approximate count of
distinct values. Values can be extracted either from specific fields in the
document or generated by a script.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p></div></div><p>Assume you are indexing books and would like to count the unique authors that
match a query:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "author_count" : {
            "cardinality" : {
                "field" : "author"
            }
        }
    }
}</pre></div><p>This aggregation also supports the <code class="literal">precision_threshold</code> and <code class="literal">rehash</code> options:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "author_count" : {
            "cardinality" : {
                "field" : "author_hash",
                "precision_threshold": 100, <a id="CO22-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
                "rehash": false <a id="CO22-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO22-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">precision_threshold</code> options allows to trade memory for accuracy, and
defines a unique count below which counts are expected to be close to
accurate. Above this value, counts might become a bit more fuzzy. The maximum
supported value is 40000, thresholds above this number will have the same
effect as a threshold of 40000.
Default value depends on the number of parent aggregations that multiple
create buckets (such as terms or histograms).
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO22-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
If you computed a hash on client-side, stored it into your documents and want
Elasticsearch to use them to compute counts using this hash function without
rehashing values, it is possible to specify <code class="literal">rehash: false</code>. Default value is
<code class="literal">true</code>. Please note that the hash must be indexed as a long when <code class="literal">rehash</code> is
false.
</p></td></tr></tbody></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_counts_are_approximate"></a>Counts are approximate<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/cardinality-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Computing exact counts requires loading values into a hash set and returning its
size. This doesn’t scale when working on high-cardinality sets and/or large
values as the required memory usage and the need to communicate those
per-shard sets between nodes would utilize too many resources of the cluster.</p><p>This <code class="literal">cardinality</code> aggregation is based on the
<a class="ulink" href="http://static.googleusercontent.com/media/research.google.com/fr//pubs/archive/40671.pdf" target="_top">HyperLogLog++</a>
algorithm, which counts based on the hashes of the values with some interesting
properties:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
configurable precision, which decides on how to trade memory for accuracy,
</li><li class="listitem">
excellent accuracy on low-cardinality sets,
</li><li class="listitem">
fixed memory usage: no matter if there are tens or billions of unique values,
   memory usage only depends on the configured precision.
</li></ul></div><p>For a precision threshold of <code class="literal">c</code>, the implementation that we are using requires
about <code class="literal">c * 8</code> bytes.</p><p>The following chart shows how the error varies before and after the threshold:</p><p><span class="inlinemediaobject"><img src="images/cardinality_error.png" alt="images/cardinality_error.png"></span></p><p>For all 3 thresholds, counts have been accurate up to the configured threshold
(although not guaranteed, this is likely to be the case). Please also note that
even with a threshold as low as 100, the error remains under 5%, even when
counting millions of items.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_pre_computed_hashes"></a>Pre-computed hashes<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/cardinality-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>If you don’t want Elasticsearch to re-compute hashes on every run of this
aggregation, it is possible to use pre-computed hashes, either by computing a
hash on client-side, indexing it and specifying <code class="literal">rehash: false</code>, or by using
the special <code class="literal">murmur3</code> field mapper, typically in the context of a <code class="literal">multi-field</code>
in the mapping:</p><div class="pre_wrapper"><pre class="programlisting">{
    "author": {
        "type": "string",
        "fields": {
            "hash": {
                "type": "murmur3"
            }
        }
    }
}</pre></div><p>With such a mapping, Elasticsearch is going to compute hashes of the <code class="literal">author</code>
field at indexing time and store them in the <code class="literal">author.hash</code> field. This
way, unique counts can be computed using the cardinality aggregation by only
loading the hashes into memory, not the values of the <code class="literal">author</code> field, and
without computing hashes on the fly:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "author_count" : {
            "cardinality" : {
                "field" : "author.hash"
            }
        }
    }
}</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p><code class="literal">rehash</code> is automatically set to <code class="literal">false</code> when computing unique counts on
a <code class="literal">murmur3</code> field.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Pre-computing hashes is usually only useful on very large and/or
high-cardinality fields as it saves CPU and memory. However, on numeric
fields, hashing is very fast and storing the original values requires as much
or less memory than storing the hashes. This is also true on low-cardinality
string fields, especially given that those have an optimization in order to
make sure that hashes are computed at most once per unique value per segment.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_10"></a>Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/cardinality-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">cardinality</code> metric supports scripting, with a noticeable performance hit
however since hashes need to be computed on the fly.</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "author_count" : {
            "cardinality" : {
                "script": "doc['author.first_name'].value + ' ' + doc['author.last_name'].value"
            }
        }
    }
}</pre></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p>The <code class="literal">script</code> parameter expects an inline script. Use <code class="literal">script_id</code> for indexed scripts and <code class="literal">script_file</code> for scripts in the <code class="literal">config/scripts/</code> directory.</p></div></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-metrics-percentile-rank-aggregation.html">
              «&nbsp;
              Percentile Ranks Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-geobounds-aggregation.html">Geo Bounds Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Geo Bounds Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-metrics-cardinality-aggregation.html">
              «&nbsp;
              Cardinality Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-top-hits-aggregation.html">Top hits Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-geobounds-aggregation"></a>Geo Bounds Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/geobounds-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p></div></div><p>A metric aggregation that computes the bounding box containing all geo_point values for a field.</p><p>Example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match" : { "business_type" : "shop" }
    },
    "aggs" : {
        "viewport" : {
            "geo_bounds" : {
                "field" : "location", <a id="CO23-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
                "wrap_longitude" : true <a id="CO23-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO23-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">geo_bounds</code> aggregation specifies the field to use to obtain the bounds
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO23-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
<code class="literal">wrap_longitude</code> is an optional parameter which specifies whether the bounding box should be allowed to overlap the international date line. The default value is <code class="literal">true</code>
</p></td></tr></tbody></table></div><p>The above aggregation demonstrates how one would compute the bounding box of the location field for all documents with a business type of shop</p><p>The response for the above aggregation:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations": {
        "viewport": {
            "bounds": {
                "top_left": {
                    "lat": 80.45,
                    "lon": -160.22
                },
                "bottom_right": {
                    "lat": 40.65,
                    "lon": 42.57
                }
            }
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-metrics-cardinality-aggregation.html">
              «&nbsp;
              Cardinality Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-top-hits-aggregation.html">Top hits Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Top hits Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-metrics-geobounds-aggregation.html">
              «&nbsp;
              Geo Bounds Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-scripted-metric-aggregation.html">Scripted Metric Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-top-hits-aggregation"></a>Top hits Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/tophits-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A <code class="literal">top_hits</code> metric aggregator keeps track of the most relevant document being aggregated. This aggregator is intended
to be used as a sub aggregator, so that the top matching documents can be aggregated per bucket.</p><p>The <code class="literal">top_hits</code> aggregator can effectively be used to group result sets by certain fields via a bucket aggregator.
One or more bucket aggregators determines by which properties a result set get sliced into.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_options_2"></a>Options<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/tophits-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">from</code> - The offset from the first result you want to fetch.
</li><li class="listitem">
<code class="literal">size</code> - The maximum number of top matching hits to return per bucket. By default the top three matching hits are returned.
</li><li class="listitem">
<code class="literal">sort</code> - How the top matching hits should be sorted. By default the hits are sorted by the score of the main query.
</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_supported_per_hit_features"></a>Supported per hit features<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/tophits-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The top_hits aggregation returns regular search hits, because of this many per hit features can be supported:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="link" href="search-request-highlighting.html" title="Highlighting">Highlighting</a>
</li><li class="listitem">
<a class="link" href="search-request-explain.html" title="Explain">Explain</a>
</li><li class="listitem">
<a class="link" href="search-request-named-queries-and-filters.html" title="Named Queries and Filters">Named filters and queries</a>
</li><li class="listitem">
<a class="link" href="search-request-source-filtering.html" title="Source filtering">Source filtering</a>
</li><li class="listitem">
<a class="link" href="search-request-script-fields.html" title="Script Fields">Script fields</a>
</li><li class="listitem">
<a class="link" href="search-request-fielddata-fields.html" title="Field Data Fields">Fielddata fields</a>
</li><li class="listitem">
<a class="link" href="search-request-version.html" title="Version">Include versions</a>
</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_example"></a>Example<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/tophits-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>In the following example we group the questions by tag and per tag we show the last active question. For each question
only the title field is being included in the source.</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs": {
        "top-tags": {
            "terms": {
                "field": "tags",
                "size": 3
            },
            "aggs": {
                "top_tag_hits": {
                    "top_hits": {
                        "sort": [
                            {
                                "last_activity_date": {
                                    "order": "desc"
                                }
                            }
                        ],
                        "_source": {
                            "include": [
                                "title"
                            ]
                        },
                        "size" : 1
                    }
                }
            }
        }
    }
}</pre></div><p>Possible response snippet:</p><div class="pre_wrapper"><pre class="programlisting">"aggregations": {
  "top-tags": {
     "buckets": [
        {
           "key": "windows-7",
           "doc_count": 25365,
           "top_tags_hits": {
              "hits": {
                 "total": 25365,
                 "max_score": 1,
                 "hits": [
                    {
                       "_index": "stack",
                       "_type": "question",
                       "_id": "602679",
                       "_score": 1,
                       "_source": {
                          "title": "Windows port opening"
                       },
                       "sort": [
                          1370143231177
                       ]
                    }
                 ]
              }
           }
        },
        {
           "key": "linux",
           "doc_count": 18342,
           "top_tags_hits": {
              "hits": {
                 "total": 18342,
                 "max_score": 1,
                 "hits": [
                    {
                       "_index": "stack",
                       "_type": "question",
                       "_id": "602672",
                       "_score": 1,
                       "_source": {
                          "title": "Ubuntu RFID Screensaver lock-unlock"
                       },
                       "sort": [
                          1370143379747
                       ]
                    }
                 ]
              }
           }
        },
        {
           "key": "windows",
           "doc_count": 18119,
           "top_tags_hits": {
              "hits": {
                 "total": 18119,
                 "max_score": 1,
                 "hits": [
                    {
                       "_index": "stack",
                       "_type": "question",
                       "_id": "602678",
                       "_score": 1,
                       "_source": {
                          "title": "If I change my computers date / time, what could be affected?"
                       },
                       "sort": [
                          1370142868283
                       ]
                    }
                 ]
              }
           }
        }
     ]
  }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_field_collapse_example"></a>Field collapse example<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/tophits-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Field collapsing or result grouping is a feature that logically groups a result set into groups and per group returns
top documents. The ordering of the groups is determined by the relevancy of the first document in a group. In
Elasticsearch this can be implemented via a bucket aggregator that wraps a <code class="literal">top_hits</code> aggregator as sub-aggregator.</p><p>In the example below we search across crawled webpages. For each webpage we store the body and the domain the webpage
belong to. By defining a <code class="literal">terms</code> aggregator on the <code class="literal">domain</code> field we group the result set of webpages by domain. The
<code class="literal">top_docs</code> aggregator is then defined as sub-aggregator, so that the top matching hits are collected per bucket.</p><p>Also a <code class="literal">max</code> aggregator is defined which is used by the <code class="literal">terms</code> aggregator’s order feature the return the buckets by
relevancy order of the most relevant document in a bucket.</p><div class="pre_wrapper"><pre class="programlisting">{
  "query": {
    "match": {
      "body": "elections"
    }
  },
  "aggs": {
    "top-sites": {
      "terms": {
        "field": "domain",
        "order": {
          "top_hit": "desc"
        }
      },
      "aggs": {
        "top_tags_hits": {
          "top_hits": {}
        },
        "top_hit" : {
          "max": {
            "script": "_score"
          }
        }
      }
    }
  }
}</pre></div><p>At the moment the <code class="literal">max</code> (or <code class="literal">min</code>) aggregator is needed to make sure the buckets from the <code class="literal">terms</code> aggregator are
ordered according to the score of the most relevant webpage per domain. The <code class="literal">top_hits</code> aggregator isn’t a metric aggregator
and therefore can’t be used in the <code class="literal">order</code> option of the <code class="literal">terms</code> aggregator.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_top_hits_support_in_a_nested_or_reverse_nested_aggregator"></a>top_hits support in a nested or reverse_nested aggregator<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/tophits-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>If the <code class="literal">top_hits</code> aggregator is wrapped in a <code class="literal">nested</code> or <code class="literal">reverse_nested</code> aggregator then nested hits are being returned.
Nested hits are in a sense hidden mini documents that are part of regular document where in the mapping a nested field type
has been configured. The <code class="literal">top_hits</code> aggregator has the ability to un-hide these documents if it is wrapped in a <code class="literal">nested</code>
or <code class="literal">reverse_nested</code> aggregator. Read more about nested in the <a class="link" href="mapping-nested-type.html" title="Nested Type">nested type mapping</a>.</p><p>If nested type has been configured a single document is actually indexed as multiple Lucene documents and they share
the same id. In order to determine the identity of a nested hit there is more needed than just the id, so that is why
nested hits also include their nested identity. The nested identity is kept under the <code class="literal">_nested</code> field in the search hit
and includes the array field and the offset in the array field the nested hit belongs to. The offset is zero based.</p><p>Top hits response snippet with a nested hit, which resides in the third slot of array field <code class="literal">nested_field1</code> in document with id <code class="literal">1</code>:</p><div class="pre_wrapper"><pre class="programlisting">...
"hits": {
 "total": 25365,
 "max_score": 1,
 "hits": [
   {
     "_index": "a",
     "_type": "b",
     "_id": "1",
     "_score": 1,
     "_nested" : {
       "field" : "nested_field1",
       "offset" : 2
     }
     "_source": ...
   },
   ...
 ]
}
...</pre></div><p>If <code class="literal">_source</code> is requested then just the part of the source of the nested object is returned, not the entire source of the document.
Also stored fields on the <span class="strong emphasis"><strong>nested</strong></span> inner object level are accessible via <code class="literal">top_hits</code> aggregator residing in a <code class="literal">nested</code> or <code class="literal">reverse_nested</code> aggregator.</p><p>Only nested hits will have a <code class="literal">_nested</code> field in the hit, non nested (regular) hits will not have a <code class="literal">_nested</code> field.</p><p>The information in <code class="literal">_nested</code> can also be used to parse the original source somewhere else if <code class="literal">_source</code> isn’t enabled.</p><p>If there are multiple levels of nested object types defined in mappings then the <code class="literal">_nested</code> information can also be hierarchical
in order to express the identity of nested hits that are two layers deep or more.</p><p>In the example below a nested hit resides in the first slot of the field <code class="literal">nested_grand_child_field</code> which then resides in
the second slow of the <code class="literal">nested_child_field</code> field:</p><div class="pre_wrapper"><pre class="programlisting">...
"hits": {
 "total": 2565,
 "max_score": 1,
 "hits": [
   {
     "_index": "a",
     "_type": "b",
     "_id": "1",
     "_score": 1,
     "_nested" : {
       "field" : "nested_child_field",
       "offset" : 1,
       "_nested" : {
         "field" : "nested_grand_child_field",
         "offset" : 0
       }
     }
     "_source": ...
   },
   ...
 ]
}
...</pre></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-metrics-geobounds-aggregation.html">
              «&nbsp;
              Geo Bounds Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-metrics-scripted-metric-aggregation.html">Scripted Metric Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Scripted Metric Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-metrics-top-hits-aggregation.html">
              «&nbsp;
              Top hits Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-global-aggregation.html">Global Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-metrics-scripted-metric-aggregation"></a>Scripted Metric Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p></div></div><p>A metric aggregation that executes using scripts to provide a metric output.</p><p>Example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "aggs": {
        "profit": {
            "scripted_metric": {
                "init_script" : "_agg['transactions'] = []",
                "map_script" : "if (doc['type'].value == \"sale\") { _agg.transactions.add(doc['amount'].value) } else { _agg.transactions.add(-1 * doc['amount'].value) }", <a id="CO24-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
                "combine_script" : "profit = 0; for (t in _agg.transactions) { profit += t }; return profit",
                "reduce_script" : "profit = 0; for (a in _aggs) { profit += a }; return profit"
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO24-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
<code class="literal">map_script</code> is the only required  parameter
</p></td></tr></tbody></table></div><p>The above aggregation demonstrates how one would use the script aggregation compute the total profit from sale and cost transactions.</p><p>The response for the above aggregation:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations": {
        "profit": {
            "value": 170
        }
   }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_scope_of_scripts"></a>Scope of scripts<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The scripted metric aggregation uses scripts at 4 stages of its execution:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
init_script
</span></dt><dd><p class="simpara">
Executed prior to any collection of documents. Allows the aggregation to set up any initial state.
</p><p class="simpara">In the above example, the <code class="literal">init_script</code> creates an array <code class="literal">transactions</code> in the <code class="literal">_agg</code> object.</p></dd><dt><span class="term">
map_script
</span></dt><dd><p class="simpara">
Executed once per document collected. This is the only required script. If no combine_script is specified, the resulting state
                    needs to be stored in an object named <code class="literal">_agg</code>.
</p><p class="simpara">In the above example, the <code class="literal">map_script</code> checks the value of the type field. If the value is <span class="emphasis"><em>sale</em></span> the value of the amount field
is added to the transactions array. If the value of the type field is not <span class="emphasis"><em>sale</em></span> the negated value of the amount field is added
to transactions.</p></dd><dt><span class="term">
combine_script
</span></dt><dd><p class="simpara">
Executed once on each shard after document collection is complete. Allows the aggregation to consolidate the state returned from
                    each shard. If a combine_script is not provided the combine phase will return the aggregation variable.
</p><p class="simpara">In the above example, the <code class="literal">combine_script</code> iterates through all the stored transactions, summing the values in the <code class="literal">profit</code> variable
and finally returns <code class="literal">profit</code>.</p></dd><dt><span class="term">
reduce_script
</span></dt><dd><p class="simpara">
Executed once on the coordinating node after all shards have returned their results. The script is provided with access to a
                    variable <code class="literal">_aggs</code> which is an array of the result of the combine_script on each shard. If a reduce_script is not provided
                    the reduce phase will return the <code class="literal">_aggs</code> variable.
</p><p class="simpara">In the above example, the <code class="literal">reduce_script</code> iterates through the <code class="literal">profit</code> returned by each shard summing the values before returning the
final combined profit which will be returned in the response of the aggregation.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_worked_example"></a>Worked Example<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Imagine a situation where you index the following documents into and index with 2 shards:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPUT 'http://localhost:9200/transactions/stock/1' -d '
{
    "type": "sale",
    "amount": 80
}
'

$ curl -XPUT 'http://localhost:9200/transactions/stock/2' -d '
{
    "type": "cost",
    "amount": 10
}
'

$ curl -XPUT 'http://localhost:9200/transactions/stock/3' -d '
{
    "type": "cost",
    "amount": 30
}
'

$ curl -XPUT 'http://localhost:9200/transactions/stock/4' -d '
{
    "type": "sale",
    "amount": 130
}
'</pre></div><p>Lets say that documents 1 and 3 end up on shard A and documents 2 and 4 end up on shard B. The following is a breakdown of what the aggregation result is
at each stage of the example above.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_before_init_script"></a>Before init_script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>No params object was specified so the default params object is used:</p><div class="pre_wrapper"><pre class="programlisting">"params" : {
    "_agg" : {}
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_after_init_script"></a>After init_script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>This is run once on each shard before any document collection is performed, and so we will have a copy on each shard:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Shard A
</span></dt><dd><div class="pre_wrapper"><pre class="programlisting">"params" : {
    "_agg" : {
        "transactions" : []
    }
}</pre></div></dd><dt><span class="term">
Shard B
</span></dt><dd><div class="pre_wrapper"><pre class="programlisting">"params" : {
    "_agg" : {
        "transactions" : []
    }
}</pre></div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_after_map_script"></a>After map_script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Each shard collects its documents and runs the map_script on each document that is collected:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Shard A
</span></dt><dd><div class="pre_wrapper"><pre class="programlisting">"params" : {
    "_agg" : {
        "transactions" : [ 80, -30 ]
    }
}</pre></div></dd><dt><span class="term">
Shard B
</span></dt><dd><div class="pre_wrapper"><pre class="programlisting">"params" : {
    "_agg" : {
        "transactions" : [ -10, 130 ]
    }
}</pre></div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_after_combine_script"></a>After combine_script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The combine_script is executed on each shard after document collection is complete and reduces all the transactions down to a single profit figure for each
shard (by summing the values in the transactions array) which is passed back to the coordinating node:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Shard A
</span></dt><dd>
50
</dd><dt><span class="term">
Shard B
</span></dt><dd>
120
</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_after_reduce_script"></a>After reduce_script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The reduce_script receives an <code class="literal">_aggs</code> array containing the result of the combine script for each shard:</p><div class="pre_wrapper"><pre class="programlisting">"_aggs" : [
    50,
    120
]</pre></div><p>It reduces the responses for the shards down to a final overall profit figure (by summing the values) and returns this as the result of the aggregation to
produce the response:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations": {
        "profit": {
            "value": 170
        }
   }
}</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_other_parameters"></a>Other Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/metrics/scripted-metric-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
params
</p>
</td><td class="entry" valign="top">
<p>
Optional. An object whose contents will be passed as variables to the  <code class="literal">init_script</code>, <code class="literal">map_script</code> and <code class="literal">combine_script</code>. This can be
                   useful to allow the user to control the behavior of the aggregation and for storing state between the scripts. If this is not specified,
                   the default is the equivalent of providing:
</p>
<div class="pre_wrapper"><pre class="programlisting">"params" : {
    "_agg" : {}
}</pre></div>
</td></tr><tr><td class="entry" valign="top">
<p>
reduce_params
</p>
</td><td class="entry" valign="top">
<p>
Optional. An object whose contents will be passed as variables to the <code class="literal">reduce_script</code>. This can be useful to allow the user to control
                   the behavior of the reduce phase. If this is not specified the variable will be undefined in the reduce_script execution.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
lang
</p>
</td><td class="entry" valign="top">
<p>
Optional. The script language used for the scripts. If this is not specified the default scripting language is used.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
init_script_file
</p>
</td><td class="entry" valign="top">
<p>
Optional. Can be used in place of the <code class="literal">init_script</code> parameter to provide the script using in a file.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
init_script_id
</p>
</td><td class="entry" valign="top">
<p>
Optional. Can be used in place of the <code class="literal">init_script</code> parameter to provide the script using an indexed script.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
map_script_file
</p>
</td><td class="entry" valign="top">
<p>
Optional. Can be used in place of the <code class="literal">map_script</code> parameter to provide the script using in a file.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
map_script_id
</p>
</td><td class="entry" valign="top">
<p>
Optional. Can be used in place of the <code class="literal">map_script</code> parameter to provide the script using an indexed script.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
combine_script_file
</p>
</td><td class="entry" valign="top">
<p>
Optional. Can be used in place of the <code class="literal">combine_script</code> parameter to provide the script using in a file.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
combine_script_id
</p>
</td><td class="entry" valign="top">
<p>
Optional. Can be used in place of the <code class="literal">combine_script</code> parameter to provide the script using an indexed script.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
reduce_script_file
</p>
</td><td class="entry" valign="top">
<p>
Optional. Can be used in place of the <code class="literal">reduce_script</code> parameter to provide the script using in a file.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
reduce_script_id
</p>
</td><td class="entry" valign="top">
<p>
Optional. Can be used in place of the <code class="literal">reduce_script</code> parameter to provide the script using an indexed script.
</p>
</td></tr></tbody></table></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-metrics-top-hits-aggregation.html">
              «&nbsp;
              Top hits Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-global-aggregation.html">Global Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Global Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-metrics-scripted-metric-aggregation.html">
              «&nbsp;
              Scripted Metric Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-filter-aggregation.html">Filter Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-global-aggregation"></a>Global Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/global-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Defines a single bucket of all the documents within the search execution context. This context is defined by the indices and the document types you’re searching on, but is <span class="strong emphasis"><strong>not</strong></span> influenced by the search query itself.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Global aggregators can only be placed as top level aggregators (it makes no sense to embed a global aggregator
        within another bucket aggregator)</p></div></div><p>Example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match" : { "title" : "shirt" }
    },
    "aggs" : {
        "all_products" : {
            "global" : {}, <a id="CO25-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
            "aggs" : { <a id="CO25-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
                "avg_price" : { "avg" : { "field" : "price" } }
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">global</code> aggregation has an empty body
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO25-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The sub-aggregations that are registered for this <code class="literal">global</code> aggregation
</p></td></tr></tbody></table></div><p>The above aggregation demonstrates how one would compute aggregations (<code class="literal">avg_price</code> in this example) on all the documents in the search context, regardless of the query (in our example, it will compute the average price over all products in our catalog, not just on the "shirts").</p><p>The response for the above aggregation:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations" : {
        "all_products" : {
            "doc_count" : 100, <a id="CO26-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
            "avg_price" : {
                "value" : 56.3
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO26-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The number of documents that were aggregated (in our case, all documents within the search context)
</p></td></tr></tbody></table></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-metrics-scripted-metric-aggregation.html">
              «&nbsp;
              Scripted Metric Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-filter-aggregation.html">Filter Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Filter Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-bucket-global-aggregation.html">
              «&nbsp;
              Global Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-filters-aggregation.html">Filters Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-filter-aggregation"></a>Filter Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/filter-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Defines a single bucket of all the documents in the current document set context that match a specified filter. Often this will be used to narrow down the current aggregation context to a specific set of documents.</p><p>Example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "red_products" : {
            "filter" : { "term": { "color": "red" } },
            "aggs" : {
                "avg_price" : { "avg" : { "field" : "price" } }
            }
        }
    }
}</pre></div><p>In the above example, we calculate the average price of all the products that are red.</p><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggs" : {
        "red_products" : {
            "doc_count" : 100,
            "avg_price" : { "value" : 56.3 }
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-bucket-global-aggregation.html">
              «&nbsp;
              Global Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-filters-aggregation.html">Filters Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Filters Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-bucket-filter-aggregation.html">
              «&nbsp;
              Filter Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-missing-aggregation.html">Missing Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-filters-aggregation"></a>Filters Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/filters-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Defines a multi bucket aggregations where each bucket is associated with a
filter. Each bucket will collect all documents that match its associated
filter.</p><p>Example:</p><div class="pre_wrapper"><pre class="programlisting">{
  "aggs" : {
    "messages" : {
      "filters" : {
        "filters" : {
          "errors" :   { "term" : { "body" : "error"   }},
          "warnings" : { "term" : { "body" : "warning" }}
        }
      },
      "aggs" : {
        "monthly" : {
          "histogram" : {
            "field" : "timestamp",
            "interval" : "1M"
          }
        }
      }
    }
  }
}</pre></div><p>In the above example, we analyze log messages. The aggregation will build two
collection (buckets) of log messages - one for all those containing an error,
and another for all those containing a warning. And for each of these buckets
it will break them down by month.</p><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">...
  "aggs" : {
    "messages" : {
      "buckets" : {
        "errors" : {
          "doc_count" : 34,
            "monthly" : {
              "buckets" : [
                ... // the histogram monthly breakdown
              ]
            }
          },
          "warnings" : {
            "doc_count" : 439,
            "monthly" : {
              "buckets" : [
                 ... // the histogram monthly breakdown
              ]
            }
          }
        }
      }
    }
  }
...</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_anonymous_filters"></a>Anonymous filters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/filters-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The filters field can also be provided as an array of filters, as in the
following request:</p><div class="pre_wrapper"><pre class="programlisting">{
  "aggs" : {
    "messages" : {
      "filters" : {
        "filters" : [
          { "term" : { "body" : "error"   }},
          { "term" : { "body" : "warning" }}
        ]
      },
      "aggs" : {
        "monthly" : {
          "histogram" : {
            "field" : "timestamp",
            "interval" : "1M"
          }
        }
      }
    }
  }
}</pre></div><p>The filtered buckets are returned in the same order as provided in the
request.  The response for this example would be:</p><div class="pre_wrapper"><pre class="programlisting">...
  "aggs" : {
    "messages" : {
      "buckets" : [
        {
          "doc_count" : 34,
          "monthly" : {
            "buckets : [
              ... // the histogram monthly breakdown
            ]
          }
        },
        {
          "doc_count" : 439,
          "monthly" : {
            "buckets" : [
              ... // the histogram monthly breakdown
            ]
          }
        }
      ]
    }
  }
...</pre></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-bucket-filter-aggregation.html">
              «&nbsp;
              Filter Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-missing-aggregation.html">Missing Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Missing Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-bucket-filters-aggregation.html">
              «&nbsp;
              Filters Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-nested-aggregation.html">Nested Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-missing-aggregation"></a>Missing Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/missing-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A field data based single bucket aggregation, that creates a bucket of all documents in the current document set context that are missing a field value (effectively, missing a field or having the configured NULL value set). This aggregator will often be used in conjunction with other field data bucket aggregators (such as ranges) to return information for all the documents that could not be placed in any of the other buckets due to missing field data values.</p><p>Example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "products_without_a_price" : {
            "missing" : { "field" : "price" }
        }
    }
}</pre></div><p>In the above example, we get the total number of products that do not have a price.</p><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggs" : {
        "products_without_a_price" : {
            "doc_count" : 10
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-bucket-filters-aggregation.html">
              «&nbsp;
              Filters Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-nested-aggregation.html">Nested Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Nested Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-bucket-missing-aggregation.html">
              «&nbsp;
              Missing Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-reverse-nested-aggregation.html">Reverse nested Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-nested-aggregation"></a>Nested Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/nested-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A special single bucket aggregation that enables aggregating nested documents.</p><p>For example, lets say we have a index of products, and each product holds the list of resellers - each having its own
price for the product. The mapping could look like:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "product" : {
        "properties" : {
            "resellers" : { <a id="CO27-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
                "type" : "nested",
                "properties" : {
                    "name" : { "type" : "string" },
                    "price" : { "type" : "double" }
                }
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO27-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">resellers</code> is an array that holds nested documents under the <code class="literal">product</code> object.
</p></td></tr></tbody></table></div><p>The following aggregations will return the minimum price products can be purchased in:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match" : { "name" : "led tv" }
    },
    "aggs" : {
        "resellers" : {
            "nested" : {
                "path" : "resellers"
            },
            "aggs" : {
                "min_price" : { "min" : { "field" : "resellers.price" } }
            }
        }
    }
}</pre></div><p>As you can see above, the nested aggregation requires the <code class="literal">path</code> of the nested documents within the top level documents.
Then one can define any type of aggregation over these nested documents.</p><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggregations": {
        "resellers": {
            "min_price": {
                "value" : 350
            }
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-bucket-missing-aggregation.html">
              «&nbsp;
              Missing Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-reverse-nested-aggregation.html">Reverse nested Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Reverse nested Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-bucket-nested-aggregation.html">
              «&nbsp;
              Nested Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-children-aggregation.html">Children Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-reverse-nested-aggregation"></a>Reverse nested Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/reverse-nested-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A special single bucket aggregation that enables aggregating on parent docs from nested documents. Effectively this
aggregation can break out of the nested block structure and link to other nested structures or the root document,
which allows nesting other aggregations that aren’t part of the nested object in a nested aggregation.</p><p>The <code class="literal">reverse_nested</code> aggregation must be defined inside a <code class="literal">nested</code> aggregation.</p><div class="itemizedlist"><p class="title"><strong>Options:</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">path</code> - Which defines to what nested object field should be joined back. The default is empty,
which means that it joins back to the root / main document level. The path cannot contain a reference to
a nested object field that falls outside the <code class="literal">nested</code> aggregation’s nested structure a <code class="literal">reverse_nested</code> is in.
</li></ul></div><p>For example, lets say we have an index for a ticket system with issues and comments. The comments are inlined into
the issue documents as nested documents. The mapping could look like:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "issue" : {
        "properties" : {
            "tags" : { "type" : "string" }
            "comments" : { <a id="CO28-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
                "type" : "nested"
                "properties" : {
                    "username" : { "type" : "string", "index" : "not_analyzed" },
                    "comment" : { "type" : "string" }
                }
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO28-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">comments</code> is an array that holds nested documents under the <code class="literal">issue</code> object.
</p></td></tr></tbody></table></div><p>The following aggregations will return the top commenters' username that have commented and per top commenter the top
tags of the issues the user has commented on:</p><div class="pre_wrapper"><pre class="programlisting">{
  "query": {
    "match": {
      "name": "led tv"
    }
  },
  "aggs": {
    "comments": {
      "nested": {
        "path": "comments"
      },
      "aggs": {
        "top_usernames": {
          "terms": {
            "field": "comments.username"
          },
          "aggs": {
            "comment_to_issue": {
              "reverse_nested": {}, <a id="CO29-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
              "aggs": {
                "top_tags_per_comment": {
                  "terms": {
                    "field": "tags"
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}</pre></div><p>As you can see above, the the <code class="literal">reverse_nested</code> aggregation is put in to a <code class="literal">nested</code> aggregation as this is the only place
in the dsl where the <code class="literal">reversed_nested</code> aggregation can be used. Its sole purpose is to join back to a parent doc higher
up in the nested structure.</p><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO29-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
A <code class="literal">reverse_nested</code> aggregation that joins back to the root / main document level, because no <code class="literal">path</code> has been defined.
Via the <code class="literal">path</code> option the <code class="literal">reverse_nested</code> aggregation can join back to a different level, if multiple layered nested
object types have been defined in the mapping
</p></td></tr></tbody></table></div><p>Possible response snippet:</p><div class="pre_wrapper"><pre class="programlisting">{
  "aggregations": {
    "comments": {
      "top_usernames": {
        "buckets": [
          {
            "key": "username_1",
            "doc_count": 12,
            "comment_to_issue": {
              "top_tags_per_comment": {
                "buckets": [
                  {
                    "key": "tag1",
                    "doc_count": 9
                  },
                  ...
                ]
              }
            }
          },
          ...
        ]
      }
    }
  }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-bucket-nested-aggregation.html">
              «&nbsp;
              Nested Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-children-aggregation.html">Children Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Children Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-bucket-reverse-nested-aggregation.html">
              «&nbsp;
              Reverse nested Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-terms-aggregation.html">Terms Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-children-aggregation"></a>Children Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/children-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A special single bucket aggregation that enables aggregating from buckets on parent document types to buckets on child documents.</p><p>This aggregation relies on the <a class="link" href="mapping-parent-field.html" title="_parent">_parent field</a> in the mapping. This aggregation has a single option:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">type</code> - The what child type the buckets in the parent space should be mapped to.
</li></ul></div><p>For example, let’s say we have an index of questions and answers. The answer type has the following <code class="literal">_parent</code> field in the mapping:</p><div class="pre_wrapper"><pre class="programlisting">{
    "answer" : {
        "_parent" : {
            "type" : "question"
        }
    }
}</pre></div><p>The question typed document contain a tag field and the answer typed documents contain an owner field. With the <code class="literal">children</code>
aggregation the tag buckets can be mapped to the owner buckets in a single request even though the two fields exist in
two different kinds of documents.</p><p>An example of a question typed document:</p><div class="pre_wrapper"><pre class="programlisting">{
    "body": "&lt;p&gt;I have Windows 2003 server and i bought a new Windows 2008 server...",
    "title": "Whats the best way to file transfer my site from server to a newer one?",
    "tags": [
        "windows-server-2003",
        "windows-server-2008",
        "file-transfer"
    ],
}</pre></div><p>An example of an answer typed document:</p><div class="pre_wrapper"><pre class="programlisting">{
    "owner": {
        "location": "Norfolk, United Kingdom",
        "display_name": "Sam",
        "id": 48
    },
    "body": "&lt;p&gt;Unfortunately your pretty much limited to FTP...",
    "creation_date": "2009-05-04T13:45:37.030"
}</pre></div><p>The following request can be built that connects the two together:</p><div class="pre_wrapper"><pre class="programlisting">{
  "aggs": {
    "top-tags": {
      "terms": {
        "field": "tags",
        "size": 10
      },
      "aggs": {
        "to-answers": {
          "children": {
            "type" : "answer" <a id="CO30-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
          },
          "aggs": {
            "top-names": {
              "terms": {
                "field": "owner.display_name",
                "size": 10
              }
            }
          }
        }
      }
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO30-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">type</code> points to type / mapping with the name <code class="literal">answer</code>.
</p></td></tr></tbody></table></div><p>The above example returns the top question tags and per tag the top answer owners.</p><p>Possible response:</p><div class="pre_wrapper"><pre class="programlisting">{
  "aggregations": {
    "top-tags": {
      "buckets": [
        {
          "key": "windows-server-2003",
          "doc_count": 25365, <a id="CO31-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
          "to-answers": {
            "doc_count": 36004, <a id="CO31-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
            "top-names": {
              "buckets": [
                {
                  "key": "Sam",
                  "doc_count": 274
                },
                {
                  "key": "chris",
                  "doc_count": 19
                },
                {
                  "key": "david",
                  "doc_count": 14
                },
                ...
              ]
            }
          }
        },
        {
          "key": "linux",
          "doc_count": 18342,
          "to-answers": {
            "doc_count": 6655,
            "top-names": {
              "buckets": [
                {
                  "key": "abrams",
                  "doc_count": 25
                },
                {
                  "key": "ignacio",
                  "doc_count": 25
                },
                {
                  "key": "vazquez",
                  "doc_count": 25
                },
                ...
              ]
            }
          }
        },
        {
          "key": "windows",
          "doc_count": 18119,
          "to-answers": {
            "doc_count": 24051,
            "top-names": {
              "buckets": [
                {
                  "key": "molly7244",
                  "doc_count": 265
                },
                {
                  "key": "david",
                  "doc_count": 27
                },
                {
                  "key": "chris",
                  "doc_count": 26
                },
                ...
              ]
            }
          }
        },
        {
          "key": "osx",
          "doc_count": 10971,
          "to-answers": {
            "doc_count": 5902,
            "top-names": {
              "buckets": [
                {
                  "key": "diago",
                  "doc_count": 4
                },
                {
                  "key": "albert",
                  "doc_count": 3
                },
                {
                  "key": "asmus",
                  "doc_count": 3
                },
                ...
              ]
            }
          }
        },
        {
          "key": "ubuntu",
          "doc_count": 8743,
          "to-answers": {
            "doc_count": 8784,
            "top-names": {
              "buckets": [
                {
                  "key": "ignacio",
                  "doc_count": 9
                },
                {
                  "key": "abrams",
                  "doc_count": 8
                },
                {
                  "key": "molly7244",
                  "doc_count": 8
                },
                ...
              ]
            }
          }
        },
        {
          "key": "windows-xp",
          "doc_count": 7517,
          "to-answers": {
            "doc_count": 13610,
            "top-names": {
              "buckets": [
                {
                  "key": "molly7244",
                  "doc_count": 232
                },
                {
                  "key": "chris",
                  "doc_count": 9
                },
                {
                  "key": "john",
                  "doc_count": 9
                },
                ...
              ]
            }
          }
        },
        {
          "key": "networking",
          "doc_count": 6739,
          "to-answers": {
            "doc_count": 2076,
            "top-names": {
              "buckets": [
                {
                  "key": "molly7244",
                  "doc_count": 6
                },
                {
                  "key": "alnitak",
                  "doc_count": 5
                },
                {
                  "key": "chris",
                  "doc_count": 3
                },
                ...
              ]
            }
          }
        },
        {
          "key": "mac",
          "doc_count": 5590,
          "to-answers": {
            "doc_count": 999,
            "top-names": {
              "buckets": [
                {
                  "key": "abrams",
                  "doc_count": 2
                },
                {
                  "key": "ignacio",
                  "doc_count": 2
                },
                {
                  "key": "vazquez",
                  "doc_count": 2
                },
                ...
              ]
            }
          }
        },
        {
          "key": "wireless-networking",
          "doc_count": 4409,
          "to-answers": {
            "doc_count": 6497,
            "top-names": {
              "buckets": [
                {
                  "key": "molly7244",
                  "doc_count": 61
                },
                {
                  "key": "chris",
                  "doc_count": 5
                },
                {
                  "key": "mike",
                  "doc_count": 5
                },
                ...
              ]
            }
          }
        },
        {
          "key": "windows-8",
          "doc_count": 3601,
          "to-answers": {
            "doc_count": 4263,
            "top-names": {
              "buckets": [
                {
                  "key": "molly7244",
                  "doc_count": 3
                },
                {
                  "key": "msft",
                  "doc_count": 2
                },
                {
                  "key": "user172132",
                  "doc_count": 2
                },
                ...
              ]
            }
          }
        }
      ]
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO31-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The number of question documents with the tag <code class="literal">windows-server-2003</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO31-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The number of answer documents that are related to question documents with the tag <code class="literal">windows-server-2003</code>.
</p></td></tr></tbody></table></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-bucket-reverse-nested-aggregation.html">
              «&nbsp;
              Reverse nested Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-terms-aggregation.html">Terms Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Terms Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-bucket-children-aggregation.html">
              «&nbsp;
              Children Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-significantterms-aggregation.html">Significant Terms Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-terms-aggregation"></a>Terms Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A multi-bucket value source based aggregation where buckets are dynamically built - one per unique value.</p><p>Example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "genders" : {
            "terms" : { "field" : "gender" }
        }
    }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations" : {
        "genders" : {
            "doc_count_error_upper_bound": 0, <a id="CO32-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
            "sum_other_doc_count": 0, <a id="CO32-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
            "buckets" : [ <a id="CO32-3"></a><span><img src="images/icons/callouts/3.png" alt=""></span>
                {
                    "key" : "male",
                    "doc_count" : 10
                },
                {
                    "key" : "female",
                    "doc_count" : 10
                },
            ]
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO32-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
an upper bound of the error on the document counts for each term, see <a class="link" href="search-aggregations-bucket-terms-aggregation.html#search-aggregations-bucket-terms-aggregation-approximate-counts" title="Document counts are approximate">below</a>
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO32-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
when there are lots of unique terms, elasticsearch only returns the top terms; this number is the sum of the document counts for all buckets that are not part of the response
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO32-3"><span><img src="images/icons/callouts/3.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
the list of the top buckets, the meaning of <code class="literal">top</code> being defined by the <a class="link" href="search-aggregations-bucket-terms-aggregation.html#search-aggregations-bucket-terms-aggregation-order" title="Order">order</a>
</p></td></tr></tbody></table></div><p>By default, the <code class="literal">terms</code> aggregation will return the buckets for the top ten terms ordered by the <code class="literal">doc_count</code>. One can
change this default behaviour by setting the <code class="literal">size</code> parameter.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_size"></a>Size<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">size</code> parameter can be set to define how many term buckets should be returned out of the overall terms list. By
default, the node coordinating the search process will request each shard to provide its own top <code class="literal">size</code> term buckets
and once all shards respond, it will reduce the results to the final list that will then be returned to the client.
This means that if the number of unique terms is greater than <code class="literal">size</code>, the returned list is slightly off and not accurate
(it could be that the term counts are slightly off and it could even be that a term that should have been in the top
size buckets was not returned). If set to <code class="literal">0</code>, the <code class="literal">size</code> will be set to <code class="literal">Integer.MAX_VALUE</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="search-aggregations-bucket-terms-aggregation-approximate-counts"></a>Document counts are approximate<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>As described above, the document counts (and the results of any sub aggregations) in the terms aggregation are not always
accurate.  This is because each shard provides its own view of what the ordered list of terms should be and these are
combined to give a final view. Consider the following scenario:</p><p>A request is made to obtain the top 5 terms in the field product, ordered by descending document count from an index with
3 shards. In this case each shard is asked to give its top 5 terms.</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "products" : {
            "terms" : {
                "field" : "product",
                "size" : 5
            }
        }
    }
}</pre></div><p>The terms for each of the three shards are shown below with their
respective document counts in brackets:</p><div class="informaltable"><table cellpadding="4px" border="1" width="100%"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"><col class="col_4"></colgroup><thead><tr><th class="entry" align="center" valign="top">    </th><th class="entry" align="center" valign="top"> Shard A        </th><th class="entry" align="center" valign="top"> Shard B        </th><th class="entry" align="center" valign="top"> Shard C</th></tr></thead><tbody><tr><td class="entry" align="center" valign="top"><p>1</p></td><td class="entry" align="center" valign="top"><p>Product A (25)</p></td><td class="entry" align="center" valign="top"><p>Product A (30)</p></td><td class="entry" align="center" valign="top"><p>Product A (45)</p></td></tr><tr><td class="entry" align="center" valign="top"><p>2</p></td><td class="entry" align="center" valign="top"><p>Product B (18)</p></td><td class="entry" align="center" valign="top"><p>Product B (25)</p></td><td class="entry" align="center" valign="top"><p>Product C (44)</p></td></tr><tr><td class="entry" align="center" valign="top"><p>3</p></td><td class="entry" align="center" valign="top"><p>Product C (6)</p></td><td class="entry" align="center" valign="top"><p>Product F (17)</p></td><td class="entry" align="center" valign="top"><p>Product Z (36)</p></td></tr><tr><td class="entry" align="center" valign="top"><p>4</p></td><td class="entry" align="center" valign="top"><p>Product D (3)</p></td><td class="entry" align="center" valign="top"><p>Product Z (16)</p></td><td class="entry" align="center" valign="top"><p>Product G (30)</p></td></tr><tr><td class="entry" align="center" valign="top"><p>5</p></td><td class="entry" align="center" valign="top"><p>Product E (2)</p></td><td class="entry" align="center" valign="top"><p>Product G (15)</p></td><td class="entry" align="center" valign="top"><p>Product E (29)</p></td></tr><tr><td class="entry" align="center" valign="top"><p>6</p></td><td class="entry" align="center" valign="top"><p>Product F (2)</p></td><td class="entry" align="center" valign="top"><p>Product H (14)</p></td><td class="entry" align="center" valign="top"><p>Product H (28)</p></td></tr><tr><td class="entry" align="center" valign="top"><p>7</p></td><td class="entry" align="center" valign="top"><p>Product G (2)</p></td><td class="entry" align="center" valign="top"><p>Product I (10)</p></td><td class="entry" align="center" valign="top"><p>Product Q (2)</p></td></tr><tr><td class="entry" align="center" valign="top"><p>8</p></td><td class="entry" align="center" valign="top"><p>Product H (2)</p></td><td class="entry" align="center" valign="top"><p>Product Q (6)</p></td><td class="entry" align="center" valign="top"><p>Product D (1)</p></td></tr><tr><td class="entry" align="center" valign="top"><p>9</p></td><td class="entry" align="center" valign="top"><p>Product I (1)</p></td><td class="entry" align="center" valign="top"><p>Product J (8)</p></td><td class="entry" align="center" valign="top"><p></p></td></tr><tr><td class="entry" align="center" valign="top"><p>10</p></td><td class="entry" align="center" valign="top"><p>Product J (1)</p></td><td class="entry" align="center" valign="top"><p>Product C (4)</p></td><td class="entry" align="center" valign="top"><p></p></td></tr></tbody></table></div><p>The shards will return their top 5 terms so the results from the shards will be:</p><div class="informaltable"><table cellpadding="4px" border="1" width="100%"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"><col class="col_4"></colgroup><thead><tr><th class="entry" align="center" valign="top">    </th><th class="entry" align="center" valign="top"> Shard A        </th><th class="entry" align="center" valign="top"> Shard B        </th><th class="entry" align="center" valign="top"> Shard C</th></tr></thead><tbody><tr><td class="entry" align="center" valign="top"><p>1</p></td><td class="entry" align="center" valign="top"><p>Product A (25)</p></td><td class="entry" align="center" valign="top"><p>Product A (30)</p></td><td class="entry" align="center" valign="top"><p>Product A (45)</p></td></tr><tr><td class="entry" align="center" valign="top"><p>2</p></td><td class="entry" align="center" valign="top"><p>Product B (18)</p></td><td class="entry" align="center" valign="top"><p>Product B (25)</p></td><td class="entry" align="center" valign="top"><p>Product C (44)</p></td></tr><tr><td class="entry" align="center" valign="top"><p>3</p></td><td class="entry" align="center" valign="top"><p>Product C (6)</p></td><td class="entry" align="center" valign="top"><p>Product F (17)</p></td><td class="entry" align="center" valign="top"><p>Product Z (36)</p></td></tr><tr><td class="entry" align="center" valign="top"><p>4</p></td><td class="entry" align="center" valign="top"><p>Product D (3)</p></td><td class="entry" align="center" valign="top"><p>Product Z (16)</p></td><td class="entry" align="center" valign="top"><p>Product G (30)</p></td></tr><tr><td class="entry" align="center" valign="top"><p>5</p></td><td class="entry" align="center" valign="top"><p>Product E (2)</p></td><td class="entry" align="center" valign="top"><p>Product G (15)</p></td><td class="entry" align="center" valign="top"><p>Product E (29)</p></td></tr></tbody></table></div><p>Taking the top 5 results from each of the shards (as requested) and combining them to make a final top 5 list produces
the following:</p><div class="informaltable"><table cellpadding="4px" border="1" width="40%"><colgroup><col class="col_1"><col class="col_2"></colgroup><tbody><tr><td class="entry" align="center" valign="top"><p>1</p></td><td class="entry" align="center" valign="top"><p>Product A (100)</p></td></tr><tr><td class="entry" align="center" valign="top"><p>2</p></td><td class="entry" align="center" valign="top"><p>Product Z (52)</p></td></tr><tr><td class="entry" align="center" valign="top"><p>3</p></td><td class="entry" align="center" valign="top"><p>Product C (50)</p></td></tr><tr><td class="entry" align="center" valign="top"><p>4</p></td><td class="entry" align="center" valign="top"><p>Product G (45)</p></td></tr><tr><td class="entry" align="center" valign="top"><p>5</p></td><td class="entry" align="center" valign="top"><p>Product B (43)</p></td></tr></tbody></table></div><p>Because Product A was returned from all shards we know that its document count value is accurate. Product C was only
returned by shards A and C so its document count is shown as 50 but this is not an accurate count. Product C exists on
shard B, but its count of 4 was not high enough to put Product C into the top 5 list for that shard. Product Z was also
returned only by 2 shards but the third shard does not contain the term. There is no way of knowing, at the point of
combining the results to produce the final list of terms, that there is an error in the document count for Product C and
not for Product Z. Product H has a document count of 44 across all 3 shards but was not included in the final list of
terms because it did not make it into the top five terms on any of the shards.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_shard_size"></a>Shard Size<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The higher the requested <code class="literal">size</code> is, the more accurate the results will be, but also, the more expensive it will be to
compute the final results (both due to bigger priority queues that are managed on a shard level and due to bigger data
transfers between the nodes and the client).</p><p>The <code class="literal">shard_size</code> parameter can be  used to minimize the extra work that comes with bigger requested <code class="literal">size</code>. When defined,
it will determine how many terms the coordinating node will request from each shard. Once all the shards responded, the
coordinating node will then reduce them to a final result which will be based on the <code class="literal">size</code> parameter - this way,
one can increase the accuracy of the returned terms and avoid the overhead of streaming a big list of buckets back to
the client. If set to <code class="literal">0</code>, the <code class="literal">shard_size</code> will be set to <code class="literal">Integer.MAX_VALUE</code>.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p><code class="literal">shard_size</code> cannot be smaller than <code class="literal">size</code> (as it doesn’t make much sense). When it is, elasticsearch will
        override it and reset it to be equal to <code class="literal">size</code>.</p></div></div><p>It is possible to not limit the number of terms that are returned by setting <code class="literal">size</code> to <code class="literal">0</code>. Don’t use this
on high-cardinality fields as this will kill both your CPU since terms need to be return sorted, and your network.</p><p>The default <code class="literal">shard_size</code> is a multiple of the <code class="literal">size</code> parameter which is dependant on the number of shards.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_calculating_document_count_error"></a>Calculating Document Count Error<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>There are two error values which can be shown on the terms aggregation.  The first gives a value for the aggregation as
a whole which represents the maximum potential document count for a term which did not make it into the final list of
terms. This is calculated as the sum of the document count from the last term returned from each shard .For the example
given above the value would be 46 (2 + 15 + 29). This means that in the worst case scenario a term which was not returned
could have the 4th highest document count.</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations" : {
        "products" : {
            "doc_count_error_upper_bound" : 46,
            "buckets" : [
                {
                    "key" : "Product A",
                    "doc_count" : 100
                },
                {
                    "key" : "Product Z",
                    "doc_count" : 52
                },
                ...
            ]
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_per_bucket_document_count_error"></a>Per bucket document count error<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p></div></div><p>The second error value can be enabled by setting the <code class="literal">show_term_doc_count_error</code> parameter to true. This shows an error value
for each term returned by the aggregation which represents the <span class="emphasis"><em>worst case</em></span> error in the document count and can be useful when
deciding on a value for the <code class="literal">shard_size</code> parameter. This is calculated by summing the document counts for the last term returned
by all shards which did not return the term. In the example above the error in the document count for Product C would be 15 as
Shard B was the only shard not to return the term and the document count of the last termit did return was 15. The actual document
count of Product C was 54 so the document count was only actually off by 4 even though the worst case was that it would be off by
15.  Product A, however has an error of 0 for its document count, since every shard returned it we can be confident that the count
returned is accurate.</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations" : {
        "products" : {
            "doc_count_error_upper_bound" : 46,
            "buckets" : [
                {
                    "key" : "Product A",
                    "doc_count" : 100,
                    "doc_count_error_upper_bound" : 0
                },
                {
                    "key" : "Product Z",
                    "doc_count" : 52,
                    "doc_count_error_upper_bound" : 2
                },
                ...
            ]
        }
    }
}</pre></div><p>These errors can only be calculated in this way when the terms are ordered by descending document count. When the aggregation is
ordered by the terms values themselves (either ascending or descending) there is no error in the document count since if a shard
does not return a particular term which appears in the results from another shard, it must not have that term in its index. When the
aggregation is either sorted by a sub aggregation or in order of ascending document count, the error in the document counts cannot be
determined and is given a value of -1 to indicate this.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="search-aggregations-bucket-terms-aggregation-order"></a>Order<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The order of the buckets can be customized by setting the <code class="literal">order</code> parameter. By default, the buckets are ordered by
their <code class="literal">doc_count</code> descending. It is also possible to change this behaviour as follows:</p><p>Ordering the buckets by their <code class="literal">doc_count</code> in an ascending manner:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "genders" : {
            "terms" : {
                "field" : "gender",
                "order" : { "_count" : "asc" }
            }
        }
    }
}</pre></div><p>Ordering the buckets alphabetically by their terms in an ascending manner:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "genders" : {
            "terms" : {
                "field" : "gender",
                "order" : { "_term" : "asc" }
            }
        }
    }
}</pre></div><p>Ordering the buckets by single value metrics sub-aggregation (identified by the aggregation name):</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "genders" : {
            "terms" : {
                "field" : "gender",
                "order" : { "avg_height" : "desc" }
            },
            "aggs" : {
                "avg_height" : { "avg" : { "field" : "height" } }
            }
        }
    }
}</pre></div><p>Ordering the buckets by multi value metrics sub-aggregation (identified by the aggregation name):</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "genders" : {
            "terms" : {
                "field" : "gender",
                "order" : { "height_stats.avg" : "desc" }
            },
            "aggs" : {
                "height_stats" : { "stats" : { "field" : "height" } }
            }
        }
    }
}</pre></div><p>It is also possible to order the buckets based on a "deeper" aggregation in the hierarchy. This is supported as long
as the aggregations path are of a single-bucket type, where the last aggregation in the path may either be a single-bucket
one or a metrics one. If it’s a single-bucket type, the order will be defined by the number of docs in the bucket (i.e. <code class="literal">doc_count</code>),
in case it’s a metrics one, the same rules as above apply (where the path must indicate the metric name to sort by in case of
a multi-value metrics aggregation, and in case of a single-value metrics aggregation the sort will be applied on that value).</p><p>The path must be defined in the following form:</p><pre class="screen">AGG_SEPARATOR       :=  '&gt;'
METRIC_SEPARATOR    :=  '.'
AGG_NAME            :=  &lt;the name of the aggregation&gt;
METRIC              :=  &lt;the name of the metric (in case of multi-value metrics aggregation)&gt;
PATH                :=  &lt;AGG_NAME&gt;[&lt;AGG_SEPARATOR&gt;&lt;AGG_NAME&gt;]*[&lt;METRIC_SEPARATOR&gt;&lt;METRIC&gt;]</pre><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "countries" : {
            "terms" : {
                "field" : "address.country",
                "order" : { "females&gt;height_stats.avg" : "desc" }
            },
            "aggs" : {
                "females" : {
                    "filter" : { "term" : { "gender" :  "female" }},
                    "aggs" : {
                        "height_stats" : { "stats" : { "field" : "height" }}
                    }
                }
            }
        }
    }
}</pre></div><p>The above will sort the countries buckets based on the average height among the female population.</p><p>Multiple criteria can be used to order the buckets by providing an array of order criteria such as the following:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "countries" : {
            "terms" : {
                "field" : "address.country",
                "order" : [ { "females&gt;height_stats.avg" : "desc" }, { "_count" : "desc" } ]
            },
            "aggs" : {
                "females" : {
                    "filter" : { "term" : { "gender" : { "female" }}},
                    "aggs" : {
                        "height_stats" : { "stats" : { "field" : "height" }}
                    }
                }
            }
        }
    }
}</pre></div><p>The above will sort the countries buckets based on the average height among the female population and then by
their <code class="literal">doc_count</code> in descending order.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>In the event that two buckets share the same values for all order criteria the bucket’s term value is used as a
tie-breaker in ascending alphabetical order to prevent non-deterministic ordering of buckets.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_minimum_document_count"></a>Minimum document count<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>It is possible to only return terms that match more than a configured number of hits using the <code class="literal">min_doc_count</code> option:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "tags" : {
            "terms" : {
                "field" : "tags",
                "min_doc_count": 10
            }
        }
    }
}</pre></div><p>The above aggregation would only return tags which have been found in 10 hits or more. Default value is <code class="literal">1</code>.</p><p>Terms are collected and ordered on a shard level and merged with the terms collected from other shards in a second step. However, the shard does not have the information about the global document count available. The decision if a term is added to a candidate list depends only on the order computed on the shard using local shard frequencies. The <code class="literal">min_doc_count</code> criterion is only applied after merging local terms statistics of all shards. In a way the decision to add the term as a candidate is made without being very <span class="emphasis"><em>certain</em></span> about if the term will actually reach the required <code class="literal">min_doc_count</code>. This might cause many (globally) high frequent terms to be missing in the final result if low frequent terms populated the candidate lists. To avoid this, the <code class="literal">shard_size</code> parameter can be increased to allow more candidate terms on the shards. However, this increases memory consumption and network traffic.</p><p><code class="literal">shard_min_doc_count</code> parameter</p><p>The parameter <code class="literal">shard_min_doc_count</code> regulates the <span class="emphasis"><em>certainty</em></span> a shard has if the term should actually be added to the candidate list or not with respect to the <code class="literal">min_doc_count</code>. Terms will only be considered if their local shard frequency within the set is higher than the <code class="literal">shard_min_doc_count</code>. If your dictionary contains many low frequent terms and you are not interested in those (for example misspellings), then you can set the <code class="literal">shard_min_doc_count</code> parameter to filter out candidate terms on a shard level that will with a reasonable certainty not reach the required <code class="literal">min_doc_count</code> even after merging the local counts. <code class="literal">shard_min_doc_count</code> is set to <code class="literal">0</code> per default and has no effect unless you explicitly set it.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Setting <code class="literal">min_doc_count</code>=<code class="literal">0</code> will also return buckets for terms that didn’t match any hit. However, some of
         the returned terms which have a document count of zero might only belong to deleted documents or documents
         from other types, so there is no warranty that a <code class="literal">match_all</code> query would find a positive document count for
         those terms.</p></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>When NOT sorting on <code class="literal">doc_count</code> descending, high values of <code class="literal">min_doc_count</code> may return a number of buckets
         which is less than <code class="literal">size</code> because not enough data was gathered from the shards. Missing buckets can be
         back by increasing <code class="literal">shard_size</code>.
         Setting <code class="literal">shard_min_doc_count</code> too high will cause terms to be filtered out on a shard level. This value should be set much lower than <code class="literal">min_doc_count/#shards</code>.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="search-aggregations-bucket-terms-aggregation-script"></a>Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Generating the terms using a script:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "genders" : {
            "terms" : {
                "script" : "doc['gender'].value"
            }
        }
    }
}</pre></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p>The <code class="literal">script</code> parameter expects an inline script. Use <code class="literal">script_id</code> for indexed scripts and <code class="literal">script_file</code> for scripts in the <code class="literal">config/scripts/</code> directory.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_value_script_7"></a>Value Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "genders" : {
            "terms" : {
                "field" : "gender",
                "script" : "'Gender: ' +_value"
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_filtering_values"></a>Filtering Values<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>It is possible to filter the values for which buckets will be created. This can be done using the <code class="literal">include</code> and
<code class="literal">exclude</code> parameters which are based on regular expression strings or arrays of exact values.</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "tags" : {
            "terms" : {
                "field" : "tags",
                "include" : ".*sport.*",
                "exclude" : "water_.*"
            }
        }
    }
}</pre></div><p>In the above example, buckets will be created for all the tags that has the word <code class="literal">sport</code> in them, except those starting
with <code class="literal">water_</code> (so the tag <code class="literal">water_sports</code> will no be aggregated). The <code class="literal">include</code> regular expression will determine what
values are "allowed" to be aggregated, while the <code class="literal">exclude</code> determines the values that should not be aggregated. When
both are defined, the <code class="literal">exclude</code> has precedence, meaning, the <code class="literal">include</code> is evaluated first and only then the <code class="literal">exclude</code>.</p><p>The regular expression are based on the Java™ <a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html" target="_top">Pattern</a>,
and as such, they it is also possible to pass in flags that will determine how the compiled regular expression will work:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "tags" : {
             "terms" : {
                 "field" : "tags",
                 "include" : {
                     "pattern" : ".*sport.*",
                     "flags" : "CANON_EQ|CASE_INSENSITIVE" <a id="CO33-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
                 },
                 "exclude" : {
                     "pattern" : "water_.*",
                     "flags" : "CANON_EQ|CASE_INSENSITIVE"
                 }
             }
         }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO33-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
the flags are concatenated using the <code class="literal">|</code> character as a separator
</p></td></tr></tbody></table></div><p>The possible flags that can be used are:
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#CANON_EQ" target="_top"><code class="literal">CANON_EQ</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#CASE_INSENSITIVE" target="_top"><code class="literal">CASE_INSENSITIVE</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#COMMENTS" target="_top"><code class="literal">COMMENTS</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#DOTALL" target="_top"><code class="literal">DOTALL</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#LITERAL" target="_top"><code class="literal">LITERAL</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#MULTILINE" target="_top"><code class="literal">MULTILINE</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#UNICODE_CASE" target="_top"><code class="literal">UNICODE_CASE</code></a>,
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#UNICODE_CHARACTER_CLASS" target="_top"><code class="literal">UNICODE_CHARACTER_CLASS</code></a> and
<a class="ulink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#UNIX_LINES" target="_top"><code class="literal">UNIX_LINES</code></a></p><p>For matching based on exact values the <code class="literal">include</code> and <code class="literal">exclude</code> parameters can simply take an array of
strings that represent the terms as they are found in the index:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "JapaneseCars" : {
             "terms" : {
                 "field" : "make",
                 "include" : ["mazda", "honda"]
             }
         },
        "ActiveCarManufacturers" : {
             "terms" : {
                 "field" : "make",
                 "exclude" : ["rover", "jensen"]
             }
         }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_multi_field_terms_aggregation"></a>Multi-field terms aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">terms</code> aggregation does not support collecting terms from multiple fields
in the same document.  The reason is that the <code class="literal">terms</code> agg doesn’t collect the
string term values themselves, but rather uses
<a class="link" href="search-aggregations-bucket-terms-aggregation.html#search-aggregations-bucket-terms-aggregation-execution-hint" title="Execution hint">global ordinals</a>
to produce a list of all of the unique values in the field.  Global ordinals
results in an important performance boost which would not be possible across
multiple fields.</p><p>There are two approaches that you can use to perform a <code class="literal">terms</code> agg across
multiple fields:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<a class="link" href="search-aggregations-bucket-terms-aggregation.html#search-aggregations-bucket-terms-aggregation-script" title="Script">Script</a>
</span></dt><dd>
Use a script to retrieve terms from multiple fields.  This disables the global
ordinals optimization and will be slower than collecting terms from a single
field, but it gives you the flexibility to implement this option at search
time.
</dd><dt><span class="term">
<a class="link" href="mapping-core-types.html#copy-to" title="Copy to fieldedit"><code class="literal">copy_to</code> field</a>
</span></dt><dd>
If you know ahead of time that you want to collect the terms from two or more
fields, then use <code class="literal">copy_to</code> in your mapping to create a new dedicated field at
index time which contains the values from both fields.  You can aggregate on
this single field, which will benefit from the global ordinals optimization.
</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_collect_mode"></a>Collect mode<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Deferring calculation of child aggregations</p><p>For fields with many unique terms and a small number of required results it can be more efficient to delay the calculation
of child aggregations until the top parent-level aggs have been pruned. Ordinarily, all branches of the aggregation tree
are expanded in one depth-first pass and only then any pruning occurs. In some rare scenarios this can be very wasteful and can hit memory constraints.
An example problem scenario is querying a movie database for the 10 most popular actors and their 5 most common co-stars:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "actors" : {
             "terms" : {
                 "field" : "actors",
                 "size" : 10
             },
            "aggs" : {
                "costars" : {
                     "terms" : {
                         "field" : "actors",
                         "size" : 5
                     }
                 }
            }
         }
    }
}</pre></div><p>Even though the number of movies may be comparatively small and we want only 50 result buckets there is a combinatorial explosion of buckets
during calculation - a single movie will produce n² buckets where n is the number of actors. The sane option would be to first determine
the 10 most popular actors and only then examine the top co-stars for these 10 actors. This alternative strategy is what we call the <code class="literal">breadth_first</code> collection
mode as opposed to the default <code class="literal">depth_first</code> mode:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "actors" : {
             "terms" : {
                 "field" : "actors",
                 "size" : 10,
                 "collect_mode" : "breadth_first"
             },
            "aggs" : {
                "costars" : {
                     "terms" : {
                         "field" : "actors",
                         "size" : 5
                     }
                 }
            }
         }
    }
}</pre></div><p>When using <code class="literal">breadth_first</code> mode the set of documents that fall into the uppermost buckets are
cached for subsequent replay so there is a memory overhead in doing this which is linear with the number of matching documents.
In most requests the volume of buckets generated is smaller than the number of documents that fall into them so the default <code class="literal">depth_first</code>
collection mode is normally the best bet but occasionally the <code class="literal">breadth_first</code> strategy can be significantly more efficient. Currently
elasticsearch will always use the <code class="literal">depth_first</code> collect_mode unless explicitly instructed to use <code class="literal">breadth_first</code> as in the above example.
Note that the <code class="literal">order</code> parameter can still be used to refer to data from a child aggregation when using the <code class="literal">breadth_first</code> setting - the parent
aggregation understands that this child aggregation will need to be called first before any of the other child aggregations.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>It is not possible to nest aggregations such as <code class="literal">top_hits</code> which require access to match score information under an aggregation that uses
the <code class="literal">breadth_first</code> collection mode. This is because this would require a RAM buffer to hold the float score value for every document and
this would typically be too costly in terms of RAM.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="search-aggregations-bucket-terms-aggregation-execution-hint"></a>Execution hint<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/terms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p></div></div><p>There are different mechanisms by which terms aggregations can be executed:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
by using field values directly in order to aggregate data per-bucket (<code class="literal">map</code>)
</li><li class="listitem">
by using ordinals of the field and preemptively allocating one bucket per ordinal value (<code class="literal">global_ordinals</code>)
</li><li class="listitem">
by using ordinals of the field and dynamically allocating one bucket per ordinal value (<code class="literal">global_ordinals_hash</code>)
</li><li class="listitem">
by using per-segment ordinals to compute counts and remap these counts to global counts using global ordinals (<code class="literal">global_ordinals_low_cardinality</code>)
</li></ul></div><p>Elasticsearch tries to have sensible defaults so this is something that generally doesn’t need to be configured.</p><p><code class="literal">map</code> should only be considered when very few documents match a query. Otherwise the ordinals-based execution modes
are significantly faster. By default, <code class="literal">map</code> is only used when running an aggregation on scripts, since they don’t have
ordinals.</p><p><code class="literal">global_ordinals_low_cardinality</code> only works for leaf terms aggregations but is usually the fastest execution mode. Memory
usage is linear with the number of unique values in the field, so it is only enabled by default on low-cardinality fields.</p><p><code class="literal">global_ordinals</code> is the second fastest option, but the fact that it preemptively allocates buckets can be memory-intensive,
especially if you have one or more sub aggregations. It is used by default on top-level terms aggregations.</p><p><code class="literal">global_ordinals_hash</code> on the contrary to <code class="literal">global_ordinals</code> and <code class="literal">global_ordinals_low_cardinality</code> allocates buckets dynamically
so memory usage is linear to the number of values of the documents that are part of the aggregation scope. It is used by default
in inner aggregations.</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "tags" : {
             "terms" : {
                 "field" : "tags",
                 "execution_hint": "map" <a id="CO34-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
             }
         }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO34-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
<span class="experimental">
      [<span class="experimental_title">experimental</span>]
      <span class="detail">This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</span></span> the possible values are <code class="literal">map</code>, <code class="literal">global_ordinals</code>, <code class="literal">global_ordinals_hash</code> and <code class="literal">global_ordinals_low_cardinality</code>
</p></td></tr></tbody></table></div><p>Please note that Elasticsearch will ignore this execution hint if it is not applicable and that there is no backward compatibility guarantee on these hints.</p></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-bucket-children-aggregation.html">
              «&nbsp;
              Children Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-significantterms-aggregation.html">Significant Terms Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Significant Terms Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-bucket-terms-aggregation.html">
              «&nbsp;
              Terms Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-range-aggregation.html">Range Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-significantterms-aggregation"></a>Significant Terms Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>An aggregation that returns interesting or unusual occurrences of terms in a set.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p></div></div><div class="itemizedlist"><p class="title"><strong>Example use cases:</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
Suggesting "H5N1" when users search for "bird flu" in text
</li><li class="listitem">
Identifying the merchant that is the "common point of compromise" from the transaction history of credit card owners reporting loss
</li><li class="listitem">
Suggesting keywords relating to stock symbol $ATI for an automated news classifier
</li><li class="listitem">
Spotting the fraudulent doctor who is diagnosing more than his fair share of whiplash injuries
</li><li class="listitem">
Spotting the tire manufacturer who has a disproportionate number of blow-outs
</li></ul></div><p>In all these cases the terms being selected are not simply the most popular terms in a set.
They are the terms that have undergone a significant change in popularity measured between a <span class="emphasis"><em>foreground</em></span> and <span class="emphasis"><em>background</em></span> set.
If the term "H5N1" only exists in 5 documents in a 10 million document index and yet is found in 4 of the 100 documents that make up a user’s search results
that is significant and probably very relevant to their search. 5/10,000,000 vs 4/100 is a big swing in frequency.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_single_set_analysis"></a>Single-set analysis<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>In the simplest case, the <span class="emphasis"><em>foreground</em></span> set of interest is the search results matched by a query and the <span class="emphasis"><em>background</em></span>
set used for statistical comparisons is the index or indices from which the results were gathered.</p><p>Example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "terms" : {"force" : [ "British Transport Police" ]}
    },
    "aggregations" : {
        "significantCrimeTypes" : {
            "significant_terms" : { "field" : "crime_type" }
        }
    }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations" : {
        "significantCrimeTypes" : {
            "doc_count": 47347,
            "buckets" : [
                {
                    "key": "Bicycle theft",
                    "doc_count": 3640,
                    "score": 0.371235374214817,
                    "bg_count": 66799
                }
                ...
            ]
        }
    }
}</pre></div><p>When querying an index of all crimes from all police forces, what these results show is that the British Transport Police force
stand out as a force dealing with a disproportionately large number of bicycle thefts. Ordinarily, bicycle thefts represent only 1% of crimes (66799/5064554)
but for the British Transport Police, who handle crime on railways and stations, 7% of crimes (3640/47347) is
a bike theft. This is a significant seven-fold increase in frequency and so this anomaly was highlighted as the top crime type.</p><p>The problem with using a query to spot anomalies is it only gives us one subset to use for comparisons.
To discover all the other police forces' anomalies we would have to repeat the query for each of the different forces.</p><p>This can be a tedious way to look for unusual patterns in an index</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_multi_set_analysis"></a>Multi-set analysis<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>A simpler way to perform analysis across multiple categories is to use a parent-level aggregation to segment the data ready for analysis.</p><p>Example using a parent aggregation for segmentation:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggregations": {
        "forces": {
            "terms": {"field": "force"},
            "aggregations": {
                "significantCrimeTypes": {
                    "significant_terms": {"field": "crime_type"}
                }
            }
        }
    }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
 ...

 "aggregations": {
    "forces": {
        "buckets": [
            {
                "key": "Metropolitan Police Service",
                "doc_count": 894038,
                "significantCrimeTypes": {
                    "doc_count": 894038,
                    "buckets": [
                        {
                            "key": "Robbery",
                            "doc_count": 27617,
                            "score": 0.0599,
                            "bg_count": 53182
                        },
                        ...
                    ]
                }
            },
            {
                "key": "British Transport Police",
                "doc_count": 47347,
                "significantCrimeTypes": {
                    "doc_count": 47347,
                    "buckets": [
                        {
                            "key": "Bicycle theft",
                            "doc_count": 3640,
                            "score": 0.371,
                            "bg_count": 66799
                        },
                        ...
                    ]
                }
            }
        ]
    }
}</pre></div><p>Now we have anomaly detection for each of the police forces using a single request.</p><p>We can use other forms of top-level aggregations to segment our data, for example segmenting by geographic
area to identify unusual hot-spots of a particular crime type:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs": {
        "hotspots": {
            "geohash_grid" : {
                "field":"location",
                "precision":5,
            },
            "aggs": {
                "significantCrimeTypes": {
                    "significant_terms": {"field": "crime_type"}
                }
            }
        }
    }
}</pre></div><p>This example uses the <code class="literal">geohash_grid</code> aggregation to create result buckets that represent geographic areas, and inside each
bucket we can identify anomalous levels of a crime type in these tightly-focused areas e.g.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Airports exhibit unusual numbers of weapon confiscations
</li><li class="listitem">
Universities show uplifts of bicycle thefts
</li></ul></div><p>At a higher geohash_grid zoom-level with larger coverage areas we would start to see where an entire police-force may be
tackling an unusual volume of a particular crime type.</p><p>Obviously a time-based top-level segmentation would help identify current trends for each point in time
where a simple <code class="literal">terms</code> aggregation would typically show the very popular "constants" that persist across all time slots.</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>How are the scores calculated?</strong></p></div></div></div><p>The numbers returned for scores are primarily intended for ranking different suggestions sensibly rather than something easily understood by end users. The scores are derived from the doc frequencies in <span class="emphasis"><em>foreground</em></span> and <span class="emphasis"><em>background</em></span> sets. In brief, a term is considered significant if there is a noticeable difference in the frequency in which a term appears in the subset and in the background. The way the terms are ranked can be configured, see "Parameters" section.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_use_on_free_text_fields"></a>Use on free-text fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The significant_terms aggregation can be used effectively on tokenized free-text fields to suggest:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
keywords for refining end-user searches
</li><li class="listitem">
keywords for use in percolator queries
</li></ul></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Picking a free-text field as the subject of a significant terms analysis can be expensive! It will attempt
to load every unique word into RAM. It is recommended to only use this on smaller indices.</p></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Use the <span class="emphasis"><em>"like this but not this"</em></span> pattern</strong></p></div></div></div><p>You can spot mis-categorized content by first searching a structured field e.g. <code class="literal">category:adultMovie</code> and use significant_terms on the
free-text "movie_description" field. Take the suggested words (I’ll leave them to your imagination) and then search for all movies NOT marked as category:adultMovie but containing these keywords.
You now have a ranked list of badly-categorized movies that you should reclassify or at least remove from the "familyFriendly" category.</p><p>The significance score from each term can also provide a useful <code class="literal">boost</code> setting to sort matches.
Using the <code class="literal">minimum_should_match</code> setting of the <code class="literal">terms</code> query with the keywords will help control the balance of precision/recall in the result set i.e
a high setting would have a small number of relevant results packed full of keywords and a setting of "1" would produce a more exhaustive results set with all documents containing <span class="emphasis"><em>any</em></span> keyword.</p></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p class="formalpara"><strong>Show significant_terms in context.&nbsp;</strong>Free-text significant_terms are much more easily understood when viewed in context. Take the results of <code class="literal">significant_terms</code> suggestions from a
free-text field and use them in a <code class="literal">terms</code> query on the same field with a <code class="literal">highlight</code> clause to present users with example snippets of documents. When the terms
are presented unstemmed, highlighted, with the right case, in the right order and with some context, their significance/meaning is more readily apparent.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_custom_background_sets"></a>Custom background sets<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Ordinarily, the foreground set of documents is "diffed" against a background set of all the documents in your index.
However, sometimes it may prove useful to use a narrower background set as the basis for comparisons.
For example, a query on documents relating to "Madrid" in an index with content from all over the world might reveal that "Spanish"
was a significant term. This may be true but if you want some more focused terms you could use a <code class="literal">background_filter</code>
on the term <span class="emphasis"><em>spain</em></span> to establish a narrower set of documents as context. With this as a background "Spanish" would now
be seen as commonplace and therefore not as significant as words like "capital" that relate more strongly with Madrid.
Note that using a background filter will slow things down - each term’s background frequency must now be derived on-the-fly from filtering posting lists rather than reading the index’s pre-computed count for a term.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_limitations"></a>Limitations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_significant_terms_must_be_indexed_values"></a>Significant terms must be indexed values<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Unlike the terms aggregation it is currently not possible to use script-generated terms for counting purposes.
Because of the way the significant_terms aggregation must consider both <span class="emphasis"><em>foreground</em></span> and <span class="emphasis"><em>background</em></span> frequencies
it would be prohibitively expensive to use a script on the entire index to obtain background frequencies for comparisons.
Also DocValues are not supported as sources of term data for similar reasons.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_no_analysis_of_floating_point_fields"></a>No analysis of floating point fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Floating point fields are currently not supported as the subject of significant_terms analysis.
While integer or long fields can be used to represent concepts like bank account numbers or category numbers which
can be interesting to track, floating point fields are usually used to represent quantities of something.
As such, individual floating point terms are not useful for this form of frequency analysis.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_use_as_a_parent_aggregation"></a>Use as a parent aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>If there is the equivalent of a <code class="literal">match_all</code> query or no query criteria providing a subset of the index the significant_terms aggregation should not be used as the
top-most aggregation - in this scenario the <span class="emphasis"><em>foreground</em></span> set is exactly the same as the <span class="emphasis"><em>background</em></span> set and
so there is no difference in document frequencies to observe and from which to make sensible suggestions.</p><p>Another consideration is that  the significant_terms aggregation produces many candidate results at shard level
that are only later pruned on the reducing node once all statistics from all shards are merged. As a result,
it can be inefficient and costly in terms of RAM to embed large child aggregations under a significant_terms
aggregation that later discards many candidate terms. It is advisable in these cases to perform two searches - the first to provide a rationalized list of
significant_terms and then add this shortlist of terms to a second query to go back and fetch the required child aggregations.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_approximate_counts"></a>Approximate counts<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The counts of how many documents contain a term provided in results are based on summing the samples returned from each shard and
as such may be:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
low if certain shards did not provide figures for a given term in their top sample
</li><li class="listitem">
high when considering the background frequency as it may count occurrences found in deleted documents
</li></ul></div><p>Like most design decisions, this is the basis of a trade-off in which we have chosen to provide fast performance at the cost of some (typically small) inaccuracies.
However, the <code class="literal">size</code> and <code class="literal">shard size</code> settings covered in the next section provide tools to help control the accuracy levels.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_parameters_6"></a>Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_jlh_score"></a>JLH score<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The scores are derived from the doc frequencies in <span class="emphasis"><em>foreground</em></span> and <span class="emphasis"><em>background</em></span> sets. The <span class="emphasis"><em>absolute</em></span> change in popularity (foregroundPercent - backgroundPercent) would favor common terms whereas the <span class="emphasis"><em>relative</em></span> change in popularity (foregroundPercent/ backgroundPercent) would favor rare terms. Rare vs common is essentially a precision vs recall balance and so the absolute and relative changes are multiplied to provide a sweet spot between precision and recall.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_mutual_information"></a>mutual information<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Mutual information as described in "Information Retrieval", Manning et al., Chapter 13.5.1 can be used as significance score by adding the parameter</p><div class="pre_wrapper"><pre class="programlisting">         "mutual_information": {
              "include_negatives": true
         }</pre></div><p>Mutual information does not differentiate between terms that are descriptive for the subset or for documents outside the subset. The significant terms therefore can contain terms that appear more or less frequent in the subset than outside the subset. To filter out the terms that appear less often in the subset than in documents outside the subset, <code class="literal">include_negatives</code> can be set to <code class="literal">false</code>.</p><p>Per default, the assumption is that the documents in the bucket are also contained in the background. If instead you defined a custom background filter that represents a different set of documents that you want to compare to, set</p><div class="pre_wrapper"><pre class="programlisting">"background_is_superset": false</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_chi_square"></a>Chi square<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Chi square as described in "Information Retrieval", Manning et al., Chapter 13.5.2 can be used as significance score by adding the parameter</p><div class="pre_wrapper"><pre class="programlisting">         "chi_square": {
         }</pre></div><p>Chi square behaves like mutual information and can be configured with the same parameters <code class="literal">include_negatives</code> and <code class="literal">background_is_superset</code>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_google_normalized_distance"></a>google normalized distance<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Google normalized distance  as described in "The Google Similarity Distance", Cilibrasi and Vitanyi, 2007 (<a class="ulink" href="http://arxiv.org/pdf/cs/0412098v3.pdf" target="_top">http://arxiv.org/pdf/cs/0412098v3.pdf</a>) can be used as significance score by adding the parameter</p><div class="pre_wrapper"><pre class="programlisting">         "gnd": {
         }</pre></div><p><code class="literal">gnd</code> also accepts the <code class="literal">background_is_superset</code> parameter.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_percentage"></a>Percentage<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>A simple calculation of the number of documents in the foreground sample with a term divided by the number of documents in the background with the term.
By default this produces a score greater than zero and less than one.</p><p>The benefit of this heuristic is that the scoring logic is simple to explain to anyone familiar with a "per capita" statistic. However, for fields with high cardinality there is a tendency for this heuristic to select the rarest terms such as typos that occur only once because they score 1/1 = 100%.</p><p>It would be hard for a seasoned boxer to win a championship if the prize was awarded purely on the basis of percentage of fights won - by these rules a newcomer with only one fight under his belt would be impossible to beat.
Multiple observations are typically required to reinforce a view so it is recommended in these cases to set both <code class="literal">min_doc_count</code> and <code class="literal">shard_min_doc_count</code> to a higher value such as 10 in order to filter out the low-frequency terms that otherwise take precedence.</p><div class="pre_wrapper"><pre class="programlisting">         "percentage": {
         }</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_which_one_is_best"></a>Which one is best?<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Roughly, <code class="literal">mutual_information</code> prefers high frequent terms even if they occur also frequently in the background. For example, in an analysis of natural language text this might lead to selection of stop words. <code class="literal">mutual_information</code> is unlikely to select very rare terms like misspellings. <code class="literal">gnd</code> prefers terms with a high co-occurence and avoids selection of stopwords. It might be better suited for synonym detection. However, <code class="literal">gnd</code> has a tendency to select very rare terms that are, for example, a result of misspelling. <code class="literal">chi_square</code> and <code class="literal">jlh</code> are somewhat in-between.</p><p>It is hard to say which one of the different heuristics will be the best choice as it depends on what the significant terms are used for (see for example [Yang and Pedersen, "A Comparative Study on Feature Selection in Text Categorization", 1997](<a class="ulink" href="http://courses.ischool.berkeley.edu/i256/f06/papers/yang97comparative.pdf" target="_top">http://courses.ischool.berkeley.edu/i256/f06/papers/yang97comparative.pdf</a>) for a study on using significant terms for feature selection for text classification).</p><p>If none of the above measures suits your usecase than another option is to implement a custom significance measure:</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_scripted"></a>scripted<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Customized scores can be implemented via a script:</p><div class="pre_wrapper"><pre class="programlisting">            "script_heuristic": {
              "script": "_subset_freq/(_superset_freq - _subset_freq + 1)"
            }</pre></div><p>Scripts can be inline (as in above example), indexed or stored on disk. For details on the options, see <a class="link" href="modules-scripting.html" title="Scripting">script documentation</a>.
Parameters need to be set as follows:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">script</code>
</p>
</td><td class="entry" valign="top">
<p>
Inline script, name of script file or name of indexed script. Mandatory.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">script_type</code>
</p>
</td><td class="entry" valign="top">
<p>
One of "inline" (default), "indexed" or "file".
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">lang</code>
</p>
</td><td class="entry" valign="top">
<p>
Script language (default "groovy")
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">params</code>
</p>
</td><td class="entry" valign="top">
<p>
Script parameters (default empty).
</p>
</td></tr></tbody></table></div><p>Available parameters in the script are</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">_subset_freq</code>
</p>
</td><td class="entry" valign="top">
<p>
Number of documents the term appears in in the subset.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">_superset_freq</code>
</p>
</td><td class="entry" valign="top">
<p>
Number of documents the term appears in in the superset.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">_subset_size</code>
</p>
</td><td class="entry" valign="top">
<p>
Number of documents in the subset.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">_superset_size</code>
</p>
</td><td class="entry" valign="top">
<p>
Number of documents in the superset.
</p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_size_amp_shard_size"></a>Size &amp; Shard Size<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The <code class="literal">size</code> parameter can be set to define how many term buckets should be returned out of the overall terms list. By
default, the node coordinating the search process will request each shard to provide its own top term buckets
and once all shards respond, it will reduce the results to the final list that will then be returned to the client.
If the number of unique terms is greater than <code class="literal">size</code>, the returned list can be slightly off and not accurate
(it could be that the term counts are slightly off and it could even be that a term that should have been in the top
size buckets was not returned).</p><p>If set to <code class="literal">0</code>, the <code class="literal">size</code> will be set to <code class="literal">Integer.MAX_VALUE</code>.</p><p>To ensure better accuracy a multiple of the final <code class="literal">size</code> is used as the number of terms to request from each shard
using a heuristic based on the number of shards. To take manual control of this setting the <code class="literal">shard_size</code> parameter
can be  used to control the volumes of candidate terms produced by each shard.</p><p>Low-frequency terms can turn out to be the most interesting ones once all results are combined so the
significant_terms aggregation can produce higher-quality results when the <code class="literal">shard_size</code> parameter is set to
values significantly higher than the <code class="literal">size</code> setting. This ensures that a bigger volume of promising candidate terms are given
a consolidated review by the reducing node before the final selection. Obviously large candidate term lists
will cause extra network traffic and RAM usage so this is  quality/cost trade off that needs to be balanced.  If <code class="literal">shard_size</code> is set to -1 (the default) then <code class="literal">shard_size</code> will be automatically estimated based on the number of shards and the <code class="literal">size</code> parameter.</p><p>If set to <code class="literal">0</code>, the <code class="literal">shard_size</code> will be set to <code class="literal">Integer.MAX_VALUE</code>.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p><code class="literal">shard_size</code> cannot be smaller than <code class="literal">size</code> (as it doesn’t make much sense). When it is, elasticsearch will
        override it and reset it to be equal to <code class="literal">size</code>.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_minimum_document_count_2"></a>Minimum document count<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>It is possible to only return terms that match more than a configured number of hits using the <code class="literal">min_doc_count</code> option:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "tags" : {
            "significant_terms" : {
                "field" : "tag",
                "min_doc_count": 10
            }
        }
    }
}</pre></div><p>The above aggregation would only return tags which have been found in 10 hits or more. Default value is <code class="literal">3</code>.</p><p>Terms that score highly will be collected on a shard level and merged with the terms collected from other shards in a second step. However, the shard does not have the information about the global term frequencies available. The decision if a term is added to a candidate list depends only on the score computed on the shard using local shard frequencies, not the global frequencies of the word. The <code class="literal">min_doc_count</code> criterion is only applied after merging local terms statistics of all shards. In a way the decision to add the term as a candidate is made without being very <span class="emphasis"><em>certain</em></span> about if the term will actually reach the required <code class="literal">min_doc_count</code>. This might cause many (globally) high frequent terms to be missing in the final result if low frequent but high scoring terms populated the candidate lists. To avoid this, the <code class="literal">shard_size</code> parameter can be increased to allow more candidate terms on the shards. However, this increases memory consumption and network traffic.</p><p><code class="literal">shard_min_doc_count</code> parameter</p><p>The parameter <code class="literal">shard_min_doc_count</code> regulates the <span class="emphasis"><em>certainty</em></span> a shard has if the term should actually be added to the candidate list or not with respect to the <code class="literal">min_doc_count</code>. Terms will only be considered if their local shard frequency within the set is higher than the <code class="literal">shard_min_doc_count</code>. If your dictionary contains many low frequent words and you are not interested in these (for example misspellings), then you can set the <code class="literal">shard_min_doc_count</code> parameter to filter out candidate terms on a shard level that will with a reasonable certainty not reach the required <code class="literal">min_doc_count</code> even after merging the local frequencies. <code class="literal">shard_min_doc_count</code> is set to <code class="literal">1</code> per default and has no effect unless you explicitly set it.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Setting <code class="literal">min_doc_count</code> to <code class="literal">1</code> is generally not advised as it tends to return terms that
         are typos or other bizarre curiosities. Finding more than one instance of a term helps
         reinforce that, while still rare, the term was not the result of a one-off accident. The
         default value of 3 is used to provide a minimum weight-of-evidence.
         Setting <code class="literal">shard_min_doc_count</code> too high will cause significant candidate terms to be filtered out on a shard level. This value should be set much lower than <code class="literal">min_doc_count/#shards</code>.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_custom_background_context"></a>Custom background context<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The default source of statistical information for background term frequencies is the entire index and this
scope can be narrowed through the use of a <code class="literal">background_filter</code> to focus in on significant terms within a narrower
context:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match" : "madrid"
    },
    "aggs" : {
        "tags" : {
            "significant_terms" : {
                "field" : "tag",
                "background_filter": {
                        "term" : { "text" : "spain"}
                }
            }
        }
    }
}</pre></div><p>The above filter would help focus in on terms that were peculiar to the city of Madrid rather than revealing
terms like "Spanish" that are unusual in the full index’s worldwide context but commonplace in the subset of documents containing the
word "Spain".</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Use of background filters will slow the query as each term’s postings must be filtered to determine a frequency</p></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_filtering_values_2"></a>Filtering Values<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>It is possible (although rarely required) to filter the values for which buckets will be created. This can be done using the <code class="literal">include</code> and
<code class="literal">exclude</code> parameters which are based on a regular expression string or arrays of exact terms. This functionality mirrors the features
described in the <a class="link" href="search-aggregations-bucket-terms-aggregation.html" title="Terms Aggregation">terms aggregation</a> documentation.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_execution_hint"></a>Execution hint<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/significantterms-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>There are different mechanisms by which terms aggregations can be executed:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
by using field values directly in order to aggregate data per-bucket (<code class="literal">map</code>)
</li><li class="listitem">
by using ordinals of the field and preemptively allocating one bucket per ordinal value (<code class="literal">global_ordinals</code>)
</li><li class="listitem">
by using ordinals of the field and dynamically allocating one bucket per ordinal value (<code class="literal">global_ordinals_hash</code>)
</li></ul></div><p>Elasticsearch tries to have sensible defaults so this is something that generally doesn’t need to be configured.</p><p><code class="literal">map</code> should only be considered when very few documents match a query. Otherwise the ordinals-based execution modes
are significantly faster. By default, <code class="literal">map</code> is only used when running an aggregation on scripts, since they don’t have
ordinals.</p><p><code class="literal">global_ordinals</code> is the second fastest option, but the fact that it preemptively allocates buckets can be memory-intensive,
especially if you have one or more sub aggregations. It is used by default on top-level terms aggregations.</p><p><code class="literal">global_ordinals_hash</code> on the contrary to <code class="literal">global_ordinals</code> and <code class="literal">global_ordinals_low_cardinality</code> allocates buckets dynamically
so memory usage is linear to the number of values of the documents that are part of the aggregation scope. It is used by default
in inner aggregations.</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "tags" : {
             "significant_terms" : {
                 "field" : "tags",
                 "execution_hint": "map" <a id="CO35-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
             }
         }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO35-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
the possible values are <code class="literal">map</code>, <code class="literal">global_ordinals</code> and <code class="literal">global_ordinals_hash</code>
</p></td></tr></tbody></table></div><p>Please note that Elasticsearch will ignore this execution hint if it is not applicable.</p></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-bucket-terms-aggregation.html">
              «&nbsp;
              Terms Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-range-aggregation.html">Range Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Range Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-bucket-significantterms-aggregation.html">
              «&nbsp;
              Significant Terms Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-daterange-aggregation.html">Date Range Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-range-aggregation"></a>Range Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/range-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A multi-bucket value source based aggregation that enables the user to define a set of ranges - each representing a bucket. During the aggregation process, the values extracted from each document will be checked against each bucket range and "bucket" the relevant/matching document.
Note that this aggregration includes the <code class="literal">from</code> value and excludes the <code class="literal">to</code> value for each range.</p><p>Example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "field" : "price",
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 50, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations": {
        "price_ranges" : {
            "buckets": [
                {
                    "to": 50,
                    "doc_count": 2
                },
                {
                    "from": 50,
                    "to": 100,
                    "doc_count": 4
                },
                {
                    "from": 100,
                    "doc_count": 4
                }
            ]
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_keyed_response"></a>Keyed Response<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/range-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Setting the <code class="literal">keyed</code> flag to <code class="literal">true</code> will associate a unique string key with each bucket and return the ranges as a hash rather than an array:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "field" : "price",
                "keyed" : true,
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 50, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations": {
        "price_ranges" : {
            "buckets": {
                "*-50.0": {
                    "to": 50,
                    "doc_count": 2
                },
                "50.0-100.0": {
                    "from": 50,
                    "to": 100,
                    "doc_count": 4
                },
                "100.0-*": {
                    "from": 100,
                    "doc_count": 4
                }
            }
        }
    }
}</pre></div><p>It is also possible to customize the key for each range:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "field" : "price",
                "keyed" : true,
                "ranges" : [
                    { "key" : "cheap", "to" : 50 },
                    { "key" : "average", "from" : 50, "to" : 100 },
                    { "key" : "expensive", "from" : 100 }
                ]
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_11"></a>Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/range-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p>The <code class="literal">script</code> parameter expects an inline script. Use <code class="literal">script_id</code> for indexed scripts and <code class="literal">script_file</code> for scripts in the <code class="literal">config/scripts/</code> directory.</p></div></div><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "script" : "doc['price'].value",
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 50, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_value_script_8"></a>Value Script<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/range-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Lets say the product prices are in USD but we would like to get the price ranges in EURO. We can use value script to convert the prices prior the aggregation (assuming conversion rate of 0.8)</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "field" : "price",
                "script" : "_value * conversion_rate",
                "params" : {
                    "conversion_rate" : 0.8
                },
                "ranges" : [
                    { "to" : 35 },
                    { "from" : 35, "to" : 70 },
                    { "from" : 70 }
                ]
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_sub_aggregations"></a>Sub Aggregations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/range-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The following example, not only "bucket" the documents to the different buckets but also computes statistics over the prices in each price range</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "field" : "price",
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 50, "to" : 100 },
                    { "from" : 100 }
                ]
            },
            "aggs" : {
                "price_stats" : {
                    "stats" : { "field" : "price" }
                }
            }
        }
    }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggregations": {
        "price_ranges" : {
            "buckets": [
                {
                    "to": 50,
                    "doc_count": 2,
                    "price_stats": {
                        "count": 2,
                        "min": 20,
                        "max": 47,
                        "avg": 33.5,
                        "sum": 67
                    }
                },
                {
                    "from": 50,
                    "to": 100,
                    "doc_count": 4,
                    "price_stats": {
                        "count": 4,
                        "min": 60,
                        "max": 98,
                        "avg": 82.5,
                        "sum": 330
                    }
                },
                {
                    "from": 100,
                    "doc_count": 4,
                    "price_stats": {
                        "count": 4,
                        "min": 134,
                        "max": 367,
                        "avg": 216,
                        "sum": 864
                    }
                }
            ]
        }
    }
}</pre></div><p>If a sub aggregation is also based on the same value source as the range aggregation (like the <code class="literal">stats</code> aggregation in the example above) it is possible to leave out the value source definition for it. The following will return the same response as above:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "price_ranges" : {
            "range" : {
                "field" : "price",
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 50, "to" : 100 },
                    { "from" : 100 }
                ]
            },
            "aggs" : {
                "price_stats" : {
                    "stats" : {} <a id="CO36-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
                }
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO36-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
We don’t need to specify the <code class="literal">price</code> as we "inherit" it by default from the parent <code class="literal">range</code> aggregation
</p></td></tr></tbody></table></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-bucket-significantterms-aggregation.html">
              «&nbsp;
              Significant Terms Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-daterange-aggregation.html">Date Range Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Date Range Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-bucket-range-aggregation.html">
              «&nbsp;
              Range Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-iprange-aggregation.html">IPv4 Range Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-daterange-aggregation"></a>Date Range Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/daterange-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A range aggregation that is dedicated for date values. The main difference between this aggregation and the normal <a class="link" href="search-aggregations-bucket-range-aggregation.html" title="Range Aggregation">range</a> aggregation is that the <code class="literal">from</code> and <code class="literal">to</code> values can be expressed in <a class="link" href="mapping-date-format.html#date-math" title="Date Mathedit">Date Math</a> expressions, and it is also possible to specify a date format by which the <code class="literal">from</code> and <code class="literal">to</code> response fields will be returned.
Note that this aggregation includes the <code class="literal">from</code> value and excludes the <code class="literal">to</code> value for each range.</p><p>Example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs": {
        "range": {
            "date_range": {
                "field": "date",
                "format": "MM-yyy",
                "ranges": [
                    { "to": "now-10M/M" }, <a id="CO37-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
                    { "from": "now-10M/M" } <a id="CO37-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
                ]
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO37-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
&lt; now minus 10 months, rounded down to the start of the month.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO37-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
&gt;= now minus 10 months, rounded down to the start of the month.
</p></td></tr></tbody></table></div><p>In the example above, we created two range buckets, the first will "bucket" all documents dated prior to 10 months ago and
the second will "bucket" all documents dated since 10 months ago</p><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations": {
        "range": {
            "buckets": [
                {
                    "to": 1.3437792E+12,
                    "to_as_string": "08-2012",
                    "doc_count": 7
                },
                {
                    "from": 1.3437792E+12,
                    "from_as_string": "08-2012",
                    "doc_count": 2
                }
            ]
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="date-format-pattern"></a>Date Format/Pattern<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/daterange-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>this information was copied from <a class="ulink" href="http://www.joda.org/joda-time/apidocs/org/joda/time/format/DateTimeFormat.html" target="_top">JodaDate</a></p></div></div><p>All ASCII letters are reserved as format pattern letters, which are defined as follows:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"><col class="col_4"></colgroup><thead><tr><th class="entry" align="left" valign="top">Symbol </th><th class="entry" align="left" valign="top">Meaning                </th><th class="entry" align="left" valign="top">Presentation       </th><th class="entry" align="left" valign="top">Examples</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p>G</p></td><td class="entry" align="left" valign="top"><p>era</p></td><td class="entry" align="left" valign="top"><p>text</p></td><td class="entry" align="left" valign="top"><p>AD</p></td></tr><tr><td class="entry" align="left" valign="top"><p>C</p></td><td class="entry" align="left" valign="top"><p>century of era (&gt;=0)</p></td><td class="entry" align="left" valign="top"><p>number</p></td><td class="entry" align="left" valign="top"><p>20</p></td></tr><tr><td class="entry" align="left" valign="top"><p>Y</p></td><td class="entry" align="left" valign="top"><p>year of era (&gt;=0)</p></td><td class="entry" align="left" valign="top"><p>year</p></td><td class="entry" align="left" valign="top"><p>1996</p></td></tr><tr><td class="entry" align="left" valign="top"><p>x</p></td><td class="entry" align="left" valign="top"><p>weekyear</p></td><td class="entry" align="left" valign="top"><p>year</p></td><td class="entry" align="left" valign="top"><p>1996</p></td></tr><tr><td class="entry" align="left" valign="top"><p>w</p></td><td class="entry" align="left" valign="top"><p>week of weekyear</p></td><td class="entry" align="left" valign="top"><p>number</p></td><td class="entry" align="left" valign="top"><p>27</p></td></tr><tr><td class="entry" align="left" valign="top"><p>e</p></td><td class="entry" align="left" valign="top"><p>day of week</p></td><td class="entry" align="left" valign="top"><p>number</p></td><td class="entry" align="left" valign="top"><p>2</p></td></tr><tr><td class="entry" align="left" valign="top"><p>E</p></td><td class="entry" align="left" valign="top"><p>day of week</p></td><td class="entry" align="left" valign="top"><p>text</p></td><td class="entry" align="left" valign="top"><p>Tuesday; Tue</p></td></tr><tr><td class="entry" align="left" valign="top"><p>y</p></td><td class="entry" align="left" valign="top"><p>year</p></td><td class="entry" align="left" valign="top"><p>year</p></td><td class="entry" align="left" valign="top"><p>1996</p></td></tr><tr><td class="entry" align="left" valign="top"><p>D</p></td><td class="entry" align="left" valign="top"><p>day of year</p></td><td class="entry" align="left" valign="top"><p>number</p></td><td class="entry" align="left" valign="top"><p>189</p></td></tr><tr><td class="entry" align="left" valign="top"><p>M</p></td><td class="entry" align="left" valign="top"><p>month of year</p></td><td class="entry" align="left" valign="top"><p>month</p></td><td class="entry" align="left" valign="top"><p>July; Jul; 07</p></td></tr><tr><td class="entry" align="left" valign="top"><p>d</p></td><td class="entry" align="left" valign="top"><p>day of month</p></td><td class="entry" align="left" valign="top"><p>number</p></td><td class="entry" align="left" valign="top"><p>10</p></td></tr><tr><td class="entry" align="left" valign="top"><p>a</p></td><td class="entry" align="left" valign="top"><p>halfday of day</p></td><td class="entry" align="left" valign="top"><p>text</p></td><td class="entry" align="left" valign="top"><p>PM</p></td></tr><tr><td class="entry" align="left" valign="top"><p>K</p></td><td class="entry" align="left" valign="top"><p>hour of halfday (0~11)</p></td><td class="entry" align="left" valign="top"><p>number</p></td><td class="entry" align="left" valign="top"><p>0</p></td></tr><tr><td class="entry" align="left" valign="top"><p>h</p></td><td class="entry" align="left" valign="top"><p>clockhour of halfday (1~12)</p></td><td class="entry" align="left" valign="top"><p>number</p></td><td class="entry" align="left" valign="top"><p>12</p></td></tr><tr><td class="entry" align="left" valign="top"><p>H</p></td><td class="entry" align="left" valign="top"><p>hour of day (0~23)</p></td><td class="entry" align="left" valign="top"><p>number</p></td><td class="entry" align="left" valign="top"><p>0</p></td></tr><tr><td class="entry" align="left" valign="top"><p>k</p></td><td class="entry" align="left" valign="top"><p>clockhour of day (1~24)</p></td><td class="entry" align="left" valign="top"><p>number</p></td><td class="entry" align="left" valign="top"><p>24</p></td></tr><tr><td class="entry" align="left" valign="top"><p>m</p></td><td class="entry" align="left" valign="top"><p>minute of hour</p></td><td class="entry" align="left" valign="top"><p>number</p></td><td class="entry" align="left" valign="top"><p>30</p></td></tr><tr><td class="entry" align="left" valign="top"><p>s</p></td><td class="entry" align="left" valign="top"><p>second of minute</p></td><td class="entry" align="left" valign="top"><p>number</p></td><td class="entry" align="left" valign="top"><p>55</p></td></tr><tr><td class="entry" align="left" valign="top"><p>S</p></td><td class="entry" align="left" valign="top"><p>fraction of second</p></td><td class="entry" align="left" valign="top"><p>number</p></td><td class="entry" align="left" valign="top"><p>978</p></td></tr><tr><td class="entry" align="left" valign="top"><p>z</p></td><td class="entry" align="left" valign="top"><p>time zone</p></td><td class="entry" align="left" valign="top"><p>text</p></td><td class="entry" align="left" valign="top"><p>Pacific Standard Time; PST</p></td></tr><tr><td class="entry" align="left" valign="top"><p>Z</p></td><td class="entry" align="left" valign="top"><p>time zone offset/id</p></td><td class="entry" align="left" valign="top"><p>zone</p></td><td class="entry" align="left" valign="top"><p>-0800; -08:00; America/Los_Angeles</p></td></tr><tr><td class="entry" align="left" valign="top"><p>'</p></td><td class="entry" align="left" valign="top"><p>escape for text</p></td><td class="entry" align="left" valign="top"><p>delimiter</p></td><td class="entry" align="left" valign="top"><p>''</p></td></tr></tbody></table></div><p>The count of pattern letters determine the format.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Text
</span></dt><dd>
If the number of pattern letters is 4 or more, the full form is used; otherwise a short or abbreviated form is used if available.
</dd><dt><span class="term">
Number
</span></dt><dd>
The minimum number of digits. Shorter numbers are zero-padded to this amount.
</dd><dt><span class="term">
Year
</span></dt><dd>
Numeric presentation for year and weekyear fields are handled specially. For example, if the count of <span class="emphasis"><em>y</em></span> is 2, the year will be displayed as the zero-based year of the century, which is two digits.
</dd><dt><span class="term">
Month
</span></dt><dd>
3 or over, use text, otherwise use number.
</dd><dt><span class="term">
Zone
</span></dt><dd>
<span class="emphasis"><em>Z</em></span> outputs offset without a colon, <span class="emphasis"><em>ZZ</em></span> outputs the offset with a colon, <span class="emphasis"><em>ZZZ</em></span> or more outputs the zone id.
</dd><dt><span class="term">
Zone names
</span></dt><dd>
Time zone names (<span class="emphasis"><em>z</em></span>) cannot be parsed.
</dd></dl></div><p>Any characters in the pattern that are not in the ranges of [<span class="emphasis"><em>a</em></span>..<span class="emphasis"><em>z</em></span>] and [<span class="emphasis"><em>A</em></span>..<span class="emphasis"><em>Z</em></span>] will be treated as quoted text. For instance, characters like <span class="emphasis"><em>:</em></span>, <span class="emphasis"><em>.</em></span>, ' <span class="emphasis"><em>, '#</em></span> and <span class="emphasis"><em>?</em></span> will appear in the resulting time text even they are not embraced within single quotes.</p></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-bucket-range-aggregation.html">
              «&nbsp;
              Range Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-iprange-aggregation.html">IPv4 Range Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">IPv4 Range Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-bucket-daterange-aggregation.html">
              «&nbsp;
              Date Range Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-histogram-aggregation.html">Histogram Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-iprange-aggregation"></a>IPv4 Range Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/iprange-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Just like the dedicated <a class="link" href="search-aggregations-bucket-daterange-aggregation.html" title="Date Range Aggregation">date</a> range aggregation, there is also a dedicated range aggregation for IPv4 typed fields:</p><p>Example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "ip_ranges" : {
            "ip_range" : {
                "field" : "ip",
                "ranges" : [
                    { "to" : "10.0.0.5" },
                    { "from" : "10.0.0.5" }
                ]
            }
        }
    }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...

    "aggregations": {
        "ip_ranges": {
            "buckets" : [
                {
                    "to": 167772165,
                    "to_as_string": "10.0.0.5",
                    "doc_count": 4
                },
                {
                    "from": 167772165,
                    "from_as_string": "10.0.0.5",
                    "doc_count": 6
                }
            ]
        }
    }
}</pre></div><p>IP ranges can also be defined as CIDR masks:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "ip_ranges" : {
            "ip_range" : {
                "field" : "ip",
                "ranges" : [
                    { "mask" : "10.0.0.0/25" },
                    { "mask" : "10.0.0.127/25" }
                ]
            }
        }
    }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggregations": {
        "ip_ranges": {
            "buckets": [
                {
                    "key": "10.0.0.0/25",
                    "from": 1.6777216E+8,
                    "from_as_string": "10.0.0.0",
                    "to": 167772287,
                    "to_as_string": "10.0.0.127",
                    "doc_count": 127
                },
                {
                    "key": "10.0.0.127/25",
                    "from": 1.6777216E+8,
                    "from_as_string": "10.0.0.0",
                    "to": 167772287,
                    "to_as_string": "10.0.0.127",
                    "doc_count": 127
                }
            ]
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-bucket-daterange-aggregation.html">
              «&nbsp;
              Date Range Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-histogram-aggregation.html">Histogram Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Histogram Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-bucket-iprange-aggregation.html">
              «&nbsp;
              IPv4 Range Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-datehistogram-aggregation.html">Date Histogram Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-histogram-aggregation"></a>Histogram Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/histogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A multi-bucket values source based aggregation that can be applied on numeric values extracted from the documents.
It dynamically builds fixed size (a.k.a. interval) buckets over the values. For example, if the documents have a field
that holds a price (numeric), we can configure this aggregation to dynamically build buckets with interval <code class="literal">5</code>
(in case of price it may represent $5). When the aggregation executes, the price field of every document will be
evaluated and will be rounded down to its closest bucket - for example, if the price is <code class="literal">32</code> and the bucket size is <code class="literal">5</code>
then the rounding will yield <code class="literal">30</code> and thus the document will "fall" into the bucket that is associated withe the key <code class="literal">30</code>.
To make this more formal, here is the rounding function that is used:</p><div class="pre_wrapper"><pre class="programlisting">rem = value % interval
if (rem &lt; 0) {
    rem += interval
}
bucket_key = value - rem</pre></div><p>From the rounding function above it can be seen that the intervals themselves <span class="strong emphasis"><strong>must</strong></span> be integers.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Currently, values are cast to integers before being bucketed, which
might cause negative floating-point values to fall into the wrong bucket. For
instance, <code class="literal">-4.5</code> with an interval of <code class="literal">2</code> would be cast to <code class="literal">-4</code>, and so would
end up in the <code class="literal">-4 &lt;= val &lt; -2</code> bucket instead of the <code class="literal">-6 &lt;= val &lt; -4</code> bucket.</p></div></div><p>The following snippet "buckets" the products based on their <code class="literal">price</code> by interval of <code class="literal">50</code>:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50
            }
        }
    }
}</pre></div><p>And the following may be the response:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggregations": {
        "prices" : {
            "buckets": [
                {
                    "key": 0,
                    "doc_count": 2
                },
                {
                    "key": 50,
                    "doc_count": 4
                },
                {
                    "key": 150,
                    "doc_count": 3
                }
            ]
        }
    }
}</pre></div><p>The response above shows that none of the aggregated products has a price that falls within the range of <code class="literal">[100 - 150)</code>.
By default, the response will only contain those buckets with a <code class="literal">doc_count</code> greater than 0. It is possible change that
and request buckets with either a higher minimum count or even 0 (in which case elasticsearch will "fill in the gaps"
and create buckets with zero documents). This can be configured using the <code class="literal">min_doc_count</code> setting:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "min_doc_count" : 0
            }
        }
    }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggregations": {
        "prices" : {
            "buckets": [
                {
                    "key": 0,
                    "doc_count": 2
                },
                {
                    "key": 50,
                    "doc_count": 4
                },
                {
                    "key" : 100,
                    "doc_count" : 0 <a id="CO38-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
                },
                {
                    "key": 150,
                    "doc_count": 3
                }
            ]
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO38-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
No documents were found that belong in this bucket, yet it is still returned with zero <code class="literal">doc_count</code>.
</p></td></tr></tbody></table></div><p><a id="search-aggregations-bucket-histogram-aggregation-extended-bounds"></a>By default the date_/histogram returns all the buckets within the range of the data itself, that is, the documents with
the smallest values (on which with histogram) will determine the min bucket (the bucket with the smallest key) and the
documents with the highest values will determine the max bucket (the bucket with the highest key). Often, when
requesting empty buckets (<code class="literal">"min_doc_count" : 0</code>), this causes a confusion, specifically, when the data is also filtered.</p><p>To understand why, let’s look at an example:</p><p>Lets say the you’re filtering your request to get all docs with values between <code class="literal">0</code> and <code class="literal">500</code>, in addition you’d like
to slice the data per price using a histogram with an interval of <code class="literal">50</code>. You also specify <code class="literal">"min_doc_count" : 0</code> as you’d
like to get all buckets even the empty ones. If it happens that all products (documents) have prices higher than <code class="literal">100</code>,
the first bucket you’ll get will be the one with <code class="literal">100</code> as its key. This is confusing, as many times, you’d also like
to get those buckets between <code class="literal">0 - 100</code>.</p><p>With <code class="literal">extended_bounds</code> setting, you now can "force" the histogram aggregation to start building buckets on a specific
<code class="literal">min</code> values and also keep on building buckets up to a <code class="literal">max</code> value (even if there are no documents anymore). Using
<code class="literal">extended_bounds</code> only makes sense when <code class="literal">min_doc_count</code> is 0 (the empty buckets will never be returned if <code class="literal">min_doc_count</code>
is greater than 0).</p><p>Note that (as the name suggest) <code class="literal">extended_bounds</code> is <span class="strong emphasis"><strong>not</strong></span> filtering buckets. Meaning, if the <code class="literal">extended_bounds.min</code> is higher
than the values extracted from the documents, the documents will still dictate what the first bucket will be (and the
same goes for the <code class="literal">extended_bounds.max</code> and the last bucket). For filtering buckets, one should nest the histogram aggregation
under a range <code class="literal">filter</code> aggregation with the appropriate <code class="literal">from</code>/<code class="literal">to</code> settings.</p><p>Example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "filtered" : { "filter": { "range" : { "price" : { "to" : "500" } } } }
    },
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "min_doc_count" : 0,
                "extended_bounds" : {
                    "min" : 0,
                    "max" : 500
                }
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_order"></a>Order<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/histogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>By default the returned buckets are sorted by their <code class="literal">key</code> ascending, though the order behaviour can be controlled
using the <code class="literal">order</code> setting.</p><p>Ordering the buckets by their key - descending:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "order" : { "_key" : "desc" }
            }
        }
    }
}</pre></div><p>Ordering the buckets by their <code class="literal">doc_count</code> - ascending:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "order" : { "_count" : "asc" }
            }
        }
    }
}</pre></div><p>If the histogram aggregation has a direct metrics sub-aggregation, the latter can determine the order of the buckets:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "order" : { "price_stats.min" : "asc" } <a id="CO39-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
            },
            "aggs" : {
                "price_stats" : { "stats" : {} } <a id="CO39-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO39-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">{ "price_stats.min" : asc" }</code> will sort the buckets based on <code class="literal">min</code> value of their <code class="literal">price_stats</code> sub-aggregation.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO39-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
There is no need to configure the <code class="literal">price</code> field for the <code class="literal">price_stats</code> aggregation as it will inherit it by default from its parent histogram aggregation.
</p></td></tr></tbody></table></div><p>It is also possible to order the buckets based on a "deeper" aggregation in the hierarchy. This is supported as long
as the aggregations path are of a single-bucket type, where the last aggregation in the path may either by a single-bucket
one or a metrics one. If it’s a single-bucket type, the order will be defined by the number of docs in the bucket (i.e. <code class="literal">doc_count</code>),
in case it’s a metrics one, the same rules as above apply (where the path must indicate the metric name to sort by in case of
a multi-value metrics aggregation, and in case of a single-value metrics aggregation the sort will be applied on that value).</p><p>The path must be defined in the following form:</p><pre class="screen">AGG_SEPARATOR       :=  '&gt;'
METRIC_SEPARATOR    :=  '.'
AGG_NAME            :=  &lt;the name of the aggregation&gt;
METRIC              :=  &lt;the name of the metric (in case of multi-value metrics aggregation)&gt;
PATH                :=  &lt;AGG_NAME&gt;[&lt;AGG_SEPARATOR&gt;&lt;AGG_NAME&gt;]*[&lt;METRIC_SEPARATOR&gt;&lt;METRIC&gt;]</pre><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "order" : { "promoted_products&gt;rating_stats.avg" : "desc" } <a id="CO40-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
            },
            "aggs" : {
                "promoted_products" : {
                    "filter" : { "term" : { "promoted" : true }},
                    "aggs" : {
                        "rating_stats" : { "stats" : { "field" : "rating" }}
                    }
                }
            }
        }
    }
}</pre></div><p>The above will sort the buckets based on the avg rating among the promoted products</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_minimum_document_count_3"></a>Minimum document count<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/histogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>It is possible to only return buckets that have a document count that is greater than or equal to a configured
limit through the <code class="literal">min_doc_count</code> option.</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "min_doc_count": 10
            }
        }
    }
}</pre></div><p>The above aggregation would only return buckets that contain 10 documents or more. Default value is <code class="literal">1</code>.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The special value <code class="literal">0</code> can be used to add empty buckets to the response between the minimum and the maximum buckets.
Here is an example of what the response could look like:</p></div></div><div class="pre_wrapper"><pre class="programlisting">{
    "aggregations": {
        "prices": {
            "buckets": {
                "0": {
                    "key": 0,
                    "doc_count": 2
                },
                "50": {
                    "key": 50,
                    "doc_count": 0
                },
                "150": {
                    "key": 150,
                    "doc_count": 3
                },
                "200": {
                    "key": 150,
                    "doc_count": 0
                },
                "250": {
                    "key": 150,
                    "doc_count": 0
                },
                "300": {
                    "key": 150,
                    "doc_count": 1
                }
            }
        }
   }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_response_format"></a>Response Format<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/histogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>By default, the buckets are returned as an ordered array. It is also possible to request the response as a hash
instead keyed by the buckets keys:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "prices" : {
            "histogram" : {
                "field" : "price",
                "interval" : 50,
                "keyed" : true
            }
        }
    }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggregations": {
        "prices": {
            "buckets": {
                "0": {
                    "key": 0,
                    "doc_count": 2
                },
                "50": {
                    "key": 50,
                    "doc_count": 4
                },
                "150": {
                    "key": 150,
                    "doc_count": 3
                }
            }
        }
    }
}</pre></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-bucket-iprange-aggregation.html">
              «&nbsp;
              IPv4 Range Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-datehistogram-aggregation.html">Date Histogram Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Date Histogram Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-bucket-histogram-aggregation.html">
              «&nbsp;
              Histogram Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-geodistance-aggregation.html">Geo Distance Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-datehistogram-aggregation"></a>Date Histogram Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/datehistogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A multi-bucket aggregation similar to the <a class="link" href="search-aggregations-bucket-histogram-aggregation.html" title="Histogram Aggregation">histogram</a> except it can
only be applied on date values. Since dates are represented in elasticsearch internally as long values, it is possible
to use the normal <code class="literal">histogram</code> on dates as well, though accuracy will be compromised. The reason for this is in the fact
that time based intervals are not fixed (think of leap years and on the number of days in a month). For this reason,
we need special support for time based data. From a functionality perspective, this histogram supports the same features
as the normal <a class="link" href="search-aggregations-bucket-histogram-aggregation.html" title="Histogram Aggregation">histogram</a>. The main difference is that the interval can be specified by date/time expressions.</p><p>Requesting bucket intervals of a month.</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "articles_over_time" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "month"
            }
        }
    }
}</pre></div><p>Available expressions for interval: <code class="literal">year</code>, <code class="literal">quarter</code>, <code class="literal">month</code>, <code class="literal">week</code>, <code class="literal">day</code>, <code class="literal">hour</code>, <code class="literal">minute</code>, <code class="literal">second</code></p><p>Fractional values are allowed for seconds, minutes, hours, days and weeks. For example 1.5 hours:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "articles_over_time" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "1.5h"
            }
        }
    }
}</pre></div><p>See <a class="xref" href="common-options.html#time-units" title="Time unitsedit">the section called “Time units</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>” for accepted abbreviations.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_time_zone"></a>Time Zone<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/datehistogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>By default, times are stored as UTC milliseconds since the epoch. Thus, all computation and "bucketing" / "rounding" is
done on UTC. It is possible to provide a time zone value, which will cause all computations to take the relevant zone
into account. The time returned for each bucket/entry is milliseconds since the epoch of the provided time zone.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><h3>Deprecated in 1.5.0. </h3>
 pre_zone, post_zone are replaced by time_zone
</div></div><p>The parameters are <code class="literal">pre_zone</code> (pre rounding based on interval) and <code class="literal">post_zone</code> (post rounding based on interval). The
<code class="literal">time_zone</code> parameter simply sets the <code class="literal">pre_zone</code> parameter. By default, those are set to <code class="literal">UTC</code>.</p><p>The zone value accepts either a numeric value for the hours offset, for example: <code class="literal">"time_zone" : -2</code>. It also accepts a
format of hours and minutes, like <code class="literal">"time_zone" : "-02:30"</code>. Another option is to provide a time zone accepted as one of
the values listed here.</p><p>Lets take an example. For <code class="literal">2012-04-01T04:15:30Z</code>, with a <code class="literal">pre_zone</code> of <code class="literal">-08:00</code>. For day interval, the actual time by
applying the time zone and rounding falls under <code class="literal">2012-03-31</code>, so the returned value will be (in millis) of
<code class="literal">2012-03-31T00:00:00Z</code> (UTC). For hour interval, applying the time zone results in <code class="literal">2012-03-31T20:15:30</code>, rounding it
results in <code class="literal">2012-03-31T20:00:00</code>, but, we want to return it in UTC (<code class="literal">post_zone</code> is not set), so we convert it back to
UTC: <code class="literal">2012-04-01T04:00:00Z</code>. Note, we are consistent in the results, returning the rounded value in UTC.</p><p><code class="literal">post_zone</code> simply takes the result, and adds the relevant offset.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><h3>Deprecated in 1.5.0. </h3>
 pre_zone_adjust_large_interval will be removed
</div></div><p>Sometimes, we want to apply the same conversion to UTC we did above for hour also for day (and up) intervals. We can
set <code class="literal">pre_zone_adjust_large_interval</code> to <code class="literal">true</code>, which will apply the same conversion done for hour interval in the
example, to day and above intervals (it can be set regardless of the interval, but only kick in when using day and
higher intervals).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_offset"></a>Offset<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/datehistogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">offset</code> option can be provided for shifting the date bucket intervals boundaries after any other shifts because of
time zones are applies. This for example makes it possible that daily buckets go from 6AM to 6AM the next day instead of starting at 12AM
or that monthly buckets go from the 10th of the month to the 10th of the next month instead of the 1st.</p><p>The <code class="literal">offset</code> option accepts positive or negative time durations like "1h" for an hour or "1M" for a Month. See <a class="xref" href="common-options.html#time-units" title="Time unitsedit">the section called “Time units</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>” for more
possible time duration options.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><h3>Deprecated in 1.5.0. </h3>
 pre_offset and post_offset are deprecated and replaced by offset
</div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_keys"></a>Keys<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/datehistogram-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Since internally, dates are represented as 64bit numbers, these numbers are returned as the bucket keys (each key
representing a date - milliseconds since the epoch). It is also possible to define a date format, which will result in
returning the dates as formatted strings next to the numeric key values:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "articles_over_time" : {
            "date_histogram" : {
                "field" : "date",
                "interval" : "1M",
                "format" : "yyyy-MM-dd" <a id="CO40-2"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO40-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> <a href="#CO40-2"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Supports expressive date <a class="link" href="search-aggregations-bucket-daterange-aggregation.html#date-format-pattern" title="Date Format/Pattern">format pattern</a>
</p></td></tr></tbody></table></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggregations": {
        "articles_over_time": {
            "buckets": [
                {
                    "key_as_string": "2013-02-02",
                    "key": 1328140800000,
                    "doc_count": 1
                },
                {
                    "key_as_string": "2013-03-02",
                    "key": 1330646400000,
                    "doc_count": 2
                },
                ...
            ]
        }
    }
}</pre></div><p>Like with the normal <a class="link" href="search-aggregations-bucket-histogram-aggregation.html" title="Histogram Aggregation">histogram</a>, both document level scripts and
value level scripts are supported. It is also possible to control the order of the returned buckets using the <code class="literal">order</code>
settings and filter the returned buckets based on a <code class="literal">min_doc_count</code> setting (by default all buckets with
<code class="literal">min_doc_count &gt; 0</code> will be returned). This histogram also supports the <code class="literal">extended_bounds</code> setting, which enables extending
the bounds of the histogram beyond the data itself (to read more on why you’d want to do that please refer to the
explanation <a class="link" href="search-aggregations-bucket-histogram-aggregation.html#search-aggregations-bucket-histogram-aggregation-extended-bounds">here</a>).</p></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-bucket-histogram-aggregation.html">
              «&nbsp;
              Histogram Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-geodistance-aggregation.html">Geo Distance Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">Geo Distance Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-bucket-datehistogram-aggregation.html">
              «&nbsp;
              Date Histogram Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-geohashgrid-aggregation.html">GeoHash grid Aggregation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-geodistance-aggregation"></a>Geo Distance Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/geodistance-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A multi-bucket aggregation that works on <code class="literal">geo_point</code> fields and conceptually works very similar to the <a class="link" href="search-aggregations-bucket-range-aggregation.html" title="Range Aggregation">range</a> aggregation. The user can define a point of origin and a set of distance range buckets. The aggregation evaluate the distance of each document value from the origin point and determines the buckets it belongs to based on the ranges (a document belongs to a bucket if the distance between the document and the origin falls within the distance range of the bucket).</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "rings_around_amsterdam" : {
            "geo_distance" : {
                "field" : "location",
                "origin" : "52.3760, 4.894",
                "ranges" : [
                    { "to" : 100 },
                    { "from" : 100, "to" : 300 },
                    { "from" : 300 }
                ]
            }
        }
    }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggregations": {
        "rings" : {
            "buckets": [
                {
                    "key": "*-100.0",
                    "from": 0,
                    "to": 100.0,
                    "doc_count": 3
                },
                {
                    "key": "100.0-300.0",
                    "from": 100.0,
                    "to": 300.0,
                    "doc_count": 1
                },
                {
                    "key": "300.0-*",
                    "from": 300.0,
                    "doc_count": 7
                }
            ]
        }
    }
}</pre></div><p>The specified field must be of type <code class="literal">geo_point</code> (which can only be set explicitly in the mappings). And it can also hold an array of <code class="literal">geo_point</code> fields, in which case all will be taken into account during aggregation. The origin point can accept all formats supported by the <code class="literal">geo_point</code> <a class="link" href="mapping-geo-point-type.html" title="Geo Point Type">type</a>:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Object format: <code class="literal">{ "lat" : 52.3760, "lon" : 4.894 }</code> - this is the safest format as it is the most explicit about the <code class="literal">lat</code> &amp; <code class="literal">lon</code> values
</li><li class="listitem">
String format: <code class="literal">"52.3760, 4.894"</code> - where the first number is the <code class="literal">lat</code> and the second is the <code class="literal">lon</code>
</li><li class="listitem">
Array format: <code class="literal">[4.894, 52.3760]</code> - which is based on the <code class="literal">GeoJson</code> standard and where the first number is the <code class="literal">lon</code> and the second one is the <code class="literal">lat</code>
</li></ul></div><p>By default, the distance unit is <code class="literal">m</code> (metres) but it can also accept: <code class="literal">mi</code> (miles), <code class="literal">in</code> (inches), <code class="literal">yd</code> (yards), <code class="literal">km</code> (kilometers), <code class="literal">cm</code> (centimeters), <code class="literal">mm</code> (millimeters).</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "rings" : {
            "geo_distance" : {
                "field" : "location",
                "origin" : "52.3760, 4.894",
                "unit" : "mi", <a id="CO41-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
                "ranges" : [
                    { "to" : 100 },
                    { "from" : 100, "to" : 300 },
                    { "from" : 300 }
                ]
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO41-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The distances will be computed as miles
</p></td></tr></tbody></table></div><p>There are three distance calculation modes: <code class="literal">sloppy_arc</code> (the default), <code class="literal">arc</code> (most accurate) and <code class="literal">plane</code> (fastest). The <code class="literal">arc</code> calculation is the most accurate one but also the more expensive one in terms of performance. The <code class="literal">sloppy_arc</code> is faster but less accurate. The <code class="literal">plane</code> is the fastest but least accurate distance function. Consider using <code class="literal">plane</code> when your search context is "narrow" and spans smaller geographical areas (like cities or even countries). <code class="literal">plane</code> may return higher error mergins for searches across very large areas (e.g. cross continent search). The distance calculation type can be set using the <code class="literal">distance_type</code> parameter:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "rings" : {
            "geo_distance" : {
                "field" : "location",
                "origin" : "52.3760, 4.894",
                "distance_type" : "plane",
                "ranges" : [
                    { "to" : 100 },
                    { "from" : 100, "to" : 300 },
                    { "from" : 300 }
                ]
            }
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-bucket-datehistogram-aggregation.html">
              «&nbsp;
              Date Histogram Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-aggregations-bucket-geohashgrid-aggregation.html">GeoHash grid Aggregation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-aggregations.html">Aggregations</a></span> » <span class="breadcrumb-node">GeoHash grid Aggregation</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-bucket-geodistance-aggregation.html">
              «&nbsp;
              Geo Distance Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets.html">Facets
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-aggregations-bucket-geohashgrid-aggregation"></a>GeoHash grid Aggregation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/geohashgrid-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A multi-bucket aggregation that works on <code class="literal">geo_point</code> fields and groups points into buckets that represent cells in a grid.
The resulting grid can be sparse and only contains cells that have matching data. Each cell is labeled using a <a class="ulink" href="http://en.wikipedia.org/wiki/Geohash" target="_top">geohash</a> which is of user-definable precision.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
High precision geohashes have a long string length and represent cells that cover only a small area.
</li><li class="listitem">
Low precision geohashes have a short string length and represent cells that each cover a large area.
</li></ul></div><p>Geohashes used in this aggregation can have a choice of precision between 1 and 12.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>The highest-precision geohash of length 12 produces cells that cover less than a square metre of land and so high-precision requests can be very costly in terms of RAM and result sizes.
Please see the example below on how to first filter the aggregation to a smaller geographic area before requesting high-levels of detail.</p></div></div><p>The specified field must be of type <code class="literal">geo_point</code> (which can only be set explicitly in the mappings) and it can also hold an array of <code class="literal">geo_point</code> fields, in which case all points will be taken into account during aggregation.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_simple_low_precision_request"></a>Simple low-precision request<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/geohashgrid-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="pre_wrapper"><pre class="programlisting">{
    "aggregations" : {
        "myLarge-GrainGeoHashGrid" : {
            "geohash_grid" : {
                "field" : "location",
                "precision" : 3
            }
        }
    }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggregations": {
        "myLarge-GrainGeoHashGrid": {
            "buckets": [
                {
                    "key": "svz",
                    "doc_count": 10964
                },
                {
                    "key": "sv8",
                    "doc_count": 3198
                }
            ]
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_high_precision_requests"></a>High-precision requests<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/geohashgrid-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>When requesting detailed buckets (typically for displaying a "zoomed in" map) a filter like <a class="link" href="query-dsl-geo-bounding-box-filter.html" title="Geo Bounding Box Filter">geo_bounding_box</a> should be applied to narrow the subject area otherwise potentially millions of buckets will be created and returned.</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggregations" : {
        "zoomedInView" : {
            "filter" : {
                "geo_bounding_box" : {
                    "location" : {
                        "top_left" : "51.73, 0.9",
                        "bottom_right" : "51.55, 1.1"
                    }
                }
            },
            "aggregations":{
                "zoom1":{
                    "geohash_grid" : {
                        "field":"location",
                        "precision":8,
                    }
                }
            }
        }
    }
 }</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_cell_dimensions_at_the_equator"></a>Cell dimensions at the equator<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/geohashgrid-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The table below shows the metric dimensions for cells covered by various string lengths of geohash.
Cell dimensions vary with latitude and so the table is for the worst-case scenario at the equator.</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<span class="strong emphasis"><strong>GeoHash length</strong></span>
</p>
</td><td class="entry" valign="top">
<p>
<span class="strong emphasis"><strong>Area width x height</strong></span>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
1
</p>
</td><td class="entry" valign="top">
<p>
5,009.4km x 4,992.6km
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
2
</p>
</td><td class="entry" valign="top">
<p>
1,252.3km x 624.1km
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
3
</p>
</td><td class="entry" valign="top">
<p>
156.5km x 156km
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
4
</p>
</td><td class="entry" valign="top">
<p>
39.1km x 19.5km
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
5
</p>
</td><td class="entry" valign="top">
<p>
4.9km x 4.9km
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
6
</p>
</td><td class="entry" valign="top">
<p>
1.2km x 609.4m
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
7
</p>
</td><td class="entry" valign="top">
<p>
152.9m x 152.4m
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
8
</p>
</td><td class="entry" valign="top">
<p>
38.2m x 19m
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
9
</p>
</td><td class="entry" valign="top">
<p>
4.8m x 4.8m
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
10
</p>
</td><td class="entry" valign="top">
<p>
1.2m x 59.5cm
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
11
</p>
</td><td class="entry" valign="top">
<p>
14.9cm x 14.9cm
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
12
</p>
</td><td class="entry" valign="top">
<p>
3.7cm x 1.9cm
</p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_options_3"></a>Options<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/aggregations/bucket/geohashgrid-aggregation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
field
</p>
</td><td class="entry" valign="top">
<p>
Mandatory. The name of the field indexed with GeoPoints.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
precision
</p>
</td><td class="entry" valign="top">
<p>
Optional. The string length of the geohashes used to define
                cells/buckets in the results. Defaults to 5.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
size
</p>
</td><td class="entry" valign="top">
<p>
Optional. The maximum number of geohash buckets to return
                (defaults to 10,000). When results are trimmed, buckets are
                prioritised based on the volumes of documents they contain.
                A value of <code class="literal">0</code> will return all buckets that
                contain a hit, use with caution as this could use a lot of CPU
                and network bandwidth if there are many buckets.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
shard_size
</p>
</td><td class="entry" valign="top">
<p>
Optional. To allow for more accurate counting of the top cells
                returned in the final result the aggregation defaults to
                returning <code class="literal">max(10,(size x number-of-shards))</code> buckets from each
                shard. If this heuristic is undesirable, the number considered
                from each shard can be over-ridden using this parameter.
                A value of <code class="literal">0</code> makes the shard size unlimited.
</p>
</td></tr></tbody></table></div></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-bucket-geodistance-aggregation.html">
              «&nbsp;
              Geo Distance Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets.html">Facets
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-node">Facets</span></div><div class="navheader"><span class="prev"><a href="search-aggregations-bucket-geohashgrid-aggregation.html">
              «&nbsp;
              GeoHash grid Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-terms-facet.html">Terms Facet
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets"></a>Facets<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Facets are deprecated and will be removed in a future release. You are
encouraged to migrate to <a class="link" href="search-aggregations.html" title="Aggregations">aggregations</a> instead.</p></div></div><p>The usual purpose of a full-text search engine is to return a small
number of documents matching your query.</p><p><span class="emphasis"><em>Facets</em></span> provide aggregated data based on a search query. In the
simplest case, a
<a class="link" href="search-facets-terms-facet.html" title="Terms Facet">terms facet</a>
can return <span class="emphasis"><em>facet counts</em></span> for various <span class="emphasis"><em>facet values</em></span> for a specific
<span class="emphasis"><em>field</em></span>. Elasticsearch supports more facet implementations, such as
<a class="link" href="search-facets-statistical-facet.html" title="Statistical Facet">statistical</a>
or
<a class="link" href="search-facets-date-histogram-facet.html" title="Date Histogram Facet">date histogram</a> facets.</p><p>The field used for facet calculations <span class="emphasis"><em>must</em></span> be of type numeric,
date/time or be analyzed as a single token — see the
<a class="link" href="mapping.html" title="Mapping"><span class="emphasis"><em>Mapping</em></span></a> guide for details on the
analysis process.</p><p>You can give the facet a custom <span class="emphasis"><em>name</em></span> and return multiple facets in one
request.</p><p>Let’s try it out with a simple example. Suppose we have a number of
articles with a field called <code class="literal">tags</code>, preferably analyzed with the
<a class="link" href="analysis-keyword-analyzer.html" title="Keyword Analyzer">keyword</a>
analyzer. The facet aggregation will return counts for the most popular
tags across the documents matching your query — or across all documents
in the index.</p><p>We will store some example data first:</p><div class="pre_wrapper"><pre class="programlisting">curl -X DELETE "http://localhost:9200/articles"
curl -X POST "http://localhost:9200/articles/article" -d '{"title" : "One",   "tags" : ["foo"]}'
curl -X POST "http://localhost:9200/articles/article" -d '{"title" : "Two",   "tags" : ["foo", "bar"]}'
curl -X POST "http://localhost:9200/articles/article" -d '{"title" : "Three", "tags" : ["foo", "bar", "baz"]}'</pre></div><p>Now, let’s query the index for articles beginning with letter <code class="literal">T</code>
and retrieve a
<a class="link" href="search-facets-terms-facet.html" title="Terms Facet"><span class="emphasis"><em>terms facet</em></span></a>
for the <code class="literal">tags</code> field. We will name the facet simply: <span class="emphasis"><em>tags</em></span>.</p><div class="pre_wrapper"><pre class="programlisting">curl -X POST "http://localhost:9200/articles/_search?pretty=true" -d '
  {
    "query" : { "query_string" : {"query" : "T*"} },
    "facets" : {
      "tags" : { "terms" : {"field" : "tags"} }
    }
  }
'</pre></div><p>This request will return articles <code class="literal">Two</code> and <code class="literal">Three</code> (because
they match our query), as well as the <code class="literal">tags</code> facet:</p><div class="pre_wrapper"><pre class="programlisting">"facets" : {
  "tags" : {
    "_type" : "terms",
    "missing" : 0,
    "total": 5,
    "other": 0,
    "terms" : [ {
      "term" : "foo",
      "count" : 2
    }, {
      "term" : "bar",
      "count" : 2
    }, {
      "term" : "baz",
      "count" : 1
    } ]
  }
}</pre></div><p>In the <code class="literal">terms</code> array, relevant <span class="emphasis"><em>terms</em></span> and <span class="emphasis"><em>counts</em></span> are returned. You’ll
probably want to display these to your users. The facet returns several
important counts:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">missing</code> : The number of documents which have no value for the
faceted field
</li><li class="listitem">
<code class="literal">total</code> : The total number of terms in the facet
</li><li class="listitem">
<code class="literal">other</code> : The number of terms not included in the returned facet
(effectively <code class="literal">other</code> = <code class="literal">total</code> - <code class="literal">terms</code> )
</li></ul></div><p>Notice, that the counts are scoped to the current query: <span class="emphasis"><em>foo</em></span> is
counted only twice (not three times), <span class="emphasis"><em>bar</em></span> is counted twice and <span class="emphasis"><em>baz</em></span>
once. Also note that terms are counted once per document, even if the
occur more frequently in that document.</p><p>That’s because the primary purpose of facets is to enable
<a class="ulink" href="http://en.wikipedia.org/wiki/Faceted_search" target="_top"><span class="emphasis"><em>faceted navigation</em></span></a>,
allowing the user to refine her query based on the insight from the
facet, i.e. restrict the search to a specific category, price or date
range. Facets can be used, however, for other purposes: computing
histograms, statistical aggregations, and more. See the blog about
<a class="ulink" href="/blog/data-visualization-with-elasticsearch-and-protovis/" target="_top">data visualization</a> for inspiration.</p><h3><a id="_scope"></a>Scope<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>As we have already mentioned, facet computation is restricted to the
scope of the current query, called <code class="literal">main</code>, by default. Facets can be
computed within the <code class="literal">global</code> scope as well, in which case it will return
values computed across all documents in the index:</p><div class="pre_wrapper"><pre class="programlisting">{
    "facets" : {
        "my_facets" : {
            "terms" : { ... },
            "global" : true <a id="CO42-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO42-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">global</code> keyword can be used with any facet type.
</p></td></tr></tbody></table></div><p>There’s one <span class="strong emphasis"><strong>important distinction</strong></span> to keep in mind. While search
<span class="emphasis"><em>queries</em></span> restrict both the returned documents and facet counts, search
<span class="emphasis"><em>filters</em></span> restrict only returned documents — but <span class="emphasis"><em>not</em></span> facet counts.</p><p>If you need to restrict both the documents and facets, and you’re not
willing or able to use a query, you may use a <span class="emphasis"><em>facet filter</em></span>.</p><h3><a id="_facet_filter"></a>Facet Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>All facets can be configured with an additional filter (explained in the
<a class="link" href="query-dsl.html" title="Query DSL">Query DSL</a> section), which <span class="emphasis"><em>will</em></span> reduce
the documents they use for computing results. An example with a <span class="emphasis"><em>term</em></span>
filter:</p><div class="pre_wrapper"><pre class="programlisting">{
    "facets" : {
        "&lt;FACET NAME&gt;" : {
            "&lt;FACET TYPE&gt;" : {
                ...
            },
            "facet_filter" : {
                "term" : { "user" : "kimchy"}
            }
        }
    }
}</pre></div><p>Note that this is different from a facet of the
<a class="link" href="search-facets-filter-facet.html" title="Filter Facets">filter</a> type.</p><h3><a id="_facets_with_the_emphasis_nested_emphasis_types"></a>Facets with the <span class="emphasis"><em>nested</em></span> types<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p><a class="link" href="mapping-nested-type.html" title="Nested Type">Nested</a> mapping allows
for better support for "inner" documents faceting, especially when it
comes to multi valued key and value facets (like histograms, or term
stats).</p><p>What is it good for? First of all, this is the only way to use facets on
nested documents once they are used (possibly for other reasons). But,
there is also facet specific reason why nested documents can be used,
and that’s the fact that facets working on different key and value field
(like term_stats, or histogram) can now support cases where both are
multi valued properly.</p><p>For example, let’s use the following mapping:</p><div class="pre_wrapper"><pre class="programlisting">{
    "type1" : {
        "properties" : {
            "obj1" : {
                "type" : "nested"
            }
        }
    }
}</pre></div><p>And, here is a sample data:</p><div class="pre_wrapper"><pre class="programlisting">{
    "obj1" : [
        {
            "name" : "blue",
            "count" : 4
        },
        {
            "name" : "green",
            "count" : 6
        }
    ]
}</pre></div><h4><a id="_all_nested_matching_root_documents"></a>All Nested Matching Root Documents<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Another option is to run the facet on all the nested documents matching
the root objects that the main query will end up producing. For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query": {
        "match_all": {}
    },
    "facets": {
        "facet1": {
            "terms_stats": {
                "key_field" : "name",
                "value_field": "count"
            },
            "nested": "obj1"
        }
    }
}</pre></div><p>The <code class="literal">nested</code> element provides the path to the nested document (can be a
multi level nested docs) that will be used.</p><p>Facet filter allows you to filter your facet on the nested object level.
It is important that these filters match on the nested object level and
not on the root document level. In the following example the
<code class="literal">terms_stats</code> only applies on nested objects with the name <span class="emphasis"><em>blue</em></span>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "query": {
        "match_all": {}
    },
    "facets": {
        "facet1": {
            "terms_stats": {
                "key_field" : "name",
                "value_field": "count"
            },
            "nested": "obj1",
            "facet_filter" : {
                "term" : {"name" : "blue"}
            }
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="search-aggregations-bucket-geohashgrid-aggregation.html">
              «&nbsp;
              GeoHash grid Aggregation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-terms-facet.html">Terms Facet
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-facets.html">Facets</a></span> » <span class="breadcrumb-node">Terms Facet</span></div><div class="navheader"><span class="prev"><a href="search-facets.html">
              «&nbsp;
              Facets</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-range-facet.html">Range Facets
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-terms-facet"></a>Terms Facet<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/terms-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Facets are deprecated and will be removed in a future release. You are
encouraged to migrate to <a class="link" href="search-aggregations.html" title="Aggregations">aggregations</a> instead.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The equivalent aggregation would be the
<a class="link" href="search-aggregations-bucket-terms-aggregation.html" title="Terms Aggregation"><code class="literal">terms</code></a>
aggregation.</p></div></div><p>Allow to specify field facets that return the N most frequent terms. For
example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {  }
    },
    "facets" : {
        "tag" : {
            "terms" : {
                "field" : "tag",
                "size" : 10
            }
        }
    }
}</pre></div><p>It is preferred to have the terms facet executed on a non analyzed
field, or a field without a large number of terms it breaks to.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_accuracy_control"></a>Accuracy Control<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/terms-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">size</code> parameter defines how many top terms should be returned out
of the overall terms list. By default, the node coordinating the
search process will ask each shard to provide its own top <code class="literal">size</code> terms
and once all shards respond, it will reduce the results to the final list
that will then be sent back to the client. This means that if the number
of unique terms is greater than <code class="literal">size</code>, the returned list is slightly off
and not accurate (it could be that the term counts are slightly off and it
could even be that a term that should have been in the top <code class="literal">size</code> entries
was not returned).</p><p>The higher the requested <code class="literal">size</code> is, the more accurate the results will be,
but also, the more expensive it will be to compute the final results (both
due to bigger priority queues that are managed on a shard level and due to
bigger data transfers between the nodes and the client). In an attempt to
minimize the extra work that comes with bigger requested <code class="literal">size</code> the
<code class="literal">shard_size</code> parameter was introduced. When defined, it will determine
how many terms the coordinating node will request from each shard. Once
all the shards responded, the coordinating node will then reduce them
to a final result which will be based on the <code class="literal">size</code> parameter - this way,
one can increase the accuracy of the returned terms and avoid the overhead
of streaming a big list of terms back to the client.</p><p>Note that <code class="literal">shard_size</code> cannot be smaller than <code class="literal">size</code>… if that’s the case
elasticsearch will override it and reset it to be equal to <code class="literal">size</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_ordering"></a>Ordering<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/terms-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Allow to control the ordering of the terms facets, to be ordered by
<code class="literal">count</code>, <code class="literal">term</code>, <code class="literal">reverse_count</code> or <code class="literal">reverse_term</code>. The default is
<code class="literal">count</code>. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {  }
    },
    "facets" : {
        "tag" : {
            "terms" : {
                "field" : "tag",
                "size" : 10,
                "order" : "term"
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_all_terms"></a>All Terms<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/terms-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Allow to get all the terms in the terms facet, ones that do not match a
hit, will have a count of 0. Note, this should not be used with fields
that have many terms.</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {  }
    },
    "facets" : {
        "tag" : {
            "terms" : {
                "field" : "tag",
                "all_terms" : true
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_excluding_terms"></a>Excluding Terms<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/terms-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>It is possible to specify a set of terms that should be excluded from
the terms facet request result:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : { }
    },
    "facets" : {
        "tag" : {
            "terms" : {
                "field" : "tag",
                "exclude" : ["term1", "term2"]
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_regex_patterns"></a>Regex Patterns<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/terms-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The terms API allows to define regex expression that will control which
terms will be included in the faceted list, here is an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : { }
    },
    "facets" : {
        "tag" : {
            "terms" : {
                "field" : "tag",
                "regex" : "_regex expression here_",
                "regex_flags" : "DOTALL"
            }
        }
    }
}</pre></div><p>Check
<a class="ulink" href="http://download.oracle.com/javase/6/docs/api/java/util/regex/Pattern.html#field_summary" target="_top">Java
Pattern API</a> for more details about <code class="literal">regex_flags</code> options.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_term_scripts"></a>Term Scripts<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/terms-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Allow to define a script for terms facet to process the actual term that
will be used in the term facet collection, and also optionally control
its inclusion or not.</p><p>The script can either return a boolean value, with <code class="literal">true</code> to include it
in the facet collection, and <code class="literal">false</code> to exclude it from the facet
collection.</p><p>Another option is for the script to return a <code class="literal">string</code> controlling the
term that will be used to count against. The script execution will
include the term variable which is the current field term used.</p><p>For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {  }
    },
    "facets" : {
        "tag" : {
            "terms" : {
                "field" : "tag",
                "size" : 10,
                "script" : "term + 'aaa'"
            }
        }
    }
}</pre></div><p>And using the boolean feature:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {  }
    },
    "facets" : {
        "tag" : {
            "terms" : {
                "field" : "tag",
                "size" : 10,
                "script" : "term == 'aaa' ? true : false"
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_multi_fields_2"></a>Multi Fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/terms-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The term facet can be executed against more than one field, returning
the aggregation result across those fields. For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {  }
    },
    "facets" : {
        "tag" : {
            "terms" : {
                "fields" : ["tag1", "tag2"],
                "size" : 10
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_field"></a>Script Field<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/terms-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>A script that provides the actual terms that will be processed for a
given doc. A <code class="literal">script_field</code> (or <code class="literal">script</code> which will be used when no
<code class="literal">field</code> or <code class="literal">fields</code> are provided) can be set to provide it.</p><p>As an example, a search request (that is quite "heavy") can be executed
and use either <code class="literal">_source</code> itself or <code class="literal">_fields</code> (for stored fields) without
needing to load the terms to memory (at the expense of much slower
execution of the search, and causing more IO load):</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {  }
    },
    "facets" : {
        "my_facet" : {
            "terms" : {
                "script_field" : "_source.my_field",
                "size" : 10
            }
        }
    }
}</pre></div><p>Or:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {  }
    },
    "facets" : {
        "my_facet" : {
            "terms" : {
                "script_field" : "_fields['my_field']",
                "size" : 10
            }
        }
    }
}</pre></div><p>Note also, that the above will use the whole field value as a single
term.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_index_2"></a>_index<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/terms-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The term facet allows to specify a special field name called <code class="literal">_index</code>.
This will return a facet count of hits per <code class="literal">_index</code> the search was
executed on (relevant when a search request spans more than one index).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_memory_considerations_2"></a>Memory Considerations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/terms-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Term facet causes the relevant field values to be loaded into memory.
This means that per shard, there should be enough memory to contain
them. It is advisable to explicitly set the fields to be <code class="literal">not_analyzed</code>
or make sure the number of unique tokens a field can have is not large.</p></div></div><div class="navfooter"><span class="prev"><a href="search-facets.html">
              «&nbsp;
              Facets</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-range-facet.html">Range Facets
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-facets.html">Facets</a></span> » <span class="breadcrumb-node">Range Facets</span></div><div class="navheader"><span class="prev"><a href="search-facets-terms-facet.html">
              «&nbsp;
              Terms Facet</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-histogram-facet.html">Histogram Facets
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-range-facet"></a>Range Facets<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/range-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Facets are deprecated and will be removed in a future release. You are
encouraged to migrate to <a class="link" href="search-aggregations.html" title="Aggregations">aggregations</a> instead.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The equivalent aggregation would be the
<a class="link" href="search-aggregations-bucket-range-aggregation.html" title="Range Aggregation"><code class="literal">range</code></a>
aggregation.</p></div></div><p><code class="literal">range</code> facet allows to specify a set of ranges and get both the number
of docs (count) that fall within each range, and aggregated data either
based on the field, or using another field. Here is a simple example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "range1" : {
            "range" : {
                "field" : "field_name",
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 20, "to" : 70 },
                    { "from" : 70, "to" : 120 },
                    { "from" : 150 }
                ]
            }
        }
    }
}</pre></div><p>Another option which is a bit more DSL enabled is to provide the ranges
on the actual field name, for example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "range1" : {
            "range" : {
                "my_field" : [
                    { "to" : 50 },
                    { "from" : 20, "to" : 70 },
                    { "from" : 70, "to" : 120 },
                    { "from" : 150 }
                ]
            }
        }
    }
}</pre></div><p>The <code class="literal">range</code> facet always includes the <code class="literal">from</code> parameter and excludes the
<code class="literal">to</code> parameter for each range.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_key_and_value"></a>Key and Value<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/range-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">range</code> facet allows to use a different field to check if its value
falls within a range, and another field to compute aggregated data per
range (like total). For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "range1" : {
            "range" : {
                "key_field" : "field_name",
                "value_field" : "another_field_name",
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 20, "to" : 70 },
                    { "from" : 70, "to" : 120 },
                    { "from" : 150 }
                ]
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_key_and_value"></a>Script Key and Value<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/range-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Sometimes, some munging of both the key and the value are needed. In the
key case, before it is checked if it falls within a range, and for the
value, when the statistical data is computed per range scripts can be
used. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "range1" : {
            "range" : {
                "key_script" : "doc['date'].date.minuteOfHour",
                "value_script" : "doc['num1'].value",
                "ranges" : [
                    { "to" : 50 },
                    { "from" : 20, "to" : 70 },
                    { "from" : 70, "to" : 120 },
                    { "from" : 150 }
                ]
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_date_ranges"></a>Date Ranges<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/range-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The range facet support also providing the range as string formatted
dates.</p></div></div><div class="navfooter"><span class="prev"><a href="search-facets-terms-facet.html">
              «&nbsp;
              Terms Facet</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-histogram-facet.html">Histogram Facets
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-facets.html">Facets</a></span> » <span class="breadcrumb-node">Histogram Facets</span></div><div class="navheader"><span class="prev"><a href="search-facets-range-facet.html">
              «&nbsp;
              Range Facets</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-date-histogram-facet.html">Date Histogram Facet
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-histogram-facet"></a>Histogram Facets<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/histogram-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Facets are deprecated and will be removed in a future release. You are
encouraged to migrate to <a class="link" href="search-aggregations.html" title="Aggregations">aggregations</a> instead.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The equivalent aggregation would be the
<a class="link" href="search-aggregations-bucket-histogram-aggregation.html" title="Histogram Aggregation"><code class="literal">histogram</code></a>
aggregation.</p></div></div><p>The histogram facet works with numeric data by building a histogram
across intervals of the field values. Each value is "rounded" into an
interval (or placed in a bucket), and statistics are provided per
interval/bucket (count and total). Here is a simple example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "histogram" : {
                "field" : "field_name",
                "interval" : 100
            }
        }
    }
}</pre></div><p>The above example will run a histogram facet on the <code class="literal">field_name</code> field,
with an <code class="literal">interval</code> of <code class="literal">100</code> (so, for example, a value of <code class="literal">1055</code> will be
placed within the <code class="literal">1000</code> bucket).</p><p>The interval can also be provided as a time based interval (using the
time format). This mainly make sense when working on date fields or
field that represent absolute milliseconds, here is an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "histogram" : {
                "field" : "field_name",
                "time_interval" : "1.5h"
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_key_and_value_2"></a>Key and Value<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/histogram-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The histogram facet allows to use a different key and value. The key is
used to place the hit/document within the appropriate bucket, and the
value is used to compute statistical data (for example, total). Here is
an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "histogram" : {
                "key_field" : "key_field_name",
                "value_field" : "value_field_name",
                "interval" : 100
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_key_and_value_2"></a>Script Key and Value<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/histogram-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Sometimes, some munging of both the key and the value are needed. In the
key case, before it is rounded into a bucket, and for the value, when
the statistical data is computed per bucket
<a class="link" href="modules-scripting.html" title="Scripting">scripts</a> can be used. Here
is an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "histogram" : {
                "key_script" : "doc['date'].date.minuteOfHour",
                "value_script" : "doc['num1'].value"
            }
        }
    }
}</pre></div><p>In the above sample, we can use a date type field called <code class="literal">date</code> to get
the minute of hour from it, and the total will be computed based on
another field <code class="literal">num1</code>. Note, in this case, no <code class="literal">interval</code> was provided, so
the bucket will be based directly on the <code class="literal">key_script</code> (no rounding).</p><p>Parameters can also be provided to the different scripts (preferable if
the script is the same, with different values for a specific parameter,
like "factor"):</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "histogram" : {
                "key_script" : "doc['date'].date.minuteOfHour * factor1",
                "value_script" : "doc['num1'].value + factor2",
                "params" : {
                    "factor1" : 2,
                    "factor2" : 3
                }
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_memory_considerations_3"></a>Memory Considerations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/histogram-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>In order to implement the histogram facet, the relevant field values are
loaded into memory from the index. This means that per shard, there
should be enough memory to contain them. Since by default, dynamic
introduced types are <code class="literal">long</code> and <code class="literal">double</code>, one option to reduce the
memory footprint is to explicitly set the types for the relevant fields
to either <code class="literal">short</code>, <code class="literal">integer</code>, or <code class="literal">float</code> when possible.</p></div></div><div class="navfooter"><span class="prev"><a href="search-facets-range-facet.html">
              «&nbsp;
              Range Facets</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-date-histogram-facet.html">Date Histogram Facet
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-facets.html">Facets</a></span> » <span class="breadcrumb-node">Date Histogram Facet</span></div><div class="navheader"><span class="prev"><a href="search-facets-histogram-facet.html">
              «&nbsp;
              Histogram Facets</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-filter-facet.html">Filter Facets
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-date-histogram-facet"></a>Date Histogram Facet<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/date-histogram-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Facets are deprecated and will be removed in a future release. You are
encouraged to migrate to <a class="link" href="search-aggregations.html" title="Aggregations">aggregations</a> instead.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The equivalent aggregation would be the
<a class="link" href="search-aggregations-bucket-datehistogram-aggregation.html" title="Date Histogram Aggregation"><code class="literal">date_histogram</code></a>
aggregation.</p></div></div><p>A specific histogram facet that can work with <code class="literal">date</code> field types
enhancing it over the regular
<a class="link" href="search-facets-histogram-facet.html" title="Histogram Facets">histogram facet</a>. Here is a quick example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "date_histogram" : {
                "field" : "field_name",
                "interval" : "day"
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_interval"></a>Interval<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/date-histogram-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">interval</code> allows to set the interval at which buckets will be
created for each hit. It allows for the constant values of <code class="literal">year</code>,
<code class="literal">quarter</code>, <code class="literal">month</code>, <code class="literal">week</code>, <code class="literal">day</code>, <code class="literal">hour</code>, <code class="literal">minute</code> ,<code class="literal">second</code>.</p><p>It also support time setting like <code class="literal">1.5h</code> (up to <code class="literal">w</code> for weeks).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_time_zone_2"></a>Time Zone<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/date-histogram-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>By default, times are stored as UTC milliseconds since the epoch. Thus,
all computation and "bucketing" / "rounding" is done on UTC. It is
possible to provide a time zone (both pre rounding, and post rounding)
value, which will cause all computations to take the relevant zone into
account. The time returned for each bucket/entry is milliseconds since
the epoch of the provided time zone.</p><p>The parameters are <code class="literal">pre_zone</code> (pre rounding based on interval) and
<code class="literal">post_zone</code> (post rounding based on interval). The <code class="literal">time_zone</code> parameter
simply sets the <code class="literal">pre_zone</code> parameter. By default, those are set to
<code class="literal">UTC</code>.</p><p>The zone value accepts either a numeric value for the hours offset, for
example: <code class="literal">"time_zone" : -2</code>. It also accepts a format of hours and
minutes, like <code class="literal">"time_zone" : "-02:30"</code>. Another option is to provide a
time zone accepted as one of the values listed
<a class="ulink" href="http://www.joda.org/joda-time/timezones.html" target="_top">here</a>.</p><p>Lets take an example. For <code class="literal">2012-04-01T04:15:30Z</code>, with a <code class="literal">pre_zone</code> of
<code class="literal">-08:00</code>. For <code class="literal">day</code> interval, the actual time by applying the time zone
and rounding falls under <code class="literal">2012-03-31</code>, so the returned value will be (in
millis) of <code class="literal">2012-03-31T00:00:00Z</code> (UTC). For <code class="literal">hour</code> interval, applying
the time zone results in <code class="literal">2012-03-31T20:15:30</code>, rounding it results in
<code class="literal">2012-03-31T20:00:00</code>, but, we want to return it in UTC (<code class="literal">post_zone</code> is
not set), so we convert it back to UTC: <code class="literal">2012-04-01T04:00:00Z</code>. Note, we
are consistent in the results, returning the rounded value in UTC.</p><p><code class="literal">post_zone</code> simply takes the result, and adds the relevant offset.</p><p>Sometimes, we want to apply the same conversion to UTC we did above for
<code class="literal">hour</code> also for <code class="literal">day</code> (and up) intervals. We can set
<code class="literal">pre_zone_adjust_large_interval</code> to <code class="literal">true</code>, which will apply the same
conversion done for <code class="literal">hour</code> interval in the example, to <code class="literal">day</code> and above
intervals (it can be set regardless of the interval, but only kick in
when using <code class="literal">day</code> and higher intervals).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_factor"></a>Factor<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/date-histogram-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The date histogram works on numeric values (since time is stored in
milliseconds since the epoch in UTC). But, sometimes, systems will store
a different resolution (like seconds since UTC) in a numeric field. The
<code class="literal">factor</code> parameter can be used to change the value in the field to
milliseconds to actual do the relevant rounding, and then be applied
again to get to the original unit. For example, when storing in a
numeric field seconds resolution, the <code class="literal">factor</code> can be set to <code class="literal">1000</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_pre_post_offset"></a>Pre / Post Offset<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/date-histogram-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Specific offsets can be provided for pre rounding and post rounding. The
<code class="literal">pre_offset</code> for pre rounding, and <code class="literal">post_offset</code> for post rounding. The
format is the date time format (<code class="literal">1h</code>, <code class="literal">1d</code>, …).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_value_field"></a>Value Field<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/date-histogram-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The date_histogram facet allows to use a different key (of type date)
which controls the bucketing, with a different value field which will
then return the total and mean for that field values of the hits within
the relevant bucket. For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "date_histogram" : {
                "key_field" : "timestamp",
                "value_field" : "price",
                "interval" : "day"
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_value_field"></a>Script Value Field<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/date-histogram-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>A script can be used to compute the value that will then be used to
compute the total and mean for a bucket. For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "histo1" : {
            "date_histogram" : {
                "key_field" : "timestamp",
                "value_script" : "doc['price'].value * 2",
                "interval" : "day"
            }
        }
    }
}</pre></div></div></div><div class="navfooter"><span class="prev"><a href="search-facets-histogram-facet.html">
              «&nbsp;
              Histogram Facets</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-filter-facet.html">Filter Facets
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-facets.html">Facets</a></span> » <span class="breadcrumb-node">Filter Facets</span></div><div class="navheader"><span class="prev"><a href="search-facets-date-histogram-facet.html">
              «&nbsp;
              Date Histogram Facet</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-query-facet.html">Query Facets
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-filter-facet"></a>Filter Facets<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/filter-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Facets are deprecated and will be removed in a future release. You are
encouraged to migrate to <a class="link" href="search-aggregations.html" title="Aggregations">aggregations</a> instead.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The equivalent aggregation would be the
<a class="link" href="search-aggregations-bucket-filter-aggregation.html" title="Filter Aggregation"><code class="literal">filter</code></a>
aggregation.</p></div></div><p>A filter facet (not to be confused with a
<a class="link" href="search-facets.html" title="Facets">facet filter</a>) allows you to
return a count of the hits matching the filter. The filter itself can be
expressed using the <a class="link" href="query-dsl.html" title="Query DSL">Query DSL</a>. For
example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "facets" : {
        "wow_facet" : {
            "filter" : {
                "term" : { "tag" : "wow" }
            }
        }
    }
}</pre></div><p>Note, filter facet filters are faster than query facet when using native
filters (non query wrapper ones).</p></div><div class="navfooter"><span class="prev"><a href="search-facets-date-histogram-facet.html">
              «&nbsp;
              Date Histogram Facet</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-query-facet.html">Query Facets
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-facets.html">Facets</a></span> » <span class="breadcrumb-node">Query Facets</span></div><div class="navheader"><span class="prev"><a href="search-facets-filter-facet.html">
              «&nbsp;
              Filter Facets</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-statistical-facet.html">Statistical Facet
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-query-facet"></a>Query Facets<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/query-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Facets are deprecated and will be removed in a future release. You are
encouraged to migrate to <a class="link" href="search-aggregations.html" title="Aggregations">aggregations</a> instead.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>There is no equivalent aggregation but you can use the
<a class="link" href="search-aggregations-bucket-filter-aggregation.html" title="Filter Aggregation"><code class="literal">filter</code></a> aggregation and wrap
the query inside a <a class="link" href="query-dsl-query-filter.html" title="Query Filter">query filter</a>.</p></div></div><p>A facet query allows to return a count of the hits matching the facet
query. The query itself can be expressed using the Query DSL. For
example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "facets" : {
        "wow_facet" : {
            "query" : {
                "term" : { "tag" : "wow" }
            }
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="search-facets-filter-facet.html">
              «&nbsp;
              Filter Facets</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-statistical-facet.html">Statistical Facet
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-facets.html">Facets</a></span> » <span class="breadcrumb-node">Statistical Facet</span></div><div class="navheader"><span class="prev"><a href="search-facets-query-facet.html">
              «&nbsp;
              Query Facets</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-terms-stats-facet.html">Terms Stats Facet
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-statistical-facet"></a>Statistical Facet<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/statistical-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Facets are deprecated and will be removed in a future release. You are
encouraged to migrate to <a class="link" href="search-aggregations.html" title="Aggregations">aggregations</a> instead.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The equivalent aggregation would be the
<a class="link" href="search-aggregations-metrics-stats-aggregation.html" title="Stats Aggregation"><code class="literal">stats</code></a>
aggregation.</p></div></div><p>Statistical facet allows to compute statistical data on a numeric
fields. The statistical data include count, total, sum of squares, mean
(average), minimum, maximum, variance, and standard deviation. Here is
an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "stat1" : {
            "statistical" : {
                "field" : "num1"
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_script_field_2"></a>Script field<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/statistical-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>When using <code class="literal">field</code>, the numeric value of the field is used to compute
the statistical information. Sometimes, several fields values represent
the statistics we want to compute, or some sort of mathematical
evaluation. The script field allows to define a
<a class="link" href="modules-scripting.html" title="Scripting">script</a> to evaluate, with
its value used to compute the statistical information. For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "stat1" : {
            "statistical" : {
                "script" : "doc['num1'].value + doc['num2'].value"
            }
        }
    }
}</pre></div><p>Parameters can also be provided to the different scripts (preferable if
the script is the same, with different values for a specific parameter,
like "factor"):</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "stat1" : {
            "statistical" : {
                "script" : "(doc['num1'].value + doc['num2'].value) * factor",
                "params" : {
                    "factor" : 5
                }
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_multi_field"></a>Multi Field<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/statistical-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The statistical facet can be executed against more than one field,
returning the aggregation result across those fields. For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "stat1" : {
            "statistical" : {
                "fields" : ["num1", "num2"]
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_memory_considerations_4"></a>Memory Considerations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/statistical-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>In order to implement the statistical facet, the relevant field values
are loaded into memory from the index. This means that per shard, there
should be enough memory to contain them. Since by default, dynamic
introduced types are <code class="literal">long</code> and <code class="literal">double</code>, one option to reduce the
memory footprint is to explicitly set the types for the relevant fields
to either <code class="literal">short</code>, <code class="literal">integer</code>, or <code class="literal">float</code> when possible.</p></div></div><div class="navfooter"><span class="prev"><a href="search-facets-query-facet.html">
              «&nbsp;
              Query Facets</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-terms-stats-facet.html">Terms Stats Facet
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-facets.html">Facets</a></span> » <span class="breadcrumb-node">Terms Stats Facet</span></div><div class="navheader"><span class="prev"><a href="search-facets-statistical-facet.html">
              «&nbsp;
              Statistical Facet</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-geo-distance-facet.html">Geo Distance Facets
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-terms-stats-facet"></a>Terms Stats Facet<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/terms-stats-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Facets are deprecated and will be removed in a future release. You are
encouraged to migrate to <a class="link" href="search-aggregations.html" title="Aggregations">aggregations</a> instead.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The equivalent aggregation would be the
<a class="link" href="search-aggregations-bucket-terms-aggregation.html" title="Terms Aggregation"><code class="literal">terms</code></a>
aggregation with an inner
<a class="link" href="search-aggregations-metrics-stats-aggregation.html" title="Stats Aggregation"><code class="literal">stats</code></a>
aggregation.</p></div></div><p>The <code class="literal">terms_stats</code> facet combines both the
<a class="link" href="search-facets-terms-facet.html" title="Terms Facet">terms</a> and
<a class="link" href="search-facets-statistical-facet.html" title="Statistical Facet">statistical</a>
allowing to compute stats computed on a field, per term value driven by
another field. For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {  }
    },
    "facets" : {
        "tag_price_stats" : {
            "terms_stats" : {
                "key_field" : "tag",
                "value_field" : "price"
            }
        }
    }
}</pre></div><p>The <code class="literal">size</code> parameter controls how many facet entries will be returned.
It defaults to <code class="literal">10</code>. Setting it to 0 will return all terms matching the
hits (be careful not to return too many results).</p><p>One can also set <code class="literal">shard_size</code> (in addition to <code class="literal">size</code>) which will determine
how many term entries will be requested from each shard. When dealing
with field with high cardinality (at least higher than the requested <code class="literal">size</code>)
The greater <code class="literal">shard_size</code> is - the more accurate the result will be (and the
more expensive the overall facet computation will be). <code class="literal">shard_size</code> is there
to enable you to increase accuracy yet still avoid returning too many
terms_stats entries back to the client.</p><p>Ordering is done by setting <code class="literal">order</code>, with possible values of <code class="literal">term</code>,
<code class="literal">reverse_term</code>, <code class="literal">count</code>, <code class="literal">reverse_count</code>, <code class="literal">total</code>, <code class="literal">reverse_total</code>,
<code class="literal">min</code>, <code class="literal">reverse_min</code>, <code class="literal">max</code>, <code class="literal">reverse_max</code>, <code class="literal">mean</code>, <code class="literal">reverse_mean</code>.
Defaults to <code class="literal">count</code>.</p><p>The value computed can also be a script, using the <code class="literal">value_script</code>
instead of <code class="literal">value_field</code>, in which case the <code class="literal">lang</code> can control its
language, and <code class="literal">params</code> allow to provide custom parameters (as in other
scripted components).</p><p>Note, the terms stats can work with multi valued key fields, or multi
valued value fields, but not when both are multi valued (as ordering is
not maintained).</p></div><div class="navfooter"><span class="prev"><a href="search-facets-statistical-facet.html">
              «&nbsp;
              Statistical Facet</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-geo-distance-facet.html">Geo Distance Facets
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-facets.html">Facets</a></span> » <span class="breadcrumb-node">Geo Distance Facets</span></div><div class="navheader"><span class="prev"><a href="search-facets-terms-stats-facet.html">
              «&nbsp;
              Terms Stats Facet</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-migrating-to-aggs.html">Migrating to aggregations
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-geo-distance-facet"></a>Geo Distance Facets<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/geo-distance-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Facets are deprecated and will be removed in a future release. You are
encouraged to migrate to <a class="link" href="search-aggregations.html" title="Aggregations">aggregations</a> instead.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The equivalent aggregation would be the
<a class="link" href="search-aggregations-bucket-geodistance-aggregation.html" title="Geo Distance Aggregation"><code class="literal">geo_distance</code></a>
aggregation.</p></div></div><p>The geo_distance facet is a facet providing information for ranges of
distances from a provided geo_point including count of the number of
hits that fall within each range, and aggregation information (like
total).</p><p>Assuming the following sample doc:</p><div class="pre_wrapper"><pre class="programlisting">{
    "pin" : {
        "location" : {
            "lat" : 40.12,
            "lon" : -71.34
        }
    }
}</pre></div><p>Here is an example that create a <code class="literal">geo_distance</code> facet from a
<code class="literal">pin.location</code> of 40,-70, and a set of ranges:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "geo1" : {
            "geo_distance" : {
                "pin.location" : {
                    "lat" : 40,
                    "lon" : -70
                },
                "ranges" : [
                    { "to" : 10 },
                    { "from" : 10, "to" : 20 },
                    { "from" : 20, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_accepted_formats"></a>Accepted Formats<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/geo-distance-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>In much the same way the geo_point type can accept different
representation of the geo point, the filter can accept it as well:</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_lat_lon_as_properties_2"></a>Lat Lon As Properties<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/geo-distance-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "geo1" : {
            "geo_distance" : {
                "pin.location" : {
                    "lat" : 40,
                    "lon" : -70
                },
                "ranges" : [
                    { "to" : 10 },
                    { "from" : 10, "to" : 20 },
                    { "from" : 20, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_lat_lon_as_array_2"></a>Lat Lon As Array<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/geo-distance-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Format in <code class="literal">[lon, lat]</code>, note, the order of lon/lat here in order to
conform with <a class="ulink" href="http://geojson.org/" target="_top">GeoJSON</a>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "geo1" : {
            "geo_distance" : {
                "pin.location" : [40, -70],
                "ranges" : [
                    { "to" : 10 },
                    { "from" : 10, "to" : 20 },
                    { "from" : 20, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_lat_lon_as_string_2"></a>Lat Lon As String<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/geo-distance-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Format in <code class="literal">lat,lon</code>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "geo1" : {
            "geo_distance" : {
                "pin.location" : "40, -70",
                "ranges" : [
                    { "to" : 10 },
                    { "from" : 10, "to" : 20 },
                    { "from" : 20, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_geohash_2"></a>Geohash<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/geo-distance-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "geo1" : {
            "geo_distance" : {
                "pin.location" : "drm3btev3e86",
                "ranges" : [
                    { "to" : 10 },
                    { "from" : 10, "to" : 20 },
                    { "from" : 20, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_ranges"></a>Ranges<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/geo-distance-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>When a <code class="literal">to</code> or <code class="literal">from</code> are not set, they are assumed to be unbounded.
Ranges are allowed to overlap, basically, each range is treated by
itself.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_options_4"></a>Options<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/geo-distance-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th class="entry" align="left" valign="top">Option </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">unit</code></p></td><td class="entry" align="left" valign="top"><p>The unit the ranges are provided in. Defaults to <code class="literal">km</code>. Can also
be <code class="literal">mi</code>, <code class="literal">miles</code>, <code class="literal">in</code>, <code class="literal">inch</code>, <code class="literal">yd</code>, <code class="literal">yards</code>, <code class="literal">ft</code>, <code class="literal">feet</code>, <code class="literal">kilometers</code>, <code class="literal">mm</code>, <code class="literal">millimeters</code>, <code class="literal">cm</code>, <code class="literal">centimeters</code>, <code class="literal">m</code> or <code class="literal">meters</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">distance_type</code></p></td><td class="entry" align="left" valign="top"><p>How to compute the distance. Can either be <code class="literal">arc</code>
(better precision), <code class="literal">sloppy_arc</code> (faster) or <code class="literal">plane</code> (fastest). Defaults to <code class="literal">sloppy_arc</code>.</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_value_options"></a>Value Options<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/geo-distance-facet.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>On top of the count of hits falling within each range, aggregated data
can be provided (total) as well. By default, the aggregated data will
simply use the distance calculated, but the value can be extracted
either using a different numeric field, or a script. Here is an example
of using a different numeric field:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "geo1" : {
            "geo_distance" : {
                "pin.location" : "drm3btev3e86",
                "value_field" : "num1",
                "ranges" : [
                    { "to" : 10 },
                    { "from" : 10, "to" : 20 },
                    { "from" : 20, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre></div><p>And here is an example of using a script:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "match_all" : {}
    },
    "facets" : {
        "geo1" : {
            "geo_distance" : {
                "pin.location" : "drm3btev3e86",
                "value_script" : "doc['num1'].value * factor",
                "params" : {
                    "factor" : 5
                }
                "ranges" : [
                    { "to" : 10 },
                    { "from" : 10, "to" : 20 },
                    { "from" : 20, "to" : 100 },
                    { "from" : 100 }
                ]
            }
        }
    }
}</pre></div><p>Note the params option, allowing to pass parameters to the script
(resulting in faster script execution instead of providing the values
within the script each time).</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><h3><code class="literal">geo_point</code> Type</h3><p>The facet <span class="strong emphasis"><strong>requires</strong></span> the <code class="literal">geo_point</code> type to be set on the relevant
field.</p></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><h3>Multi Location Per Document</h3><p>The facet can work with multiple locations per document.</p></div></div></div></div><div class="navfooter"><span class="prev"><a href="search-facets-terms-stats-facet.html">
              «&nbsp;
              Terms Stats Facet</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-facets-migrating-to-aggs.html">Migrating to aggregations
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-facets.html">Facets</a></span> » <span class="breadcrumb-node">Migrating to aggregations</span></div><div class="navheader"><span class="prev"><a href="search-facets-geo-distance-facet.html">
              «&nbsp;
              Geo Distance Facets</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-suggesters.html">Suggesters
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-facets-migrating-to-aggs"></a>Migrating to aggregations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/migrating-to-aggregations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Facets have been deprecated in favor of <a class="link" href="search-aggregations.html" title="Aggregations">aggregations</a>
and as such it is recommended to migrate existing code using facets to
aggregations.</p><p>It is recommended to read the documentation about aggregations before this
section.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_simple_cases"></a>Simple cases<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/migrating-to-aggregations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>In quite a number of cases, the migration is rather straightforward as simple
facets have their direct aggregation equivalent and the only thing that is
required is to replace <code class="literal">facets</code> with <code class="literal">aggs</code>.</p><p>For instance:</p><div class="pre_wrapper"><pre class="programlisting">{
    "facets" : {
        "wow" : {
            "filter" : {
                "term" : { "tag" : "wow" }
            }
        }
    }
}</pre></div><p>can be translated to the following aggregation:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "wow" : {
            "filter" : {
                "term" : { "tag" : "wow" }
            }
        }
    }
}</pre></div><p>We will now spend more time on facets that don’t have their direct aggregation
equivalent and need more modifications.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_query_facets"></a>Query facets<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/migrating-to-aggregations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>There is no <code class="literal">query</code> aggregation so such facets must be migrated to the <code class="literal">filter</code>
aggregation.</p><p>For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "facets" : {
        "wow" : {
            "query" : {
                "query_string" : {
                    "query" : "tag:wow"
                }
            }
        }
    }
}</pre></div><p>can be replaced with the following
<a class="link" href="search-aggregations-bucket-filter-aggregation.html" title="Filter Aggregation">filter aggregation</a> that uses
the <a class="link" href="query-dsl-query-filter.html" title="Query Filter">query filter</a>:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "wow" : {
            "filter" : {
                "query" : {
                    "query_string" : {
                        "query" : "tag:wow"
                    }
                }
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_term_stats"></a>Term stats<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/migrating-to-aggregations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>There is no <code class="literal">term_stats</code> aggregation, so you actually need to create a
<a class="link" href="search-aggregations-bucket-terms-aggregation.html" title="Terms Aggregation">terms aggregation</a> that will
create buckets that will be processed with a
<a class="link" href="search-aggregations-metrics-stats-aggregation.html" title="Stats Aggregation">stats aggregation</a>.</p><p>For example</p><div class="pre_wrapper"><pre class="programlisting">{
    "facets" : {
        "tag_price_stats" : {
            "terms_stats" : {
                "key_field" : "tag",
                "value_field" : "price"
            }
        }
    }
}</pre></div><p>can be replaced with</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "tags" : {
            "terms" : {
                "field" : "tag"
            },
            "aggs" : {
                "price_stats" : {
                    "stats" : {
                        "field" : "price"
                    }
                }
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_value_field_2"></a>value_field<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/migrating-to-aggregations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">histogram</code>, <code class="literal">date_histogram</code>, <code class="literal">range</code> and <code class="literal">geo_distance</code> facets have a
<code class="literal">value_field</code> parameter that allows to compute statistics per bucket. With
aggregations this needs to be changed to a sub
<a class="link" href="search-aggregations-metrics-stats-aggregation.html" title="Stats Aggregation">stats aggregation</a>.</p><p>For example</p><div class="pre_wrapper"><pre class="programlisting">{
    "facets" : {
        "histo1" : {
            "date_histogram" : {
                "key_field" : "timestamp",
                "value_field" : "price",
                "interval" : "day"
            }
        }
    }
}</pre></div><p>can be replaced with</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "histo1" : {
            "date_histogram" : {
                "field" : "timestamp",
                "interval" : "day"
            },
            "aggs" : {
                "price_stats" : {
                    "stats" : {
                        "field" : "price"
                    }
                }
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_global_scope"></a>Global scope<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/migrating-to-aggregations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Facets allow to set a global scope by setting <code class="literal">global : true</code> in the facet
definition. With aggregations, you will need to put your aggregation under a
<a class="link" href="search-aggregations-bucket-global-aggregation.html" title="Global Aggregation">global aggregation</a> instead.</p><p>For example</p><div class="pre_wrapper"><pre class="programlisting">{
    "facets" : {
        "terms1" : {
            "terms" : { ... },
            "global" : true
        }
    }
}</pre></div><p>can be replaced with</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "global_count" : {
            "global" : {},
            "aggs" : {
                "terms1" : {
                    "terms" : { ... }
                }
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_facet_filters"></a>Facet filters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/migrating-to-aggregations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Facet filters can be replaced with a
<a class="link" href="search-aggregations-bucket-filter-aggregation.html" title="Filter Aggregation">filter aggregation</a>.</p><p>For example</p><div class="pre_wrapper"><pre class="programlisting">{
    "facets" : {
        "&lt;FACET NAME&gt;" : {
            "&lt;FACET TYPE&gt;" : {
                ...
            },
            "facet_filter" : {
                "term" : { "user" : "mvg" }
            }
        }
    }
}</pre></div><p>can be replaced with</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "filter1" : {
            "filter" : {
                "term" : { "user" : "mvg" }
            },
            "aggs" : {
                "&lt;AGG NAME&gt;" : {
                    "&lt;AGG TYPE&gt;" : {
                        ...
                    }
                }
            }
        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_nested"></a>Nested<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/facets/migrating-to-aggregations.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Aggregations have a dedicated
<a class="link" href="search-aggregations-bucket-nested-aggregation.html" title="Nested Aggregation">nested aggregation</a> to deal
with nested objects.</p><p>For example</p><div class="pre_wrapper"><pre class="programlisting">{
    "facets" : {
        "facet1" : {
            "terms" : {
                "field" : "name"
            },
            "nested" : "obj1"
        }
    }
}</pre></div><p>can be replaced with</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "agg1" : {
            "nested" : {
                "path" : "obj1"
            },
            "aggs" : {
                "agg1": {
                    "terms": {
                        "field" : "obj1.name"
                    }
                }
            }
        }
    }
}</pre></div><p>Note how fields are identified with their full path instead of relative path.</p><p>Similarly, this more complex facet that combines <code class="literal">nested</code> and facet filters:</p><div class="pre_wrapper"><pre class="programlisting">{
    "facets" : {
        "facet1" : {
            "terms" : {
                "field" : "name"
            },
            "nested" : "obj1",
            "facet_filter" : {
                "term" : { "color" : "blue" }
            }
        }
    }
}</pre></div><p>can be replaced with the following aggregation, which puts a terms aggregation
under a filter aggregation, and the filter aggregation under a nested
aggregation:</p><div class="pre_wrapper"><pre class="programlisting">{
    "aggs" : {
        "nested_obj1" : {
            "nested" : {
                "path" : "obj1"
            },
            "aggs" : {
                "color_filter" : {
                    "filter" : {
                        "term" : { "obj1.color" : "blue" }
                    },
                    "aggs" : {
                        "name_terms" : {
                            "terms" : {
                                "field" : "obj1.name"
                            }
                        }
                    }
                }
            }
        }
    }
}</pre></div><p>In short, this aggregation first moves from the root documents to their nested
documents following the path <code class="literal">obj1</code>. Then for each nested document, it filters
out those that are not blue, and for the remaining documents, it computes a
terms aggregation on the <code class="literal">name</code> field.</p></div></div><div class="navfooter"><span class="prev"><a href="search-facets-geo-distance-facet.html">
              «&nbsp;
              Geo Distance Facets</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-suggesters.html">Suggesters
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-node">Suggesters</span></div><div class="navheader"><span class="prev"><a href="search-facets-migrating-to-aggs.html">
              «&nbsp;
              Migrating to aggregations</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-suggesters-term.html">Term suggester
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-suggesters"></a>Suggesters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The suggest feature suggests similar looking terms based on a provided
text by using a suggester. Parts of the suggest feature are still under
development.</p><p>The suggest request part is either defined alongside the query part in a
<code class="literal">_search</code> request or via the REST <code class="literal">_suggest</code> endpoint.</p><div class="pre_wrapper"><pre class="programlisting">curl -s -XPOST 'localhost:9200/_search' -d '{
  "query" : {
    ...
  },
  "suggest" : {
    ...
  }
}'</pre></div><p>Suggest requests executed against the <code class="literal">_suggest</code> endpoint should omit
the surrounding <code class="literal">suggest</code> element which is only used if the suggest
request is part of a search.</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/_suggest' -d '{
  "my-suggestion" : {
    "text" : "the amsterdma meetpu",
    "term" : {
      "field" : "body"
    }
  }
}'</pre></div><p>Several suggestions can be specified per request. Each suggestion is
identified with an arbitrary name. In the example below two suggestions
are requested. Both <code class="literal">my-suggest-1</code> and <code class="literal">my-suggest-2</code> suggestions use
the <code class="literal">term</code> suggester, but have a different <code class="literal">text</code>.</p><div class="pre_wrapper"><pre class="programlisting">"suggest" : {
  "my-suggest-1" : {
    "text" : "the amsterdma meetpu",
    "term" : {
      "field" : "body"
    }
  },
  "my-suggest-2" : {
    "text" : "the rottredam meetpu",
    "term" : {
      "field" : "title"
    }
  }
}</pre></div><p>The below suggest response example includes the suggestion response for
<code class="literal">my-suggest-1</code> and <code class="literal">my-suggest-2</code>. Each suggestion part contains
entries. Each entry is effectively a token from the suggest text and
contains the suggestion entry text, the original start offset and length
in the suggest text and if found an arbitrary number of options.</p><div class="pre_wrapper"><pre class="programlisting">{
  ...
  "suggest": {
    "my-suggest-1": [
      {
        "text" : "amsterdma",
        "offset": 4,
        "length": 9,
        "options": [
           ...
        ]
      },
      ...
    ],
    "my-suggest-2" : [
      ...
    ]
  }
  ...
}</pre></div><p>Each options array contains an option object that includes the
suggested text, its document frequency and score compared to the suggest
entry text. The meaning of the score depends on the used suggester. The
term suggester’s score is based on the edit distance.</p><div class="pre_wrapper"><pre class="programlisting">"options": [
  {
    "text": "amsterdam",
    "freq": 77,
    "score": 0.8888889
  },
  ...
]</pre></div><h3><a id="global-suggest"></a>Global suggest text<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>To avoid repetition of the suggest text, it is possible to define a
global text. In the example below the suggest text is defined globally
and applies to the <code class="literal">my-suggest-1</code> and <code class="literal">my-suggest-2</code> suggestions.</p><div class="pre_wrapper"><pre class="programlisting">"suggest" : {
  "text" : "the amsterdma meetpu",
  "my-suggest-1" : {
    "term" : {
      "field" : "title"
    }
  },
  "my-suggest-2" : {
    "term" : {
      "field" : "body"
    }
  }
}</pre></div><p>The suggest text can in the above example also be specified as
suggestion specific option. The suggest text specified on suggestion
level override the suggest text on the global level.</p><h3><a id="_other_suggest_example"></a>Other suggest example<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>In the below example we request suggestions for the following suggest
text: <code class="literal">devloping distibutd saerch engies</code> on the <code class="literal">title</code> field with a
maximum of 3 suggestions per term inside the suggest text. Note that in
this example we use the <code class="literal">count</code> search type. This isn’t required, but a
nice optimization. The suggestions are gather in the <code class="literal">query</code> phase and
in the case that we only care about suggestions (so no hits) we don’t
need to execute the <code class="literal">fetch</code> phase.</p><div class="pre_wrapper"><pre class="programlisting">curl -s -XPOST 'localhost:9200/_search?search_type=count' -d '{
  "suggest" : {
    "my-title-suggestions-1" : {
      "text" : "devloping distibutd saerch engies",
      "term" : {
        "size" : 3,
        "field" : "title"
      }
    }
  }
}'</pre></div><p>The above request could yield the response as stated in the code example
below. As you can see if we take the first suggested options of each
suggestion entry we get <code class="literal">developing distributed search engines</code> as
result.</p><div class="pre_wrapper"><pre class="programlisting">{
  ...
  "suggest": {
    "my-title-suggestions-1": [
      {
        "text": "devloping",
        "offset": 0,
        "length": 9,
        "options": [
          {
            "text": "developing",
            "freq": 77,
            "score": 0.8888889
          },
          {
            "text": "deloping",
            "freq": 1,
            "score": 0.875
          },
          {
            "text": "deploying",
            "freq": 2,
            "score": 0.7777778
          }
        ]
      },
      {
        "text": "distibutd",
        "offset": 10,
        "length": 9,
        "options": [
          {
            "text": "distributed",
            "freq": 217,
            "score": 0.7777778
          },
          {
            "text": "disributed",
            "freq": 1,
            "score": 0.7777778
          },
          {
            "text": "distribute",
            "freq": 1,
            "score": 0.7777778
          }
        ]
      },
      {
        "text": "saerch",
        "offset": 20,
        "length": 6,
        "options": [
          {
            "text": "search",
            "freq": 1038,
            "score": 0.8333333
          },
          {
            "text": "smerch",
            "freq": 3,
            "score": 0.8333333
          },
          {
            "text": "serch",
            "freq": 2,
            "score": 0.8
          }
        ]
      },
      {
        "text": "engies",
        "offset": 27,
        "length": 6,
        "options": [
          {
            "text": "engines",
            "freq": 568,
            "score": 0.8333333
          },
          {
            "text": "engles",
            "freq": 3,
            "score": 0.8333333
          },
          {
            "text": "eggies",
            "freq": 1,
            "score": 0.8333333
          }
        ]
      }
    ]
  }
  ...
}</pre></div></div><div class="navfooter"><span class="prev"><a href="search-facets-migrating-to-aggs.html">
              «&nbsp;
              Migrating to aggregations</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-suggesters-term.html">Term suggester
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-suggesters.html">Suggesters</a></span> » <span class="breadcrumb-node">Term suggester</span></div><div class="navheader"><span class="prev"><a href="search-suggesters.html">
              «&nbsp;
              Suggesters</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-suggesters-phrase.html">Phrase Suggester
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-suggesters-term"></a>Term suggester<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/term-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>In order to understand the format of suggestions, please
read the <a class="xref" href="search-suggesters.html" title="Suggesters"><em>Suggesters</em></a> page first.</p></div></div><p>The <code class="literal">term</code> suggester suggests terms based on edit distance. The provided
suggest text is analyzed before terms are suggested. The suggested terms
are provided per analyzed suggest text token. The <code class="literal">term</code> suggester
doesn’t take the query into account that is part of request.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_common_suggest_options"></a>Common suggest options:<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/term-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">text</code>
</p>
</td><td class="entry" valign="top">
<p>
    The suggest text. The suggest text is a required option that
    needs to be set globally or per suggestion.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">field</code>
</p>
</td><td class="entry" valign="top">
<p>
    The field to fetch the candidate suggestions from. This is
    an required option that either needs to be set globally or per
    suggestion.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">analyzer</code>
</p>
</td><td class="entry" valign="top">
<p>
    The analyzer to analyse the suggest text with. Defaults
    to the search analyzer of the suggest field.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">size</code>
</p>
</td><td class="entry" valign="top">
<p>
    The maximum corrections to be returned per suggest text
    token.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">sort</code>
</p>
</td><td class="entry" valign="top">
<p>
    Defines how suggestions should be sorted per suggest text
    term. Two possible values:
</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">score</code>:     Sort by score first, then document frequency and
                    then the term itself.
</li><li class="listitem">
<code class="literal">frequency</code>: Sort by document frequency first, then similarity
                    score and then the term itself.
</li></ul></div>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">suggest_mode</code>
</p>
</td><td class="entry" valign="top">
<p>
    The suggest mode controls what suggestions are
    included or controls for what suggest text terms, suggestions should be
    suggested. Three possible values can be specified:
</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">missing</code>:  Only provide suggestions for suggest text terms that are
                    not in the index. This is the default.
</li><li class="listitem">
<code class="literal">popular</code>:  Only suggest suggestions that occur in more docs then
                    the original suggest text term.
</li><li class="listitem">
<code class="literal">always</code>:   Suggest any matching suggestions based on terms in the
                    suggest text.
</li></ul></div>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_other_term_suggest_options"></a>Other term suggest options:<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/term-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">lowercase_terms</code>
</p>
</td><td class="entry" valign="top">
<p>
    Lower cases the suggest text terms after text analysis.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">max_edits</code>
</p>
</td><td class="entry" valign="top">
<p>
    The maximum edit distance candidate suggestions can
    have in order to be considered as a suggestion. Can only be a value
    between 1 and 2. Any other value result in an bad request error being
    thrown. Defaults to 2.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">prefix_length</code>
</p>
</td><td class="entry" valign="top">
<p>
    The number of minimal prefix characters that must
    match in order be a candidate suggestions. Defaults to 1. Increasing
    this number improves spellcheck performance. Usually misspellings don’t
    occur in the beginning of terms. (Old name "prefix_len" is deprecated)
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">min_word_length</code>
</p>
</td><td class="entry" valign="top">
<p>
    The minimum length a suggest text term must have in
    order to be included. Defaults to 4. (Old name "min_word_len" is deprecated)
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">shard_size</code>
</p>
</td><td class="entry" valign="top">
<p>
    Sets the maximum number of suggestions to be retrieved
    from each individual shard. During the reduce phase only the top N
    suggestions are returned based on the <code class="literal">size</code> option. Defaults to the
    <code class="literal">size</code> option. Setting this to a value higher than the <code class="literal">size</code> can be
    useful in order to get a more accurate document frequency for spelling
    corrections at the cost of performance. Due to the fact that terms are
    partitioned amongst shards, the shard level document frequencies of
    spelling corrections may not be precise. Increasing this will make these
    document frequencies more precise.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">max_inspections</code>
</p>
</td><td class="entry" valign="top">
<p>
    A factor that is used to multiply with the
    <code class="literal">shards_size</code> in order to inspect more candidate spell corrections on
    the shard level. Can improve accuracy at the cost of performance.
    Defaults to 5.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">min_doc_freq</code>
</p>
</td><td class="entry" valign="top">
<p>
    The minimal threshold in number of documents a
    suggestion should appear in. This can be specified as an absolute number
    or as a relative percentage of number of documents. This can improve
    quality by only suggesting high frequency terms. Defaults to 0f and is
    not enabled. If a value higher than 1 is specified then the number
    cannot be fractional. The shard level document frequencies are used for
    this option.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">max_term_freq</code>
</p>
</td><td class="entry" valign="top">
<p>
    The maximum threshold in number of documents a
    suggest text token can exist in order to be included. Can be a relative
    percentage number (e.g 0.4) or an absolute number to represent document
    frequencies. If an value higher than 1 is specified then fractional can
    not be specified. Defaults to 0.01f. This can be used to exclude high
    frequency terms from being spellchecked. High frequency terms are
    usually spelled correctly on top of this also improves the spellcheck
    performance. The shard level document frequencies are used for this
    option.
</p>
</td></tr></tbody></table></div></div></div><div class="navfooter"><span class="prev"><a href="search-suggesters.html">
              «&nbsp;
              Suggesters</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-suggesters-phrase.html">Phrase Suggester
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-suggesters.html">Suggesters</a></span> » <span class="breadcrumb-node">Phrase Suggester</span></div><div class="navheader"><span class="prev"><a href="search-suggesters-term.html">
              «&nbsp;
              Term suggester</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-suggesters-completion.html">Completion Suggester
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-suggesters-phrase"></a>Phrase Suggester<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/phrase-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>In order to understand the format of suggestions, please
read the <a class="xref" href="search-suggesters.html" title="Suggesters"><em>Suggesters</em></a> page first.</p></div></div><p>The <code class="literal">term</code> suggester provides a very convenient API to access word
alternatives on a per token basis within a certain string distance. The API
allows accessing each token in the stream individually while
suggest-selection is left to the API consumer. Yet, often pre-selected
suggestions are required in order to present to the end-user. The
<code class="literal">phrase</code> suggester adds additional logic on top of the <code class="literal">term</code> suggester
to select entire corrected phrases instead of individual tokens weighted
based on <code class="literal">ngram-language</code> models. In practice this suggester will be
able to make better decisions about which tokens to pick based on
co-occurence and frequencies.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_api_example"></a>API Example<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/phrase-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">phrase</code> request is defined along side the query part in the json
request:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/_search' -d '{
  "suggest" : {
    "text" : "Xor the Got-Jewel",
    "simple_phrase" : {
      "phrase" : {
        "analyzer" : "body",
        "field" : "bigram",
        "size" : 1,
        "real_word_error_likelihood" : 0.95,
        "max_errors" : 0.5,
        "gram_size" : 2,
        "direct_generator" : [ {
          "field" : "body",
          "suggest_mode" : "always",
          "min_word_length" : 1
        } ],
        "highlight": {
          "pre_tag": "&lt;em&gt;",
          "post_tag": "&lt;/em&gt;"
        }
      }
    }
  }
}'</pre></div><p>The response contains suggestions scored by the most likely spell
correction first. In this case we received the expected correction
<code class="literal">xorr the god jewel</code> first while the second correction is less
conservative where only one of the errors is corrected. Note, the
request is executed with <code class="literal">max_errors</code> set to <code class="literal">0.5</code> so 50% of the terms
can contain misspellings (See parameter descriptions below).</p><div class="pre_wrapper"><pre class="programlisting">  {
  "took" : 5,
  "timed_out" : false,
  "_shards" : {
    "total" : 5,
    "successful" : 5,
    "failed" : 0
  },
  "hits" : {
    "total" : 2938,
    "max_score" : 0.0,
    "hits" : [ ]
  },
  "suggest" : {
    "simple_phrase" : [ {
      "text" : "Xor the Got-Jewel",
      "offset" : 0,
      "length" : 17,
      "options" : [ {
        "text" : "xorr the god jewel",
        "highlighted": "&lt;em&gt;xorr&lt;/em&gt; the &lt;em&gt;god&lt;/em&gt; jewel",
        "score" : 0.17877324
      }, {
        "text" : "xor the god jewel",
        "highlighted": "xor the &lt;em&gt;god&lt;/em&gt; jewel",
        "score" : 0.14231323
      } ]
    } ]
  }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_basic_phrase_suggest_api_parameters"></a>Basic Phrase suggest API parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/phrase-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">field</code>
</p>
</td><td class="entry" valign="top">
<p>
    the name of the field used to do n-gram lookups for the
    language model, the suggester will use this field to gain statistics to
    score corrections. This field is mandatory.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">gram_size</code>
</p>
</td><td class="entry" valign="top">
<p>
    sets max size of the n-grams (shingles) in the <code class="literal">field</code>.
    If the field doesn’t contain n-grams (shingles) this should be omitted
    or set to <code class="literal">1</code>. Note that Elasticsearch tries to detect the gram size
    based on the specified <code class="literal">field</code>. If the field uses a <code class="literal">shingle</code> filter the
    <code class="literal">gram_size</code> is set to the <code class="literal">max_shingle_size</code> if not explicitly set.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">real_word_error_likelihood</code>
</p>
</td><td class="entry" valign="top">
<p>
    the likelihood of a term being a
    misspelled even if the term exists in the dictionary. The default is
    <code class="literal">0.95</code> corresponding to 5% of the real words are misspelled.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">confidence</code>
</p>
</td><td class="entry" valign="top">
<p>
    The confidence level defines a factor applied to the
    input phrases score which is used as a threshold for other suggest
    candidates. Only candidates that score higher than the threshold will be
    included in the result. For instance a confidence level of <code class="literal">1.0</code> will
    only return suggestions that score higher than the input phrase. If set
    to <code class="literal">0.0</code> the top N candidates are returned. The default is <code class="literal">1.0</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">max_errors</code>
</p>
</td><td class="entry" valign="top">
<p>
    the maximum percentage of the terms that at most
    considered to be misspellings in order to form a correction. This method
    accepts a float value in the range <code class="literal">[0..1)</code> as a fraction of the actual
    query terms or a number <code class="literal">&gt;=1</code> as an absolute number of query terms. The
    default is set to <code class="literal">1.0</code> which corresponds to that only corrections with
    at most 1 misspelled term are returned.  Note that setting this too high
    can negatively impact performance. Low values like <code class="literal">1</code> or <code class="literal">2</code> are recommended
    otherwise the time spend in suggest calls might exceed the time spend in
    query execution.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">separator</code>
</p>
</td><td class="entry" valign="top">
<p>
    the separator that is used to separate terms in the
    bigram field. If not set the whitespace character is used as a
    separator.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">size</code>
</p>
</td><td class="entry" valign="top">
<p>
    the number of candidates that are generated for each
    individual query term Low numbers like <code class="literal">3</code> or <code class="literal">5</code> typically produce good
    results. Raising this can bring up terms with higher edit distances. The
    default is <code class="literal">5</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">analyzer</code>
</p>
</td><td class="entry" valign="top">
<p>
    Sets the analyzer to analyse to suggest text with.
    Defaults to the search analyzer of the suggest field passed via <code class="literal">field</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">shard_size</code>
</p>
</td><td class="entry" valign="top">
<p>
    Sets the maximum number of suggested term to be
    retrieved from each individual shard. During the reduce phase, only the
    top N suggestions are returned based on the <code class="literal">size</code> option. Defaults to
    <code class="literal">5</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">text</code>
</p>
</td><td class="entry" valign="top">
<p>
    Sets the text / query to provide suggestions for.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">highlight</code>
</p>
</td><td class="entry" valign="top">
<p>
    Sets up suggestion highlighting.  If not provided then
    no <code class="literal">highlighted</code> field is returned.  If provided must
    contain exactly <code class="literal">pre_tag</code> and <code class="literal">post_tag</code> which are
    wrapped around the changed tokens.  If multiple tokens
    in a row are changed the entire phrase of changed tokens
    is wrapped rather than each token.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">collate</code>
</p>
</td><td class="entry" valign="top">
<p>
    Checks each suggestion against a specified <code class="literal">query</code> to prune suggestions
    for which no matching docs exist in the index. The collate query for a
    suggestion is run only on the local shard from which the suggestion has
    been generated from. A <code class="literal">query</code> must be specified, and it is run as a
    <a class="link" href="query-dsl-template-query.html" title="Template Query"><code class="literal">template</code> query</a>. The current suggestion is
    automatically made available as the <code class="literal">{{suggestion}}</code> variable, which
    should be used in your query.  You can still specify your own template
    <code class="literal">params</code> — the <code class="literal">suggestion</code> value will be added to the variables you specify.
    Additionally, you can specify a <code class="literal">prune</code> to control if all phrase suggestions
    will be returned, when set to <code class="literal">true</code> the suggestions will have an additional
    option <code class="literal">collate_match</code>, which will be <code class="literal">true</code> if matching documents for the
    phrase was found, <code class="literal">false</code> otherwise. The default value for <code class="literal">prune</code> is <code class="literal">false</code>.
    The option of specifying a <code class="literal">filter</code> has been deprecated in v1.6.0 and will be
    removed in v2.0.0.
</p>
</td></tr></tbody></table></div><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/_search' -d {
   "suggest" : {
     "text" : "Xor the Got-Jewel",
     "simple_phrase" : {
       "phrase" : {
         "field" :  "bigram",
         "size" :   1,
         "direct_generator" : [ {
           "field" :            "body",
           "suggest_mode" :     "always",
           "min_word_length" :  1
         } ],
         "collate": {
           "query": { <a id="CO43-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
             "match": {
                 "{{field_name}}" : "{{suggestion}}" <a id="CO43-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
             }
           },
           "params": {"field_name" : "title"}, <a id="CO43-3"></a><span><img src="images/icons/callouts/3.png" alt=""></span>
           "prune": true <a id="CO43-4"></a><span><img src="images/icons/callouts/4.png" alt=""></span>
         }
       }
     }
   }
 }</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO43-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
This query will be run once for every suggestion.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO43-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">{{suggestion}}</code> variable will be replaced by the text
    of each suggestion.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO43-3"><span><img src="images/icons/callouts/3.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
An additional <code class="literal">field_name</code> variable has been specified in
    <code class="literal">params</code> and is used by the <code class="literal">match</code> query.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO43-4"><span><img src="images/icons/callouts/4.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
All suggestions will be returned with an extra <code class="literal">collate_match</code>
    option indicating whether the generated phrase matched any
    document.
</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_smoothing_models"></a>Smoothing Models<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/phrase-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">phrase</code> suggester supports multiple smoothing models to balance
weight between infrequent grams (grams (shingles) are not existing in
the index) and frequent grams (appear at least once in the index).</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">stupid_backoff</code>
</p>
</td><td class="entry" valign="top">
<p>
    a simple backoff model that backs off to lower
    order n-gram models if the higher order count is <code class="literal">0</code> and discounts the
    lower order n-gram model by a constant factor. The default <code class="literal">discount</code> is
    <code class="literal">0.4</code>. Stupid Backoff is the default model.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">laplace</code>
</p>
</td><td class="entry" valign="top">
<p>
    a smoothing model that uses an additive smoothing where a
    constant (typically <code class="literal">1.0</code> or smaller) is added to all counts to balance
    weights, The default <code class="literal">alpha</code> is <code class="literal">0.5</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">linear_interpolation</code>
</p>
</td><td class="entry" valign="top">
<p>
    a smoothing model that takes the weighted
    mean of the unigrams, bigrams and trigrams based on user supplied
    weights (lambdas). Linear Interpolation doesn’t have any default values.
    All parameters (<code class="literal">trigram_lambda</code>, <code class="literal">bigram_lambda</code>, <code class="literal">unigram_lambda</code>)
    must be supplied.
</p>
</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_candidate_generators"></a>Candidate Generators<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/phrase-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">phrase</code> suggester uses candidate generators to produce a list of
possible terms per term in the given text. A single candidate generator
is similar to a <code class="literal">term</code> suggester called for each individual term in the
text. The output of the generators is subsequently scored in combination
with the candidates from the other terms to for suggestion candidates.</p><p>Currently only one type of candidate generator is supported, the
<code class="literal">direct_generator</code>. The Phrase suggest API accepts a list of generators
under the key <code class="literal">direct_generator</code> each of the generators in the list are
called per term in the original text.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_direct_generators"></a>Direct Generators<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/phrase-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The direct generators support the following parameters:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">field</code>
</p>
</td><td class="entry" valign="top">
<p>
    The field to fetch the candidate suggestions from. This is
    a required option that either needs to be set globally or per
    suggestion.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">size</code>
</p>
</td><td class="entry" valign="top">
<p>
    The maximum corrections to be returned per suggest text token.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">suggest_mode</code>
</p>
</td><td class="entry" valign="top">
<p>
    The suggest mode controls what suggestions are
    included or controls for what suggest text terms, suggestions should be
    suggested. Three possible values can be specified:
</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">missing</code>: Only suggest terms in the suggest text that aren’t in the
                  index. This is the default.
</li><li class="listitem">
<code class="literal">popular</code>: Only suggest suggestions that occur in more docs then the
                  original suggest text term.
</li><li class="listitem">
<code class="literal">always</code>: Suggest any matching suggestions based on terms in the
                 suggest text.
</li></ul></div>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">max_edits</code>
</p>
</td><td class="entry" valign="top">
<p>
    The maximum edit distance candidate suggestions can have
    in order to be considered as a suggestion. Can only be a value between 1
    and 2. Any other value result in an bad request error being thrown.
    Defaults to 2.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">prefix_length</code>
</p>
</td><td class="entry" valign="top">
<p>
    The number of minimal prefix characters that must
    match in order be a candidate suggestions. Defaults to 1. Increasing
    this number improves spellcheck performance. Usually misspellings don’t
    occur in the beginning of terms. (Old name "prefix_len" is deprecated)
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">min_word_length</code>
</p>
</td><td class="entry" valign="top">
<p>
    The minimum length a suggest text term must have in
    order to be included. Defaults to 4. (Old name "min_word_len" is deprecated)
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">max_inspections</code>
</p>
</td><td class="entry" valign="top">
<p>
    A factor that is used to multiply with the
    <code class="literal">shards_size</code> in order to inspect more candidate spell corrections on
    the shard level. Can improve accuracy at the cost of performance.
    Defaults to 5.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">min_doc_freq</code>
</p>
</td><td class="entry" valign="top">
<p>
    The minimal threshold in number of documents a
    suggestion should appear in. This can be specified as an absolute number
    or as a relative percentage of number of documents. This can improve
    quality by only suggesting high frequency terms. Defaults to 0f and is
    not enabled. If a value higher than 1 is specified then the number
    cannot be fractional. The shard level document frequencies are used for
    this option.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">max_term_freq</code>
</p>
</td><td class="entry" valign="top">
<p>
    The maximum threshold in number of documents a
    suggest text token can exist in order to be included. Can be a relative
    percentage number (e.g 0.4) or an absolute number to represent document
    frequencies. If an value higher than 1 is specified then fractional can
    not be specified. Defaults to 0.01f. This can be used to exclude high
    frequency terms from being spellchecked. High frequency terms are
    usually spelled correctly on top of this also improves the spellcheck
    performance. The shard level document frequencies are used for this
    option.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">pre_filter</code>
</p>
</td><td class="entry" valign="top">
<p>
    a filter (analyzer) that is applied to each of the
    tokens passed to this candidate generator. This filter is applied to the
    original token before candidates are generated.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">post_filter</code>
</p>
</td><td class="entry" valign="top">
<p>
    a filter (analyzer) that is applied to each of the
    generated tokens before they are passed to the actual phrase scorer.
</p>
</td></tr></tbody></table></div><p>The following example shows a <code class="literal">phrase</code> suggest call with two generators,
the first one is using a field containing ordinary indexed terms and the
second one uses a field that uses terms indexed with a <code class="literal">reverse</code> filter
(tokens are index in reverse order). This is used to overcome the limitation
of the direct generators to require a constant prefix to provide
high-performance suggestions. The <code class="literal">pre_filter</code> and <code class="literal">post_filter</code> options
accept ordinary analyzer names.</p><div class="pre_wrapper"><pre class="programlisting">curl -s -XPOST 'localhost:9200/_search' -d {
 "suggest" : {
    "text" : "Xor the Got-Jewel",
    "simple_phrase" : {
      "phrase" : {
        "analyzer" : "body",
        "field" : "bigram",
        "size" : 4,
        "real_word_error_likelihood" : 0.95,
        "confidence" : 2.0,
        "gram_size" : 2,
        "direct_generator" : [ {
          "field" : "body",
          "suggest_mode" : "always",
          "min_word_length" : 1
        }, {
          "field" : "reverse",
          "suggest_mode" : "always",
          "min_word_length" : 1,
          "pre_filter" : "reverse",
          "post_filter" : "reverse"
        } ]
      }
    }
  }
}</pre></div><p><code class="literal">pre_filter</code> and <code class="literal">post_filter</code> can also be used to inject synonyms after
candidates are generated. For instance for the query <code class="literal">captain usq</code> we
might generate a candidate <code class="literal">usa</code> for term <code class="literal">usq</code> which is a synonym for
<code class="literal">america</code> which allows to present <code class="literal">captain america</code> to the user if this
phrase scores high enough.</p></div></div><div class="navfooter"><span class="prev"><a href="search-suggesters-term.html">
              «&nbsp;
              Term suggester</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-suggesters-completion.html">Completion Suggester
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-suggesters.html">Suggesters</a></span> » <span class="breadcrumb-node">Completion Suggester</span></div><div class="navheader"><span class="prev"><a href="search-suggesters-phrase.html">
              «&nbsp;
              Phrase Suggester</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="suggester-context.html">Context Suggester
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="search-suggesters-completion"></a>Completion Suggester<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/completion-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>In order to understand the format of suggestions, please
read the <a class="xref" href="search-suggesters.html" title="Suggesters"><em>Suggesters</em></a> page first.</p></div></div><p>The <code class="literal">completion</code> suggester is a so-called prefix suggester. It does not
do spell correction like the <code class="literal">term</code> or <code class="literal">phrase</code> suggesters but allows
basic <code class="literal">auto-complete</code> functionality.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_why_another_suggester_why_not_prefix_queries"></a>Why another suggester? Why not prefix queries?<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/completion-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The first question which comes to mind when reading about a prefix
suggestion is, why you should use it at all, if you have prefix queries
already. The answer is simple: Prefix suggestions are fast.</p><p>The data structures are internally backed by Lucenes
<code class="literal">AnalyzingSuggester</code>, which uses FSTs (finite state transducers) to
execute suggestions. Usually these data structures are costly to
create, stored in-memory and need to be rebuilt every now and then to
reflect changes in your indexed documents. The <code class="literal">completion</code> suggester
circumvents this by storing the FST (finite state transducer) as part
of your index during index time. This allows for really fast
loads and executions.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="completion-suggester-mapping"></a>Mapping<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/completion-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>In order to use this feature, you have to specify a special mapping for
this field, which enables the special storage of the field.</p><div class="pre_wrapper"><pre class="programlisting">curl -X PUT localhost:9200/music
curl -X PUT localhost:9200/music/song/_mapping -d '{
  "song" : {
        "properties" : {
            "name" : { "type" : "string" },
            "suggest" : { "type" : "completion",
                          "index_analyzer" : "simple",
                          "search_analyzer" : "simple",
                          "payloads" : true
            }
        }
    }
}'</pre></div><p>Mapping supports the following parameters:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">index_analyzer</code>
</span></dt><dd>
    The index analyzer to use, defaults to <code class="literal">simple</code>.
</dd><dt><span class="term">
<code class="literal">search_analyzer</code>
</span></dt><dd>
    The search analyzer to use, defaults to <code class="literal">simple</code>.
    In case you are wondering why we did not opt for the <code class="literal">standard</code>
    analyzer: We try to have easy to understand behaviour here, and if you
    index the field content <code class="literal">At the Drive-in</code>, you will not get any
    suggestions for <code class="literal">a</code>, nor for <code class="literal">d</code> (the first non stopword).
</dd><dt><span class="term">
<code class="literal">payloads</code>
</span></dt><dd>
    Enables the storing of payloads, defaults to <code class="literal">false</code>
</dd><dt><span class="term">
<code class="literal">preserve_separators</code>
</span></dt><dd>
    Preserves the separators, defaults to <code class="literal">true</code>.
    If disabled, you could find a field starting with <code class="literal">Foo Fighters</code>, if you
    suggest for <code class="literal">foof</code>.
</dd><dt><span class="term">
<code class="literal">preserve_position_increments</code>
</span></dt><dd>
    Enables position increments, defaults
    to <code class="literal">true</code>. If disabled and using stopwords analyzer, you could get a
    field starting with <code class="literal">The Beatles</code>, if you suggest for <code class="literal">b</code>. <span class="strong emphasis"><strong>Note</strong></span>: You
    could also achieve this by indexing two inputs, <code class="literal">Beatles</code> and
    <code class="literal">The Beatles</code>, no need to change a simple analyzer, if you are able to
    enrich your data.
</dd><dt><span class="term">
<code class="literal">max_input_length</code>
</span></dt><dd>
    Limits the length of a single input, defaults to <code class="literal">50</code> UTF-16 code points.
    This limit is only used at index time to reduce the total number of
    characters per input string in order to prevent massive inputs from
    bloating the underlying datastructure. The most usecases won’t be influenced
    by the default value since prefix completions hardly grow beyond prefixes longer
    than a handful of characters. (Old name "max_input_len" is deprecated)
</dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="indexing"></a>Indexing<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/completion-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="pre_wrapper"><pre class="programlisting">curl -X PUT 'localhost:9200/music/song/1?refresh=true' -d '{
    "name" : "Nevermind",
    "suggest" : {
        "input": [ "Nevermind", "Nirvana" ],
        "output": "Nirvana - Nevermind",
        "payload" : { "artistId" : 2321 },
        "weight" : 34
    }
}'</pre></div><p>The following parameters are supported:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">input</code>
</span></dt><dd>
    The input to store, this can be a an array of strings or just
    a string. This field is mandatory.
</dd><dt><span class="term">
<code class="literal">output</code>
</span></dt><dd>
    The string to return, if a suggestion matches. This is very
    useful to normalize outputs (i.e. have them always in the format
    <code class="literal">artist - songname</code>). This is optional.
    <span class="strong emphasis"><strong>Note</strong></span>: The result is de-duplicated if several documents
    have the same output, i.e. only one is returned as part of the
    suggest result.
</dd><dt><span class="term">
<code class="literal">payload</code>
</span></dt><dd>
    An arbitrary JSON object, which is simply returned in the
    suggest option. You could store data like the id of a document, in order
    to load it from elasticsearch without executing another search (which
    might not yield any results, if <code class="literal">input</code> and <code class="literal">output</code> differ strongly).
</dd><dt><span class="term">
<code class="literal">weight</code>
</span></dt><dd>
    A positive integer or a string containing a positive integer,
    which defines a weight and allows you to rank your suggestions.
    This field is optional.
</dd></dl></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Even though you will lose most of the features of the
completion suggest, you can choose to use the following shorthand form.
Keep in mind that you will not be able to use several inputs, an output,
payloads or weights. This form does still work inside of multi fields.</p></div></div><div class="pre_wrapper"><pre class="programlisting">{
  "suggest" : "Nirvana"
}</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The suggest data structure might not reflect deletes on
documents immediately. You may need to do an <a class="xref" href="indices-optimize.html" title="Optimize"><em>Optimize</em></a> for that.
You can call optimize with the <code class="literal">only_expunge_deletes=true</code> to only target
deletions for merging. By default <code class="literal">only_expunge_deletes=true</code> will only select
segments for merge where the percentage of deleted documents is greater than <code class="literal">10%</code> of
the number of document in that segment. To adjust this <code class="literal">index.merge.policy.expunge_deletes_allowed</code> can
be updated to a value between <code class="literal">[0..100]</code>. Please remember even with this option set, optimize
is considered a extremely heavy operation and should be called rarely.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="querying"></a>Querying<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/completion-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Suggesting works as usual, except that you have to specify the suggest
type as <code class="literal">completion</code>.</p><div class="pre_wrapper"><pre class="programlisting">curl -X POST 'localhost:9200/music/_suggest?pretty' -d '{
    "song-suggest" : {
        "text" : "n",
        "completion" : {
            "field" : "suggest"
        }
    }
}'

{
  "_shards" : {
    "total" : 5,
    "successful" : 5,
    "failed" : 0
  },
  "song-suggest" : [ {
    "text" : "n",
    "offset" : 0,
    "length" : 1,
    "options" : [ {
      "text" : "Nirvana - Nevermind",
      "score" : 34.0, "payload" : {"artistId":2321}
    } ]
  } ]
}</pre></div><p>As you can see, the payload is included in the response, if configured
appropriately. If you configured a weight for a suggestion, this weight
is used as <code class="literal">score</code>. Also the <code class="literal">text</code> field uses the <code class="literal">output</code> of your
indexed suggestion, if configured, otherwise the matched part of the
<code class="literal">input</code> field.</p><p>The basic completion suggester query supports the following two parameters:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">field</code>
</span></dt><dd>
The name of the field on which to run the query (required).
</dd><dt><span class="term">
<code class="literal">size</code>
</span></dt><dd>
The number of suggestions to return (defaults to <code class="literal">5</code>).
</dd></dl></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The completion suggester considers all documents in the index.
See <a class="xref" href="suggester-context.html" title="Context Suggester">Context Suggester</a> for an explanation of how to query a subset of
documents instead.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="fuzzy"></a>Fuzzy queries<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/completion-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The completion suggester also supports fuzzy queries - this means,
you can actually have a typo in your search and still get results back.</p><div class="pre_wrapper"><pre class="programlisting">curl -X POST 'localhost:9200/music/_suggest?pretty' -d '{
    "song-suggest" : {
        "text" : "n",
        "completion" : {
            "field" : "suggest",
            "fuzzy" : {
                "fuzziness" : 2
            }
        }
    }
}'</pre></div><p>The fuzzy query can take specific fuzzy parameters.
The following parameters are supported:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">fuzziness</code>
</p>
</td><td class="entry" valign="top">
<p>
    The fuzziness factor, defaults to <code class="literal">AUTO</code>.
    See  <a class="xref" href="common-options.html#fuzziness" title="Fuzzinessedit">the section called “Fuzziness</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>” for allowed settings.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">transpositions</code>
</p>
</td><td class="entry" valign="top">
<p>
    Sets if transpositions should be counted
    as one or two changes, defaults to <code class="literal">true</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">min_length</code>
</p>
</td><td class="entry" valign="top">
<p>
    Minimum length of the input before fuzzy
    suggestions are returned, defaults <code class="literal">3</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">prefix_length</code>
</p>
</td><td class="entry" valign="top">
<p>
    Minimum length of the input, which is not
    checked for fuzzy alternatives, defaults to <code class="literal">1</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">unicode_aware</code>
</p>
</td><td class="entry" valign="top">
<p>
    Sets all are measurements (like edit distance,
    transpositions and lengths) in unicode code points
    (actual letters) instead of bytes.
</p>
</td></tr></tbody></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>If you want to stick with the default values, but
      still use fuzzy, you can either use <code class="literal">fuzzy: {}</code>
      or <code class="literal">fuzzy: true</code>.</p></div></div></div></div><div class="navfooter"><span class="prev"><a href="search-suggesters-phrase.html">
              «&nbsp;
              Phrase Suggester</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="suggester-context.html">Context Suggester
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-link"><a href="search-suggesters.html">Suggesters</a></span> » <span class="breadcrumb-node">Context Suggester</span></div><div class="navheader"><span class="prev"><a href="search-suggesters-completion.html">
              «&nbsp;
              Completion Suggester</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-multi-search.html">Multi Search API
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="suggester-context"></a>Context Suggester<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/context-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The context suggester is an extension to the suggest API of Elasticsearch. Namely the
suggester system provides a very fast way of searching documents by handling these
entirely in memory. But this special treatment does not allow the handling of
traditional queries and filters, because those would have notable impact on the
performance. So the context extension is designed to take so-called context information
into account to specify a more accurate way of searching within the suggester system.
Instead of using the traditional query and filter system a predefined ``context`` is
configured to limit suggestions to a particular subset of suggestions.
Such a context is defined by a set of context mappings which can either be a simple
<span class="strong emphasis"><strong>category</strong></span> or a <span class="strong emphasis"><strong>geo location</strong></span>. The information used by the context suggester is
configured in the type mapping with the <code class="literal">context</code> parameter, which lists all of the
contexts that need to be specified in each document and in each suggestion request.
For instance:</p><div class="pre_wrapper"><pre class="programlisting">PUT services/_mapping/service
{
    "service": {
        "properties": {
            "name": {
                "type" : "string"
            },
            "tag": {
                "type" : "string"
            },
            "suggest_field": {
                "type": "completion",
                "context": {
                    "color": { <a id="CO44-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
                        "type": "category",
                        "path": "color_field",
                        "default": ["red", "green", "blue"]
                    },
                    "location": { <a id="CO44-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
                        "type": "geo",
                        "precision": "5m",
                        "neighbors": true,
                        "default": "u33"
                    }
                }
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO44-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
See <a class="xref" href="suggester-context.html#suggester-context-category" title="Category Contextedit">the section called “Category Context</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/context-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>”
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO44-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
See <a class="xref" href="suggester-context.html#suggester-context-geo" title="Geo location Contextedit">the section called “Geo location Context</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/context-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>”
</p></td></tr></tbody></table></div><p>However contexts are specified (as type <code class="literal">category</code> or <code class="literal">geo</code>, which are discussed below), each
context value generates a new sub-set of documents which can be queried by the completion
suggester. All three types accept a <code class="literal">default</code> parameter which provides a default value to use
if the corresponding context value is absent.</p><p>The basic structure of this element is that each field forms a new context and the fieldname
is used to reference this context information later on during indexing or querying. All context
mappings have the <code class="literal">default</code> and the <code class="literal">type</code> option in common. The value of the <code class="literal">default</code> field
is used, when ever no specific is provided for the certain context. Note that a context is
defined by at least one value. The <code class="literal">type</code> option defines the kind of information hold by this
context. These type will be explained further in the following sections.</p><h4><a id="suggester-context-category"></a>Category Context<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/context-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">category</code> context allows you to specify one or more categories in the document at index time.
The document will be assigned to each named category, which can then be queried later. The category
type also allows to specify a field to extract the categories from. The <code class="literal">path</code> parameter is used to
specify this field of the documents that should be used. If the referenced field contains multiple
values, all these values will be used as alternative categories.</p><h5><a id="_category_mapping"></a>Category Mapping<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/context-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>The mapping for a category is simply defined by its <code class="literal">default</code> values. These can either be
defined as list of <span class="strong emphasis"><strong>default</strong></span> categories:</p><div class="pre_wrapper"><pre class="programlisting">"context": {
    "color": {
        "type": "category",
        "default": ["red", "orange"]
    }
}</pre></div><p>or as a single value</p><div class="pre_wrapper"><pre class="programlisting">"context": {
    "color": {
        "type": "category",
        "default": "red"
    }
}</pre></div><p>or as reference to another field within the documents indexed:</p><div class="pre_wrapper"><pre class="programlisting">"context": {
    "color": {
        "type": "category",
        "default": "red",
        "path": "color_field"
    }
}</pre></div><p>in this case the <span class="strong emphasis"><strong>default</strong></span> categories will only be used, if the given field does not
exist within the document. In the example above the categories are received from a
field named <code class="literal">color_field</code>. If this field does not exist a category <span class="strong emphasis"><strong>red</strong></span> is assumed for
the context <span class="strong emphasis"><strong>color</strong></span>.</p><h5><a id="_indexing_category_contexts"></a>Indexing category contexts<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/context-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Within a document the category is specified either as an <code class="literal">array</code> of values, a
single value or <code class="literal">null</code>. A list of values is interpreted as alternative categories. So
a document belongs to all the categories defined. If the category is <code class="literal">null</code> or remains
unset the categories will be retrieved from the documents field addressed by the <code class="literal">path</code>
parameter. If this value is not set or the field is missing, the default values of the
mapping will be assigned to the context.</p><div class="pre_wrapper"><pre class="programlisting">PUT services/service/1
{
    "name": "knapsack",
    "suggest_field": {
        "input": ["knacksack", "backpack", "daypack"],
        "context": {
            "color": ["red", "yellow"]
        }
    }
}</pre></div><h5><a id="_category_query"></a>Category Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/context-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>A query within a category works similar to the configuration. If the value is <code class="literal">null</code>
the mappings default categories will be used. Otherwise the suggestion takes place
for all documents that have at least one category in common with the query.</p><div class="pre_wrapper"><pre class="programlisting">POST services/_suggest?pretty'
{
    "suggest" : {
        "text" : "m",
        "completion" : {
            "field" : "suggest_field",
            "size": 10,
            "context": {
                "color": "red"
            }
        }
    }
}</pre></div><h4><a id="suggester-context-geo"></a>Geo location Context<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/context-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>A <code class="literal">geo</code> context allows you to limit results to those that lie within a certain distance
of a specified geolocation. At index time, a lat/long geo point is converted into a
geohash of a certain precision, which provides the context.</p><h5><a id="_geo_location_mapping"></a>Geo location Mapping<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/context-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>The mapping for a geo context accepts four settings, only of which <code class="literal">precision</code> is required:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">precision</code>
</p>
</td><td class="entry" valign="top">
<p>
This defines the precision of the geohash and can be specified as <code class="literal">5m</code>, <code class="literal">10km</code>,
               or as a raw geohash precision: <code class="literal">1</code>..<code class="literal">12</code>. It’s also possible to setup multiple
               precisions by defining a list of precisions: <code class="literal">["5m", "10km"]</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">neighbors</code>
</p>
</td><td class="entry" valign="top">
<p>
Geohashes are rectangles, so a geolocation, which in reality is only 1 metre
               away from the specified point, may fall into the neighbouring rectangle. Set
               <code class="literal">neighbours</code> to <code class="literal">true</code> to include the neighbouring geohashes in the context.
               (default is <span class="strong emphasis"><strong>on</strong></span>)
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">path</code>
</p>
</td><td class="entry" valign="top">
<p>
Optionally specify a field to use to look up the geopoint.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">default</code>
</p>
</td><td class="entry" valign="top">
<p>
The geopoint to use if no geopoint has been specified.
</p>
</td></tr></tbody></table></div><p>Since all locations of this mapping are translated into geohashes, each location matches
a geohash cell. So some results that lie within the specified range but not in the same
cell as the query location will not match. To avoid this the <code class="literal">neighbors</code> option allows a
matching of cells that join the bordering regions of the documents location. This option
is turned on by default.
If a document or a query doesn’t define a location a value to use instead can defined by
the <code class="literal">default</code> option. The value of this option supports all the ways a <code class="literal">geo_point</code> can be
defined. The <code class="literal">path</code> refers to another field within the document to retrieve the
location. If this field contains multiple values, the document will be linked to all these
locations.</p><div class="pre_wrapper"><pre class="programlisting">"context": {
    "location": {
        "type": "geo",
        "precision": ["1km", "5m"],
        "neighbors": true,
        "path": "pin",
        "default": {
            "lat": 0.0,
            "lon": 0.0
        }
    }
}</pre></div><h5><a id="_geo_location_config"></a>Geo location Config<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/context-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Within a document a geo location retrieved from the mapping definition can be overridden
by another location. In this case the context mapped to a geo location supports all
variants of defining a <code class="literal">geo_point</code>.</p><div class="pre_wrapper"><pre class="programlisting">PUT services/service/1
{
    "name": "some hotel 1",
    "suggest_field": {
        "input": ["my hotel", "this hotel"],
        "context": {
            "location": {
                    "lat": 0,
                    "lon": 0
            }
        }
    }
}</pre></div><h5><a id="_geo_location_query"></a>Geo location Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/suggesters/context-suggest.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Like in the configuration, querying with a geo location in context, the geo location
query supports all representations of a <code class="literal">geo_point</code> to define the location. In this
simple case all precision values defined in the mapping will be applied to the given
location.</p><div class="pre_wrapper"><pre class="programlisting">POST services/_suggest
{
    "suggest" : {
        "text" : "m",
        "completion" : {
            "field" : "suggest_field",
            "size": 10,
            "context": {
                "location": {
                    "lat": 0,
                    "lon": 0
                }
            }
        }
    }
}</pre></div><p>But it also possible to set a subset of the precisions set in the mapping, by using the
<code class="literal">precision</code> parameter. Like in the mapping, this parameter is allowed to be set to a
single precision value or a list of these.</p><div class="pre_wrapper"><pre class="programlisting">POST services/_suggest
{
    "suggest" : {
        "text" : "m",
        "completion" : {
            "field" : "suggest_field",
            "size": 10,
            "context": {
                "location": {
                    "value": {
                        "lat": 0,
                        "lon": 0
                    },
                    "precision": "1km"
                }
            }
        }
    }
}</pre></div><p>A special form of the query is defined by an extension of the object representation of
the <code class="literal">geo_point</code>. Using this representation allows to set the <code class="literal">precision</code> parameter within
the location itself:</p><div class="pre_wrapper"><pre class="programlisting">POST services/_suggest
{
    "suggest" : {
        "text" : "m",
        "completion" : {
            "field" : "suggest_field",
            "size": 10,
            "context": {
                "location": {
                        "lat": 0,
                        "lon": 0,
                        "precision": "1km"
                }
            }
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="search-suggesters-completion.html">
              «&nbsp;
              Completion Suggester</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-multi-search.html">Multi Search API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-node">Multi Search API</span></div><div class="navheader"><span class="prev"><a href="suggester-context.html">
              «&nbsp;
              Context Suggester</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-count.html">Count API
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-multi-search"></a>Multi Search API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/multi-search.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The multi search API allows to execute several search requests within
the same API. The endpoint for it is <code class="literal">_msearch</code>.</p><p>The format of the request is similar to the bulk API format, and the
structure is as follows (the structure is specifically optimized to
reduce parsing if a specific search ends up redirected to another node):</p><div class="pre_wrapper"><pre class="programlisting">header\n
body\n
header\n
body\n</pre></div><p>The header part includes which index / indices to search on, optional
(mapping) types to search on, the <code class="literal">search_type</code>, <code class="literal">preference</code>, and
<code class="literal">routing</code>. The body includes the typical search body request (including
the <code class="literal">query</code>, <code class="literal">facets</code>, <code class="literal">from</code>, <code class="literal">size</code>, and so on). Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">$ cat requests
{"index" : "test"}
{"query" : {"match_all" : {}}, "from" : 0, "size" : 10}
{"index" : "test", "search_type" : "count"}
{"query" : {"match_all" : {}}}
{}
{"query" : {"match_all" : {}}}

{"query" : {"match_all" : {}}}
{"search_type" : "count"}
{"query" : {"match_all" : {}}}

$ curl -XGET localhost:9200/_msearch --data-binary "@requests"; echo</pre></div><p>Note, the above includes an example of an empty header (can also be just
without any content) which is supported as well.</p><p>The response returns a <code class="literal">responses</code> array, which includes the search
response for each search request matching its order in the original
multi search request. If there was a complete failure for that specific
search request, an object with <code class="literal">error</code> message will be returned in place
of the actual search response.</p><p>The endpoint allows to also search against an index/indices and
type/types in the URI itself, in which case it will be used as the
default unless explicitly defined otherwise in the header. For example:</p><div class="pre_wrapper"><pre class="programlisting">$ cat requests
{}
{"query" : {"match_all" : {}}, "from" : 0, "size" : 10}
{}
{"query" : {"match_all" : {}}}
{"index" : "test2"}
{"query" : {"match_all" : {}}}

$ curl -XGET localhost:9200/test/_msearch --data-binary @requests; echo</pre></div><p>The above will execute the search against the <code class="literal">test</code> index for all the
requests that don’t define an index, and the last one will be executed
against the <code class="literal">test2</code> index.</p><p>The <code class="literal">search_type</code> can be set in a similar manner to globally apply to
all search requests.</p><h3><a id="msearch-security"></a>Security<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/multi-search.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>See <a class="xref" href="url-access-control.html" title="URL-based access control"><em>URL-based access control</em></a></p></div><div class="navfooter"><span class="prev"><a href="suggester-context.html">
              «&nbsp;
              Context Suggester</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-count.html">Count API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-node">Count API</span></div><div class="navheader"><span class="prev"><a href="search-multi-search.html">
              «&nbsp;
              Multi Search API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-exists.html">Search Exists API
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-count"></a>Count API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/count.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The count API allows to easily execute a query and get the number of
matches for that query. It can be executed across one or more indices
and across one or more types. The query can either be provided using a
simple query string as a parameter, or using the
<a class="link" href="query-dsl.html" title="Query DSL">Query DSL</a> defined within the request
body. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/twitter/tweet/_count?q=user:kimchy'

$ curl -XGET 'http://localhost:9200/twitter/tweet/_count' -d '
{
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}'</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The query being sent in the body must be nested in a <code class="literal">query</code> key, same as
the <a class="link" href="search-search.html" title="Search">search api</a> works</p></div></div><p>Both examples above do the same thing, which is count the number of
tweets from the twitter index for a certain user. The result is:</p><div class="pre_wrapper"><pre class="programlisting">{
    "count" : 1,
    "_shards" : {
        "total" : 5,
        "successful" : 5,
        "failed" : 0
    }
}</pre></div><p>The query is optional, and when not provided, it will use <code class="literal">match_all</code> to
count all the docs.</p><h3><a id="_multi_index_multi_type"></a>Multi index, Multi type<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/count.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The count API can be applied to <a class="link" href="search-search.html#search-multi-index-type" title="Multi-Index, Multi-Typeedit">multiple types in multiple indices</a>.</p><h3><a id="_request_parameters"></a>Request Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/count.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>When executing count using the query parameter <code class="literal">q</code>, the query passed is
a query string using Lucene query parser. There are additional
parameters that can be passed:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th class="entry" align="left" valign="top">Name </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">df</code></p></td><td class="entry" align="left" valign="top"><p>The default field to use when no field prefix is defined within the
query.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td class="entry" align="left" valign="top"><p>The analyzer name to be used when analyzing the query string.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">default_operator</code></p></td><td class="entry" align="left" valign="top"><p>The default operator to be used, can be <code class="literal">AND</code> or
<code class="literal">OR</code>. Defaults to <code class="literal">OR</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">lenient</code></p></td><td class="entry" align="left" valign="top"><p>If set to true will cause format based failures (like
providing text to a numeric field) to be ignored. Defaults to false.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">lowercase_expanded_terms</code></p></td><td class="entry" align="left" valign="top"><p>Should terms be automatically lowercased or
not. Defaults to <code class="literal">true</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">analyze_wildcard</code></p></td><td class="entry" align="left" valign="top"><p>Should wildcard and prefix queries be analyzed or
not. Defaults to <code class="literal">false</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">terminate_after</code></p></td><td class="entry" align="left" valign="top"><p><span class="experimental">
      [<span class="experimental_title">experimental</span>]
      <span class="detail">
The API for this feature may change in the future
</span></span>
The maximum count for each shard, upon reaching which the query execution
will terminate early. If set, the response will have a boolean field
<code class="literal">terminated_early</code> to indicate whether the query execution has actually
terminated_early. Defaults to no terminate_after.</p></td></tr></tbody></table></div><h3><a id="_request_body"></a>Request Body<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/count.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The count can use the <a class="link" href="query-dsl.html" title="Query DSL">Query DSL</a> within
its body in order to express the query that should be executed. The body
content can also be passed as a REST parameter named <code class="literal">source</code>.</p><p>Both HTTP GET and HTTP POST can be used to execute count with body.
Since not all clients support GET with body, POST is allowed as well.</p><h3><a id="_distributed"></a>Distributed<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/count.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The count operation is broadcast across all shards. For each shard id
group, a replica is chosen and executed against it. This means that
replicas increase the scalability of count.</p><h3><a id="_routing"></a>Routing<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/count.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The routing value (a comma separated list of the routing values) can be
specified to control which shards the count request will be executed on.</p></div><div class="navfooter"><span class="prev"><a href="search-multi-search.html">
              «&nbsp;
              Multi Search API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-exists.html">Search Exists API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-node">Search Exists API</span></div><div class="navheader"><span class="prev"><a href="search-count.html">
              «&nbsp;
              Count API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-validate.html">Validate API
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-exists"></a>Search Exists API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/exists.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The exists API allows to easily determine if any
matching documents exist for a provided query. It can be executed across one or more indices
and across one or more types. The query can either be provided using a
simple query string as a parameter, or using the
<a class="link" href="query-dsl.html" title="Query DSL">Query DSL</a> defined within the request
body. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/twitter/tweet/_search/exists?q=user:kimchy'

$ curl -XGET 'http://localhost:9200/twitter/tweet/_search/exists' -d '
{
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}'</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The query being sent in the body must be nested in a <code class="literal">query</code> key, same as
how the <a class="link" href="search-search.html" title="Search">search api</a> works.</p></div></div><p>Both the examples above do the same thing, which is determine the existence of
tweets from the twitter index for a certain user. The response body will be of
the following format:</p><div class="pre_wrapper"><pre class="programlisting">{
    "exists" : true
}</pre></div><h3><a id="_multi_index_multi_type_2"></a>Multi index, Multi type<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/exists.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The exists API can be applied to <a class="link" href="search-search.html#search-multi-index-type" title="Multi-Index, Multi-Typeedit">multiple types in multiple indices</a>.</p><h3><a id="_request_parameters_2"></a>Request Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/exists.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>When executing exists using the query parameter <code class="literal">q</code>, the query passed is
a query string using Lucene query parser. There are additional
parameters that can be passed:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th class="entry" align="left" valign="top">Name </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">df</code></p></td><td class="entry" align="left" valign="top"><p>The default field to use when no field prefix is defined within the
query.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td class="entry" align="left" valign="top"><p>The analyzer name to be used when analyzing the query string.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">default_operator</code></p></td><td class="entry" align="left" valign="top"><p>The default operator to be used, can be <code class="literal">AND</code> or
<code class="literal">OR</code>. Defaults to <code class="literal">OR</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">lenient</code></p></td><td class="entry" align="left" valign="top"><p>If set to true will cause format based failures (like
providing text to a numeric field) to be ignored. Defaults to false.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">lowercase_expanded_terms</code></p></td><td class="entry" align="left" valign="top"><p>Should terms be automatically lowercased or
not. Defaults to <code class="literal">true</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">analyze_wildcard</code></p></td><td class="entry" align="left" valign="top"><p>Should wildcard and prefix queries be analyzed or
not. Defaults to <code class="literal">false</code>.</p></td></tr></tbody></table></div><h3><a id="_request_body_2"></a>Request Body<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/exists.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The exists API can use the <a class="link" href="query-dsl.html" title="Query DSL">Query DSL</a> within
its body in order to express the query that should be executed. The body
content can also be passed as a REST parameter named <code class="literal">source</code>.</p><p>HTTP GET and HTTP POST can be used to execute exists with body.
Since not all clients support GET with body, POST is allowed as well.</p><h3><a id="_distributed_2"></a>Distributed<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/exists.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The exists operation is broadcast across all shards. For each shard id
group, a replica is chosen and executed against it. This means that
replicas increase the scalability of exists. The exists operation also
early terminates shard requests once the first shard reports matched
document existence.</p><h3><a id="_routing_2"></a>Routing<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/exists.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The routing value (a comma separated list of the routing values) can be
specified to control which shards the exists request will be executed on.</p></div><div class="navfooter"><span class="prev"><a href="search-count.html">
              «&nbsp;
              Count API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-validate.html">Validate API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-node">Validate API</span></div><div class="navheader"><span class="prev"><a href="search-exists.html">
              «&nbsp;
              Search Exists API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-explain.html">Explain API
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-validate"></a>Validate API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/validate.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The validate API allows a user to validate a potentially expensive query
without executing it. The following example shows how it can be used:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'http://localhost:9200/twitter/tweet/1' -d '{
    "user" : "kimchy",
    "post_date" : "2009-11-15T14:12:12",
    "message" : "trying out Elasticsearch"
}'</pre></div><p>When the query is valid, the response contains <code class="literal">valid:true</code>:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/_validate/query?q=user:foo'
{"valid":true,"_shards":{"total":1,"successful":1,"failed":0}}</pre></div><h3><a id="_request_parameters_3"></a>Request Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/validate.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>When executing exists using the query parameter <code class="literal">q</code>, the query passed is
a query string using Lucene query parser. There are additional
parameters that can be passed:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th class="entry" align="left" valign="top">Name </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">df</code></p></td><td class="entry" align="left" valign="top"><p>The default field to use when no field prefix is defined within the
query.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td class="entry" align="left" valign="top"><p>The analyzer name to be used when analyzing the query string.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">default_operator</code></p></td><td class="entry" align="left" valign="top"><p>The default operator to be used, can be <code class="literal">AND</code> or
<code class="literal">OR</code>. Defaults to <code class="literal">OR</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">lenient</code></p></td><td class="entry" align="left" valign="top"><p>If set to true will cause format based failures (like
providing text to a numeric field) to be ignored. Defaults to false.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">lowercase_expanded_terms</code></p></td><td class="entry" align="left" valign="top"><p>Should terms be automatically lowercased or
not. Defaults to <code class="literal">true</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">analyze_wildcard</code></p></td><td class="entry" align="left" valign="top"><p>Should wildcard and prefix queries be analyzed or
not. Defaults to <code class="literal">false</code>.</p></td></tr></tbody></table></div><p>Or, with a request body:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/tweet/_validate/query' -d '{
  "query" : {
    "filtered" : {
      "query" : {
        "query_string" : {
          "query" : "*:*"
        }
      },
      "filter" : {
        "term" : { "user" : "kimchy" }
      }
    }
  }
}'
{"valid":true,"_shards":{"total":1,"successful":1,"failed":0}}</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The query being sent in the body must be nested in a <code class="literal">query</code> key, same as
the <a class="link" href="search-search.html" title="Search">search api</a> works</p></div></div><p>If the query is invalid, <code class="literal">valid</code> will be <code class="literal">false</code>. Here the query is
invalid because Elasticsearch knows the post_date field should be a date
due to dynamic mapping, and <span class="emphasis"><em>foo</em></span> does not correctly parse into a date:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/tweet/_validate/query?q=post_date:foo'
{"valid":false,"_shards":{"total":1,"successful":1,"failed":0}}</pre></div><p>An <code class="literal">explain</code> parameter can be specified to get more detailed information
about why a query failed:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/tweet/_validate/query?q=post_date:foo&amp;pretty=true&amp;explain=true'
{
  "valid" : false,
  "_shards" : {
    "total" : 1,
    "successful" : 1,
    "failed" : 0
  },
  "explanations" : [ {
    "index" : "twitter",
    "valid" : false,
    "error" : "org.elasticsearch.index.query.QueryParsingException: [twitter] Failed to parse; org.elasticsearch.ElasticsearchParseException: failed to parse date field [foo], tried both date format [dateOptionalTime], and timestamp number; java.lang.IllegalArgumentException: Invalid format: \"foo\""
  } ]
}</pre></div><p><span class="added">
      [<span class="version">1.6.0</span>]
      <span class="detail">Added in 1.6.0.
</span></span> When the query is valid, the explanation defaults to the string
representation of that query. With <code class="literal">rewrite</code> set to <code class="literal">true</code>, the explanation
is more detailed showing the actual Lucene query that will be executed.</p><p>For Fuzzy Queries:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/imdb/movies/_validate/query?rewrite=true'
{
  "query": {
    "fuzzy": {
      "actors": "kyle"
    }
  }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
   "valid": true,
   "_shards": {
      "total": 1,
      "successful": 1,
      "failed": 0
   },
   "explanations": [
      {
         "index": "imdb",
         "valid": true,
         "explanation": "filtered(plot:kyle plot:kylie^0.75 plot:kyne^0.75 plot:lyle^0.75 plot:pyle^0.75)-&gt;cache(_type:movies)"
      }
   ]
}</pre></div><p>For More Like This:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/imdb/movies/_validate/query?rewrite=true'
{
  "query": {
    "more_like_this": {
      "like": {
        "_id": "88247"
      },
      "boost_terms": 1
    }
  }
}</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
   "valid": true,
   "_shards": {
      "total": 1,
      "successful": 1,
      "failed": 0
   },
   "explanations": [
      {
         "index": "imdb",
         "valid": true,
         "explanation": "filtered(((title:terminator^3.71334 plot:future^2.763601 plot:human^2.8415773 plot:sarah^3.4193945 plot:kyle^3.8244398 plot:cyborg^3.9177752 plot:connor^4.040236 plot:reese^4.7133346 ... )~6) -ConstantScore(_uid:movies#88247))-&gt;cache(_type:movies)"
      }
   ]
}</pre></div><div class="caution admon"><div class="icon"><img alt="Caution" src="images/icons/caution.png"></div><div class="admon_content"><p>The request is executed on a single shard only, which is randomly
selected. The detailed explanation of the query may depend on which shard is
being hit, and therefore may vary from one request to another.</p></div></div></div><div class="navfooter"><span class="prev"><a href="search-exists.html">
              «&nbsp;
              Search Exists API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-explain.html">Explain API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-node">Explain API</span></div><div class="navheader"><span class="prev"><a href="search-validate.html">
              «&nbsp;
              Validate API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-percolate.html">Percolator
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-explain"></a>Explain API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/explain.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The explain api computes a score explanation for a query and a specific
document. This can give useful feedback whether a document matches or
didn’t match a specific query.</p><p>The <code class="literal">index</code> and <code class="literal">type</code> parameters expect a single index and a single
type respectively.</p><h3><a id="_usage_2"></a>Usage<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/explain.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Full query example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/twitter/tweet/1/_explain' -d '{
      "query" : {
        "term" : { "message" : "search" }
      }
}'</pre></div><p>This will yield the following result:</p><div class="pre_wrapper"><pre class="programlisting">{
  "matches" : true,
  "explanation" : {
    "value" : 0.15342641,
    "description" : "fieldWeight(message:search in 0), product of:",
    "details" : [ {
      "value" : 1.0,
      "description" : "tf(termFreq(message:search)=1)"
    }, {
      "value" : 0.30685282,
      "description" : "idf(docFreq=1, maxDocs=1)"
    }, {
      "value" : 0.5,
      "description" : "fieldNorm(field=message, doc=0)"
    } ]
  }
}</pre></div><p>There is also a simpler way of specifying the query via the <code class="literal">q</code>
parameter. The specified <code class="literal">q</code> parameter value is then parsed as if the
<code class="literal">query_string</code> query was used. Example usage of the <code class="literal">q</code> parameter in the
explain api:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/twitter/tweet/1/_explain?q=message:search'</pre></div><p>This will yield the same result as the previous request.</p><h3><a id="_all_parameters_2"></a>All parameters:<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/explain.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">_source</code>
</p>
</td><td class="entry" valign="top">
<p>
    Set to <code class="literal">true</code> to retrieve the <code class="literal">_source</code> of the document explained. You can also
    retrieve part of the document by using <code class="literal">_source_include</code> &amp; <code class="literal">_source_exclude</code> (see <a class="link" href="docs-get.html#get-source-filtering" title="Source filteringedit">Get API</a> for more details)
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">fields</code>
</p>
</td><td class="entry" valign="top">
<p>
    Allows to control which stored fields to return as part of the
    document explained.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">routing</code>
</p>
</td><td class="entry" valign="top">
<p>
    Controls the routing in the case the routing was used
    during indexing.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">parent</code>
</p>
</td><td class="entry" valign="top">
<p>
    Same effect as setting the routing parameter.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">preference</code>
</p>
</td><td class="entry" valign="top">
<p>
    Controls on which shard the explain is executed.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">source</code>
</p>
</td><td class="entry" valign="top">
<p>
    Allows the data of the request to be put in the query
    string of the url.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">q</code>
</p>
</td><td class="entry" valign="top">
<p>
    The query string (maps to the query_string query).
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">df</code>
</p>
</td><td class="entry" valign="top">
<p>
    The default field to use when no field prefix is defined within
    the query. Defaults to _all field.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">analyzer</code>
</p>
</td><td class="entry" valign="top">
<p>
    The analyzer name to be used when analyzing the query
    string. Defaults to the analyzer of the _all field.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">analyze_wildcard</code>
</p>
</td><td class="entry" valign="top">
<p>
    Should wildcard and prefix queries be analyzed or
    not. Defaults to false.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">lowercase_expanded_terms</code>
</p>
</td><td class="entry" valign="top">
<p>
    Should terms be automatically lowercased
    or not. Defaults to true.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">lenient</code>
</p>
</td><td class="entry" valign="top">
<p>
    If set to true will cause format based failures (like
    providing text to a numeric field) to be ignored. Defaults to false.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">default_operator</code>
</p>
</td><td class="entry" valign="top">
<p>
    The default operator to be used, can be AND or
    OR. Defaults to OR.
</p>
</td></tr></tbody></table></div></div><div class="navfooter"><span class="prev"><a href="search-validate.html">
              «&nbsp;
              Validate API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-percolate.html">Percolator
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-node">Percolator</span></div><div class="navheader"><span class="prev"><a href="search-explain.html">
              «&nbsp;
              Explain API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-more-like-this.html">More Like This API
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-percolate"></a>Percolator<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/percolate.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Traditionally you design documents based on your data, store them into an index, and then define queries via the search API
in order to retrieve these documents. The percolator works in the opposite direction. First you store queries into an
index and then, via the percolate API, you define documents in order to retrieve these queries.</p><p>The reason that queries can be stored comes from the fact that in Elasticsearch both documents and queries are defined in
JSON. This allows you to embed queries into documents via the index API. Elasticsearch can extract the query from a
document and make it available to the percolate API. Since documents are also defined as JSON, you can define a document
in a request to the percolate API.</p><p>The percolator and most of its features work in realtime, so once a percolate query is indexed it can immediately be used
in the percolate API.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png"></div><div class="admon_content"><p>Fields referred to in a percolator query must <span class="strong emphasis"><strong>already</strong></span> exist in the mapping
associated with the index used for percolation.
There are two ways to make sure that a field mapping exist:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Add or update a mapping via the <a class="link" href="indices-create-index.html" title="Create Index">create index</a> or
  <a class="link" href="indices-put-mapping.html" title="Put Mapping">put mapping</a> APIs.
</li><li class="listitem">
Percolate a document before registering a query. Percolating a document can
  add field mappings dynamically, in the same way as happens when indexing a
  document.
</li></ul></div></div></div><h3><a id="_sample_usage"></a>Sample Usage<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/percolate.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Create an index with a mapping for the field <code class="literal">message</code>:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'localhost:9200/my-index' -d '{
  "mappings": {
    "my-type": {
      "properties": {
        "message": {
          "type": "string"
        }
      }
    }
  }
}'</pre></div><p>Register a query in the percolator:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'localhost:9200/my-index/.percolator/1' -d '{
    "query" : {
        "match" : {
            "message" : "bonsai tree"
        }
    }
}'</pre></div><p>Match a document to the registered percolator queries:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/my-index/my-type/_percolate' -d '{
    "doc" : {
        "message" : "A new bonsai tree in the office"
    }
}'</pre></div><p>The above request will yield the following response:</p><div class="pre_wrapper"><pre class="programlisting">{
    "took" : 19,
    "_shards" : {
        "total" : 5,
        "successful" : 5,
        "failed" : 0
    },
    "total" : 1,
    "matches" : [ <a id="CO45-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
        {
          "_index" : "my-index",
          "_id" : "1"
        }
    ]
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO45-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The percolate query with id <code class="literal">1</code> matches our document.
</p></td></tr></tbody></table></div><h3><a id="_indexing_percolator_queries"></a>Indexing Percolator Queries<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/percolate.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Percolate queries are stored as documents in a specific format and in an arbitrary index under a reserved type with the
name <code class="literal">.percolator</code>. The query itself is placed as is in a JSON object under the top level field <code class="literal">query</code>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
                "match" : {
                        "field" : "value"
                }
        }
}</pre></div><p>Since this is just an ordinary document, any field can be added to this document. This can be useful later on to only
percolate documents by specific queries.</p><div class="pre_wrapper"><pre class="programlisting">{
        "query" : {
                "match" : {
                        "field" : "value"
                }
        },
        "priority" : "high"
}</pre></div><p>On top of this, also a mapping type can be associated with this query. This allows to control how certain queries
like range queries, shape filters, and other query &amp; filters that rely on mapping settings get constructed. This is
important since the percolate queries are indexed into the <code class="literal">.percolator</code> type, and the queries / filters that rely on
mapping settings would yield unexpected behaviour. Note: By default, field names do get resolved in a smart manner,
but in certain cases with multiple types this can lead to unexpected behavior, so being explicit about it will help.</p><div class="pre_wrapper"><pre class="programlisting">{
        "query" : {
                "range" : {
                        "created_at" : {
                                "gte" : "2010-01-01T00:00:00",
                                "lte" : "2011-01-01T00:00:00"
                        }
                }
        },
        "type" : "tweet",
        "priority" : "high"
}</pre></div><p>In the above example the range query really gets parsed into a Lucene numeric range query, based on the settings for
the field <code class="literal">created_at</code> in the type <code class="literal">tweet</code>.</p><p>Just as with any other type, the <code class="literal">.percolator</code> type has a mapping, which you can configure via the mappings APIs.
The default percolate mapping doesn’t index the query field, only stores it.</p><p>Because <code class="literal">.percolate</code> is a type it also has a mapping. By default the following mapping is active:</p><div class="pre_wrapper"><pre class="programlisting">{
        ".percolator" : {
                "properties" : {
                        "query" : {
                                "type" : "object",
                                "enabled" : false
                        }
                }
        }
}</pre></div><p>If needed, this mapping can be modified with the update mapping API.</p><p>In order to un-register a percolate query the delete API can be used. So if the previous added query needs to be deleted
the following delete requests needs to be executed:</p><div class="pre_wrapper"><pre class="programlisting">curl -XDELETE localhost:9200/my-index/.percolator/1</pre></div><h3><a id="_percolate_api"></a>Percolate API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/percolate.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The percolate API executes in a distributed manner, meaning it executes on all shards an index points to.</p><div class="itemizedlist"><p class="title"><strong>Required options</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">index</code> - The index that contains the <code class="literal">.percolator</code> type. This can also be an alias.
</li><li class="listitem">
<code class="literal">type</code> - The type of the document to be percolated. The mapping of that type is used to parse document.
</li><li class="listitem">
<code class="literal">doc</code> - The actual document to percolate. Unlike the other two options this needs to be specified in the request body. Note: This isn’t required when percolating an existing document.
</li></ul></div><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/twitter/tweet/_percolate' -d '{
        "doc" : {
                "created_at" : "2010-10-10T00:00:00",
                "message" : "some text"
        }
}'</pre></div><div class="itemizedlist"><p class="title"><strong>Additional supported query string options</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">routing</code> - In case the percolate queries are partitioned by a custom routing value, that routing option makes sure
that the percolate request only gets executed on the shard where the routing value is partitioned to. This means that
the percolate request only gets executed on one shard instead of all shards. Multiple values can be specified as a
comma separated string, in that case the request can be be executed on more than one shard.
</li><li class="listitem">
<code class="literal">preference</code> - Controls which shard replicas are preferred to execute the request on. Works the same as in the search API.
</li><li class="listitem">
<code class="literal">ignore_unavailable</code> - Controls if missing concrete indices should silently be ignored. Same as is in the search API.
</li><li class="listitem">
<code class="literal">percolate_format</code> - If <code class="literal">ids</code> is specified then the matches array in the percolate response will contain a string
array of the matching ids instead of an array of objects. This can be useful to reduce the amount of data being send
back to the client. Obviously if there are two percolator queries with same id from different indices there is no way
to find out which percolator query belongs to what index. Any other value to <code class="literal">percolate_format</code> will be ignored.
</li></ul></div><div class="itemizedlist"><p class="title"><strong>Additional request body options</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">filter</code> - Reduces the number queries to execute during percolating. Only the percolator queries that match with the
filter will be included in the percolate execution. The filter option works in near realtime, so a refresh needs to have
occurred for the filter to included the latest percolate queries.
</li><li class="listitem">
<code class="literal">query</code> - Same as the <code class="literal">filter</code> option, but also the score is computed. The computed scores can then be used by the
<code class="literal">track_scores</code> and <code class="literal">sort</code> option.
</li><li class="listitem">
<code class="literal">size</code> - Defines to maximum number of matches (percolate queries) to be returned. Defaults to unlimited.
</li><li class="listitem">
<code class="literal">track_scores</code> - Whether the <code class="literal">_score</code> is included for each match. The <code class="literal">_score</code> is based on the query and represents
how the query matched the <span class="strong emphasis"><strong>percolate query’s metadata</strong></span>, <span class="strong emphasis"><strong>not</strong></span> how the document (that is being percolated) matched
the query. The <code class="literal">query</code> option is required for this option. Defaults to <code class="literal">false</code>.
</li><li class="listitem">
<code class="literal">sort</code> - Define a sort specification like in the search API. Currently only sorting <code class="literal">_score</code> reverse (default relevancy)
is supported. Other sort fields will throw an exception. The <code class="literal">size</code> and <code class="literal">query</code> option are required for this setting. Like
<code class="literal">track_score</code> the score is based on the query and represents how the query matched to the percolate query’s metadata
and <span class="strong emphasis"><strong>not</strong></span> how the document being percolated matched to the query.
</li><li class="listitem">
<code class="literal">facets</code> - Allows facet definitions to be included. The facets are based on the matching percolator queries. See facet
documentation how to define facets.
</li><li class="listitem">
<code class="literal">aggs</code> - Allows aggregation definitions to be included. The aggregations are based on the matching percolator queries,
look at the aggregation documentation on how to define aggregations.
</li><li class="listitem">
<code class="literal">highlight</code> - Allows highlight definitions to be included. The document being percolated is being highlight for each
matching query. This allows you to see how each match is highlighting the document being percolated. See highlight
documentation on how to define highlights. The <code class="literal">size</code> option is required for highlighting, the performance of highlighting
 in the percolate API depends of how many matches are being highlighted.
</li></ul></div><h3><a id="_dedicated_percolator_index"></a>Dedicated Percolator Index<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/percolate.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Percolate queries can be added to any index. Instead of adding percolate queries to the index the data resides in,
these queries can also be added to a dedicated index. The advantage of this is that this dedicated percolator index
can have its own index settings (For example the number of primary and replica shards). If you choose to have a dedicated
percolate index, you need to make sure that the mappings from the normal index are also available on the percolate index.
Otherwise percolate queries can be parsed incorrectly.</p><h3><a id="_filtering_executed_queries"></a>Filtering Executed Queries<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/percolate.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Filtering allows to reduce the number of queries, any filter that the search API supports, (except the ones mentioned in important notes)
can also be used in the percolate API. The filter only works on the metadata fields. The <code class="literal">query</code> field isn’t indexed by
default. Based on the query we indexed before, the following filter can be defined:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET localhost:9200/test/type1/_percolate -d '{
    "doc" : {
        "field" : "value"
    },
    "filter" : {
        "term" : {
            "priority" : "high"
        }
    }
}'</pre></div><h3><a id="_percolator_count_api"></a>Percolator Count API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/percolate.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The count percolate API, only keeps track of the number of matches and doesn’t keep track of the actual matches
Example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/my-index/my-type/_percolate/count' -d '{
   "doc" : {
       "message" : "some message"
   }
}'</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
   ... // header
   "total" : 3
}</pre></div><h3><a id="_percolating_an_existing_document"></a>Percolating an Existing Document<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/percolate.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>In order to percolate a newly indexed document, the percolate existing document can be used. Based on the response
from an index request, the <code class="literal">_id</code> and other meta information can be used to immediately percolate the newly added
document.</p><div class="itemizedlist"><p class="title"><strong>Supported options for percolating an existing document on top of existing percolator options:</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">id</code> - The id of the document to retrieve the source for.
</li><li class="listitem">
<code class="literal">percolate_index</code> - The index containing the percolate queries. Defaults to the <code class="literal">index</code> defined in the url.
</li><li class="listitem">
<code class="literal">percolate_type</code> - The percolate type (used for parsing the document). Default to <code class="literal">type</code> defined in the url.
</li><li class="listitem">
<code class="literal">routing</code> - The routing value to use when retrieving the document to percolate.
</li><li class="listitem">
<code class="literal">preference</code> - Which shard to prefer when retrieving the existing document.
</li><li class="listitem">
<code class="literal">percolate_routing</code> - The routing value to use when percolating the existing document.
</li><li class="listitem">
<code class="literal">percolate_preference</code> - Which shard to prefer when executing the percolate request.
</li><li class="listitem">
<code class="literal">version</code> - Enables a version check. If the fetched document’s version isn’t equal to the specified version then the request fails with a version conflict and the percolation request is aborted.
</li></ul></div><p>Internally the percolate API will issue a GET request for fetching the <code class="literal">_source</code> of the document to percolate.
For this feature to work, the <code class="literal">_source</code> for documents to be percolated needs to be stored.</p><h4><a id="_example_3"></a>Example<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/percolate.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Index response:</p><div class="pre_wrapper"><pre class="programlisting">{
        "_index" : "my-index",
        "_type" : "message",
        "_id" : "1",
        "_version" : 1,
        "created" : true
}</pre></div><p>Percolating an Existing Document:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/my-index1/message/1/_percolate'</pre></div><p>The response is the same as with the regular percolate API.</p><h3><a id="_multi_percolate_api"></a>Multi Percolate API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/percolate.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The multi percolate API allows to bundle multiple percolate requests into a single request, similar to what the multi
search API does to search requests. The request body format is line based. Each percolate request item takes two lines,
the first line is the header and the second line is the body.</p><p>The header can contain any parameter that normally would be set via the request path or query string parameters.
There are several percolate actions, because there are multiple types of percolate requests.</p><div class="itemizedlist"><p class="title"><strong>Supported actions:</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">percolate</code> - Action for defining a regular percolate request.
</li><li class="listitem">
<code class="literal">count</code> - Action for defining a count percolate request.
</li></ul></div><p>Depending on the percolate action different parameters can be specified. For example the percolate and percolate existing
document actions support different parameters.</p><div class="itemizedlist"><p class="title"><strong>The following endpoints are supported</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">GET|POST /[index]/[type]/_mpercolate</code>
</li><li class="listitem">
<code class="literal">GET|POST /[index]/_mpercolate</code>
</li><li class="listitem">
<code class="literal">GET|POST /_mpercolate</code>
</li></ul></div><p>The <code class="literal">index</code> and <code class="literal">type</code> defined in the url path are the default index and type.</p><h4><a id="_example_4"></a>Example<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/percolate.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Request:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/twitter/tweet/_mpercolate' --data-binary "@requests.txt"; echo</pre></div><p>The index <code class="literal">twitter</code> is the default index, and the type <code class="literal">tweet</code> is the default type and will be used in the case a header
doesn’t specify an index or type.</p><p>requests.txt:</p><div class="pre_wrapper"><pre class="programlisting">{"percolate" : {"index" : "twitter", "type" : "tweet"}}
{"doc" : {"message" : "some text"}}
{"percolate" : {"index" : "twitter", "type" : "tweet", "id" : "1"}}
{}
{"percolate" : {"index" : "users", "type" : "user", "id" : "3", "percolate_index" : "users_2012" }}
{"size" : 10}
{"count" : {"index" : "twitter", "type" : "tweet"}}
{"doc" : {"message" : "some other text"}}
{"count" : {"index" : "twitter", "type" : "tweet", "id" : "1"}}
{}</pre></div><p>For a percolate existing document item (headers with the <code class="literal">id</code> field), the response can be an empty JSON object.
All the required options are set in the header.</p><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    "responses" : [
        {
            "took" : 24,
            "_shards" : {
                "total" : 5,
                "successful" : 5,
                "failed" : 0,
            },
            "total" : 3,
            "matches" : [
                {
                    "_index": "twitter",
                    "_id": "1"
                },
                {
                    "_index": "twitter",
                    "_id": "2"
                },
                {
                    "_index": "twitter",
                    "_id": "3"
                }
            ]
        },
        {
            "took" : 12,
            "_shards" : {
                "total" : 5,
                "successful" : 5,
                "failed" : 0,
            },
            "total" : 3,
            "matches" : [
                {
                    "_index": "twitter",
                    "_id": "4"
                },
                {
                    "_index": "twitter",
                    "_id": "5"
                },
                {
                    "_index": "twitter",
                    "_id": "6"
                }
             ]
        },
        {
            "error" : "DocumentMissingException[[_na][_na] [user][3]: document missing]"
        },
        {
            "took" : 12,
            "_shards" : {
                "total" : 5,
                "successful" : 5,
                "failed" : 0,
            },
            "total" : 3
        },
        {
            "took" : 14,
            "_shards" : {
                "total" : 5,
                "successful" : 5,
                "failed" : 0,
            },
            "total" : 3
        }
    ]
}</pre></div><p>Each item represents a percolate response, the order of the items maps to the order in which the percolate requests
were specified. In case a percolate request failed, the item response is substituted with an error message.</p><h3><a id="_how_it_works_under_the_hood"></a>How it Works Under the Hood<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/percolate.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>When indexing a document that contains a query in an index and the <code class="literal">.percolator</code> type, the query part of the documents gets
parsed into a Lucene query and is kept in memory until that percolator document is removed or the index containing the
<code class="literal">.percolator</code> type gets removed. So, all the active percolator queries are kept in memory.</p><p>At percolate time, the document specified in the request gets parsed into a Lucene document and is stored in a in-memory
Lucene index. This in-memory index can just hold this one document and it is optimized for that. Then all the queries
that are registered to the index that the percolate request is targeted for, are going to be executed on this single document
in-memory index. This happens on each shard the percolate request needs to execute.</p><p>By using <code class="literal">routing</code>, <code class="literal">filter</code> or <code class="literal">query</code> features the amount of queries that need to be executed can be reduced and thus
the time the percolate API needs to run can be decreased.</p><h3><a id="_important_notes"></a>Important Notes<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/percolate.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Because the percolator API is processing one document at a time, it doesn’t support queries and filters that run
against child documents such as <code class="literal">has_child</code>, <code class="literal">has_parent</code> and <code class="literal">top_children</code>.</p><p>The <code class="literal">inner_hits</code> feature on the <code class="literal">nested</code> query isn’t supported in the percolate api.</p><p>The <code class="literal">wildcard</code> and <code class="literal">regexp</code> query natively use a lot of memory and because the percolator keeps the queries into memory
this can easily take up the available memory in the heap space. If possible try to use a <code class="literal">prefix</code> query or ngramming to
achieve the same result (with way less memory being used).</p><p>The delete-by-query API doesn’t work to unregister a query, it only deletes the percolate documents from disk. In order
to update the registered queries in memory the index needs be closed and opened.</p><h3><a id="_forcing_unmapped_fields_to_be_handled_as_strings"></a>Forcing Unmapped Fields to be Handled as Strings<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/percolate.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>In certain cases it is unknown what kind of percolator queries do get registered, and if no field mapping exists for fields
that are referred by percolator queries then adding a percolator query fails. This means the mapping needs to be updated
to have the field with the appropriate settings, and then the percolator query can be added. But sometimes it is sufficient
if all unmapped fields are handled as if these were default string fields. In those cases one can configure the
<code class="literal">index.percolator.map_unmapped_fields_as_string</code> setting to <code class="literal">true</code> (default to <code class="literal">false</code>) and then if a field referred in
a percolator query does not exist, it will be handled as a default string field so that adding the percolator query doesn’t
fail.</p></div><div class="navfooter"><span class="prev"><a href="search-explain.html">
              «&nbsp;
              Explain API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-more-like-this.html">More Like This API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-node">More Like This API</span></div><div class="navheader"><span class="prev"><a href="search-percolate.html">
              «&nbsp;
              Percolator</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-field-stats.html">Field stats API
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-more-like-this"></a>More Like This API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/more-like-this.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><h3>Deprecated in 1.6.0. </h3>
 The More Like This API will be removed in 2.0, instead use the More Like This Query
</div></div><p>The more like this (mlt) API allows to get documents that are "like" a
specified document. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/twitter/tweet/1/_mlt?mlt_fields=tag,content&amp;min_doc_freq=1'</pre></div><p>The API simply results in executing a search request with
<a class="link" href="query-dsl-mlt-query.html" title="More Like This Query">moreLikeThis</a> query (http
parameters match the parameters to the <code class="literal">more_like_this</code> query). This
means that the body of the request can optionally include all the
request body options in the <a class="link" href="search-search.html" title="Search">search API</a> (aggs, from/to and so on). Internally, the more like this
API is equivalent to performing a boolean query of <code class="literal">more_like_this_field</code>
queries, with one query per specified <code class="literal">mlt_fields</code>.</p><p>Rest parameters relating to search are also allowed, including
<code class="literal">search_type</code>, <code class="literal">search_indices</code>, <code class="literal">search_types</code>, <code class="literal">search_scroll</code>,
<code class="literal">search_size</code> and <code class="literal">search_from</code>.</p><p>When no <code class="literal">mlt_fields</code> are specified, all the fields of the document will
be used in the <code class="literal">more_like_this</code> query generated.</p><p>By default, the queried document is excluded from the response (<code class="literal">include</code>
set to false).</p><p>Note: In order to use the <code class="literal">mlt</code> feature a <code class="literal">mlt_field</code> needs to be either
be <code class="literal">stored</code>, store <code class="literal">term_vector</code> or <code class="literal">source</code> needs to be enabled.</p></div><div class="navfooter"><span class="prev"><a href="search-percolate.html">
              «&nbsp;
              Percolator</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="search-field-stats.html">Field stats API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="search.html">Search APIs</a></span> » <span class="breadcrumb-node">Field stats API</span></div><div class="navheader"><span class="prev"><a href="search-more-like-this.html">
              «&nbsp;
              More Like This API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices.html">Indices APIs
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="search-field-stats"></a>Field stats API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/field-stats.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p></div></div><p>The field stats api allows one to find statistical properties of a field
without executing a search, but looking up measurements that are natively
available in the Lucene index. This can be useful to explore a dataset which
you don’t know much about. For example, this allows creating a histogram
aggregation with meaningful intervals based on the min/max range of values.</p><p>The field stats api by defaults executes on all indices, but can execute on
specific indices too.</p><p>All indices:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET "http://localhost:9200/_field_stats?fields=rating"</pre></div><p>Specific indices:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET "http://localhost:9200/index1,index2/_field_stats?fields=rating"</pre></div><p>Supported request options:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">fields</code>
</p>
</td><td class="entry" valign="top">
<p>
A list of fields to compute stats for.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">level</code>
</p>
</td><td class="entry" valign="top">
<p>
Defines if field stats should be returned on a per index level or on a
            cluster wide level. Valid values are <code class="literal">indices</code> and <code class="literal">cluster</code> (default).
</p>
</td></tr></tbody></table></div><h3><a id="_field_statistics_2"></a>Field statistics<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/search/field-stats.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The field stats api is supported on string based, number based and date based fields and can return the following statistics per field:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">max_doc</code>
</p>
</td><td class="entry" valign="top">
<p>
The total number of documents.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">doc_count</code>
</p>
</td><td class="entry" valign="top">
<p>
The number of documents that have at least one term for this field, or -1 if
this measurement isn’t available on one or more shards.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">density</code>
</p>
</td><td class="entry" valign="top">
<p>
The percentage of documents that have at least one value for this field. This
is a derived statistic and is based on the <code class="literal">max_doc</code> and <code class="literal">doc_count</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">sum_doc_freq</code>
</p>
</td><td class="entry" valign="top">
<p>
The sum of each term’s document frequency in this field, or -1 if this
measurement isn’t available on one or more shards.
Document frequency is the number of documents containing a particular term.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">sum_total_term_freq</code>
</p>
</td><td class="entry" valign="top">
<p>
The sum of the term frequencies of all terms in this field across all
documents, or -1 if this measurement isn’t available on one or more shards.
Term frequency is the total number of occurrences of a term in a particular
document and field.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">min_value</code>
</p>
</td><td class="entry" valign="top">
<p>
The lowest value in the field represented in a displayable form.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">max_value</code>
</p>
</td><td class="entry" valign="top">
<p>
The highest value in the field represented in a displayable form.
</p>
</td></tr></tbody></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Documents marked as deleted (but not yet removed by the merge process)
still affect all the mentioned statistics.</p></div></div><div class="example"><a id="id-1.7.18.15"></a><p class="title"><strong>Example&nbsp;1.&nbsp;Cluster level field statistics</strong></p><div class="example-contents"><div class="pre_wrapper"><pre class="programlisting">GET /_field_stats?fields=rating,answer_count,creation_date,display_name</pre></div><div class="pre_wrapper"><pre class="programlisting">{
   "_shards": {
      "total": 1,
      "successful": 1,
      "failed": 0
   },
   "indices": {
      "_all": { <a id="CO46-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
         "fields": {
            "creation_date": {
               "max_doc": 1326564,
               "doc_count": 564633,
               "density": 42,
               "sum_doc_freq": 2258532,
               "sum_total_term_freq": -1,
               "min_value": "2008-08-01T16:37:51.513Z",
               "max_value": "2013-06-02T03:23:11.593Z"
            },
            "display_name": {
               "max_doc": 1326564,
               "doc_count": 126741,
               "density": 9,
               "sum_doc_freq": 166535,
               "sum_total_term_freq": 166616,
               "min_value": "0",
               "max_value": "정혜선"
            },
            "answer_count": {
               "max_doc": 1326564,
               "doc_count": 139885,
               "density": 10,
               "sum_doc_freq": 559540,
               "sum_total_term_freq": -1,
               "min_value": 0,
               "max_value": 160
            },
            "rating": {
               "max_doc": 1326564,
               "doc_count": 437892,
               "density": 33,
               "sum_doc_freq": 1751568,
               "sum_total_term_freq": -1,
               "min_value": -14,
               "max_value": 1277
            }
         }
      }
   }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO46-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">_all</code> key indicates that it contains the field stats of all indices in the cluster.
</p></td></tr></tbody></table></div></div></div><br class="example-break"><div class="example"><a id="id-1.7.18.16"></a><p class="title"><strong>Example&nbsp;2.&nbsp;Indices level field statistics</strong></p><div class="example-contents"><div class="pre_wrapper"><pre class="programlisting">GET /_field_stats?fields=rating,answer_count,creation_date,display_name&amp;level=indices</pre></div><div class="pre_wrapper"><pre class="programlisting">{
   "_shards": {
      "total": 1,
      "successful": 1,
      "failed": 0
   },
   "indices": {
      "stack": { <a id="CO47-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
         "fields": {
            "creation_date": {
               "max_doc": 1326564,
               "doc_count": 564633,
               "density": 42,
               "sum_doc_freq": 2258532,
               "sum_total_term_freq": -1,
               "min_value": "2008-08-01T16:37:51.513Z",
               "max_value": "2013-06-02T03:23:11.593Z"
            },
            "display_name": {
               "max_doc": 1326564,
               "doc_count": 126741,
               "density": 9,
               "sum_doc_freq": 166535,
               "sum_total_term_freq": 166616,
               "min_value": "0",
               "max_value": "정혜선"
            },
            "answer_count": {
               "max_doc": 1326564,
               "doc_count": 139885,
               "density": 10,
               "sum_doc_freq": 559540,
               "sum_total_term_freq": -1,
               "min_value": 0,
               "max_value": 160
            },
            "rating": {
               "max_doc": 1326564,
               "doc_count": 437892,
               "density": 33,
               "sum_doc_freq": 1751568,
               "sum_total_term_freq": -1,
               "min_value": -14,
               "max_value": 1277
            }
         }
      }
   }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO47-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">stack</code> key means it contains all field stats for the <code class="literal">stack</code> index.
</p></td></tr></tbody></table></div></div></div><br class="example-break"></div><div class="navfooter"><span class="prev"><a href="search-more-like-this.html">
              «&nbsp;
              More Like This API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices.html">Indices APIs
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-node">Indices APIs</span></div><div class="navheader"><span class="prev"><a href="search-field-stats.html">
              «&nbsp;
              Field stats API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-create-index.html">Create Index
              &nbsp;»
            </a></span></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="indices"></a>Indices APIs<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><div class="partintro"><div></div><p>The indices APIs are used to manage individual indices,
index settings, aliases, mappings, index templates
and warmers.</p><h2><a id="index-management"></a>Index management:<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="indices-create-index.html" title="Create Index"><em>Create Index</em></a>
</li><li class="listitem">
<a class="xref" href="indices-delete-index.html" title="Delete Index"><em>Delete Index</em></a>
</li><li class="listitem">
<a class="xref" href="indices-get-index.html" title="Get Index"><em>Get Index</em></a>
</li><li class="listitem">
<a class="xref" href="indices-exists.html" title="Indices Exists"><em>Indices Exists</em></a>
</li><li class="listitem">
<a class="xref" href="indices-open-close.html" title="Open / Close Index API"><em>Open / Close Index API</em></a>
</li></ul></div><h2><a id="mapping-management"></a>Mapping management:<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="indices-put-mapping.html" title="Put Mapping"><em>Put Mapping</em></a>
</li><li class="listitem">
<a class="xref" href="indices-get-mapping.html" title="Get Mapping"><em>Get Mapping</em></a>
</li><li class="listitem">
<a class="xref" href="indices-get-field-mapping.html" title="Get Field Mapping"><em>Get Field Mapping</em></a>
</li><li class="listitem">
<a class="xref" href="indices-delete-mapping.html" title="Delete Mapping"><em>Delete Mapping</em></a>
</li><li class="listitem">
<a class="xref" href="indices-types-exists.html" title="Types Exists"><em>Types Exists</em></a>
</li></ul></div><h2><a id="alias-management"></a>Alias management:<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="indices-aliases.html" title="Index Aliases"><em>Index Aliases</em></a>
</li></ul></div><h2><a id="index-settings"></a>Index settings:<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="indices-update-settings.html" title="Update Indices Settings"><em>Update Indices Settings</em></a>
</li><li class="listitem">
<a class="xref" href="indices-get-settings.html" title="Get Settings"><em>Get Settings</em></a>
</li><li class="listitem">
<a class="xref" href="indices-analyze.html" title="Analyze"><em>Analyze</em></a>
</li><li class="listitem">
<a class="xref" href="indices-templates.html" title="Index Templates"><em>Index Templates</em></a>
</li><li class="listitem">
<a class="xref" href="indices-warmers.html" title="Warmers"><em>Warmers</em></a>
</li></ul></div><h2><a id="shadow-replicas"></a>Replica configurations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="indices-shadow-replicas.html" title="Shadow replica indices"><em>Shadow replica indices</em></a>
</li></ul></div><h2><a id="monitoring"></a>Monitoring:<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="indices-status.html" title="Status"><em>Status</em></a>
</li><li class="listitem">
<a class="xref" href="indices-stats.html" title="Indices Stats"><em>Indices Stats</em></a>
</li><li class="listitem">
<a class="xref" href="indices-segments.html" title="Indices Segments"><em>Indices Segments</em></a>
</li><li class="listitem">
<a class="xref" href="indices-recovery.html" title="Indices Recovery"><em>Indices Recovery</em></a>
</li></ul></div><h2><a id="status-management"></a>Status management:<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="xref" href="indices-clearcache.html" title="Clear Cache"><em>Clear Cache</em></a>
</li><li class="listitem">
<a class="xref" href="indices-refresh.html" title="Refresh"><em>Refresh</em></a>
</li><li class="listitem">
<a class="xref" href="indices-flush.html" title="Flush"><em>Flush</em></a>
</li><li class="listitem">
<a class="xref" href="indices-optimize.html" title="Optimize"><em>Optimize</em></a>
</li><li class="listitem">
<a class="xref" href="indices-upgrade.html" title="Upgrade"><em>Upgrade</em></a>
</li></ul></div></div></div><div class="navfooter"><span class="prev"><a href="search-field-stats.html">
              «&nbsp;
              Field stats API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-create-index.html">Create Index
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Create Index</span></div><div class="navheader"><span class="prev"><a href="indices.html">
              «&nbsp;
              Indices APIs</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-delete-index.html">Delete Index
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-create-index"></a>Create Index<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/create-index.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The create index API allows to instantiate an index. Elasticsearch
provides support for multiple indices, including executing operations
across several indices.</p><h3><a id="create-index-settings"></a>Index Settings<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/create-index.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Each index created can have specific settings
associated with it.</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPUT 'http://localhost:9200/twitter/'

$ curl -XPUT 'http://localhost:9200/twitter/' -d '
index :
    number_of_shards : 3 <a id="CO48-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
    number_of_replicas : 2 <a id="CO48-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
'</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO48-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Default for <code class="literal">number_of_shards</code> is 5
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO48-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Default for <code class="literal">number_of_replicas</code> is 1 (ie one replica for each primary shard)
</p></td></tr></tbody></table></div><p>The above second curl example shows how an index called <code class="literal">twitter</code> can be
created with specific settings for it using <a class="ulink" href="http://www.yaml.org" target="_top">YAML</a>.
In this case, creating an index with 3 shards, each with 2 replicas. The
index settings can also be defined with <a class="ulink" href="http://www.json.org" target="_top">JSON</a>:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPUT 'http://localhost:9200/twitter/' -d '{
    "settings" : {
        "index" : {
            "number_of_shards" : 3,
            "number_of_replicas" : 2
        }
    }
}'</pre></div><p>or more simplified</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPUT 'http://localhost:9200/twitter/' -d '{
    "settings" : {
        "number_of_shards" : 3,
        "number_of_replicas" : 2
    }
}'</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>You do not have to explicitly specify <code class="literal">index</code> section inside the
<code class="literal">settings</code> section.</p></div></div><p>For more information regarding all the different index level settings
that can be set when creating an index, please check the
<a class="link" href="index-modules.html" title="Index Modules">index modules</a> section.</p><h3><a id="mappings"></a>Mappings<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/create-index.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The create index API allows to provide a set of one or more mappings:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST localhost:9200/test -d '{
    "settings" : {
        "number_of_shards" : 1
    },
    "mappings" : {
        "type1" : {
            "_source" : { "enabled" : false },
            "properties" : {
                "field1" : { "type" : "string", "index" : "not_analyzed" }
            }
        }
    }
}'</pre></div><h3><a id="warmers"></a>Warmers<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/create-index.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The create index API allows also to provide a set of <a class="link" href="indices-warmers.html" title="Warmers">warmers</a>:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/test -d '{
    "warmers" : {
        "warmer_1" : {
            "source" : {
                "query" : {
                    ...
                }
            }
        }
    }
}'</pre></div><h3><a id="create-index-aliases"></a>Aliases<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/create-index.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The create index API allows also to provide a set of <a class="link" href="indices-aliases.html" title="Index Aliases">aliases</a>:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/test -d '{
    "aliases" : {
        "alias_1" : {},
        "alias_2" : {
            "filter" : {
                "term" : {"user" : "kimchy" }
            },
            "routing" : "kimchy"
        }
    }
}'</pre></div><h3><a id="_creation_date"></a>Creation Date<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/create-index.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>When an index is created, a timestamp is stored in the index metadata for the creation date.  By
default this it is automatically generated but it can also be specified using the
<code class="literal">creation_date</code> parameter on the create index API:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/test -d '{
    "creation_date" : 1407751337000 <a id="CO49-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
}'</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO49-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
<code class="literal">creation_date</code> is set using epoch time in milliseconds.
</p></td></tr></tbody></table></div></div><div class="navfooter"><span class="prev"><a href="indices.html">
              «&nbsp;
              Indices APIs</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-delete-index.html">Delete Index
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Delete Index</span></div><div class="navheader"><span class="prev"><a href="indices-create-index.html">
              «&nbsp;
              Create Index</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-get-index.html">Get Index
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-delete-index"></a>Delete Index<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/delete-index.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The delete index API allows to delete an existing index.</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XDELETE 'http://localhost:9200/twitter/'</pre></div><p>The above example deletes an index called <code class="literal">twitter</code>. Specifying an index,
alias or wildcard expression is required.</p><p>The delete index API can also be applied to more than one index, or on
all indices (be careful!) by using <code class="literal">_all</code> or <code class="literal">*</code> as index.</p><p>In order to disable allowing to delete indices via wildcards or <code class="literal">_all</code>,
set <code class="literal">action.destructive_requires_name</code> setting in the config to <code class="literal">true</code>.
This setting can also be changed via the cluster update settings api.</p></div><div class="navfooter"><span class="prev"><a href="indices-create-index.html">
              «&nbsp;
              Create Index</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-get-index.html">Get Index
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Get Index</span></div><div class="navheader"><span class="prev"><a href="indices-delete-index.html">
              «&nbsp;
              Delete Index</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-exists.html">Indices Exists
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-get-index"></a>Get Index<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/get-index.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The get index API allows to retrieve information about one or more indexes.</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/twitter/'</pre></div><p>The above example gets the information for an index called <code class="literal">twitter</code>. Specifying an index,
alias or wildcard expression is required.</p><p>The get index API can also be applied to more than one index, or on
all indices by using <code class="literal">_all</code> or <code class="literal">*</code> as index.</p><h3><a id="_filtering_index_information"></a>Filtering index information<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/get-index.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The information returned by the get API can be filtered to include only specific features
by specifying a comma delimited list of features in the URL:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/twitter/_settings,_mappings'</pre></div><p>The above command will only return the settings and mappings for the index called <code class="literal">twitter</code>.</p><p>The available features are <code class="literal">_settings</code>, <code class="literal">_mappings</code>, <code class="literal">_warmers</code> and <code class="literal">_aliases</code>.</p></div><div class="navfooter"><span class="prev"><a href="indices-delete-index.html">
              «&nbsp;
              Delete Index</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-exists.html">Indices Exists
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Indices Exists</span></div><div class="navheader"><span class="prev"><a href="indices-get-index.html">
              «&nbsp;
              Get Index</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-open-close.html">Open / Close Index API
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-exists"></a>Indices Exists<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/indices-exists.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Used to check if the index (indices) exists or not. For example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XHEAD -i 'http://localhost:9200/twitter'</pre></div><p>The HTTP status code indicates if the index exists or not. A <code class="literal">404</code> means
it does not exist, and <code class="literal">200</code> means it does.</p></div><div class="navfooter"><span class="prev"><a href="indices-get-index.html">
              «&nbsp;
              Get Index</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-open-close.html">Open / Close Index API
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Open / Close Index API</span></div><div class="navheader"><span class="prev"><a href="indices-exists.html">
              «&nbsp;
              Indices Exists</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-put-mapping.html">Put Mapping
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-open-close"></a>Open / Close Index API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/open-close.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The open and close index APIs allow to close an index, and later on
opening it. A closed index has almost no overhead on the cluster (except
for maintaining its metadata), and is blocked for read/write operations.
A closed index can be opened which will then go through the normal
recovery process.</p><p>The REST endpoint is <code class="literal">/{index}/_close</code> and <code class="literal">/{index}/_open</code>. For
example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/my_index/_close'

curl -XPOST 'localhost:9200/my_index/_open'</pre></div><p>It is possible to open and close multiple indices. An error will be thrown
if the request explicitly refers to a missing index. This behaviour can be
disabled using the <code class="literal">ignore_unavailable=true</code> parameter.</p><p>All indices can be opened or closed at once using <code class="literal">_all</code> as the index name
or specifying patterns that identify them all (e.g. <code class="literal">*</code>).</p><p>Identifying indices via wildcards or <code class="literal">_all</code> can be disabled by setting the
<code class="literal">action.destructive_requires_name</code> flag in the config file to <code class="literal">true</code>.
This setting can also be changed via the cluster update settings api.</p></div><div class="navfooter"><span class="prev"><a href="indices-exists.html">
              «&nbsp;
              Indices Exists</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-put-mapping.html">Put Mapping
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Put Mapping</span></div><div class="navheader"><span class="prev"><a href="indices-open-close.html">
              «&nbsp;
              Open / Close Index API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-get-mapping.html">Get Mapping
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-put-mapping"></a>Put Mapping<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/put-mapping.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The put mapping API allows to register specific mapping definition for a
specific type.</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPUT 'http://localhost:9200/twitter/_mapping/tweet' -d '
{
    "tweet" : {
        "properties" : {
            "message" : {"type" : "string", "store" : true }
        }
    }
}
'</pre></div><p>The above example creates a mapping called <code class="literal">tweet</code> within the <code class="literal">twitter</code>
index. The mapping simply defines that the <code class="literal">message</code> field should be
stored (by default, fields are not stored, just indexed) so we can
retrieve it later on using selective loading.</p><p>More information on how to define type mappings can be found in the
<a class="link" href="mapping.html" title="Mapping">mapping</a> section.</p><h3><a id="merging-conflicts"></a>Merging &amp; Conflicts<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/put-mapping.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>When an existing mapping already exists under the given type, the two
mapping definitions, the one already defined, and the new ones are
merged. The <code class="literal">ignore_conflicts</code> parameters can be used to control if
conflicts should be ignored or not, by default, it is set to <code class="literal">false</code>
which means conflicts are <span class="strong emphasis"><strong>not</strong></span> ignored.</p><p>The definition of conflict is really dependent on the type merged, but
in general, if a different core type is defined, it is considered as a
conflict. New mapping definitions can be added to object types, and core
type mappings can be upgraded by specifying multi fields on a core type.</p><h3><a id="put-mapping-multi-index"></a>Multi Index<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/put-mapping.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The put mapping API can be applied to more than one index with a single
call, or even on <code class="literal">_all</code> the indices.</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPUT 'http://localhost:9200/kimchy,elasticsearch/_mapping/tweet' -d '
{
    "tweet" : {
        "properties" : {
            "message" : {"type" : "string", "store" : true }
        }
    }
}
'</pre></div><p>All options:</p><div class="pre_wrapper"><pre class="programlisting">PUT /{index}/_mapping/{type}</pre></div><p>where</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">{index}</code>
</p>
</td><td class="entry" valign="top">
<p>
<code class="literal">blank | * | _all | glob pattern | name1, name2, …</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">{type}</code>
</p>
</td><td class="entry" valign="top">
<p>
Name of the type to add. Must be the name of the type defined in the body.
</p>
</td></tr></tbody></table></div><p>Instead of <code class="literal">_mapping</code> you can also use the plural <code class="literal">_mappings</code>.</p></div><div class="navfooter"><span class="prev"><a href="indices-open-close.html">
              «&nbsp;
              Open / Close Index API</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-get-mapping.html">Get Mapping
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Get Mapping</span></div><div class="navheader"><span class="prev"><a href="indices-put-mapping.html">
              «&nbsp;
              Put Mapping</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-get-field-mapping.html">Get Field Mapping
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-get-mapping"></a>Get Mapping<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/get-mapping.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The get mapping API allows to retrieve mapping definitions for an index or
index/type.</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/_mapping/tweet'</pre></div><h3><a id="_multiple_indices_and_types"></a>Multiple Indices and Types<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/get-mapping.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The get mapping API can be used to get more than one index or type
mapping with a single call. General usage of the API follows the
following syntax: <code class="literal">host:port/{index}/_mapping/{type}</code> where both
<code class="literal">{index}</code> and <code class="literal">{type}</code> can accept a comma-separated list of names. To
get mappings for all indices you can use <code class="literal">_all</code> for <code class="literal">{index}</code>. The
following are some examples:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/_mapping/twitter,kimchy'

curl -XGET 'http://localhost:9200/_all/_mapping/tweet,book'</pre></div><p>If you want to get mappings of all indices and types then the following
two examples are equivalent:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/_all/_mapping'

curl -XGET 'http://localhost:9200/_mapping'</pre></div></div><div class="navfooter"><span class="prev"><a href="indices-put-mapping.html">
              «&nbsp;
              Put Mapping</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-get-field-mapping.html">Get Field Mapping
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Get Field Mapping</span></div><div class="navheader"><span class="prev"><a href="indices-get-mapping.html">
              «&nbsp;
              Get Mapping</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-types-exists.html">Types Exists
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-get-field-mapping"></a>Get Field Mapping<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/get-field-mapping.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The get field mapping API allows you to retrieve mapping definitions for one or more fields.
This is useful when you do not need the complete type mapping returned by
the <a class="xref" href="indices-get-mapping.html" title="Get Mapping"><em>Get Mapping</em></a> API.</p><p>The following returns the mapping of the field <code class="literal">text</code> only:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/_mapping/tweet/field/text'</pre></div><p>For which the response is (assuming <code class="literal">text</code> is a default string field):</p><div class="pre_wrapper"><pre class="programlisting">{
   "twitter": {
      "tweet": {
         "text": {
            "full_name": "text",
            "mapping": {
               "text": { "type": "string" }
            }
         }
      }
   }
}</pre></div><h3><a id="_multiple_indices_types_and_fields"></a>Multiple Indices, Types and Fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/get-field-mapping.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The get field mapping API can be used to get the mapping of multiple fields from more than one index or type
with a single call. General usage of the API follows the
following syntax: <code class="literal">host:port/{index}/{type}/_mapping/field/{field}</code> where
<code class="literal">{index}</code>, <code class="literal">{type}</code> and <code class="literal">{field}</code> can stand for comma-separated list of names or wild cards. To
get mappings for all indices you can use <code class="literal">_all</code> for <code class="literal">{index}</code>. The
following are some examples:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter,kimchy/_mapping/field/message'

curl -XGET 'http://localhost:9200/_all/_mapping/tweet,book/field/message,user.id'

curl -XGET 'http://localhost:9200/_all/_mapping/tw*/field/*.id'</pre></div><h3><a id="_specifying_fields"></a>Specifying fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/get-field-mapping.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The get mapping api allows you to specify one or more fields separated with by a comma.
You can also use wildcards. The field names can be any of the following:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
Full names
</p>
</td><td class="entry" valign="top">
<p>
the full path, including any parent object name the field is
   part of (ex. <code class="literal">user.id</code>).
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
Index names
</p>
</td><td class="entry" valign="top">
<p>
the name of the lucene field (can be different than the
   field name if the <code class="literal">index_name</code> option of the mapping is used).
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
Field names
</p>
</td><td class="entry" valign="top">
<p>
the name of the field without the path to it (ex. <code class="literal">id</code> for <code class="literal">{ "user" : { "id" : 1 } }</code>).
</p>
</td></tr></tbody></table></div><p>The above options are specified in the order the <code class="literal">field</code> parameter is resolved.
The first field found which matches is returned. This is especially important
if index names or field names are used as those can be ambiguous.</p><p>For example, consider the following mapping:</p><div class="pre_wrapper"><pre class="programlisting"> {
     "article": {
         "properties": {
             "id": { "type": "string" },
             "title":  { "type": "string", "index_name": "text" },
             "abstract": { "type": "string", "index_name": "text" },
             "author": {
                 "properties": {
                     "id": { "type": "string" },
                     "name": { "type": "string", "index_name": "author" }
                 }
             }
         }
     }
 }</pre></div><p>To select the <code class="literal">id</code> of the <code class="literal">author</code> field, you can use its full name <code class="literal">author.id</code>. Using <code class="literal">text</code> will return
the mapping of <code class="literal">abstract</code> as it is one of the fields which map to the Lucene field <code class="literal">text</code>. <code class="literal">name</code> will return
the field <code class="literal">author.name</code>:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET "http://localhost:9200/publications/_mapping/article/field/author.id,text,name"</pre></div><p>returns:</p><div class="pre_wrapper"><pre class="programlisting">{
   "publications": {
      "article": {
         "text": {
            "full_name": "abstract",
            "mapping": {
               "abstract": { "type": "string", "index_name": "text" }
            }
         },
         "author.id": {
            "full_name": "author.id",
            "mapping": {
               "id": { "type": "string" }
            }
         },
         "name": {
            "full_name": "author.name",
            "mapping": {
               "name": { "type": "string", "index_name": "author" }
            }
         }
      }
   }
}</pre></div><p>Note how the response always use the same fields specified in the request as keys.
The <code class="literal">full_name</code> in every entry contains the full name of the field whose mapping were returned.
This is useful when the request can refer to to multiple fields (like <code class="literal">text</code> above).</p><h3><a id="_other_options"></a>Other options<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/get-field-mapping.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">include_defaults</code>
</p>
</td><td class="entry" valign="top">
<p>
    adding <code class="literal">include_defaults=true</code> to the query string will cause the response
    to include default values, which are normally suppressed.
</p>
</td></tr></tbody></table></div></div><div class="navfooter"><span class="prev"><a href="indices-get-mapping.html">
              «&nbsp;
              Get Mapping</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-types-exists.html">Types Exists
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Types Exists</span></div><div class="navheader"><span class="prev"><a href="indices-get-field-mapping.html">
              «&nbsp;
              Get Field Mapping</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-delete-mapping.html">Delete Mapping
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-types-exists"></a>Types Exists<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/types-exists.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Used to check if a type/types exists in an index/indices.</p><div class="pre_wrapper"><pre class="programlisting">curl -XHEAD -i 'http://localhost:9200/twitter/tweet'</pre></div><p>The HTTP status code indicates if the type exists or not. A <code class="literal">404</code> means
it does not exist, and <code class="literal">200</code> means it does.</p></div><div class="navfooter"><span class="prev"><a href="indices-get-field-mapping.html">
              «&nbsp;
              Get Field Mapping</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-delete-mapping.html">Delete Mapping
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Delete Mapping</span></div><div class="navheader"><span class="prev"><a href="indices-types-exists.html">
              «&nbsp;
              Types Exists</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-aliases.html">Index Aliases
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-delete-mapping"></a>Delete Mapping<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/delete-mapping.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Allow to delete a mapping (type) along with its data. The REST endpoints are</p><div class="pre_wrapper"><pre class="programlisting">[DELETE] /{index}/{type}

[DELETE] /{index}/{type}/_mapping

[DELETE] /{index}/_mapping/{type}</pre></div><p>where</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">index</code>
</p>
</td><td class="entry" valign="top">
<p>
<code class="literal">* | _all | glob pattern | name1, name2, …</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">type</code>
</p>
</td><td class="entry" valign="top">
<p>
<code class="literal">* | _all | glob pattern | name1, name2, …</code>
</p>
</td></tr></tbody></table></div><p>Note, most times, it make more sense to reindex the data into a fresh
index compared to delete large chunks of it.</p></div><div class="navfooter"><span class="prev"><a href="indices-types-exists.html">
              «&nbsp;
              Types Exists</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-aliases.html">Index Aliases
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Index Aliases</span></div><div class="navheader"><span class="prev"><a href="indices-delete-mapping.html">
              «&nbsp;
              Delete Mapping</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-update-settings.html">Update Indices Settings
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-aliases"></a>Index Aliases<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/aliases.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>APIs in elasticsearch accept an index name when working against a
specific index, and several indices when applicable. The index aliases
API allow to alias an index with a name, with all APIs automatically
converting the alias name to the actual index name. An alias can also be
mapped to more than one index, and when specifying it, the alias will
automatically expand to the aliases indices. An alias can also be
associated with a filter that will automatically be applied when
searching, and routing values.</p><p>Here is a sample of associating the alias <code class="literal">alias1</code> with index <code class="literal">test1</code>:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        { "add" : { "index" : "test1", "alias" : "alias1" } }
    ]
}'</pre></div><p>An alias can also be removed, for example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        { "remove" : { "index" : "test1", "alias" : "alias1" } }
    ]
}'</pre></div><p>Renaming an alias is a simple <code class="literal">remove</code> then <code class="literal">add</code> operation within the
same API. This operation is atomic, no need to worry about a short
period of time where the alias does not point to an index:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        { "remove" : { "index" : "test1", "alias" : "alias1" } },
        { "add" : { "index" : "test1", "alias" : "alias2" } }
    ]
}'</pre></div><p>Associating an alias with more than one index are simply several <code class="literal">add</code>
actions:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        { "add" : { "index" : "test1", "alias" : "alias1" } },
        { "add" : { "index" : "test2", "alias" : "alias1" } }
    ]
}'</pre></div><p>Alternatively, you can use a glob pattern to associate an alias to
more than one index that share a common name:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        { "add" : { "index" : "test*", "alias" : "all_test_indices" } }
    ]
}'</pre></div><p>In this case, the alias is a point-in-time alias that will group all
current indices that match, it will not automatically update as new
indices that match this pattern are added/removed.</p><p>It is an error to index to an alias which points to more than one index.</p><h3><a id="filtered"></a>Filtered Aliases<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/aliases.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Aliases with filters provide an easy way to create different "views" of
the same index. The filter can be defined using Query DSL and is applied
to all Search, Count, Delete By Query and More Like This operations with
this alias.</p><p>To create a filtered alias, first we need to ensure that the fields already
exist in the mapping:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'http://localhost:9200/test1' -d '{
  "mappings": {
    "type1": {
      "properties": {
        "user" : {
          "type": "string",
          "index": "not_analyzed"
        }
      }
    }
  }
}</pre></div><p>Now we can create an alias that uses a filter on field <code class="literal">user</code>:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'http://localhost:9200/_aliases' -d '{
    "actions" : [
        {
            "add" : {
                 "index" : "test1",
                 "alias" : "alias2",
                 "filter" : { "term" : { "user" : "kimchy" } }
            }
        }
    ]
}'</pre></div><h4><a id="aliases-routing"></a>Routing<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/aliases.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>It is possible to associate routing values with aliases. This feature
can be used together with filtering aliases in order to avoid
unnecessary shard operations.</p><p>The following command creates a new alias <code class="literal">alias1</code> that points to index
<code class="literal">test</code>. After <code class="literal">alias1</code> is created, all operations with this alias are
automatically modified to use value <code class="literal">1</code> for routing:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        {
            "add" : {
                 "index" : "test",
                 "alias" : "alias1",
                 "routing" : "1"
            }
        }
    ]
}'</pre></div><p>It’s also possible to specify different routing values for searching
and indexing operations:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'http://localhost:9200/_aliases' -d '
{
    "actions" : [
        {
            "add" : {
                 "index" : "test",
                 "alias" : "alias2",
                 "search_routing" : "1,2",
                 "index_routing" : "2"
            }
        }
    ]
}'</pre></div><p>As shown in the example above, search routing may contain several values
separated by comma. Index routing can contain only a single value.</p><p>If an operation that uses routing alias also has a routing parameter, an
intersection of both alias routing and routing specified in the
parameter is used. For example the following command will use "2" as a
routing value:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/alias2/_search?q=user:kimchy&amp;routing=2,3'</pre></div><h3><a id="alias-adding"></a>Add a single alias<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/aliases.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>An alias can also be added with the endpoint</p><p><code class="literal">PUT /{index}/_alias/{name}</code></p><p>where</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">index</code>
</p>
</td><td class="entry" valign="top">
<p>
The index the alias refers to. Can be any of <code class="literal">* | _all | glob pattern | name1, name2, …</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">name</code>
</p>
</td><td class="entry" valign="top">
<p>
The name of the alias. This is a required option.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">routing</code>
</p>
</td><td class="entry" valign="top">
<p>
An optional routing that can be associated with an alias.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">filter</code>
</p>
</td><td class="entry" valign="top">
<p>
An optional filter that can be associated with an alias.
</p>
</td></tr></tbody></table></div><p>You can also use the plural <code class="literal">_aliases</code>.</p><h4><a id="_examples"></a>Examples:<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/aliases.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Adding time based alias
</span></dt><dd><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'localhost:9200/logs_201305/_alias/2013'</pre></div></dd><dt><span class="term">
Adding a user alias
</span></dt><dd><p class="simpara">First create the index and add a mapping for the <code class="literal">user_id</code> field:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'localhost:9200/users' -d '{
    "mappings" : {
        "user" : {
            "properties" : {
                "user_id" : {"type" : "integer"}
            }
        }
    }
}'</pre></div><p class="simpara">Then add the alias for a specific user:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'localhost:9200/users/_alias/user_12' -d '{
    "routing" : "12",
    "filter" : {
        "term" : {
            "user_id" : 12
        }
    }
}'</pre></div></dd></dl></div><h3><a id="alias-index-creation"></a>Aliases during index creation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/aliases.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Aliases can also be specified during <a class="link" href="indices-create-index.html#create-index-aliases" title="Aliasesedit">index creation</a>:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/logs_20142801 -d '{
    "mappings" : {
        "type" : {
            "properties" : {
                "year" : {"type" : "integer"}
            }
        }
    },
    "aliases" : {
        "current_day" : {},
        "2014" : {
            "filter" : {
                "term" : {"year" : 2014 }
            }
        }
    }
}'</pre></div><h3><a id="deleting"></a>Delete aliases<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/aliases.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The rest endpoint is: <code class="literal">/{index}/_alias/{name}</code></p><p>where</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">index</code>
</p>
</td><td class="entry" valign="top">
<p>
<code class="literal">* | _all | glob pattern | name1, name2, …</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">name</code>
</p>
</td><td class="entry" valign="top">
<p>
<code class="literal">* | _all | glob pattern | name1, name2, …</code>
</p>
</td></tr></tbody></table></div><p>Alternatively you can use the plural <code class="literal">_aliases</code>. Example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XDELETE 'localhost:9200/users/_alias/user_12'</pre></div><h3><a id="alias-retrieving"></a>Retrieving existing aliases<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/aliases.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The get index alias api allows to filter by
alias name and index name. This api redirects to the master and fetches
the requested index aliases, if available. This api only serialises the
found index aliases.</p><p>Possible options:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">index</code>
</p>
</td><td class="entry" valign="top">
<p>
    The index name to get aliases for. Partially names are
    supported via wildcards, also multiple index names can be specified
    separated with a comma. Also the alias name for an index can be used.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">alias</code>
</p>
</td><td class="entry" valign="top">
<p>
    The name of alias to return in the response. Like the index
    option, this option supports wildcards and the option the specify
    multiple alias names separated by a comma.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">ignore_unavailable</code>
</p>
</td><td class="entry" valign="top">
<p>
    What to do is an specified index name doesn’t
    exist. If set to <code class="literal">true</code> then those indices are ignored.
</p>
</td></tr></tbody></table></div><p>The rest endpoint is: <code class="literal">/{index}/_alias/{alias}</code>.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>For future versions of Elasticsearch, the default <a class="xref" href="multi-index.html" title="Multiple Indices"><em>Multiple Indices</em></a> options will error if a requested index is unavailable. This is to bring
this API in line with the other indices GET APIs</p></div></div><h4><a id="_examples_2"></a>Examples:<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/aliases.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>All aliases for the index users:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/users/_alias/*'</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting"> {
  "users" : {
    "aliases" : {
      "user_13" : {
        "filter" : {
          "term" : {
            "user_id" : 13
          }
        },
        "index_routing" : "13",
        "search_routing" : "13"
      },
      "user_14" : {
        "filter" : {
          "term" : {
            "user_id" : 14
          }
        },
        "index_routing" : "14",
        "search_routing" : "14"
      },
      "user_12" : {
        "filter" : {
          "term" : {
            "user_id" : 12
          }
        },
        "index_routing" : "12",
        "search_routing" : "12"
      }
    }
  }
}</pre></div><p>All aliases with the name 2013 in any index:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/_alias/2013'</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
  "logs_201304" : {
    "aliases" : {
      "2013" : { }
    }
  },
  "logs_201305" : {
    "aliases" : {
      "2013" : { }
    }
  }
}</pre></div><p>All aliases that start with 2013_01 in any index:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/_alias/2013_01*'</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
  "logs_20130101" : {
    "aliases" : {
      "2013_01" : { }
    }
  }
}</pre></div><p>There is also a HEAD variant of the get indices aliases api to check if
index aliases exist. The indices aliases exists api supports the same
option as the get indices aliases api. Examples:</p><div class="pre_wrapper"><pre class="programlisting">curl -XHEAD -i 'localhost:9200/_alias/2013'
curl -XHEAD -i 'localhost:9200/_alias/2013_01*'
curl -XHEAD -i 'localhost:9200/users/_alias/*'</pre></div></div><div class="navfooter"><span class="prev"><a href="indices-delete-mapping.html">
              «&nbsp;
              Delete Mapping</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-update-settings.html">Update Indices Settings
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Update Indices Settings</span></div><div class="navheader"><span class="prev"><a href="indices-aliases.html">
              «&nbsp;
              Index Aliases</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-get-settings.html">Get Settings
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-update-settings"></a>Update Indices Settings<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Change specific index level settings in real time.</p><p>The REST endpoint is <code class="literal">/_settings</code> (to update all indices) or
<code class="literal">{index}/_settings</code> to update one (or more) indices settings. The body
of the request includes the updated settings, for example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "index" : {
        "number_of_replicas" : 4
    }
}</pre></div><p>The above will change the number of replicas to 4 from the current
number of replicas. Here is a curl example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'localhost:9200/my_index/_settings' -d '
{
    "index" : {
        "number_of_replicas" : 4
    }
}'</pre></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>When changing the number of replicas the index needs to be open. Changing
the number of replicas on a closed index might prevent the index to be opened correctly again.</p></div></div><p>Below is the list of settings that can be changed using the update
settings API:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">index.number_of_replicas</code>
</span></dt><dd>
    The number of replicas each shard has.
</dd><dt><span class="term">
<code class="literal">index.auto_expand_replicas</code> (string)
</span></dt><dd>
    Set to a dash delimited lower and upper bound (e.g. <code class="literal">0-5</code>)
    or one may use <code class="literal">all</code> as the upper bound (e.g. <code class="literal">0-all</code>), or <code class="literal">false</code> to disable it.
</dd><dt><span class="term">
<code class="literal">index.blocks.read_only</code>
</span></dt><dd>
    Set to <code class="literal">true</code> to have the index read only, <code class="literal">false</code> to allow writes
    and metadata changes.
</dd><dt><span class="term">
<code class="literal">index.blocks.read</code>
</span></dt><dd>
    Set to <code class="literal">true</code> to disable read operations against the index.
</dd><dt><span class="term">
<code class="literal">index.blocks.write</code>
</span></dt><dd>
    Set to <code class="literal">true</code> to disable write operations against the index.
</dd><dt><span class="term">
<code class="literal">index.blocks.metadata</code>
</span></dt><dd>
    Set to <code class="literal">true</code> to disable metadata operations against the index.
</dd><dt><span class="term">
<code class="literal">index.refresh_interval</code>
</span></dt><dd>
    The async refresh interval of a shard.
</dd><dt><span class="term">
<code class="literal">index.index_concurrency</code>
</span></dt><dd>
    <span class="experimental">
      [<span class="experimental_title">experimental</span>]
      <span class="detail">This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</span></span> Defaults to <code class="literal">8</code>.
</dd><dt><span class="term">
<code class="literal">index.fail_on_merge_failure</code>
</span></dt><dd>
    <span class="experimental">
      [<span class="experimental_title">experimental</span>]
      <span class="detail">This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</span></span> Default to <code class="literal">true</code>.
</dd></dl></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><h3>Deprecated in 1.5.0. </h3>
 As of 2.0 index.fail_on_merge_failure is removed and the engine will always fail on an unexpected merge exception.
</div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">index.translog.flush_threshold_ops</code>
</span></dt><dd>
    When to flush based on operations.
</dd><dt><span class="term">
<code class="literal">index.translog.flush_threshold_size</code>
</span></dt><dd>
    When to flush based on translog (bytes) size.
</dd><dt><span class="term">
<code class="literal">index.translog.flush_threshold_period</code>
</span></dt><dd>
    When to flush based on a period of not flushing.
</dd><dt><span class="term">
<code class="literal">index.translog.disable_flush</code>
</span></dt><dd>
    Disables flushing. Note, should be set for a short
    interval and then enabled.
</dd><dt><span class="term">
<code class="literal">index.cache.filter.max_size</code>
</span></dt><dd>
    The maximum size of filter cache (per segment in shard).
    Set to <code class="literal">-1</code> to disable.
</dd><dt><span class="term">
<code class="literal">index.cache.filter.expire</code>
</span></dt><dd>
    <span class="experimental">
      [<span class="experimental_title">experimental</span>]
      <span class="detail">This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</span></span> The expire after access time for filter cache.
    Set to <code class="literal">-1</code> to disable.
</dd><dt><span class="term">
<code class="literal">index.gateway.snapshot_interval</code>
</span></dt><dd>
    <span class="experimental">
      [<span class="experimental_title">experimental</span>]
      <span class="detail">This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</span></span> The gateway snapshot interval (only applies to shared
    gateways). Defaults to 10s.
</dd><dt><span class="term">
<a class="link" href="index-modules-merge.html" title="Merge">merge policy</a>
</span></dt><dd>
    All the settings for the merge policy currently configured.
    A different merge policy can’t be set.
</dd><dt><span class="term">
<code class="literal">index.routing.allocation.include.*</code>
</span></dt><dd>
    A node matching any rule will be allowed to host shards from the index.
</dd><dt><span class="term">
<code class="literal">index.routing.allocation.exclude.*</code>
</span></dt><dd>
    A node matching any rule will NOT be allowed to host shards from the index.
</dd><dt><span class="term">
<code class="literal">index.routing.allocation.require.*</code>
</span></dt><dd>
    Only nodes matching all rules will be allowed to host shards from the index.
</dd><dt><span class="term">
<code class="literal">index.routing.allocation.disable_allocation</code>
</span></dt><dd>
    Disable allocation. Defaults to <code class="literal">false</code>. Deprecated in favour for <code class="literal">index.routing.allocation.enable</code>.
</dd><dt><span class="term">
<code class="literal">index.routing.allocation.disable_new_allocation</code>
</span></dt><dd>
    Disable new allocation. Defaults to <code class="literal">false</code>. Deprecated in favour for <code class="literal">index.routing.allocation.enable</code>.
</dd><dt><span class="term">
<code class="literal">index.routing.allocation.disable_replica_allocation</code>
</span></dt><dd>
    Disable replica allocation. Defaults to <code class="literal">false</code>. Deprecated in favour for <code class="literal">index.routing.allocation.enable</code>.
</dd><dt><span class="term">
<code class="literal">index.routing.allocation.enable</code>
</span></dt><dd><p class="simpara">
    Enables shard allocation for a specific index. It can be set to:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">all</code> (default) - Allows shard allocation for all shards.
</li><li class="listitem">
<code class="literal">primaries</code> - Allows shard allocation only for primary shards.
</li><li class="listitem">
<code class="literal">new_primaries</code> - Allows shard allocation only for primary shards for new indices.
</li><li class="listitem">
<code class="literal">none</code> - No shard allocation is allowed.
</li></ul></div></dd><dt><span class="term">
<code class="literal">index.routing.allocation.total_shards_per_node</code>
</span></dt><dd>
    Controls the total number of shards (replicas and primaries) allowed to be allocated on a single node. Defaults to unbounded (<code class="literal">-1</code>).
</dd><dt><span class="term">
<code class="literal">index.recovery.initial_shards</code>
</span></dt><dd><p class="simpara">
    When using local gateway a particular shard is recovered only if there can be allocated quorum shards in the cluster. It can be set to:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">quorum</code> (default)
</li><li class="listitem">
<code class="literal">quorum-1</code> (or <code class="literal">half</code>)
</li><li class="listitem">
<code class="literal">full</code>
</li><li class="listitem">
<code class="literal">full-1</code>.
</li><li class="listitem">
Number values are also supported, e.g. <code class="literal">1</code>.
</li></ul></div></dd><dt><span class="term">
<code class="literal">index.gc_deletes</code>
</span></dt><dd>
    <span class="experimental">
      [<span class="experimental_title">experimental</span>]
      <span class="detail">This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</span></span>
</dd><dt><span class="term">
<code class="literal">index.ttl.disable_purge</code>
</span></dt><dd>
    <span class="experimental">
      [<span class="experimental_title">experimental</span>]
      <span class="detail">This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</span></span> Disables temporarily the purge of expired docs.
</dd><dt><span class="term">
<a class="link" href="index-modules-store.html" title="Store">store level throttling</a>
</span></dt><dd>
    All the settings for the store level throttling policy currently configured.
</dd><dt><span class="term">
<code class="literal">index.translog.fs.type</code>
</span></dt><dd>
    <span class="experimental">
      [<span class="experimental_title">experimental</span>]
      <span class="detail">This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</span></span> Either <code class="literal">simple</code> or <code class="literal">buffered</code> (default).
</dd><dt><span class="term">
<code class="literal">index.compound_format</code>
</span></dt><dd>
    <span class="experimental">
      [<span class="experimental_title">experimental</span>]
      <span class="detail">This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</span></span> See <a class="link" href="index-modules.html#index-compound-format"><code class="literal">index.compound_format</code></a> in
    <a class="xref" href="index-modules.html#index-modules-settings" title="Index Settingsedit">the section called “Index Settings</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/index-modules.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>”.
</dd><dt><span class="term">
<code class="literal">index.compound_on_flush</code>
</span></dt><dd>
    <span class="experimental">
      [<span class="experimental_title">experimental</span>]
      <span class="detail">This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</span></span> See <a class="link" href="index-modules.html#index-compound-on-flush">`index.compound_on_flush</a> in
    <a class="xref" href="index-modules.html#index-modules-settings" title="Index Settingsedit">the section called “Index Settings</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/index-modules.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>”.
</dd><dt><span class="term">
<a class="xref" href="index-modules-slowlog.html" title="Index Slow Log"><em>Index Slow Log</em></a>
</span></dt><dd>
    All the settings for slow log.
</dd><dt><span class="term">
<code class="literal">index.warmer.enabled</code>
</span></dt><dd>
    See <a class="xref" href="indices-warmers.html" title="Warmers"><em>Warmers</em></a>. Defaults to <code class="literal">true</code>.
</dd></dl></div><h3><a id="bulk"></a>Bulk Indexing Usage<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>For example, the update settings API can be used to dynamically change
the index from being more performant for bulk indexing, and then move it
to more real time indexing state. Before the bulk indexing is started,
use:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/test/_settings -d '{
    "index" : {
        "refresh_interval" : "-1"
    } }'</pre></div><p>(Another optimization option is to start the index without any replicas,
and only later adding them, but that really depends on the use case).</p><p>Then, once bulk indexing is done, the settings can be updated (back to
the defaults for example):</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/test/_settings -d '{
    "index" : {
        "refresh_interval" : "1s"
    } }'</pre></div><p>And, an optimize should be called:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'http://localhost:9200/test/_optimize?max_num_segments=5'</pre></div><h3><a id="update-settings-analysis"></a>Updating Index Analysis<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>It is also possible to define new <a class="link" href="analysis.html" title="Analysis">analyzers</a> for the index.
But it is required to <a class="link" href="indices-open-close.html" title="Open / Close Index API">close</a> the index
first and <a class="link" href="indices-open-close.html" title="Open / Close Index API">open</a> it after the changes are made.</p><p>For example if <code class="literal">content</code> analyzer hasn’t been defined on <code class="literal">myindex</code> yet
you can use the following commands to add it:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/myindex/_close'

curl -XPUT 'localhost:9200/myindex/_settings' -d '{
  "analysis" : {
    "analyzer":{
      "content":{
        "type":"custom",
        "tokenizer":"whitespace"
      }
    }
  }
}'

curl -XPOST 'localhost:9200/myindex/_open'</pre></div></div><div class="navfooter"><span class="prev"><a href="indices-aliases.html">
              «&nbsp;
              Index Aliases</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-get-settings.html">Get Settings
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Get Settings</span></div><div class="navheader"><span class="prev"><a href="indices-update-settings.html">
              «&nbsp;
              Update Indices Settings</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-analyze.html">Analyze
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-get-settings"></a>Get Settings<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/get-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The get settings API allows to retrieve settings of index/indices:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/twitter/_settings'</pre></div><h3><a id="_multiple_indices_and_types_2"></a>Multiple Indices and Types<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/get-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The get settings API can be used to get settings for more than one index
with a single call. General usage of the API follows the
following syntax: <code class="literal">host:port/{index}/_settings</code> where
<code class="literal">{index}</code> can stand for comma-separated list of index names and aliases. To
get settings for all indices you can use <code class="literal">_all</code> for <code class="literal">{index}</code>.
Wildcard expressions are also supported. The following are some examples:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter,kimchy/_settings'

curl -XGET 'http://localhost:9200/_all/_settings'

curl -XGET 'http://localhost:9200/2013-*/_settings'</pre></div><h3><a id="_filtering_settings_by_name"></a>Filtering settings by name<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/get-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The settings that are returned can be filtered with wildcard matching
as follows:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/2013-*/_settings/name=index.number_*'</pre></div></div><div class="navfooter"><span class="prev"><a href="indices-update-settings.html">
              «&nbsp;
              Update Indices Settings</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-analyze.html">Analyze
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Analyze</span></div><div class="navheader"><span class="prev"><a href="indices-get-settings.html">
              «&nbsp;
              Get Settings</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-templates.html">Index Templates
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-analyze"></a>Analyze<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/analyze.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Performs the analysis process on a text and return the tokens breakdown
of the text.</p><p>Can be used without specifying an index against one of the many built in
analyzers:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/_analyze?analyzer=standard' -d 'this is a test'</pre></div><p>Or by building a custom transient analyzer out of tokenizers,
token filters and char filters. Token filters can use the shorter <span class="emphasis"><em>filters</em></span>
parameter name:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/_analyze?tokenizer=keyword&amp;filters=lowercase' -d 'this is a test'

curl -XGET 'localhost:9200/_analyze?tokenizer=keyword&amp;token_filters=lowercase&amp;char_filters=html_strip' -d 'this is a &lt;b&gt;test&lt;/b&gt;'</pre></div><p>It can also run against a specific index:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/test/_analyze?text=this+is+a+test'</pre></div><p>The above will run an analysis on the "this is a test" text, using the
default index analyzer associated with the <code class="literal">test</code> index. An <code class="literal">analyzer</code>
can also be provided to use a different analyzer:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/test/_analyze?analyzer=whitespace' -d 'this is a test'</pre></div><p>Also, the analyzer can be derived based on a field mapping, for example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'localhost:9200/test/_analyze?field=obj1.field1' -d 'this is a test'</pre></div><p>Will cause the analysis to happen based on the analyzer configured in the
mapping for <code class="literal">obj1.field1</code> (and if not, the default index analyzer).</p><p>Also, the text can be provided as part of the request body, and not as a
parameter.</p></div><div class="navfooter"><span class="prev"><a href="indices-get-settings.html">
              «&nbsp;
              Get Settings</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-templates.html">Index Templates
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Index Templates</span></div><div class="navheader"><span class="prev"><a href="indices-analyze.html">
              «&nbsp;
              Analyze</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-warmers.html">Warmers
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-templates"></a>Index Templates<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/templates.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Index templates allow you to define templates that will automatically be
applied to new indices created. The templates include both settings and
mappings, and a simple pattern template that controls if the template
will be applied to the index created. For example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/_template/template_1 -d '
{
    "template" : "te*",
    "settings" : {
        "number_of_shards" : 1
    },
    "mappings" : {
        "type1" : {
            "_source" : { "enabled" : false }
        }
    }
}
'</pre></div><p>Defines a template named template_1, with a template pattern of <code class="literal">te*</code>.
The settings and mappings will be applied to any index name that matches
the <code class="literal">te*</code> template.</p><p>It is also possible to include aliases in an index template as follows:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/_template/template_1 -d '
{
    "template" : "te*",
    "settings" : {
        "number_of_shards" : 1
    },
    "aliases" : {
        "alias1" : {},
        "alias2" : {
            "filter" : {
                "term" : {"user" : "kimchy" }
            },
            "routing" : "kimchy"
        },
        "{index}-alias" : {} <a id="CO50-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
    }
}
'</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO50-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
the <code class="literal">{index}</code> placeholder within the alias name will be replaced with the
actual index name that the template gets applied to during index creation.
</p></td></tr></tbody></table></div><h3><a id="delete"></a>Deleting a Template<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/templates.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Index templates are identified by a name (in the above case
<code class="literal">template_1</code>) and can be deleted as well:</p><div class="pre_wrapper"><pre class="programlisting">curl -XDELETE localhost:9200/_template/template_1</pre></div><h3><a id="getting"></a>GETting templates<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/templates.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Index templates are identified by a name (in the above case
<code class="literal">template_1</code>) and can be retrieved using the following:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET localhost:9200/_template/template_1</pre></div><p>You can also match several templates by using wildcards like:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET localhost:9200/_template/temp*
curl -XGET localhost:9200/_template/template_1,template_2</pre></div><p>To get list of all index templates you can run:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET localhost:9200/_template/</pre></div><h3><a id="indices-templates-exists"></a>Templates exists<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/templates.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Used to check if the template exists or not. For example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XHEAD -i localhost:9200/_template/template_1</pre></div><p>The HTTP status code indicates if the template with the given name
exists or not. A status code <code class="literal">200</code> means it exists, a <code class="literal">404</code> it does not.</p><h3><a id="multiple-templates"></a>Multiple Template Matching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/templates.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Multiple index templates can potentially match an index, in this case,
both the settings and mappings are merged into the final configuration
of the index. The order of the merging can be controlled using the
<code class="literal">order</code> parameter, with lower order being applied first, and higher
orders overriding them. For example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/_template/template_1 -d '
{
    "template" : "*",
    "order" : 0,
    "settings" : {
        "number_of_shards" : 1
    },
    "mappings" : {
        "type1" : {
            "_source" : { "enabled" : false }
        }
    }
}
'

curl -XPUT localhost:9200/_template/template_2 -d '
{
    "template" : "te*",
    "order" : 1,
    "settings" : {
        "number_of_shards" : 1
    },
    "mappings" : {
        "type1" : {
            "_source" : { "enabled" : true }
        }
    }
}
'</pre></div><p>The above will disable storing the <code class="literal">_source</code> on all <code class="literal">type1</code> types, but
for indices of that start with <code class="literal">te*</code>, source will still be enabled.
Note, for mappings, the merging is "deep", meaning that specific
object/property based mappings can easily be added/overridden on higher
order templates, with lower order templates providing the basis.</p><h3><a id="config"></a>Config<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/templates.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Index templates can also be placed within the config location
(<code class="literal">path.conf</code>) under the <code class="literal">templates</code> directory (note, make sure to place
them on all master eligible nodes). For example, a file called
<code class="literal">template_1.json</code> can be placed under <code class="literal">config/templates</code> and it will be
added if it matches an index. Here is a sample of the mentioned file:</p><div class="pre_wrapper"><pre class="programlisting">{
    "template_1" : {
        "template" : "*",
        "settings" : {
            "index.number_of_shards" : 2
        },
        "mappings" : {
            "_default_" : {
                "_source" : {
                    "enabled" : false
                }
            },
            "type1" : {
                "_all" : {
                    "enabled" : false
                }
            }
        }
    }
}</pre></div><p><span class="strong emphasis"><strong>Please note that templates added this way will not appear in the <code class="literal">/_template/*</code> API request.</strong></span></p></div><div class="navfooter"><span class="prev"><a href="indices-analyze.html">
              «&nbsp;
              Analyze</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-warmers.html">Warmers
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Warmers</span></div><div class="navheader"><span class="prev"><a href="indices-templates.html">
              «&nbsp;
              Index Templates</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-status.html">Status
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-warmers"></a>Warmers<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/warmers.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Index warming allows to run registered search requests to warm up the index
before it is available for search. With the near real time aspect of search,
cold data (segments) will be warmed up before they become available for search.
This includes things such as the filter cache, filesystem cache, and loading
field data for fields.</p><p>Warmup searches typically include requests that require heavy loading of
data, such as aggregations or sorting on specific fields. The warmup APIs
allows to register warmup (search) under specific names, remove them,
and get them.</p><p>Index warmup can be disabled by setting <code class="literal">index.warmer.enabled</code> to
<code class="literal">false</code>. It is supported as a realtime setting using update settings
API. This can be handy when doing initial bulk indexing: disable pre
registered warmers to make indexing faster and less expensive and then
enable it.</p><h3><a id="creation"></a>Index Creation / Templates<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/warmers.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Warmers can be registered when an index gets created, for example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/test -d '{
    "warmers" : {
        "warmer_1" : {
            "types" : [],
            "source" : {
                "query" : {
                    ...
                },
                "aggs" : {
                    ...
                }
            }
        }
    }
}'</pre></div><p>Or, in an index template:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/_template/template_1 -d '
{
    "template" : "te*",
    "warmers" : {
        "warmer_1" : {
            "types" : [],
            "source" : {
                "query" : {
                    ...
                },
                "aggs" : {
                    ...
                }
            }
        }
    }
}'</pre></div><p>On the same level as <code class="literal">types</code> and <code class="literal">source</code>, the <code class="literal">query_cache</code> flag is supported
to enable query caching for the warmed search request. If not specified, it will
use the index level configuration of query caching.</p><h3><a id="warmer-adding"></a>Put Warmer<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/warmers.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Allows to put a warmup search request on a specific index (or indices),
with the body composing of a regular search request. Types can be
provided as part of the URI if the search request is designed to be run
only against the specific types.</p><p>Here is an example that registers a warmup called <code class="literal">warmer_1</code> against
index <code class="literal">test</code> (can be alias or several indices), for a search request
that runs against all types:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/test/_warmer/warmer_1 -d '{
    "query" : {
        "match_all" : {}
    },
    "aggs" : {
        "aggs_1" : {
            "terms" : {
                "field" : "field"
            }
        }
    }
}'</pre></div><p>And an example that registers a warmup against specific types:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/test/type1/_warmer/warmer_1 -d '{
    "query" : {
        "match_all" : {}
    },
    "aggs" : {
        "aggs_1" : {
            "terms" : {
                "field" : "field"
            }
        }
    }
}'</pre></div><p>All options:</p><div class="pre_wrapper"><pre class="programlisting">PUT _warmer/{warmer_name}

PUT /{index}/_warmer/{warmer_name}

PUT /{index}/{type}/_warmer/{warmer_name}</pre></div><p>where</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">{index}</code>
</p>
</td><td class="entry" valign="top">
<p>
<code class="literal">* | _all | glob pattern | name1, name2, …</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">{type}</code>
</p>
</td><td class="entry" valign="top">
<p>
<code class="literal">* | _all | glob pattern | name1, name2, …</code>
</p>
</td></tr></tbody></table></div><p>Instead of <code class="literal">_warmer</code> you can also use the plural <code class="literal">_warmers</code>.</p><p>The <code class="literal">query_cache</code> parameter can be used to enable query caching for
the search request. If not specified, it will use the index level configuration
of query caching.</p><h3><a id="removing"></a>Delete Warmers<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/warmers.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Warmers can be deleted using the following endpoint:</p><div class="pre_wrapper"><pre class="programlisting">[DELETE] /{index}/_warmer/{name}</pre></div><p>where</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">{index}</code>
</p>
</td><td class="entry" valign="top">
<p>
<code class="literal">* | _all | glob pattern | name1, name2, …</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">{name}</code>
</p>
</td><td class="entry" valign="top">
<p>
<code class="literal">* | _all | glob pattern | name1, name2, …</code>
</p>
</td></tr></tbody></table></div><p>Instead of <code class="literal">_warmer</code> you can also use the plural <code class="literal">_warmers</code>.</p><h3><a id="warmer-retrieving"></a>GETting Warmer<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/warmers.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Getting a warmer for specific index (or alias, or several indices) based
on its name. The provided name can be a simple wildcard expression or
omitted to get all warmers.</p><p>Some examples:</p><div class="pre_wrapper"><pre class="programlisting"># get warmer named warmer_1 on test index
curl -XGET localhost:9200/test/_warmer/warmer_1

# get all warmers that start with warm on test index
curl -XGET localhost:9200/test/_warmer/warm*

# get all warmers for test index
curl -XGET localhost:9200/test/_warmer/</pre></div></div><div class="navfooter"><span class="prev"><a href="indices-templates.html">
              «&nbsp;
              Index Templates</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-status.html">Status
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Status</span></div><div class="navheader"><span class="prev"><a href="indices-warmers.html">
              «&nbsp;
              Warmers</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-stats.html">Indices Stats
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-status"></a>Status<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/status.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><h3>Deprecated in 1.2.0. </h3>
See the Indices Recovery API
</div></div><p>The indices status API allows to get a comprehensive status information
of one or more indices.</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/twitter/_status'</pre></div><p>In order to see the recovery status of shards, pass <code class="literal">recovery</code> flag and
set it to <code class="literal">true</code>. For snapshot status, pass the <code class="literal">snapshot</code> flag and set
it to <code class="literal">true</code>.</p><h3><a id="_multi_index"></a>Multi Index<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/status.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The status API can be applied to more than one index with a single call,
or even on <code class="literal">_all</code> the indices.</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/kimchy,elasticsearch/_status'

curl -XGET 'http://localhost:9200/_status'</pre></div></div><div class="navfooter"><span class="prev"><a href="indices-warmers.html">
              «&nbsp;
              Warmers</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-stats.html">Indices Stats
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Indices Stats</span></div><div class="navheader"><span class="prev"><a href="indices-status.html">
              «&nbsp;
              Status</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-segments.html">Indices Segments
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-stats"></a>Indices Stats<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/stats.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Indices level stats provide statistics on different operations happening
on an index. The API provides statistics on the index level scope
(though most stats can also be retrieved using node level scope).</p><p>The following returns high level aggregation and index level stats for
all indices:</p><div class="pre_wrapper"><pre class="programlisting">curl localhost:9200/_stats</pre></div><p>Specific index stats can be retrieved using:</p><div class="pre_wrapper"><pre class="programlisting">curl localhost:9200/index1,index2/_stats</pre></div><p>By default, all stats are returned, returning only specific stats can be
specified as well in the URI. Those stats can be any of:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">docs</code>
</p>
</td><td class="entry" valign="top">
<p>
The number of docs / deleted docs (docs not yet merged out).
                                Note, affected by refreshing the index.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">store</code>
</p>
</td><td class="entry" valign="top">
<p>
The size of the index.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">indexing</code>
</p>
</td><td class="entry" valign="top">
<p>
Indexing statistics, can be combined with a comma
                                separated list of <code class="literal">types</code> to provide document type level stats.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">get</code>
</p>
</td><td class="entry" valign="top">
<p>
Get statistics, including missing stats.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">search</code>
</p>
</td><td class="entry" valign="top">
<p>
Search statistics. You can include statistics for custom groups by adding
                an extra <code class="literal">groups</code> parameter (search operations can be associated with one or more
                groups). The <code class="literal">groups</code> parameter accepts a comma separated list of group names.
                Use <code class="literal">_all</code> to return statistics for all groups.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">completion</code>
</p>
</td><td class="entry" valign="top">
<p>
Completion suggest statistics.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">fielddata</code>
</p>
</td><td class="entry" valign="top">
<p>
Fielddata statistics.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">flush</code>
</p>
</td><td class="entry" valign="top">
<p>
Flush statistics.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">merge</code>
</p>
</td><td class="entry" valign="top">
<p>
Merge statistics.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">query_cache</code>
</p>
</td><td class="entry" valign="top">
<p>
<a class="link" href="index-modules-shard-query-cache.html" title="Shard query cache">Shard query cache</a> statistics.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">refresh</code>
</p>
</td><td class="entry" valign="top">
<p>
Refresh statistics.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">suggest</code>
</p>
</td><td class="entry" valign="top">
<p>
Suggest statistics.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">warmer</code>
</p>
</td><td class="entry" valign="top">
<p>
Warmer statistics.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">translog</code>
</p>
</td><td class="entry" valign="top">
<p>
Translog statistics.
</p>
</td></tr></tbody></table></div><p>Some statistics allow per field granularity which accepts a list
comma-separated list of included fields. By default all fields are included:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">fields</code>
</p>
</td><td class="entry" valign="top">
<p>
    List of fields to be included in the statistics. This is used as the
    default list unless a more specific field list is provided (see below).
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">completion_fields</code>
</p>
</td><td class="entry" valign="top">
<p>
    List of fields to be included in the Completion Suggest statistics.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">fielddata_fields</code>
</p>
</td><td class="entry" valign="top">
<p>
    List of fields to be included in the Fielddata statistics.
</p>
</td></tr></tbody></table></div><p>Here are some samples:</p><div class="pre_wrapper"><pre class="programlisting"># Get back stats for merge and refresh only for all indices
curl 'localhost:9200/_stats/merge,refresh'
# Get back stats for type1 and type2 documents for the my_index index
curl 'localhost:9200/my_index/_stats/indexing?types=type1,type2
# Get back just search stats for group1 and group2
curl 'localhost:9200/_stats/search?groups=group1,group2</pre></div><p>The stats returned are aggregated on the index level, with
<code class="literal">primaries</code> and <code class="literal">total</code> aggregations, where <code class="literal">primaries</code> are the values for only the
primary shards, and <code class="literal">total</code> are the cumulated values for both primary and replica shards.</p><p>In order to get back shard level stats, set the <code class="literal">level</code> parameter to <code class="literal">shards</code>.</p><p>Note, as shards move around the cluster, their stats will be cleared as
they are created on other nodes. On the other hand, even though a shard
"left" a node, that node will still retain the stats that shard
contributed to.</p></div><div class="navfooter"><span class="prev"><a href="indices-status.html">
              «&nbsp;
              Status</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-segments.html">Indices Segments
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Indices Segments</span></div><div class="navheader"><span class="prev"><a href="indices-stats.html">
              «&nbsp;
              Indices Stats</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-recovery.html">Indices Recovery
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-segments"></a>Indices Segments<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/segments.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Provide low level segments information that a Lucene index (shard level)
is built with. Allows to be used to provide more information on the
state of a shard and an index, possibly optimization information, data
"wasted" on deletes, and so on.</p><p>Endpoints include segments for a specific index, several indices, or
all:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/test/_segments'
curl -XGET 'http://localhost:9200/test1,test2/_segments'
curl -XGET 'http://localhost:9200/_segments'</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
    ...
        "_3": {
            "generation": 3,
            "num_docs": 1121,
            "deleted_docs": 53,
            "size_in_bytes": 228288,
            "memory_in_bytes": 3211,
            "committed": true,
            "search": true,
            "version": "4.6",
            "compound": true
        }
    ...
}</pre></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
_0
</span></dt><dd>
The key of the JSON document is the name of the segment. This name
             is used to generate file names: all files starting with this
             segment name in the directory of the shard belong to this segment.
</dd><dt><span class="term">
generation
</span></dt><dd>
A generation number that is basically incremented when needing to
             write a new segment. The segment name is derived from this
             generation number.
</dd><dt><span class="term">
num_docs
</span></dt><dd>
The number of non-deleted documents that are stored in this segment.
</dd><dt><span class="term">
deleted_docs
</span></dt><dd>
The number of deleted documents that are stored in this segment.
             It is perfectly fine if this number is greater than 0, space is
             going to be reclaimed when this segment gets merged.
</dd><dt><span class="term">
size_in_bytes
</span></dt><dd>
The amount of disk space that this segment uses, in bytes.
</dd><dt><span class="term">
memory_in_bytes
</span></dt><dd>
Segments need to store some data into memory in order to be
             searchable efficiently. This number returns the number of bytes
             that are used for that purpose. A value of -1 indicates that
             Elasticsearch was not able to compute this number.
</dd><dt><span class="term">
committed
</span></dt><dd>
Whether the segment has been sync’ed on disk. Segments that are
             committed would survive a hard reboot. No need to worry in case
             of false, the data from uncommitted segments is also stored in
             the transaction log so that Elasticsearch is able to replay
             changes on the next start.
</dd><dt><span class="term">
search
</span></dt><dd>
Whether the segment is searchable. A value of false would most
             likely mean that the segment has been written to disk but no
             refresh occurred since then to make it searchable.
</dd><dt><span class="term">
version
</span></dt><dd>
The version of Lucene that has been used to write this segment.
</dd><dt><span class="term">
compound
</span></dt><dd>
Whether the segment is stored in a compound file. When true, this
             means that Lucene merged all files from the segment in a single
             one in order to save file descriptors.
</dd></dl></div></div><div class="navfooter"><span class="prev"><a href="indices-stats.html">
              «&nbsp;
              Indices Stats</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-recovery.html">Indices Recovery
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Indices Recovery</span></div><div class="navheader"><span class="prev"><a href="indices-segments.html">
              «&nbsp;
              Indices Segments</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-clearcache.html">Clear Cache
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-recovery"></a>Indices Recovery<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/recovery.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The indices recovery API provides insight into on-going index shard recoveries.
Recovery status may be reported for specific indices, or cluster-wide.</p><p>For example, the following command would show recovery information for the indices "index1" and "index2".</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET http://localhost:9200/index1,index2/_recovery</pre></div><p>To see cluster-wide recovery status simply leave out the index names.</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET http://localhost:9200/_recovery?pretty&amp;human</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
  "index1" : {
    "shards" : [ {
      "id" : 0,
      "type" : "SNAPSHOT",
      "stage" : "INDEX",
      "primary" : true,
      "start_time" : "2014-02-24T12:15:59.716",
      "start_time_in_millis": 1393244159716,
      "total_time" : "2.9m"
      "total_time_in_millis" : 175576,
      "source" : {
        "repository" : "my_repository",
        "snapshot" : "my_snapshot",
        "index" : "index1"
      },
      "target" : {
        "id" : "ryqJ5lO5S4-lSFbGntkEkg",
        "hostname" : "my.fqdn",
        "ip" : "10.0.1.7",
        "name" : "my_es_node"
      },
      "index" : {
        "size" : {
          "total" : "75.4mb"
          "total_in_bytes" : 79063092,
          "reused" : "0b",
          "reused_in_bytes" : 0,
          "recovered" : "65.7mb",
          "recovered_in_bytes" : 68891939,
          "percent" : "87.1%"
        },
        "files" : {
          "total" : 73,
          "reused" : 0,
          "recovered" : 69,
          "percent" : "94.5%"
        },
        "total_time" : "0s",
        "total_time_in_millis" : 0
      },
      "translog" : {
        "recovered" : 0,
        "total" : 0,
        "percent" : "100.0%",
        "total_on_start" : 0,
        "total_time" : "0s",
        "total_time_in_millis" : 0
      },
      "start" : {
        "check_index_time" : "0s",
        "check_index_time_in_millis" : 0,
        "total_time" : "0s",
        "total_time_in_millis" : 0
      }
    } ]
  }
}</pre></div><p>The above response shows a single index recovering a single shard. In this case, the source of the recovery is a snapshot repository
and the target of the recovery is the node with name "my_es_node".</p><p>Additionally, the output shows the number and percent of files recovered, as well as the number and percent of bytes recovered.</p><p>In some cases a higher level of detail may be preferable. Setting "detailed=true" will present a list of physical files in recovery.</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET http://localhost:9200/_recovery?pretty&amp;human&amp;detailed=true</pre></div><p>Response:</p><div class="pre_wrapper"><pre class="programlisting">{
  "index1" : {
    "shards" : [ {
      "id" : 0,
      "type" : "GATEWAY",
      "stage" : "DONE",
      "primary" : true,
      "start_time" : "2014-02-24T12:38:06.349",
      "start_time_in_millis" : "1393245486349",
      "stop_time" : "2014-02-24T12:38:08.464",
      "stop_time_in_millis" : "1393245488464",
      "total_time" : "2.1s",
      "total_time_in_millis" : 2115,
      "source" : {
        "id" : "RGMdRc-yQWWKIBM4DGvwqQ",
        "hostname" : "my.fqdn",
        "ip" : "10.0.1.7",
        "name" : "my_es_node"
      },
      "target" : {
        "id" : "RGMdRc-yQWWKIBM4DGvwqQ",
        "hostname" : "my.fqdn",
        "ip" : "10.0.1.7",
        "name" : "my_es_node"
      },
      "index" : {
        "size" : {
          "total" : "24.7mb",
          "total_in_bytes" : 26001617,
          "reused" : "24.7mb",
          "reused_in_bytes" : 26001617,
          "recovered" : "0b",
          "recovered_in_bytes" : 0,
          "percent" : "100.0%"
        },
        "files" : {
          "total" : 26,
          "reused" : 26,
          "recovered" : 0,
          "percent" : "100.0%",
          "details" : [ {
            "name" : "segments.gen",
            "length" : 20,
            "recovered" : 20
          }, {
            "name" : "_0.cfs",
            "length" : 135306,
            "recovered" : 135306
          }, {
            "name" : "segments_2",
            "length" : 251,
            "recovered" : 251
          },
           ...
          ]
        },
        "total_time" : "2ms",
        "total_time_in_millis" : 2
      },
      "translog" : {
        "recovered" : 71,
        "total_time" : "2.0s",
        "total_time_in_millis" : 2025
      },
      "start" : {
        "check_index_time" : 0,
        "total_time" : "88ms",
        "total_time_in_millis" : 88
      }
    } ]
  }
}</pre></div><p>This response shows a detailed listing (truncated for brevity) of the actual files recovered and their sizes.</p><p>Also shown are the timings in milliseconds of the various stages of recovery: index retrieval, translog replay, and index start time.</p><p>Note that the above listing indicates that the recovery is in stage "done". All recoveries, whether on-going or complete, are kept in
cluster state and may be reported on at any time. Setting "active_only=true" will cause only on-going recoveries to be reported.</p><p>Here is a complete list of options:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">detailed</code>
</p>
</td><td class="entry" valign="top">
<p>
Display a detailed view. This is primarily useful for viewing the recovery of physical index files. Default: false.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">active_only</code>
</p>
</td><td class="entry" valign="top">
<p>
Display only those recoveries that are currently on-going. Default: false.
</p>
</td></tr></tbody></table></div><p>Description of output fields:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">id</code>
</p>
</td><td class="entry" valign="top">
<p>
Shard ID
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">type</code>
</p>
</td><td class="entry" valign="top">
<p>
Recovery type:
</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
gateway
</li><li class="listitem">
snapshot
</li><li class="listitem">
replica
</li><li class="listitem">
relocating
</li></ul></div>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">stage</code>
</p>
</td><td class="entry" valign="top">
<p>
Recovery stage:
</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
init:     Recovery has not started
</li><li class="listitem">
index:    Reading index meta-data and copying bytes from source to destination
</li><li class="listitem">
start:    Starting the engine; opening the index for use
</li><li class="listitem">
translog: Replaying transaction log
</li><li class="listitem">
finalize: Cleanup
</li><li class="listitem">
done:     Complete
</li></ul></div>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">primary</code>
</p>
</td><td class="entry" valign="top">
<p>
True if shard is primary, false otherwise
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">start_time</code>
</p>
</td><td class="entry" valign="top">
<p>
Timestamp of recovery start
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">stop_time</code>
</p>
</td><td class="entry" valign="top">
<p>
Timestamp of recovery finish
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">total_time_in_millis</code>
</p>
</td><td class="entry" valign="top">
<p>
Total time to recover shard in milliseconds
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">source</code>
</p>
</td><td class="entry" valign="top">
<p>
Recovery source:
</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
repository description if recovery is from a snapshot
</li><li class="listitem">
description of source node otherwise
</li></ul></div>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">target</code>
</p>
</td><td class="entry" valign="top">
<p>
Destination node
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">index</code>
</p>
</td><td class="entry" valign="top">
<p>
Statistics about physical index recovery
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">translog</code>
</p>
</td><td class="entry" valign="top">
<p>
Statistics about translog recovery
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">start</code>
</p>
</td><td class="entry" valign="top">
<p>
Statistics about time to open and start the index
</p>
</td></tr></tbody></table></div></div><div class="navfooter"><span class="prev"><a href="indices-segments.html">
              «&nbsp;
              Indices Segments</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-clearcache.html">Clear Cache
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Clear Cache</span></div><div class="navheader"><span class="prev"><a href="indices-recovery.html">
              «&nbsp;
              Indices Recovery</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-flush.html">Flush
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-clearcache"></a>Clear Cache<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/clearcache.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The clear cache API allows to clear either all caches or specific cached
associated with one or more indices.</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPOST 'http://localhost:9200/twitter/_cache/clear'</pre></div><p>The API, by default, will clear all caches. Specific caches can be cleaned
explicitly by setting <code class="literal">filter</code>, <code class="literal">fielddata</code>, <code class="literal">query_cache</code>,
or <code class="literal">id_cache</code> to <code class="literal">true</code>.</p><p>All caches relating to a specific field(s) can also be cleared by
specifying <code class="literal">fields</code> parameter with a comma delimited list of the
relevant fields.</p><h3><a id="_multi_index_2"></a>Multi Index<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/clearcache.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The clear cache API can be applied to more than one index with a single
call, or even on <code class="literal">_all</code> the indices.</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPOST 'http://localhost:9200/kimchy,elasticsearch/_cache/clear'

$ curl -XPOST 'http://localhost:9200/_cache/clear'</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The <code class="literal">filter</code> cache is not cleared immediately but is scheduled to be
cleared within 60 seconds.</p></div></div></div><div class="navfooter"><span class="prev"><a href="indices-recovery.html">
              «&nbsp;
              Indices Recovery</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-flush.html">Flush
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Flush</span></div><div class="navheader"><span class="prev"><a href="indices-clearcache.html">
              «&nbsp;
              Clear Cache</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-synced-flush.html">Synced Flush
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-flush"></a>Flush<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/flush.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The flush API allows to flush one or more indices through an API. The
flush process of an index basically frees memory from the index by
flushing data to the index storage and clearing the internal
<a class="link" href="index-modules-translog.html" title="Translog">transaction log</a>. By
default, Elasticsearch uses memory heuristics in order to automatically
trigger flush operations as required in order to clear memory.</p><div class="pre_wrapper"><pre class="programlisting">POST /twitter/_flush</pre></div><div class="sense_widget" data-snippet="snippets/indices-flush/1.json"></div><h3><a id="flush-parameters"></a>Request Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/flush.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The flush API accepts the following request parameters:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">wait_if_ongoing</code>
</p>
</td><td class="entry" valign="top">
<p>
If set to <code class="literal">true</code> the flush operation will block until the
flush can be executed if another flush operation is already executing.
The default is <code class="literal">false</code> and will cause an exception to be thrown on
the shard level if another flush operation is already running.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">force</code>
</p>
</td><td class="entry" valign="top">
<p>
Whether a flush should be forced even if it is not necessarily needed ie.
if no changes will be committed to the index. This is useful if transaction log IDs
should be incremented even if no uncommitted changes are present.
(This setting can be considered as internal)
</p>
</td></tr></tbody></table></div><h3><a id="flush-multi-index"></a>Multi Index<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/flush.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The flush API can be applied to more than one index with a single call,
or even on <code class="literal">_all</code> the indices.</p><div class="pre_wrapper"><pre class="programlisting">POST /kimchy,elasticsearch/_flush

POST /_flush</pre></div><div class="sense_widget" data-snippet="snippets/indices-flush/2.json"></div></div><div class="navfooter"><span class="prev"><a href="indices-clearcache.html">
              «&nbsp;
              Clear Cache</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-synced-flush.html">Synced Flush
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-link"><a href="indices-flush.html">Flush</a></span> » <span class="breadcrumb-node">Synced Flush</span></div><div class="navheader"><span class="prev"><a href="indices-flush.html">
              «&nbsp;
              Flush</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-refresh.html">Refresh
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="indices-synced-flush"></a>Synced Flush<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/flush.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Elasticsearch tracks the indexing activity of each shard. Shards that have not
received any indexing operations for 5 minutes are automatically marked as inactive. This presents
an opportunity for Elasticsearch to reduce shard resources and also perform
a special kind of flush, called <code class="literal">synced flush</code>. A synced flush performs a normal flush, then adds
a generated unique marker (sync_id) to all shards.</p><p>Since the sync id marker was added when there were no ongoing indexing operations, it can
be used as a quick way to check if the two shards' lucene indices are identical. This quick sync id
comparison (if present) is used during recovery or restarts to skip the first and
most costly phase of the process. In that case, no segment files need to be copied and
the transaction log replay phase of the recovery can start immediately. Note that since the sync id
marker was applied together with a flush, it is very likely that the transaction log will be empty,
speeding up recoveries even more.</p><p>This is particularly useful for use cases having lots of indices which are
never or very rarely updated, such as time based data. This use case typically generates lots of indices whose
recovery without the synced flush marker would take a long time.</p><p>To check whether a shard has a marker or not, look for the <code class="literal">commit</code> section of shard stats returned by
the <a class="link" href="indices-stats.html" title="Indices Stats">indices stats</a> API:</p><div class="pre_wrapper"><pre class="programlisting">GET /twitter/_stats/commit?level=shards</pre></div><div class="sense_widget" data-snippet="snippets/indices-synced-flush/1.json"></div><p>which returns something similar to:</p><div class="pre_wrapper"><pre class="programlisting">{
   ...
   "indices": {
      "twitter": {
         "primaries": {},
         "total": {},
         "shards": {
            "0": [
               {
                  "routing": {
                     ...
                  },
                  "commit": {
                     "id": "te7zF7C4UsirqvL6jp/vUg==",
                     "generation": 2,
                     "user_data": {
                        "sync_id": "AU2VU0meX-VX2aNbEUsD" <a id="CO51-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>,
                        ...
                     },
                     "num_docs": 0
                  }
               }
               ...
            ],
            ...
         }
      }
   }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO51-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
the <code class="literal">sync id</code> marker
</p></td></tr></tbody></table></div><h3><a id="_synced_flush_api"></a>Synced Flush API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/flush.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The Synced Flush API allows an administrator to initiate a synced flush manually. This can be particularly useful for
a planned (rolling) cluster restart where you can stop indexing and don’t want to wait the default 5 minutes for
idle indices to be sync-flushed automatically.</p><p>While handy, there are a couple of caveats for this API:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
Synced flush is a best effort operation. Any ongoing indexing operations will cause
the synced flush to fail on that shard. This means that some shards may be synced flushed while others aren’t. See below for more.
</li><li class="listitem">
The <code class="literal">sync_id</code> marker is removed as soon as the shard is flushed again. That is because a flush replaces the low level
lucene commit point where the marker is stored. Uncommitted operations in the transaction log do not remove the marker.
In practice, one should consider any indexing operation on an index as removing the marker as a flush can be triggered by Elasticsearch
at any time.
</li></ol></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>It is harmless to request a synced flush while there is ongoing indexing. Shards that are idle will succeed and shards
 that are not will fail. Any shards that succeeded will have faster recovery times.</p></div></div><div class="pre_wrapper"><pre class="programlisting">POST /twitter/_flush/synced</pre></div><div class="sense_widget" data-snippet="snippets/indices-synced-flush/2.json"></div><p>The response contains details about how many shards were successfully sync-flushed and information about any failure.</p><p>Here is what it looks like when all shards of a two shards and one replica index successfully
sync-flushed:</p><div class="pre_wrapper"><pre class="programlisting">{
   "_shards": {
      "total": 4,
      "successful": 4,
      "failed": 0
   },
   "twitter": {
      "total": 4,
      "successful": 4,
      "failed": 0
   }
}</pre></div><p>Here is what it looks like when one shard group failed due to pending operations:</p><div class="pre_wrapper"><pre class="programlisting">{
   "_shards": {
      "total": 4,
      "successful": 2,
      "failed": 2
   },
   "twitter": {
      "total": 4,
      "successful": 2,
      "failed": 2,
      "failures": [
         {
            "shard": 1,
            "reason": "[2] ongoing operations on primary"
         }
      ]
   }
}</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>The above error is shown when the synced flush failes due to concurrent indexing operations. The HTTP
status code in that case will be <code class="literal">409 CONFLICT</code>.</p></div></div><p>Sometimes the failures are specific to a shard copy. The copies that failed will not be eligible for
fast recovery but those that succeeded still will be. This case is reported as follows:</p><div class="pre_wrapper"><pre class="programlisting">{
   "_shards": {
      "total": 4,
      "successful": 1,
      "failed": 1
   },
   "twitter": {
      "total": 4,
      "successful": 3,
      "failed": 1,
      "failures": [
         {
            "shard": 1,
            "reason": "unexpected error",
            "routing": {
               "state": "STARTED",
               "primary": false,
               "node": "SZNr2J_ORxKTLUCydGX4zA",
               "relocating_node": null,
               "shard": 1,
               "index": "twitter"
            }
         }
      ]
   }
}</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>When a shard copy fails to sync-flush, the HTTP status code returned will be <code class="literal">409 CONFLICT</code>.</p></div></div><p>The synced flush API can be applied to more than one index with a single call,
or even on <code class="literal">_all</code> the indices.</p><div class="pre_wrapper"><pre class="programlisting">POST /kimchy,elasticsearch/_flush/synced

POST /_flush/synced</pre></div><div class="sense_widget" data-snippet="snippets/indices-synced-flush/3.json"></div></div><div class="navfooter"><span class="prev"><a href="indices-flush.html">
              «&nbsp;
              Flush</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-refresh.html">Refresh
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Refresh</span></div><div class="navheader"><span class="prev"><a href="indices-synced-flush.html">
              «&nbsp;
              Synced Flush</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-optimize.html">Optimize
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-refresh"></a>Refresh<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/refresh.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The refresh API allows to explicitly refresh one or more index, making
all operations performed since the last refresh available for search.
The (near) real-time capabilities depend on the index engine used. For
example, the internal one requires refresh to be called, but by default a
refresh is scheduled periodically.</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPOST 'http://localhost:9200/twitter/_refresh'</pre></div><h3><a id="_multi_index_3"></a>Multi Index<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/refresh.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The refresh API can be applied to more than one index with a single
call, or even on <code class="literal">_all</code> the indices.</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPOST 'http://localhost:9200/kimchy,elasticsearch/_refresh'

$ curl -XPOST 'http://localhost:9200/_refresh'</pre></div></div><div class="navfooter"><span class="prev"><a href="indices-synced-flush.html">
              «&nbsp;
              Synced Flush</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-optimize.html">Optimize
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Optimize</span></div><div class="navheader"><span class="prev"><a href="indices-refresh.html">
              «&nbsp;
              Refresh</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-shadow-replicas.html">Shadow replica indices
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-optimize"></a>Optimize<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/optimize.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The optimize API allows to optimize one or more indices through an API.
The optimize process basically optimizes the index for faster search
operations (and relates to the number of segments a Lucene index holds
within each shard). The optimize operation allows to reduce the number
of segments by merging them.</p><p>This call will block until the optimize is complete. If the http connection
is lost, the request will continue in the background, and
any new requests will block until the previous optimize is complete.</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPOST 'http://localhost:9200/twitter/_optimize'</pre></div><h3><a id="optimize-parameters"></a>Request Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/optimize.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The optimize API accepts the following request parameters as query arguments:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">max_num_segments</code>
</p>
</td><td class="entry" valign="top">
<p>
The number of segments to optimize to. To fully
optimize the index, set it to <code class="literal">1</code>. Defaults to simply checking if a
merge needs to execute, and if so, executes it.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">only_expunge_deletes</code>
</p>
</td><td class="entry" valign="top">
<p>
Should the optimize process only expunge segments with
deletes in it. In Lucene, a document is not deleted from a segment, just marked
as deleted. During a merge process of segments, a new segment is created that
does not have those deletes. This flag allows to only merge segments that have
deletes. Defaults to <code class="literal">false</code>.  Note that this won’t override the
<code class="literal">index.merge.policy.expunge_deletes_allowed</code> threshold.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">flush</code>
</p>
</td><td class="entry" valign="top">
<p>
Should a flush be performed after the optimize. Defaults to
<code class="literal">true</code>.
</p>
</td></tr></tbody></table></div><h3><a id="optimize-multi-index"></a>Multi Index<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/optimize.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The optimize API can be applied to more than one index with a single
call, or even on <code class="literal">_all</code> the indices.</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPOST 'http://localhost:9200/kimchy,elasticsearch/_optimize'

$ curl -XPOST 'http://localhost:9200/_optimize?only_expunge_deletes=true'</pre></div></div><div class="navfooter"><span class="prev"><a href="indices-refresh.html">
              «&nbsp;
              Refresh</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-shadow-replicas.html">Shadow replica indices
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Shadow replica indices</span></div><div class="navheader"><span class="prev"><a href="indices-optimize.html">
              «&nbsp;
              Optimize</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_node_level_settings_related_to_shadow_replicas.html">Node level settings related to shadow replicas
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-shadow-replicas"></a>Shadow replica indices<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/shadow-replicas.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>This functionality is experimental and may be changed or removed completely in a future release. Elastic will take a best effort approach to fix any issues, but experimental features are not subject to the support SLA of official GA features.</p></div></div><p>If you would like to use a shared filesystem, you can use the shadow replicas
settings to choose where on disk the data for an index should be kept, as well
as how Elasticsearch should replay operations on all the replica shards of an
index.</p><p>In order to fully utilize the <code class="literal">index.data_path</code> and <code class="literal">index.shadow_replicas</code>
settings, you need to enable using it in elasticsearch.yml:</p><div class="pre_wrapper"><pre class="programlisting">node.enable_custom_paths: true</pre></div><p>You can then create an index with a custom data path, where each node will use
this path for the data:</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Because shadow replicas do not index the document on replica shards, it’s
possible for the replica’s known mapping to be behind the index’s known mapping
if the latest cluster state has not yet been processed on the node containing
the replica. Because of this, it is highly recommended to use pre-defined
mappings when using shadow replicas.</p></div></div><div class="pre_wrapper"><pre class="programlisting">curl -XPUT 'localhost:9200/my_index' -d '
{
    "index" : {
        "number_of_shards" : 1,
        "number_of_replicas" : 4,
        "data_path": "/var/data/my_index",
        "shadow_replicas": true
    }
}'</pre></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>In the above example, the "/var/data/my_index" path is a shared filesystem that
must be available on every node in the Elasticsearch cluster. You must also
ensure that the Elasticsearch process has the correct permissions to read from
and write to the directory used in the <code class="literal">index.data_path</code> setting.</p></div></div><p>An index that has been created with the <code class="literal">index.shadow_replicas</code> setting set to
"true" will not replicate document operations to any of the replica shards,
instead, it will only continually refresh. Once segments are available on the
filesystem where the shadow replica resides (after an Elasticsearch "flush"), a
regular refresh (governed by the <code class="literal">index.refresh_interval</code>) can be used to make
the new data searchable.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Since documents are only indexed on the primary shard, realtime GET
requests could fail to return a document if executed on the replica shard,
therefore, GET API requests automatically have the <code class="literal">?preference=_primary</code> flag
set if there is no preference flag already set.</p></div></div><p>In order to ensure the data is being synchronized in a fast enough manner, you
may need to tune the flush threshold for the index to a desired number. A flush
is needed to fsync segment files to disk, so they will be visible to all other
replica nodes. Users should test what flush threshold levels they are
comfortable with, as increased flushing can impact indexing performance.</p><p>The Elasticsearch cluster will still detect the loss of a primary shard, and
transform the replica into a primary in this situation. This transformation will
take slightly longer, since no <code class="literal">IndexWriter</code> is maintained for each shadow
replica.</p><p>Below is the list of settings that can be changed using the update
settings API:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">index.data_path</code> (string)
</span></dt><dd>
    Path to use for the index’s data. Note that by default Elasticsearch will
    append the node ordinal by default to the path to ensure multiple instances
    of Elasticsearch on the same machine do not share a data directory.
</dd><dt><span class="term">
<code class="literal">index.shadow_replicas</code>
</span></dt><dd>
    Boolean value indicating this index should use shadow replicas. Defaults to
    <code class="literal">false</code>.
</dd><dt><span class="term">
<code class="literal">index.shared_filesystem</code>
</span></dt><dd>
    Boolean value indicating this index uses a shared filesystem. Defaults to
    the <code class="literal">true</code> if <code class="literal">index.shadow_replicas</code> is set to true, <code class="literal">false</code> otherwise.
</dd><dt><span class="term">
<code class="literal">index.shared_filesystem.recover_on_any_node</code>
</span></dt><dd>
    Boolean value indicating whether the primary shards for the index should be
    allowed to recover on any node in the cluster, regardless of the number of
    replicas or whether the node has previously had the shard allocated to it
    before. Defaults to <code class="literal">false</code>.
</dd></dl></div></div><div class="navfooter"><span class="prev"><a href="indices-optimize.html">
              «&nbsp;
              Optimize</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="_node_level_settings_related_to_shadow_replicas.html">Node level settings related to shadow replicas
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-link"><a href="indices-shadow-replicas.html">Shadow replica indices</a></span> » <span class="breadcrumb-node">Node level settings related to shadow replicas</span></div><div class="navheader"><span class="prev"><a href="indices-shadow-replicas.html">
              «&nbsp;
              Shadow replica indices</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-upgrade.html">Upgrade
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="_node_level_settings_related_to_shadow_replicas"></a>Node level settings related to shadow replicas<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/shadow-replicas.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>These are non-dynamic settings that need to be configured in <code class="literal">elasticsearch.yml</code></p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">node.add_id_to_custom_path</code>
</span></dt><dd>
    Boolean setting indicating whether Elasticsearch should append the node’s
    ordinal to the custom data path. For example, if this is enabled and a path
    of "/tmp/foo" is used, the first locally-running node will use "/tmp/foo/0",
    the second will use "/tmp/foo/1", the third "/tmp/foo/2", etc. Defaults to
    <code class="literal">true</code>.
</dd><dt><span class="term">
<code class="literal">node.enable_custom_paths</code>
</span></dt><dd>
    Boolean value that must be set to <code class="literal">true</code> in order to use the
    <code class="literal">index.data_path</code> setting. Defaults to <code class="literal">false</code>.
</dd></dl></div></div><div class="navfooter"><span class="prev"><a href="indices-shadow-replicas.html">
              «&nbsp;
              Shadow replica indices</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="indices-upgrade.html">Upgrade
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="indices.html">Indices APIs</a></span> » <span class="breadcrumb-node">Upgrade</span></div><div class="navheader"><span class="prev"><a href="_node_level_settings_related_to_shadow_replicas.html">
              «&nbsp;
              Node level settings related to shadow replicas</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat.html">cat APIs
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="indices-upgrade"></a>Upgrade<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/upgrade.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The upgrade API allows to upgrade one or more indices to the latest Lucene
format through an API. The upgrade process converts any segments written with
older formats.</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>When to use the <code class="literal">upgrade</code> API</strong></p></div></div></div><p>Newer versions of Lucene often come with a new index format which provides bug
fixes and performance improvements. In order to take advantage of these
improvements, the segments in each shard need to be rewritten using the latest
Lucene format.</p><p class="formalpara"><strong>Automatic upgrading.&nbsp;</strong>Indices that are actively being written to will automatically write new
segments in the latest format.  The background merge process which combines
multiple small segments into a single bigger segment will also write the new
merged segment in the latest format.</p><p class="formalpara"><strong>Optional manual upgrades.&nbsp;</strong>Some old segments may never be merged away because they are already too big to
be worth merging, and indices that no longer receive changes will not be
upgraded automatically.  Upgrading segments is not required for most
Elasticsearch upgrades because it can read older formats from the current and
previous major version of Lucene.</p><p>You can, however, choose to upgrade old segments manually to take advantage of
the latest format. The <code class="literal">upgrade</code> API will rewrite any old segments in the
latest Lucene format.  It can be run on one index, multiple or all indices, so
you can control when it is run and how many indices it should upgrade.</p><p class="formalpara"><strong>When you must use the <code class="literal">upgrade</code> API.&nbsp;</strong>Elasticsearch can only read formats from the current and previous major
version of Lucene.  For instance, Elasticsearch 2.x (Lucene 5) can read disk
formats from Elasticsearch 0.90 and 1.x (Lucene 4), but not from Elasticsearch
0.20 and before (Lucene 3).</p><p>In fact, an Elasticsearch 2.0 cluster will refuse to start if any indices
created before Elasticsearch 0.90 are present, and it will refuse to open them
if they are imported as dangling indices later on.  It will not be possible to
restore an index created with Elasticsearch 0.20.x and before into a 2.0
cluster.</p><p>These ancient indices must either be deleted or upgraded before migrating to
Elasticsearch 2.0.  Upgrading will:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
Rewrite old segments in the latest Lucene format.
</li><li class="listitem">
Add the <code class="literal">index.version.minimum_compatible</code> setting to the index, to mark it as
  2.0 compatible <span class="added">
      [<span class="version">1.6.0</span>]
      <span class="detail">Added in 1.6.0.
</span></span>.
</li></ul></div><p>Instead of upgrading all segments that weren’t written with the most recent
version of Lucene, you can choose to do the minimum work required before
moving to Elasticsearch 2.0, by specifying the <code class="literal">only_ancient_segments</code> option,
which will only rewrite segments written by Lucene 3.</p></div><h3><a id="_start_an_upgrade"></a>Start an upgrade<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/upgrade.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><div class="pre_wrapper"><pre class="programlisting">$ curl -XPOST 'http://localhost:9200/twitter/_upgrade'</pre></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Upgrading is an I/O intensive operation, and is limited to processing a
single shard per node at a time.  It also is not allowed to run at the same
time as optimize.</p></div></div><p>This call will block until the upgrade is complete. If the http connection
is lost, the request will continue in the background, and
any new requests will block until the previous upgrade is complete.</p><h4><a id="upgrade-parameters"></a>Request Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/upgrade.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">upgrade</code> API accepts the following request parameters:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">only_ancient_segments</code>
</p>
</td><td class="entry" valign="top">
<p>
If true, only very old segments (from a
previous Lucene major release) will be upgraded.  While this will do
the minimal work to ensure the next major release of Elasticsearch can
read the segments, it’s dangerous because it can leave other very old
segments in sub-optimal formats.  Defaults to <code class="literal">false</code>.
</p>
</td></tr></tbody></table></div><h3><a id="_check_upgrade_status"></a>Check upgrade status<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/indices/upgrade.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Use a <code class="literal">GET</code> request to monitor how much of an index is upgraded.  This
can also be used prior to starting an upgrade to identify which
indices you want to upgrade at the same time.</p><p>The <code class="literal">ancient</code> byte values that are returned indicate total bytes of
segments whose version is extremely old (Lucene major version is
different from the current version), showing how much upgrading is
necessary when you run with <code class="literal">only_ancient_segments=true</code>.</p><div class="pre_wrapper"><pre class="programlisting">curl 'http://localhost:9200/twitter/_upgrade?pretty&amp;human'</pre></div><div class="pre_wrapper"><pre class="programlisting">{
  "size": "21gb",
  "size_in_bytes": "21000000000",
  "size_to_upgrade": "10gb",
  "size_to_upgrade_in_bytes": "10000000000"
  "size_to_upgrade_ancient": "1gb",
  "size_to_upgrade_ancient_in_bytes": "1000000000"
  "indices": {
    "twitter": {
      "size": "21gb",
      "size_in_bytes": "21000000000",
      "size_to_upgrade": "10gb",
      "size_to_upgrade_in_bytes": "10000000000"
      "size_to_upgrade_ancient": "1gb",
      "size_to_upgrade_ancient_in_bytes": "1000000000"
    }
  }
}</pre></div><p>The level of details in the upgrade status command can be controlled by
setting <code class="literal">level</code> parameter to <code class="literal">cluster</code>, <code class="literal">index</code> (default) or <code class="literal">shard</code> levels.
For example, you can run the upgrade status command with <code class="literal">level=shard</code> to
get detailed upgrade information of each individual shard.</p></div><div class="navfooter"><span class="prev"><a href="_node_level_settings_related_to_shadow_replicas.html">
              «&nbsp;
              Node level settings related to shadow replicas</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat.html">cat APIs
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-node">cat APIs</span></div><div class="navheader"><span class="prev"><a href="indices-upgrade.html">
              «&nbsp;
              Upgrade</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-alias.html">cat aliases
              &nbsp;»
            </a></span></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="cat"></a>cat APIs<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><div class="partintro"><div></div><h2><a id="intro"></a>Introduction<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><p>JSON is great… for computers.  Even if it’s pretty-printed, trying
to find relationships in the data is tedious.  Human eyes, especially
when looking at an ssh terminal, need compact and aligned text.  The
cat API aims to meet this need.</p><p>All the cat commands accept a query string parameter <code class="literal">help</code> to see all
the headers and info they provide, and the <code class="literal">/_cat</code> command alone lists all
the available commands.</p><h2><a id="common-parameters"></a>Common parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><h3><a id="verbose"></a>Verbose<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Each of the commands accepts a query string parameter <code class="literal">v</code> to turn on
verbose output.</p><div class="pre_wrapper"><pre class="programlisting">% curl 'localhost:9200/_cat/master?v'
id                     ip        node
EGtKWZlWQYWDmX29fUnp3Q 127.0.0.1 Grey, Sara</pre></div><h3><a id="help"></a>Help<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Each of the commands accepts a query string parameter <code class="literal">help</code> which will
output its available columns.</p><div class="pre_wrapper"><pre class="programlisting">% curl 'localhost:9200/_cat/master?help'
id   | node id
ip   | node transport ip address
node | node name</pre></div><h3><a id="headers"></a>Headers<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Each of the commands accepts a query string parameter <code class="literal">h</code> which forces
only those columns to appear.</p><div class="pre_wrapper"><pre class="programlisting">% curl 'n1:9200/_cat/nodes?h=ip,port,heapPercent,name'
192.168.56.40 9300 40.3 Captain Universe
192.168.56.20 9300 15.3 Kaluu
192.168.56.50 9300 17.0 Yellowjacket
192.168.56.10 9300 12.3 Remy LeBeau
192.168.56.30 9300 43.9 Ramsey, Doug</pre></div><h3><a id="numeric-formats"></a>Numeric formats<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Many commands provide a few types of numeric output, either a byte
value or a time value.  By default, these types are human-formatted,
for example, <code class="literal">3.5mb</code> instead of <code class="literal">3763212</code>.  The human values are not
sortable numerically, so in order to operate on these values where
order is important, you can change it.</p><p>Say you want to find the largest index in your cluster (storage used
by all the shards, not number of documents).  The <code class="literal">/_cat/indices</code> API
is ideal.  We only need to tweak two things.  First, we want to turn
off human mode.  We’ll use a byte-level resolution.  Then we’ll pipe
our output into <code class="literal">sort</code> using the appropriate column, which in this
case is the eight one.</p><div class="pre_wrapper"><pre class="programlisting">% curl '192.168.56.10:9200/_cat/indices?bytes=b' | sort -rnk8
green wiki2 3 0 10000   0 105274918 105274918
green wiki1 3 0 10000 413 103776272 103776272
green foo   1 0   227   0   2065131   2065131</pre></div></div></div><div class="navfooter"><span class="prev"><a href="indices-upgrade.html">
              «&nbsp;
              Upgrade</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-alias.html">cat aliases
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cat.html">cat APIs</a></span> » <span class="breadcrumb-node">cat aliases</span></div><div class="navheader"><span class="prev"><a href="cat.html">
              «&nbsp;
              cat APIs</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-allocation.html">cat allocation
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-alias"></a>cat aliases<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/alias.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p><code class="literal">aliases</code> shows information about currently configured aliases to indices
including filter and routing infos.</p><div class="pre_wrapper"><pre class="programlisting">% curl '192.168.56.10:9200/_cat/aliases?v'
alias  index filter indexRouting searchRouting
alias2 test1 *      -            -
alias4 test1 -      2            1,2
alias1 test1 -      -            -
alias3 test1 -      1            1</pre></div><p>The output shows that <code class="literal">alias</code> has configured a filter, and specific routing
configurations in <code class="literal">alias3</code> and <code class="literal">alias4</code>.</p><p>If you only want to get information about a single alias, you can specify
the alias in the URL, for example <code class="literal">/_cat/aliases/alias1</code>.</p></div><div class="navfooter"><span class="prev"><a href="cat.html">
              «&nbsp;
              cat APIs</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-allocation.html">cat allocation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cat.html">cat APIs</a></span> » <span class="breadcrumb-node">cat allocation</span></div><div class="navheader"><span class="prev"><a href="cat-alias.html">
              «&nbsp;
              cat aliases</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-count.html">cat count
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-allocation"></a>cat allocation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/allocation.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p><code class="literal">allocation</code> provides a snapshot of how shards have located around the
cluster and the state of disk usage.</p><div class="pre_wrapper"><pre class="programlisting">% curl '192.168.56.10:9200/_cat/allocation?v'
shards diskUsed diskAvail diskRatio ip            node
     1    5.6gb    72.2gb      7.8% 192.168.56.10 Jarella
     1    5.6gb    72.2gb      7.8% 192.168.56.30 Solarr
     1    5.5gb    72.3gb      7.6% 192.168.56.20 Adam II</pre></div><p>Here we can see that each node has been allocated a single shard and
that they’re all using about the same amount of space.</p></div><div class="navfooter"><span class="prev"><a href="cat-alias.html">
              «&nbsp;
              cat aliases</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-count.html">cat count
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cat.html">cat APIs</a></span> » <span class="breadcrumb-node">cat count</span></div><div class="navheader"><span class="prev"><a href="cat-allocation.html">
              «&nbsp;
              cat allocation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-fielddata.html">cat fielddata
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-count"></a>cat count<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/count.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p><code class="literal">count</code> provides quick access to the document count of the entire
cluster, or individual indices.</p><div class="pre_wrapper"><pre class="programlisting">% curl 192.168.56.10:9200/_cat/indices
green wiki1 3 0 10000 331 168.5mb 168.5mb
green wiki2 3 0   428   0     8mb     8mb
% curl 192.168.56.10:9200/_cat/count
1384314124582 19:42:04 10428
% curl 192.168.56.10:9200/_cat/count/wiki2
1384314139815 19:42:19 428</pre></div></div><div class="navfooter"><span class="prev"><a href="cat-allocation.html">
              «&nbsp;
              cat allocation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-fielddata.html">cat fielddata
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cat.html">cat APIs</a></span> » <span class="breadcrumb-node">cat fielddata</span></div><div class="navheader"><span class="prev"><a href="cat-count.html">
              «&nbsp;
              cat count</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-health.html">cat health
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-fielddata"></a>cat fielddata<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/fielddata.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p><code class="literal">fielddata</code> shows information about currently loaded fielddata on a per-node
basis.</p><div class="pre_wrapper"><pre class="programlisting">% curl '192.168.56.10:9200/_cat/fielddata?v'
id                     host    ip            node          total   body    text
c223lARiSGeezlbrcugAYQ myhost1 10.20.100.200 Jessica Jones 385.6kb 159.8kb 225.7kb
waPCbitNQaCL6xC8VxjAwg myhost2 10.20.100.201 Adversary     435.2kb 159.8kb 275.3kb
yaDkp-G3R0q1AJ-HUEvkSQ myhost3 10.20.100.202 Microchip     284.6kb 109.2kb 175.3kb</pre></div><p>Fields can be specified either as a query parameter, or in the URL path:</p><div class="pre_wrapper"><pre class="programlisting">% curl '192.168.56.10:9200/_cat/fielddata?v&amp;fields=body'
id                     host    ip            node          total   body
c223lARiSGeezlbrcugAYQ myhost1 10.20.100.200 Jessica Jones 385.6kb 159.8kb
waPCbitNQaCL6xC8VxjAwg myhost2 10.20.100.201 Adversary     435.2kb 159.8kb
yaDkp-G3R0q1AJ-HUEvkSQ myhost3 10.20.100.202 Microchip     284.6kb 109.2kb

% curl '192.168.56.10:9200/_cat/fielddata/body,text?v'
id                     host    ip            node          total   body    text
c223lARiSGeezlbrcugAYQ myhost1 10.20.100.200 Jessica Jones 385.6kb 159.8kb 225.7kb
waPCbitNQaCL6xC8VxjAwg myhost2 10.20.100.201 Adversary     435.2kb 159.8kb 275.3kb
yaDkp-G3R0q1AJ-HUEvkSQ myhost3 10.20.100.202 Microchip     284.6kb 109.2kb 175.3kb</pre></div><p>The output shows the total fielddata and then the individual fielddata for the
<code class="literal">body</code> and <code class="literal">text</code> fields.</p></div><div class="navfooter"><span class="prev"><a href="cat-count.html">
              «&nbsp;
              cat count</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-health.html">cat health
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cat.html">cat APIs</a></span> » <span class="breadcrumb-node">cat health</span></div><div class="navheader"><span class="prev"><a href="cat-fielddata.html">
              «&nbsp;
              cat fielddata</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-indices.html">cat indices
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-health"></a>cat health<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/health.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p><code class="literal">health</code> is a terse, one-line representation of the same information
from <code class="literal">/_cluster/health</code>. It has one option <code class="literal">ts</code> to disable the
timestamping.</p><div class="pre_wrapper"><pre class="programlisting">% curl 192.168.56.10:9200/_cat/health
1384308967 18:16:07 foo green 3 3 3 3 0 0 0
% curl '192.168.56.10:9200/_cat/health?v&amp;ts=0'
cluster status nodeTotal nodeData shards pri relo init unassign tasks
foo     green          3        3      3   3    0    0        0     0</pre></div><p>A common use of this command is to verify the health is consistent
across nodes:</p><div class="pre_wrapper"><pre class="programlisting">% pssh -i -h list.of.cluster.hosts curl -s localhost:9200/_cat/health
[1] 20:20:52 [SUCCESS] es3.vm
1384309218 18:20:18 foo green 3 3 3 3 0 0 0 0
[2] 20:20:52 [SUCCESS] es1.vm
1384309218 18:20:18 foo green 3 3 3 3 0 0 0 0
[3] 20:20:52 [SUCCESS] es2.vm
1384309218 18:20:18 foo green 3 3 3 3 0 0 0 0</pre></div><p>A less obvious use is to track recovery of a large cluster over
time. With enough shards, starting a cluster, or even recovering after
losing a node, can take time (depending on your network &amp; disk). A way
to track its progress is by using this command in a delayed loop:</p><div class="pre_wrapper"><pre class="programlisting">% while true; do curl 192.168.56.10:9200/_cat/health; sleep 120; done
1384309446 18:24:06 foo red 3 3 20 20 0 0 1812 0
1384309566 18:26:06 foo yellow 3 3 950 916 0 12 870 0
1384309686 18:28:06 foo yellow 3 3 1328 916 0 12 492 0
1384309806 18:30:06 foo green 3 3 1832 916 4 0 0
^C</pre></div><p>In this scenario, we can tell that recovery took roughly four minutes.
If this were going on for hours, we would be able to watch the
<code class="literal">UNASSIGNED</code> shards drop precipitously.  If that number remained
static, we would have an idea that there is a problem.</p><h3><a id="timestamp"></a>Why the timestamp?<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/health.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>You typically are using the <code class="literal">health</code> command when a cluster is
malfunctioning.  During this period, it’s extremely important to
correlate activities across log files, alerting systems, etc.</p><p>There are two outputs.  The <code class="literal">HH:MM:SS</code> output is simply for quick
human consumption.  The epoch time retains more information, including
date, and is machine sortable if your recovery spans days.</p></div><div class="navfooter"><span class="prev"><a href="cat-fielddata.html">
              «&nbsp;
              cat fielddata</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-indices.html">cat indices
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cat.html">cat APIs</a></span> » <span class="breadcrumb-node">cat indices</span></div><div class="navheader"><span class="prev"><a href="cat-health.html">
              «&nbsp;
              cat health</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-master.html">cat master
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-indices"></a>cat indices<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/indices.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">indices</code> command provides a cross-section of each index.  This
information <span class="strong emphasis"><strong>spans nodes</strong></span>.</p><div class="pre_wrapper"><pre class="programlisting">% curl 'localhost:9200/_cat/indices/twi*?v'
health status index    pri rep docs.count docs.deleted store.size pri.store.size
green  open   twitter    5   1      11434            0       64mb           32mb
green  open   twitter2   2   0       2030            0      5.8mb          5.8mb</pre></div><p>We can tell quickly how many shards make up an index, the number of
docs, deleted docs, primary store size, and total store size (all
shards including replicas).</p><h3><a id="pri-flag"></a>Primaries<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/indices.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The index stats by default will show them for all of an index’s
shards, including replicas.  A <code class="literal">pri</code> flag can be supplied to enable
the view of relevant stats in the context of only the primaries.</p><h3><a id="examples"></a>Examples<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/indices.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Which indices are yellow?</p><div class="pre_wrapper"><pre class="programlisting">% curl localhost:9200/_cat/indices | grep ^yell
yellow open  wiki     2 1  6401 1115 151.4mb 151.4mb
yellow open  twitter  5 1 11434    0    32mb    32mb</pre></div><p>What’s my largest index by disk usage not including replicas?</p><div class="pre_wrapper"><pre class="programlisting">% curl 'localhost:9200/_cat/indices?bytes=b' | sort -rnk8
green open  wiki     2 0  6401 1115 158843725 158843725
green open  twitter  5 1 11434    0  67155614  33577857
green open  twitter2 2 0  2030    0   6125085   6125085</pre></div><p>How many merge operations have the shards for the <code class="literal">wiki</code> completed?</p><div class="pre_wrapper"><pre class="programlisting">% curl 'localhost:9200/_cat/indices/wiki?pri&amp;v&amp;h=health,index,prirep,docs.count,mt'
health index docs.count mt pri.mt
green  wiki        9646 16     16</pre></div><p>How much memory is used per index?</p><div class="pre_wrapper"><pre class="programlisting">% curl 'localhost:9200/_cat/indices?v&amp;h=i,tm'
i     tm
wiki  8.1gb
test  30.5kb
user  1.9mb</pre></div></div><div class="navfooter"><span class="prev"><a href="cat-health.html">
              «&nbsp;
              cat health</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-master.html">cat master
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cat.html">cat APIs</a></span> » <span class="breadcrumb-node">cat master</span></div><div class="navheader"><span class="prev"><a href="cat-indices.html">
              «&nbsp;
              cat indices</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-nodes.html">cat nodes
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-master"></a>cat master<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/master.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p><code class="literal">master</code> doesn’t have any extra options. It simply displays the
master’s node ID, bound IP address, and node name.</p><div class="pre_wrapper"><pre class="programlisting">% curl 'localhost:9200/_cat/master?v'
id                     ip            node
Ntgn2DcuTjGuXlhKDUD4vA 192.168.56.30 Solarr</pre></div><p>This information is also available via the <code class="literal">nodes</code> command, but this
is slightly shorter when all you want to do, for example, is verify
all nodes agree on the master:</p><div class="pre_wrapper"><pre class="programlisting">% pssh -i -h list.of.cluster.hosts curl -s localhost:9200/_cat/master
[1] 19:16:37 [SUCCESS] es3.vm
Ntgn2DcuTjGuXlhKDUD4vA 192.168.56.30 Solarr
[2] 19:16:37 [SUCCESS] es2.vm
Ntgn2DcuTjGuXlhKDUD4vA 192.168.56.30 Solarr
[3] 19:16:37 [SUCCESS] es1.vm
Ntgn2DcuTjGuXlhKDUD4vA 192.168.56.30 Solarr</pre></div></div><div class="navfooter"><span class="prev"><a href="cat-indices.html">
              «&nbsp;
              cat indices</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-nodes.html">cat nodes
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cat.html">cat APIs</a></span> » <span class="breadcrumb-node">cat nodes</span></div><div class="navheader"><span class="prev"><a href="cat-master.html">
              «&nbsp;
              cat master</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-pending-tasks.html">cat pending tasks
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-nodes"></a>cat nodes<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/nodes.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">nodes</code> command shows the cluster topology.</p><div class="pre_wrapper"><pre class="programlisting">% curl 192.168.56.10:9200/_cat/nodes
SP4H 4727 192.168.56.30 9300 1.7.6 1.8.0_25 72.1gb 35.4 93.9mb 79 239.1mb 0.45 3.4h d m Boneyard
_uhJ 5134 192.168.56.10 9300 1.7.6 1.8.0_25 72.1gb 33.3 93.9mb 85 239.1mb 0.06 3.4h d * Athena
HfDp 4562 192.168.56.20 9300 1.7.6 1.8.0_25 72.2gb 74.5 93.9mb 83 239.1mb 0.12 3.4h d m Zarek</pre></div><p>The first few columns tell you where your nodes live.  For sanity it
also tells you what version of ES and the JVM each one runs.</p><div class="pre_wrapper"><pre class="programlisting">nodeId pid  ip            port version jdk
u2PZ   4234 192.168.56.30 9300 1.7.6   1.8.0_25
URzf   5443 192.168.56.10 9300 1.7.6   1.8.0_25
ActN   3806 192.168.56.20 9300 1.7.6   1.8.0_25</pre></div><p>The next few give a picture of your heap, memory, and load.</p><div class="pre_wrapper"><pre class="programlisting">diskAvail heapPercent heapMax ramPercent  ramMax load
   72.1gb        31.3  93.9mb         81 239.1mb 0.24
   72.1gb        19.6  93.9mb         82 239.1mb 0.05
   72.2gb        64.9  93.9mb         84 239.1mb 0.12</pre></div><p>The last columns provide ancillary information that can often be
useful when looking at the cluster as a whole, particularly large
ones.  How many master-eligible nodes do I have?  How many client
nodes?  It looks like someone restarted a node recently; which one was
it?</p><div class="pre_wrapper"><pre class="programlisting">uptime data/client master name
  3.5h d           m      Boneyard
  3.5h d           *      Athena
  3.5h d           m      Zarek</pre></div><h3><a id="_columns"></a>Columns<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/nodes.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Below is an exhaustive list of the existing headers that can be
passed to <code class="literal">nodes?h=</code> to retrieve the relevant details in ordered
columns.  If no headers are specified, then those marked to Appear
by Default will appear. If any header is specified, then the defaults
are not used.</p><p>Aliases can be used in place of the full header name for brevity.
Columns appear in the order that they are listed below unless a
different order is specified (e.g., <code class="literal">h=pid,id</code> versus <code class="literal">h=id,pid</code>).</p><p>When specifying headers, the headers are not placed in the output
by default.  To have the headers appear in the output, use verbose
mode (<code class="literal">v</code>). The header name will match the supplied value (e.g.,
<code class="literal">pid</code> versus <code class="literal">p</code>).  For example:</p><div class="pre_wrapper"><pre class="programlisting">% curl 192.168.56.10:9200/_cat/nodes?v&amp;h=id,ip,port,v,m
id   ip            port version m
pLSN 192.168.56.30 9300 1.7.6   m
k0zy 192.168.56.10 9300 1.7.6   m
6Tyi 192.168.56.20 9300 1.7.6   *
% curl 192.168.56.10:9200/_cat/nodes?h=id,ip,port,v,m
pLSN 192.168.56.30 9300 1.7.6 m
k0zy 192.168.56.10 9300 1.7.6 m
6Tyi 192.168.56.20 9300 1.7.6 *</pre></div><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"><col class="col_4"><col class="col_5"></colgroup><thead><tr><th class="entry" align="left" valign="top">Header </th><th class="entry" align="left" valign="top">Alias </th><th class="entry" align="left" valign="top">Appear by Default </th><th class="entry" align="left" valign="top">Description </th><th class="entry" align="left" valign="top">Example</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">id</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">nodeId</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Unique node ID</p></td><td class="entry" align="left" valign="top"><p>k0zy</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">pid</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">p</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Process ID</p></td><td class="entry" align="left" valign="top"><p>13061</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">host</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">h</code></p></td><td class="entry" align="left" valign="top"><p>Yes</p></td><td class="entry" align="left" valign="top"><p>Host name</p></td><td class="entry" align="left" valign="top"><p>n1</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">ip</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">i</code></p></td><td class="entry" align="left" valign="top"><p>Yes</p></td><td class="entry" align="left" valign="top"><p>IP address</p></td><td class="entry" align="left" valign="top"><p>127.0.1.1</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">port</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">po</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Bound transport port</p></td><td class="entry" align="left" valign="top"><p>9300</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">version</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">v</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Elasticsearch version</p></td><td class="entry" align="left" valign="top"><p>1.7.6</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">build</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">b</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Elasticsearch Build hash</p></td><td class="entry" align="left" valign="top"><p>5c03844</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">jdk</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">j</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Running Java version</p></td><td class="entry" align="left" valign="top"><p>1.8.0</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">disk.avail</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">d</code>, <code class="literal">disk</code>, <code class="literal">diskAvail</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Available disk space</p></td><td class="entry" align="left" valign="top"><p>1.8gb</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">heap.current</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">hc</code>, <code class="literal">heapCurrent</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Used heap</p></td><td class="entry" align="left" valign="top"><p>311.2mb</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">heap.percent</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">hp</code>, <code class="literal">heapPercent</code></p></td><td class="entry" align="left" valign="top"><p>Yes</p></td><td class="entry" align="left" valign="top"><p>Used heap percentage</p></td><td class="entry" align="left" valign="top"><p>7</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">heap.max</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">hm</code>, <code class="literal">heapMax</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Maximum configured heap</p></td><td class="entry" align="left" valign="top"><p>1015.6mb</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">ram.current</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">rc</code>, <code class="literal">ramCurrent</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Used total memory</p></td><td class="entry" align="left" valign="top"><p>513.4mb</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">ram.percent</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">rp</code>, <code class="literal">ramPercent</code></p></td><td class="entry" align="left" valign="top"><p>Yes</p></td><td class="entry" align="left" valign="top"><p>Used total memory percentage</p></td><td class="entry" align="left" valign="top"><p>47</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">ram.max</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">rm</code>, <code class="literal">ramMax</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Total memory</p></td><td class="entry" align="left" valign="top"><p>2.9gb</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">file_desc.current</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">fdc</code>, <code class="literal">fileDescriptorCurrent</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Used file
descriptors</p></td><td class="entry" align="left" valign="top"><p>123</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">file_desc.percent</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">fdp</code>, <code class="literal">fileDescriptorPercent</code></p></td><td class="entry" align="left" valign="top"><p>Yes</p></td><td class="entry" align="left" valign="top"><p>Used file
descriptors percentage</p></td><td class="entry" align="left" valign="top"><p>1</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">file_desc.max</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">fdm</code>, <code class="literal">fileDescriptorMax</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Maximum number of file
descriptors</p></td><td class="entry" align="left" valign="top"><p>1024</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">load</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">l</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Most recent load average</p></td><td class="entry" align="left" valign="top"><p>0.22</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">uptime</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">u</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Node uptime</p></td><td class="entry" align="left" valign="top"><p>17.3m</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">node.role</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">r</code>, <code class="literal">role</code>, <code class="literal">dc</code>, <code class="literal">nodeRole</code></p></td><td class="entry" align="left" valign="top"><p>Yes</p></td><td class="entry" align="left" valign="top"><p>Data node (d); Client
node (c)</p></td><td class="entry" align="left" valign="top"><p>d</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">master</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">m</code></p></td><td class="entry" align="left" valign="top"><p>Yes</p></td><td class="entry" align="left" valign="top"><p>Current master (*); master eligible (m)</p></td><td class="entry" align="left" valign="top"><p>m</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">name</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">n</code></p></td><td class="entry" align="left" valign="top"><p>Yes</p></td><td class="entry" align="left" valign="top"><p>Node name</p></td><td class="entry" align="left" valign="top"><p>Venom</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">completion.size</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">cs</code>, <code class="literal">completionSize</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Size of completion</p></td><td class="entry" align="left" valign="top"><p>0b</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">fielddata.memory_size</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">fm</code>, <code class="literal">fielddataMemory</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Used fielddata
cache memory</p></td><td class="entry" align="left" valign="top"><p>0b</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">fielddata.evictions</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">fe</code>, <code class="literal">fielddataEvictions</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Fielddata cache
evictions</p></td><td class="entry" align="left" valign="top"><p>0</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">filter_cache.memory_size</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">fcm</code>, <code class="literal">filterCacheMemory</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Used filter
cache memory</p></td><td class="entry" align="left" valign="top"><p>0b</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">filter_cache.evictions</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">fce</code>, <code class="literal">filterCacheEvictions</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Filter
cache evictions</p></td><td class="entry" align="left" valign="top"><p>0</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">flush.total</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">ft</code>, <code class="literal">flushTotal</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number of flushes</p></td><td class="entry" align="left" valign="top"><p>1</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">flush.total_time</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">ftt</code>, <code class="literal">flushTotalTime</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Time spent in flush</p></td><td class="entry" align="left" valign="top"><p>1</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">get.current</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">gc</code>, <code class="literal">getCurrent</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number of current get
operations</p></td><td class="entry" align="left" valign="top"><p>0</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">get.time</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">gti</code>, <code class="literal">getTime</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Time spent in get</p></td><td class="entry" align="left" valign="top"><p>14ms</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">get.total</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">gto</code>, <code class="literal">getTotal</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number of get operations</p></td><td class="entry" align="left" valign="top"><p>2</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">get.exists_time</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">geti</code>, <code class="literal">getExistsTime</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Time spent in
successful gets</p></td><td class="entry" align="left" valign="top"><p>14ms</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">get.exists_total</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">geto</code>, <code class="literal">getExistsTotal</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number of successful
get operations</p></td><td class="entry" align="left" valign="top"><p>2</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">get.missing_time</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">gmti</code>, <code class="literal">getMissingTime</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Time spent in failed
gets</p></td><td class="entry" align="left" valign="top"><p>0s</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">get.missing_total</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">gmto</code>, <code class="literal">getMissingTotal</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number of failed
get operations</p></td><td class="entry" align="left" valign="top"><p>1</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">id_cache.memory_size</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">im</code>, <code class="literal">idCacheMemory</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Used ID cache
memory</p></td><td class="entry" align="left" valign="top"><p>216b</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">indexing.delete_current</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">idc</code>, <code class="literal">indexingDeleteCurrent</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number
of current deletion operations</p></td><td class="entry" align="left" valign="top"><p>0</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">indexing.delete_time</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">idti</code>, <code class="literal">indexingDeleteTime</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Time spent in
deletions</p></td><td class="entry" align="left" valign="top"><p>2ms</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">indexing.delete_total</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">idto</code>, <code class="literal">indexingDeleteTotal</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number of
deletion operations</p></td><td class="entry" align="left" valign="top"><p>2</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">indexing.index_current</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">iic</code>, <code class="literal">indexingIndexCurrent</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number
of current indexing operations</p></td><td class="entry" align="left" valign="top"><p>0</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">indexing.index_time</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">iiti</code>, <code class="literal">indexingIndexTime</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Time spent in
indexing</p></td><td class="entry" align="left" valign="top"><p>134ms</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">indexing.index_total</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">iito</code>, <code class="literal">indexingIndexTotal</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number of
indexing operations</p></td><td class="entry" align="left" valign="top"><p>1</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">merges.current</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">mc</code>, <code class="literal">mergesCurrent</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number of current
merge operations</p></td><td class="entry" align="left" valign="top"><p>0</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">merges.current_docs</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">mcd</code>, <code class="literal">mergesCurrentDocs</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number of
current merging documents</p></td><td class="entry" align="left" valign="top"><p>0</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">merges.current_size</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">mcs</code>, <code class="literal">mergesCurrentSize</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Size of current
merges</p></td><td class="entry" align="left" valign="top"><p>0b</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">merges.total</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">mt</code>, <code class="literal">mergesTotal</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number of completed merge
operations</p></td><td class="entry" align="left" valign="top"><p>0</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">merges.total_docs</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">mtd</code>, <code class="literal">mergesTotalDocs</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number of merged
documents</p></td><td class="entry" align="left" valign="top"><p>0</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">merges.total_size</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">mts</code>, <code class="literal">mergesTotalSize</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Size of current
merges</p></td><td class="entry" align="left" valign="top"><p>0b</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">merges.total_time</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">mtt</code>, <code class="literal">mergesTotalTime</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Time spent merging
documents</p></td><td class="entry" align="left" valign="top"><p>0s</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">percolate.current</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">pc</code>, <code class="literal">percolateCurrent</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number of current
percolations</p></td><td class="entry" align="left" valign="top"><p>0</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">percolate.memory_size</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">pm</code>, <code class="literal">percolateMemory</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Memory used by
current percolations</p></td><td class="entry" align="left" valign="top"><p>0b</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">percolate.queries</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">pq</code>, <code class="literal">percolateQueries</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number of
registered percolation queries</p></td><td class="entry" align="left" valign="top"><p>0</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">percolate.time</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">pti</code>, <code class="literal">percolateTime</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Time spent
percolating</p></td><td class="entry" align="left" valign="top"><p>0s</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">percolate.total</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">pto</code>, <code class="literal">percolateTotal</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Total percolations</p></td><td class="entry" align="left" valign="top"><p>0</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">refresh.total</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">rto</code>, <code class="literal">refreshTotal</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number of refreshes</p></td><td class="entry" align="left" valign="top"><p>16</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">refresh.time</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">rti</code>, <code class="literal">refreshTime</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Time spent in refreshes</p></td><td class="entry" align="left" valign="top"><p>91ms</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">search.fetch_current</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">sfc</code>, <code class="literal">searchFetchCurrent</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Current fetch
phase operations</p></td><td class="entry" align="left" valign="top"><p>0</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">search.fetch_time</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">sfti</code>, <code class="literal">searchFetchTime</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Time spent in fetch
phase</p></td><td class="entry" align="left" valign="top"><p>37ms</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">search.fetch_total</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">sfto</code>, <code class="literal">searchFetchTotal</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number of fetch
operations</p></td><td class="entry" align="left" valign="top"><p>7</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">search.open_contexts</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">so</code>, <code class="literal">searchOpenContexts</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Open search
contexts</p></td><td class="entry" align="left" valign="top"><p>0</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">search.query_current</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">sqc</code>, <code class="literal">searchFetchCurrent</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Current query
phase operations</p></td><td class="entry" align="left" valign="top"><p>0</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">search.query_time</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">sqti</code>, <code class="literal">searchFetchTime</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Time spent in query
phase</p></td><td class="entry" align="left" valign="top"><p>43ms</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">search.query_total</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">sqto</code>, <code class="literal">searchFetchTotal</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number of query
operations</p></td><td class="entry" align="left" valign="top"><p>9</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">segments.count</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">sc</code>, <code class="literal">segmentsCount</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Number of segments</p></td><td class="entry" align="left" valign="top"><p>4</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">segments.memory</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">sm</code>, <code class="literal">segmentsMemory</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Memory used by
segments</p></td><td class="entry" align="left" valign="top"><p>1.4kb</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">segments.index_writer_memory</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">siwm</code>, <code class="literal">segmentsIndexWriterMemory</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Memory used by index writer</p></td><td class="entry" align="left" valign="top"><p>18mb</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">segments.index_writer_max_memory</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">siwmx</code>, <code class="literal">segmentsIndexWriterMaxMemory</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Maximum memory index writer may use before it must write buffered documents to a new segment</p></td><td class="entry" align="left" valign="top"><p>32mb</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">segments.version_map_memory</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">svmm</code>, <code class="literal">segmentsVersionMapMemory</code></p></td><td class="entry" align="left" valign="top"><p>No</p></td><td class="entry" align="left" valign="top"><p>Memory used by version map</p></td><td class="entry" align="left" valign="top"><p>1.0kb</p></td></tr></tbody></table></div></div><div class="navfooter"><span class="prev"><a href="cat-master.html">
              «&nbsp;
              cat master</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-pending-tasks.html">cat pending tasks
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cat.html">cat APIs</a></span> » <span class="breadcrumb-node">cat pending tasks</span></div><div class="navheader"><span class="prev"><a href="cat-nodes.html">
              «&nbsp;
              cat nodes</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-plugins.html">cat plugins
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-pending-tasks"></a>cat pending tasks<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/pending_tasks.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p><code class="literal">pending_tasks</code> provides the same information as the
<a class="link" href="cluster-pending.html" title="Pending cluster tasks"><code class="literal">/_cluster/pending_tasks</code></a> API in a
convenient tabular format.</p><div class="pre_wrapper"><pre class="programlisting">% curl 'localhost:9200/_cat/pending_tasks?v'
insertOrder timeInQueue priority source
       1685       855ms HIGH     update-mapping [foo][t]
       1686       843ms HIGH     update-mapping [foo][t]
       1693       753ms HIGH     refresh-mapping [foo][[t]]
       1688       816ms HIGH     update-mapping [foo][t]
       1689       802ms HIGH     update-mapping [foo][t]
       1690       787ms HIGH     update-mapping [foo][t]
       1691       773ms HIGH     update-mapping [foo][t]</pre></div></div><div class="navfooter"><span class="prev"><a href="cat-nodes.html">
              «&nbsp;
              cat nodes</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-plugins.html">cat plugins
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cat.html">cat APIs</a></span> » <span class="breadcrumb-node">cat plugins</span></div><div class="navheader"><span class="prev"><a href="cat-pending-tasks.html">
              «&nbsp;
              cat pending tasks</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-recovery.html">cat recovery
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-plugins"></a>cat plugins<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/plugins.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">plugins</code> command provides a view per node of running plugins. This information <span class="strong emphasis"><strong>spans nodes</strong></span>.</p><div class="pre_wrapper"><pre class="programlisting">% curl 'localhost:9200/_cat/plugins?v'
name    component       version        type isolation url
Abraxas cloud-azure     2.1.0-SNAPSHOT j    x
Abraxas lang-groovy     2.0.0          j    x
Abraxas lang-javascript 2.0.0-SNAPSHOT j    x
Abraxas marvel          NA             j/s  x         /_plugin/marvel/
Abraxas lang-python     2.0.0-SNAPSHOT j    x
Abraxas inquisitor      NA             s              /_plugin/inquisitor/
Abraxas kopf            0.5.2          s              /_plugin/kopf/
Abraxas segmentspy      NA             s              /_plugin/segmentspy/</pre></div><p>We can tell quickly how many plugins per node we have and which versions.</p></div><div class="navfooter"><span class="prev"><a href="cat-pending-tasks.html">
              «&nbsp;
              cat pending tasks</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-recovery.html">cat recovery
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cat.html">cat APIs</a></span> » <span class="breadcrumb-node">cat recovery</span></div><div class="navheader"><span class="prev"><a href="cat-plugins.html">
              «&nbsp;
              cat plugins</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-thread-pool.html">cat thread pool
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-recovery"></a>cat recovery<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/recovery.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">recovery</code> command is a view of index shard recoveries, both on-going and previously
completed. It is a more compact view of the JSON <a class="link" href="indices-recovery.html" title="Indices Recovery">recovery</a> API.</p><p>A recovery event occurs anytime an index shard moves to a different node in the cluster.
This can happen during a snapshot recovery, a change in replication level, node failure, or
on node startup. This last type is called a local gateway recovery and is the normal
way for shards to be loaded from disk when a node starts up.</p><p>As an example, here is what the recovery state of a cluster may look like when there
are no shards in transit from one node to another:</p><div class="pre_wrapper"><pre class="programlisting">&gt; curl -XGET 'localhost:9200/_cat/recovery?v'
index shard time type    stage source target files percent bytes     percent
wiki  0     73   gateway done  hostA  hostA  36    100.0%  24982806 100.0%
wiki  1     245  gateway done  hostA  hostA  33    100.0%  24501912 100.0%
wiki  2     230  gateway done  hostA  hostA  36    100.0%  30267222 100.0%</pre></div><p>In the above case, the source and target nodes are the same because the recovery
type was gateway, i.e. they were read from local storage on node start.</p><p>Now let’s see what a live recovery looks like. By increasing the replica count
of our index and bringing another node online to host the replicas, we can see
what a live shard recovery looks like.</p><div class="pre_wrapper"><pre class="programlisting">&gt; curl -XPUT 'localhost:9200/wiki/_settings' -d'{"number_of_replicas":1}'
{"acknowledged":true}

&gt; curl -XGET 'localhost:9200/_cat/recovery?v'
index shard time type    stage source target files percent bytes    percent
wiki  0     1252 gateway done  hostA  hostA  4     100.0%  23638870 100.0%
wiki  0     1672 replica index hostA  hostB  4     75.0%   23638870 48.8%
wiki  1     1698 replica index hostA  hostB  4     75.0%   23348540 49.4%
wiki  1     4812 gateway done  hostA  hostA  33    100.0%  24501912 100.0%
wiki  2     1689 replica index hostA  hostB  4     75.0%   28681851 40.2%
wiki  2     5317 gateway done  hostA  hostA  36    100.0%  30267222 100.0%</pre></div><p>We can see in the above listing that our 3 initial shards are in various stages
of being replicated from one node to another. Notice that the recovery type is
shown as <code class="literal">replica</code>. The files and bytes copied are real-time measurements.</p><p>Finally, let’s see what a snapshot recovery looks like. Assuming I have previously
made a backup of my index, I can restore it using the <a class="link" href="modules-snapshots.html" title="Snapshot And Restore">snapshot and restore</a>
API.</p><div class="pre_wrapper"><pre class="programlisting">&gt; curl -XPOST 'localhost:9200/_snapshot/imdb/snapshot_2/_restore'
{"acknowledged":true}
&gt; curl -XGET 'localhost:9200/_cat/recovery?v'
index shard time type     stage repository snapshot files percent bytes percent
imdb  0     1978 snapshot done  imdb       snap_1   79    8.0%    12086 9.0%
imdb  1     2790 snapshot index imdb       snap_1   88    7.7%    11025 8.1%
imdb  2     2790 snapshot index imdb       snap_1   85    0.0%    12072 0.0%
imdb  3     2796 snapshot index imdb       snap_1   85    2.4%    12048 7.2%
imdb  4     819  snapshot init  imdb       snap_1   0     0.0%    0     0.0%</pre></div></div><div class="navfooter"><span class="prev"><a href="cat-plugins.html">
              «&nbsp;
              cat plugins</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-thread-pool.html">cat thread pool
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cat.html">cat APIs</a></span> » <span class="breadcrumb-node">cat thread pool</span></div><div class="navheader"><span class="prev"><a href="cat-recovery.html">
              «&nbsp;
              cat recovery</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-shards.html">cat shards
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-thread-pool"></a>cat thread pool<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/thread_pool.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">thread_pool</code> command shows cluster wide thread pool statistics per node. By default the active, queue and rejected
statistics are returned for the bulk, index and search thread pools.</p><div class="pre_wrapper"><pre class="programlisting">% curl 192.168.56.10:9200/_cat/thread_pool
host1 192.168.1.35 0 0 0 0 0 0 0 0 0
host2 192.168.1.36 0 0 0 0 0 0 0 0 0</pre></div><p>The first two columns contain the host and ip of a node.</p><div class="pre_wrapper"><pre class="programlisting">host      ip
host1 192.168.1.35
host2 192.168.1.36</pre></div><p>The next three columns show the active queue and rejected statistics for the bulk thread pool.</p><div class="pre_wrapper"><pre class="programlisting">bulk.active bulk.queue bulk.rejected
          0          0             0</pre></div><p>The remaining columns show the active queue and rejected statistics of the index and search thread pool respectively.</p><p>Also other statistics of different thread pools can be retrieved by using the <code class="literal">h</code> (header) parameter.</p><div class="pre_wrapper"><pre class="programlisting">% curl 'localhost:9200/_cat/thread_pool?v&amp;h=id,host,suggest.active,suggest.rejected,suggest.completed'
host      suggest.active suggest.rejected suggest.completed
host1                  0                0                 0
host2                  0                0                 0</pre></div><p>Here the host columns and the active, rejected and completed suggest thread pool statistic are displayed. The suggest
thread pool won’t be displayed by default, so you always need to be specific about what statistic you want to display.</p><h3><a id="_available_thread_pools"></a>Available Thread Pools<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/thread_pool.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Currently available <a class="link" href="modules-threadpool.html" title="Thread Pool">thread pools</a>:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th class="entry" align="left" valign="top">Thread Pool </th><th class="entry" align="left" valign="top">Alias </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">bulk</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">b</code></p></td><td class="entry" align="left" valign="top"><p>Thread pool used for <a class="link" href="docs-bulk.html" title="Bulk API">bulk</a> operations</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">flush</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">f</code></p></td><td class="entry" align="left" valign="top"><p>Thread pool used for <a class="link" href="indices-flush.html" title="Flush">flush</a> operations</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">generic</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">ge</code></p></td><td class="entry" align="left" valign="top"><p>Thread pool used for generic operations (e.g. background node discovery)</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">get</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">g</code></p></td><td class="entry" align="left" valign="top"><p>Thread pool used for <a class="link" href="docs-get.html" title="Get API">get</a> operations</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">index</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">i</code></p></td><td class="entry" align="left" valign="top"><p>Thread pool used for <a class="link" href="docs-index_.html" title="Index API">index</a>/<a class="link" href="docs-delete.html" title="Delete API">delete</a> operations</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">management</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">ma</code></p></td><td class="entry" align="left" valign="top"><p>Thread pool used for management of Elasticsearch (e.g. cluster management)</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">merge</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">m</code></p></td><td class="entry" align="left" valign="top"><p>Thread pool used for <a class="link" href="index-modules-merge.html" title="Merge">merge</a> operations</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">optimize</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">o</code></p></td><td class="entry" align="left" valign="top"><p>Thread pool used for <a class="link" href="indices-optimize.html" title="Optimize">optimize</a> operations</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">percolate</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">p</code></p></td><td class="entry" align="left" valign="top"><p>Thread pool used for <a class="link" href="search-percolate.html" title="Percolator">percolator</a> operations</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">refresh</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">r</code></p></td><td class="entry" align="left" valign="top"><p>Thread pool used for <a class="link" href="indices-refresh.html" title="Refresh">refresh</a> operations</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">search</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">s</code></p></td><td class="entry" align="left" valign="top"><p>Thread pool used for <a class="link" href="search-search.html" title="Search">search</a>/<a class="link" href="search-count.html" title="Count API">count</a> operations</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">snapshot</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">sn</code></p></td><td class="entry" align="left" valign="top"><p>Thread pool used for <a class="link" href="modules-snapshots.html" title="Snapshot And Restore">snapshot</a> operations</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">suggest</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">su</code></p></td><td class="entry" align="left" valign="top"><p>Thread pool used for <a class="link" href="search-suggesters.html" title="Suggesters">suggester</a> operations</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">warmer</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">w</code></p></td><td class="entry" align="left" valign="top"><p>Thread pool used for <a class="link" href="indices-warmers.html" title="Warmers">index warm-up</a> operations</p></td></tr></tbody></table></div><p>The thread pool name (or alias) must be combined with a thread pool field below
to retrieve the requested information.</p><h4><a id="_thread_pool_fields"></a>Thread Pool Fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/thread_pool.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>For each thread pool, you can load details about it by using the field names
in the table below, either using the full field name (e.g. <code class="literal">bulk.active</code>) or
its alias (e.g. <code class="literal">sa</code> is equivalent to <code class="literal">search.active</code>).</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th class="entry" align="left" valign="top">Field Name </th><th class="entry" align="left" valign="top">Alias </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">type</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">t</code></p></td><td class="entry" align="left" valign="top"><p>The current (*) type of thread pool (<code class="literal">cached</code>, <code class="literal">fixed</code> or <code class="literal">scaling</code>)</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">active</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">a</code></p></td><td class="entry" align="left" valign="top"><p>The number of active threads in the current thread pool</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">size</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">s</code></p></td><td class="entry" align="left" valign="top"><p>The number of threads in the current thread pool</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">queue</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">q</code></p></td><td class="entry" align="left" valign="top"><p>The number of tasks in the queue for the current thread pool</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">queueSize</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">qs</code></p></td><td class="entry" align="left" valign="top"><p>The maximum number of tasks in the queue for the current thread pool</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">rejected</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">r</code></p></td><td class="entry" align="left" valign="top"><p>The number of rejected threads in the current thread pool</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">largest</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">l</code></p></td><td class="entry" align="left" valign="top"><p>The highest number of active threads in the current thread pool</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">completed</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">c</code></p></td><td class="entry" align="left" valign="top"><p>The number of completed threads in the current thread pool</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">min</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">mi</code></p></td><td class="entry" align="left" valign="top"><p>The configured minimum number of active threads allowed in the current thread pool</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">max</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">ma</code></p></td><td class="entry" align="left" valign="top"><p>The configured maximum number of active threads allowed in the current thread pool</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">keepAlive</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">k</code></p></td><td class="entry" align="left" valign="top"><p>The configured keep alive time for threads</p></td></tr></tbody></table></div><h3><a id="_other_fields"></a>Other Fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/thread_pool.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>In addition to details about each thread pool, it is also convenient to get an
understanding of where those thread pools reside.  As such, you can request
other details like the <code class="literal">ip</code> of the responding node(s).</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th class="entry" align="left" valign="top">Field Name </th><th class="entry" align="left" valign="top">Alias </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">id</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">nodeId</code></p></td><td class="entry" align="left" valign="top"><p>The unique node ID</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">pid</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">p</code></p></td><td class="entry" align="left" valign="top"><p>The process ID of the running node</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">host</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">h</code></p></td><td class="entry" align="left" valign="top"><p>The hostname for the current node</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">ip</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">i</code></p></td><td class="entry" align="left" valign="top"><p>The IP address for the current node</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">port</code></p></td><td class="entry" align="left" valign="top"><p><code class="literal">po</code></p></td><td class="entry" align="left" valign="top"><p>The bound transport port for the current node</p></td></tr></tbody></table></div></div><div class="navfooter"><span class="prev"><a href="cat-recovery.html">
              «&nbsp;
              cat recovery</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-shards.html">cat shards
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cat.html">cat APIs</a></span> » <span class="breadcrumb-node">cat shards</span></div><div class="navheader"><span class="prev"><a href="cat-thread-pool.html">
              «&nbsp;
              cat thread pool</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="index-pattern.html">Index pattern
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-shards"></a>cat shards<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/shards.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">shards</code> command is the detailed view of what nodes contain which
shards.  It will tell you if it’s a primary or replica, the number of
docs, the bytes it takes on disk, and the node where it’s located.</p><p>Here we see a single index, with three primary shards and no replicas:</p><div class="pre_wrapper"><pre class="programlisting">% curl 192.168.56.20:9200/_cat/shards
wiki1 0 p STARTED 3014 31.1mb 192.168.56.10 Stiletto
wiki1 1 p STARTED 3013 29.6mb 192.168.56.30 Frankie Raye
wiki1 2 p STARTED 3973 38.1mb 192.168.56.20 Commander Kraken</pre></div></div><div class="navfooter"><span class="prev"><a href="cat-thread-pool.html">
              «&nbsp;
              cat thread pool</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="index-pattern.html">Index pattern
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cat.html">cat APIs</a></span> » <span class="breadcrumb-link"><a href="cat-shards.html">cat shards</a></span> » <span class="breadcrumb-node">Index pattern</span></div><div class="navheader"><span class="prev"><a href="cat-shards.html">
              «&nbsp;
              cat shards</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="relocation.html">Relocation
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="index-pattern"></a>Index pattern<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/shards.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>If you have many shards, you may wish to limit which indices show up
in the output.  You can always do this with <code class="literal">grep</code>, but you can save
some bandwidth by supplying an index pattern to the end.</p><div class="pre_wrapper"><pre class="programlisting">% curl 192.168.56.20:9200/_cat/shards/wiki2
wiki2 0 p STARTED 197 3.2mb 192.168.56.10 Stiletto
wiki2 1 p STARTED 205 5.9mb 192.168.56.30 Frankie Raye
wiki2 2 p STARTED 275 7.8mb 192.168.56.20 Commander Kraken</pre></div></div><div class="navfooter"><span class="prev"><a href="cat-shards.html">
              «&nbsp;
              cat shards</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="relocation.html">Relocation
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cat.html">cat APIs</a></span> » <span class="breadcrumb-link"><a href="cat-shards.html">cat shards</a></span> » <span class="breadcrumb-node">Relocation</span></div><div class="navheader"><span class="prev"><a href="index-pattern.html">
              «&nbsp;
              Index pattern</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="states.html">Shard states
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="relocation"></a>Relocation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/shards.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Let’s say you’ve checked your health and you see two relocating
shards.  Where are they from and where are they going?</p><div class="pre_wrapper"><pre class="programlisting">% curl 192.168.56.10:9200/_cat/health
1384315316 20:01:56 foo green 3 3 12 6 2 0 0
% curl 192.168.56.10:9200/_cat/shards | fgrep RELO
wiki1 0 r RELOCATING 3014 31.1mb 192.168.56.20 Commander Kraken -&gt; 192.168.56.30 Frankie Raye
wiki1 1 r RELOCATING 3013 29.6mb 192.168.56.10 Stiletto -&gt; 192.168.56.30 Frankie Raye</pre></div></div><div class="navfooter"><span class="prev"><a href="index-pattern.html">
              «&nbsp;
              Index pattern</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="states.html">Shard states
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cat.html">cat APIs</a></span> » <span class="breadcrumb-link"><a href="cat-shards.html">cat shards</a></span> » <span class="breadcrumb-node">Shard states</span></div><div class="navheader"><span class="prev"><a href="relocation.html">
              «&nbsp;
              Relocation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-segments.html">cat segments
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="states"></a>Shard states<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/shards.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Before a shard can be used, it goes through an <code class="literal">INITIALIZING</code> state.
<code class="literal">shards</code> can show you which ones.</p><div class="pre_wrapper"><pre class="programlisting">% curl -XPUT 192.168.56.20:9200/_settings -d'{"number_of_replicas":1}'
{"acknowledged":true}
% curl 192.168.56.20:9200/_cat/shards
wiki1 0 p STARTED      3014 31.1mb 192.168.56.10 Stiletto
wiki1 0 r INITIALIZING    0 14.3mb 192.168.56.30 Frankie Raye
wiki1 1 p STARTED      3013 29.6mb 192.168.56.30 Frankie Raye
wiki1 1 r INITIALIZING    0 13.1mb 192.168.56.20 Commander Kraken
wiki1 2 r INITIALIZING    0   14mb 192.168.56.10 Stiletto
wiki1 2 p STARTED      3973 38.1mb 192.168.56.20 Commander Kraken</pre></div><p>If a shard cannot be assigned, for example you’ve overallocated the
number of replicas for the number of nodes in the cluster, they will
remain <code class="literal">UNASSIGNED</code>.</p><div class="pre_wrapper"><pre class="programlisting">% curl -XPUT 192.168.56.20:9200/_settings -d'{"number_of_replicas":3}'
% curl 192.168.56.20:9200/_cat/health
1384316325 20:18:45 foo yellow 3 3 9 3 0 0 3
% curl 192.168.56.20:9200/_cat/shards
wiki1 0 p STARTED    3014 31.1mb 192.168.56.10 Stiletto
wiki1 0 r STARTED    3014 31.1mb 192.168.56.30 Frankie Raye
wiki1 0 r STARTED    3014 31.1mb 192.168.56.20 Commander Kraken
wiki1 0 r UNASSIGNED
wiki1 1 r STARTED    3013 29.6mb 192.168.56.10 Stiletto
wiki1 1 p STARTED    3013 29.6mb 192.168.56.30 Frankie Raye
wiki1 1 r STARTED    3013 29.6mb 192.168.56.20 Commander Kraken
wiki1 1 r UNASSIGNED
wiki1 2 r STARTED    3973 38.1mb 192.168.56.10 Stiletto
wiki1 2 r STARTED    3973 38.1mb 192.168.56.30 Frankie Raye
wiki1 2 p STARTED    3973 38.1mb 192.168.56.20 Commander Kraken
wiki1 2 r UNASSIGNED</pre></div></div><div class="navfooter"><span class="prev"><a href="relocation.html">
              «&nbsp;
              Relocation</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cat-segments.html">cat segments
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cat.html">cat APIs</a></span> » <span class="breadcrumb-node">cat segments</span></div><div class="navheader"><span class="prev"><a href="states.html">
              «&nbsp;
              Shard states</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster.html">Cluster APIs
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cat-segments"></a>cat segments<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cat/segments.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">segments</code> command provides low level information about the segments
in the shards of an index. It provides information similar to the
<a class="ulink" href="indices-segments.html" target="_top">_segments</a> endpoint.</p><div class="pre_wrapper"><pre class="programlisting">% curl 'http://localhost:9200/_cat/segments?v'
index shard prirep ip            segment generation docs.count [...]
test  4     p      192.168.2.105 _0               0          1
test1 2     p      192.168.2.105 _0               0          1
test1 3     p      192.168.2.105 _2               2          1</pre></div><div class="pre_wrapper"><pre class="programlisting">[...] docs.deleted  size size.memory committed searchable version compound
                 0 2.9kb        7818 false     true       4.10.2  true
                 0 2.9kb        7818 false     true       4.10.2  true
                 0 2.9kb        7818 false     true       4.10.2  true</pre></div><p>The output shows information about index names and shard numbers in the first
two columns.</p><p>If you only want to get information about segments in one particular index,
you can add the index name in the URL, for example <code class="literal">/_cat/segments/test</code>. Also,
several indexes can be queried like <code class="literal">/_cat/segments/test,test1</code></p><p>The following columns provide additional monitoring information:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
prirep
</span></dt><dd>
Whether this segment belongs to a primary or replica shard.
</dd><dt><span class="term">
ip
</span></dt><dd>
The ip address of the segments shard.
</dd><dt><span class="term">
segment
</span></dt><dd>
A segment name, derived from the segment generation. The name
                is internally used to generate the file names in the directory
                of the shard this segment belongs to.
</dd><dt><span class="term">
generation
</span></dt><dd>
The generation number is incremented with each segment that is written.
                The name of the segment is derived from this generation number.
</dd><dt><span class="term">
docs.count
</span></dt><dd>
The number of non-deleted documents that are stored in this segment.
</dd><dt><span class="term">
docs.deleted
</span></dt><dd>
The number of deleted documents that are stored in this segment.
                It is perfectly fine if this number is greater than 0, space is
                going to be reclaimed when this segment gets merged.
</dd><dt><span class="term">
size
</span></dt><dd>
The amount of disk space that this segment uses.
</dd><dt><span class="term">
size.memory
</span></dt><dd>
Segments store some data into memory in order to be searchable efficiently.
                This column shows the number of bytes in memory that are used.
</dd><dt><span class="term">
committed
</span></dt><dd>
Whether the segment has been sync’ed on disk. Segments that are
                committed would survive a hard reboot. No need to worry in case
                of false, the data from uncommitted segments is also stored in
                the transaction log so that Elasticsearch is able to replay
                changes on the next start.
</dd><dt><span class="term">
searchable
</span></dt><dd>
True if the segment is searchable. A value of false would most
                likely mean that the segment has been written to disk but no
                refresh occurred since then to make it searchable.
</dd><dt><span class="term">
version
</span></dt><dd>
The version of Lucene that has been used to write this segment.
</dd><dt><span class="term">
compound
</span></dt><dd>
Whether the segment is stored in a compound file. When true, this
                means that Lucene merged all files from the segment in a single
                one in order to save file descriptors.
</dd></dl></div></div><div class="navfooter"><span class="prev"><a href="states.html">
              «&nbsp;
              Shard states</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster.html">Cluster APIs
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-node">Cluster APIs</span></div><div class="navheader"><span class="prev"><a href="cat-segments.html">
              «&nbsp;
              cat segments</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-health.html">Cluster Health
              &nbsp;»
            </a></span></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="cluster"></a>Cluster APIs<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><div class="partintro"><div></div><h2><a id="cluster-nodes"></a>Node specification<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2><p>Most cluster level APIs allow to specify which nodes to execute on (for
example, getting the node stats for a node). Nodes can be identified in
the APIs either using their internal node id, the node name, address,
custom attributes, or just the <code class="literal">_local</code> node receiving the request. For
example, here are some sample executions of nodes info:</p><div class="pre_wrapper"><pre class="programlisting"># Local
curl localhost:9200/_nodes/_local
# Address
curl localhost:9200/_nodes/10.0.0.3,10.0.0.4
curl localhost:9200/_nodes/10.0.0.*
# Names
curl localhost:9200/_nodes/node_name_goes_here
curl localhost:9200/_nodes/node_name_goes_*
# Attributes (set something like node.rack: 2 in the config)
curl localhost:9200/_nodes/rack:2
curl localhost:9200/_nodes/ra*:2
curl localhost:9200/_nodes/ra*:2*</pre></div></div></div><div class="navfooter"><span class="prev"><a href="cat-segments.html">
              «&nbsp;
              cat segments</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-health.html">Cluster Health
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cluster.html">Cluster APIs</a></span> » <span class="breadcrumb-node">Cluster Health</span></div><div class="navheader"><span class="prev"><a href="cluster.html">
              «&nbsp;
              Cluster APIs</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-state.html">Cluster State
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-health"></a>Cluster Health<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/health.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The cluster health API allows to get a very simple status on the health
of the cluster.</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/_cluster/health?pretty=true'
{
  "cluster_name" : "testcluster",
  "status" : "green",
  "timed_out" : false,
  "number_of_nodes" : 2,
  "number_of_data_nodes" : 2,
  "active_primary_shards" : 5,
  "active_shards" : 10,
  "relocating_shards" : 0,
  "initializing_shards" : 0,
  "unassigned_shards" : 0,
  "number_of_pending_tasks" : 0
}</pre></div><p>The API can also be executed against one or more indices to get just the
specified indices health:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/_cluster/health/test1,test2'</pre></div><p>The cluster health status is: <code class="literal">green</code>, <code class="literal">yellow</code> or <code class="literal">red</code>. On the shard
level, a <code class="literal">red</code> status indicates that the specific shard is not allocated
in the cluster, <code class="literal">yellow</code> means that the primary shard is allocated but
replicas are not, and <code class="literal">green</code> means that all shards are allocated. The
index level status is controlled by the worst shard status. The cluster
status is controlled by the worst index status.</p><p>One of the main benefits of the API is the ability to wait until the
cluster reaches a certain high water-mark health level. For example, the
following will wait for 50 seconds for the cluster to reach the <code class="literal">yellow</code>
level (if it reaches the <code class="literal">green</code> or <code class="literal">yellow</code> status before 50 seconds elapse,
it will return at that point):</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/_cluster/health?wait_for_status=yellow&amp;timeout=50s'</pre></div><h3><a id="request-params"></a>Request Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/health.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The cluster health API accepts the following request parameters:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">level</code>
</span></dt><dd>
    Can be one of <code class="literal">cluster</code>, <code class="literal">indices</code> or <code class="literal">shards</code>. Controls the
    details level of the health information returned. Defaults to <code class="literal">cluster</code>.
</dd><dt><span class="term">
<code class="literal">wait_for_status</code>
</span></dt><dd>
    One of <code class="literal">green</code>, <code class="literal">yellow</code> or <code class="literal">red</code>. Will wait (until
    the timeout provided) until the status of the cluster changes to the one
    provided or better, i.e. <code class="literal">green</code> &gt; <code class="literal">yellow</code> &gt; <code class="literal">red</code>. By default, will not
    wait for any status.
</dd><dt><span class="term">
<code class="literal">wait_for_relocating_shards</code>
</span></dt><dd>
    A number controlling to how many relocating
    shards to wait for. Usually will be <code class="literal">0</code> to indicate to wait till all
    relocations have happened. Defaults to not wait.
</dd><dt><span class="term">
<code class="literal">wait_for_active_shards</code>
</span></dt><dd>
    A number controlling to how many active
    shards to wait for. Defaults to not wait.
</dd><dt><span class="term">
<code class="literal">wait_for_nodes</code>
</span></dt><dd>
    The request waits until the specified number <code class="literal">N</code> of
    nodes is available. It also accepts <code class="literal">&gt;=N</code>, <code class="literal">&lt;=N</code>, <code class="literal">&gt;N</code> and <code class="literal">&lt;N</code>.
    Alternatively, it is possible to use <code class="literal">ge(N)</code>, <code class="literal">le(N)</code>, <code class="literal">gt(N)</code> and
    <code class="literal">lt(N)</code> notation.
</dd><dt><span class="term">
<code class="literal">timeout</code>
</span></dt><dd>
    A time based parameter controlling how long to wait if one of
    the wait_for_XXX are provided. Defaults to <code class="literal">30s</code>.
</dd></dl></div><p>The following is an example of getting the cluster health at the
<code class="literal">shards</code> level:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/_cluster/health/twitter?level=shards'</pre></div></div><div class="navfooter"><span class="prev"><a href="cluster.html">
              «&nbsp;
              Cluster APIs</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-state.html">Cluster State
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cluster.html">Cluster APIs</a></span> » <span class="breadcrumb-node">Cluster State</span></div><div class="navheader"><span class="prev"><a href="cluster-health.html">
              «&nbsp;
              Cluster Health</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-stats.html">Cluster Stats
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-state"></a>Cluster State<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/state.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The cluster state API allows to get a comprehensive state information of
the whole cluster.</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/_cluster/state'</pre></div><p>By default, the cluster state request is routed to the master node, to
ensure that the latest cluster state is returned.
For debugging purposes, you can retrieve the cluster state local to a
particular node by adding <code class="literal">local=true</code> to the  query string.</p><h3><a id="_response_filters"></a>Response Filters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/state.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>As the cluster state can grow (depending on the number of shards and indices, your mapping, templates),
it is possible to filter the cluster state response specifying the parts in the URL.</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/_cluster/state/{metrics}/{indices}'</pre></div><p><code class="literal">metrics</code> can be a comma-separated list of</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">version</code>
</span></dt><dd>
    Shows the cluster state version.
</dd><dt><span class="term">
<code class="literal">master_node</code>
</span></dt><dd>
    Shows the elected <code class="literal">master_node</code> part of the response
</dd><dt><span class="term">
<code class="literal">nodes</code>
</span></dt><dd>
    Shows the <code class="literal">nodes</code> part of the response
</dd><dt><span class="term">
<code class="literal">routing_table</code>
</span></dt><dd>
    Shows the <code class="literal">routing_table</code> part of the response. If you supply a comma separated list of indices, the returned output will only contain the indices listed.
</dd><dt><span class="term">
<code class="literal">metadata</code>
</span></dt><dd>
    Shows the <code class="literal">metadata</code> part of the response. If you supply a comma separated list of indices, the returned output will only contain the indices listed.
</dd><dt><span class="term">
<code class="literal">blocks</code>
</span></dt><dd>
    Shows the <code class="literal">blocks</code> part of the response
</dd></dl></div><p>A couple of example calls:</p><div class="pre_wrapper"><pre class="programlisting"># return only metadata and routing_table data for specified indices
$ curl -XGET 'http://localhost:9200/_cluster/state/metadata,routing_table/foo,bar'

# return everything for these two indices
$ curl -XGET 'http://localhost:9200/_cluster/state/_all/foo,bar'

# Return only blocks data
$ curl -XGET 'http://localhost:9200/_cluster/state/blocks'</pre></div></div><div class="navfooter"><span class="prev"><a href="cluster-health.html">
              «&nbsp;
              Cluster Health</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-stats.html">Cluster Stats
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cluster.html">Cluster APIs</a></span> » <span class="breadcrumb-node">Cluster Stats</span></div><div class="navheader"><span class="prev"><a href="cluster-state.html">
              «&nbsp;
              Cluster State</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-pending.html">Pending cluster tasks
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-stats"></a>Cluster Stats<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/stats.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The Cluster Stats API allows to retrieve statistics from a cluster wide perspective.
The API returns basic index metrics (shard numbers, store size, memory usage) and
information about the current nodes that form the cluster (number, roles, os, jvm
versions, memory usage, cpu and installed plugins).</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/_cluster/stats?human&amp;pretty'</pre></div><p>Will return, for example:</p><div class="pre_wrapper"><pre class="programlisting">{
   "timestamp": 1439326129256,
   "cluster_name": "elasticsearch",
   "status": "green",
   "indices": {
      "count": 3,
      "shards": {
         "total": 35,
         "primaries": 15,
         "replication": 1.333333333333333,
         "index": {
            "shards": {
               "min": 10,
               "max": 15,
               "avg": 11.66666666666666
            },
            "primaries": {
               "min": 5,
               "max": 5,
               "avg": 5
            },
            "replication": {
               "min": 1,
               "max": 2,
               "avg": 1.3333333333333333
            }
         }
      },
      "docs": {
         "count": 2,
         "deleted": 0
      },
      "store": {
         "size": "5.6kb",
         "size_in_bytes": 5770,
         "throttle_time": "0s",
         "throttle_time_in_millis": 0
      },
      "fielddata": {
         "memory_size": "0b",
         "memory_size_in_bytes": 0,
         "evictions": 0
      },
      "filter_cache": {
         "memory_size": "0b",
         "memory_size_in_bytes": 0,
         "evictions": 0
      },
      "id_cache": {
         "memory_size": "0b",
         "memory_size_in_bytes": 0
      },
      "completion": {
         "size": "0b",
         "size_in_bytes": 0
      },
      "segments": {
         "count": 2,
         "memory": "6.4kb",
         "memory_in_bytes": 6596,
         "index_writer_memory": "0b",
         "index_writer_memory_in_bytes": 0,
         "index_writer_max_memory": "275.7mb",
         "index_writer_max_memory_in_bytes": 289194639,
         "version_map_memory": "0b",
         "version_map_memory_in_bytes": 0,
         "fixed_bit_set": "0b",
         "fixed_bit_set_memory_in_bytes": 0
      },
      "percolate": {
         "total": 0,
         "get_time": "0s",
         "time_in_millis": 0,
         "current": 0,
         "memory_size_in_bytes": -1,
         "memory_size": "-1b",
         "queries": 0
      }
   },
   "nodes": {
      "count": {
         "total": 2,
         "master_only": 0,
         "data_only": 0,
         "master_data": 2,
         "client": 0
      },
      "versions": [
         "1.7.6"
      ],
      "os": {
         "available_processors": 4,
         "mem": {
            "total": "8gb",
            "total_in_bytes": 8589934592
         },
         "cpu": [
            {
               "vendor": "Intel",
               "model": "MacBookAir5,2",
               "mhz": 2000,
               "total_cores": 4,
               "total_sockets": 4,
               "cores_per_socket": 16,
               "cache_size": "256b",
               "cache_size_in_bytes": 256,
               "count": 1
            }
         ]
      },
      "process": {
         "cpu": {
            "percent": 3
         },
         "open_file_descriptors": {
            "min": 200,
            "max": 346,
            "avg": 273
         }
      },
      "jvm": {
         "max_uptime": "24s",
         "max_uptime_in_millis": 24054,
         "versions": [
            {
               "version": "1.6.0_45",
               "vm_name": "Java HotSpot(TM) 64-Bit Server VM",
               "vm_version": "20.45-b01-451",
               "vm_vendor": "Apple Inc.",
               "count": 2
            }
         ],
         "mem": {
            "heap_used": "38.3mb",
            "heap_used_in_bytes": 40237120,
            "heap_max": "1.9gb",
            "heap_max_in_bytes": 2130051072
         },
         "threads": 89
      },
      "fs":
         {
            "total": "232.9gb",
            "total_in_bytes": 250140434432,
            "free": "31.3gb",
            "free_in_bytes": 33705881600,
            "available": "31.1gb",
            "available_in_bytes": 33443737600,
            "disk_reads": 21202753,
            "disk_writes": 27028840,
            "disk_io_op": 48231593,
            "disk_read_size": "528gb",
            "disk_read_size_in_bytes": 566980806656,
            "disk_write_size": "617.9gb",
            "disk_write_size_in_bytes": 663525366784,
            "disk_io_size": "1145.9gb",
            "disk_io_size_in_bytes": 1230506173440
       },
      "plugins": [
         // all plugins installed on nodes
         {
            "name": "inquisitor",
            "description": "",
            "url": "/_plugin/inquisitor/",
            "jvm": false,
            "site": true
         }
      ]
   }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="cluster-state.html">
              «&nbsp;
              Cluster State</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-pending.html">Pending cluster tasks
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cluster.html">Cluster APIs</a></span> » <span class="breadcrumb-node">Pending cluster tasks</span></div><div class="navheader"><span class="prev"><a href="cluster-stats.html">
              «&nbsp;
              Cluster Stats</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-reroute.html">Cluster Reroute
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-pending"></a>Pending cluster tasks<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/pending.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The pending cluster tasks API returns a list of any cluster-level changes
(e.g. create index, update mapping, allocate or fail shard) which have not yet
been executed.</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XGET 'http://localhost:9200/_cluster/pending_tasks'</pre></div><p>Usually this will return an empty list as cluster-level changes are usually
fast. However if there are tasks queued up, the output will look something
like this:</p><div class="pre_wrapper"><pre class="programlisting">{
   "tasks": [
      {
         "insert_order": 101,
         "priority": "URGENT",
         "source": "create-index [foo_9], cause [api]",
         "time_in_queue_millis": 86,
         "time_in_queue": "86ms"
      },
      {
         "insert_order": 46,
         "priority": "HIGH",
         "source": "shard-started ([foo_2][1], node[tMTocMvQQgGCkj7QDHl3OA], [P], s[INITIALIZING]), reason [after recovery from gateway]",
         "time_in_queue_millis": 842,
         "time_in_queue": "842ms"
      },
      {
         "insert_order": 45,
         "priority": "HIGH",
         "source": "shard-started ([foo_2][0], node[tMTocMvQQgGCkj7QDHl3OA], [P], s[INITIALIZING]), reason [after recovery from gateway]",
         "time_in_queue_millis": 858,
         "time_in_queue": "858ms"
      }
  ]
}</pre></div></div><div class="navfooter"><span class="prev"><a href="cluster-stats.html">
              «&nbsp;
              Cluster Stats</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-reroute.html">Cluster Reroute
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cluster.html">Cluster APIs</a></span> » <span class="breadcrumb-node">Cluster Reroute</span></div><div class="navheader"><span class="prev"><a href="cluster-pending.html">
              «&nbsp;
              Pending cluster tasks</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-update-settings.html">Cluster Update Settings
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-reroute"></a>Cluster Reroute<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/reroute.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The reroute command allows to explicitly execute a cluster reroute
allocation command including specific commands. For example, a shard can
be moved from one node to another explicitly, an allocation can be
canceled, or an unassigned shard can be explicitly allocated on a
specific node.</p><p>Here is a short example of how a simple reroute API call:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/_cluster/reroute' -d '{
    "commands" : [ {
        "move" :
            {
              "index" : "test", "shard" : 0,
              "from_node" : "node1", "to_node" : "node2"
            }
        },
        {
          "allocate" : {
              "index" : "test", "shard" : 1, "node" : "node3"
          }
        }
    ]
}'</pre></div><p>An important aspect to remember is the fact that once when an allocation
occurs, the cluster will aim at re-balancing its state back to an even
state. For example, if the allocation includes moving a shard from
<code class="literal">node1</code> to <code class="literal">node2</code>, in an <code class="literal">even</code> state, then another shard will be moved
from <code class="literal">node2</code> to <code class="literal">node1</code> to even things out.</p><p>The cluster can be set to disable allocations, which means that only the
explicitly allocations will be performed. Obviously, only once all
commands has been applied, the cluster will aim to be re-balance its
state.</p><p>Another option is to run the commands in <code class="literal">dry_run</code> (as a URI flag, or in
the request body). This will cause the commands to apply to the current
cluster state, and return the resulting cluster after the commands (and
re-balancing) has been applied.</p><p>If the <code class="literal">explain</code> parameter is specified, a detailed explanation of why the
commands could or could not be executed is returned.</p><p>The commands supported are:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">move</code>
</span></dt><dd>
    Move a started shard from one node to another node. Accepts
    <code class="literal">index</code> and <code class="literal">shard</code> for index name and shard number, <code class="literal">from_node</code> for the
    node to move the shard <code class="literal">from</code>, and <code class="literal">to_node</code> for the node to move the
    shard to.
</dd><dt><span class="term">
<code class="literal">cancel</code>
</span></dt><dd>
    Cancel allocation of a shard (or recovery). Accepts <code class="literal">index</code>
    and <code class="literal">shard</code> for index name and shard number, and <code class="literal">node</code> for the node to
    cancel the shard allocation on. It also accepts <code class="literal">allow_primary</code> flag to
    explicitly specify that it is allowed to cancel allocation for a primary
    shard.
</dd><dt><span class="term">
<code class="literal">allocate</code>
</span></dt><dd>
    Allocate an unassigned shard to a node. Accepts the
    <code class="literal">index</code> and <code class="literal">shard</code> for index name and shard number, and <code class="literal">node</code> to
    allocate the shard to. It also accepts <code class="literal">allow_primary</code> flag to
    explicitly specify that it is allowed to explicitly allocate a primary
    shard (might result in data loss).
</dd></dl></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>The <code class="literal">allow_primary</code> parameter will force a new <span class="emphasis"><em>empty</em></span> primary shard
to be allocated <span class="strong emphasis"><strong>without any data</strong></span>. If a node which has a copy of the original
primary shard (including data) rejoins the cluster later on, that data will be
deleted: the old shard copy will be replaced by the new live shard copy.</p></div></div></div><div class="navfooter"><span class="prev"><a href="cluster-pending.html">
              «&nbsp;
              Pending cluster tasks</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-update-settings.html">Cluster Update Settings
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cluster.html">Cluster APIs</a></span> » <span class="breadcrumb-node">Cluster Update Settings</span></div><div class="navheader"><span class="prev"><a href="cluster-reroute.html">
              «&nbsp;
              Cluster Reroute</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-nodes-stats.html">Nodes Stats
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-update-settings"></a>Cluster Update Settings<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Allows to update cluster wide specific settings. Settings updated can
either be persistent (applied cross restarts) or transient (will not
survive a full cluster restart). Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/_cluster/settings -d '{
    "persistent" : {
        "discovery.zen.minimum_master_nodes" : 2
    }
}'</pre></div><p>Or:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/_cluster/settings -d '{
    "transient" : {
        "discovery.zen.minimum_master_nodes" : 2
    }
}'</pre></div><p>The cluster responds with the settings updated. So the response for the
last example will be:</p><div class="pre_wrapper"><pre class="programlisting">{
    "persistent" : {},
    "transient" : {
        "discovery.zen.minimum_master_nodes" : "2"
    }
}'</pre></div><p>Cluster wide settings can be returned using:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET localhost:9200/_cluster/settings</pre></div><p>There is a specific list of settings that can be updated, those include:</p><h3><a id="cluster-settings"></a>Cluster settings<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><h4><a id="_routing_allocation"></a>Routing allocation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><h5><a id="_awareness"></a>Awareness<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">cluster.routing.allocation.awareness.attributes</code>
</span></dt><dd>
     See <a class="xref" href="modules-cluster.html" title="Cluster"><em>Cluster</em></a>.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.awareness.force.*</code>
</span></dt><dd>
     See <a class="xref" href="modules-cluster.html" title="Cluster"><em>Cluster</em></a>.
</dd></dl></div><h5><a id="_balanced_shards"></a>Balanced Shards<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>All these values are relative to one another.  The first three are used to
compose a three separate weighting functions into one.  The cluster is balanced
when no allowed action can bring the weights of each node closer together by
more then the fourth setting.  Actions might not be allowed, for instance,
due to forced awareness or allocation filtering.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">cluster.routing.allocation.balance.shard</code>
</span></dt><dd>
     Defines the weight factor for shards allocated on a node
     (float). Defaults to <code class="literal">0.45f</code>.  Raising this raises the tendency to
     equalize the number of shards across all nodes in the cluster.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.balance.index</code>
</span></dt><dd>
     Defines a factor to the number of shards per index allocated
      on a specific node (float). Defaults to <code class="literal">0.55f</code>.  Raising this raises the
      tendency to equalize the number of shards per index across all nodes in
      the cluster.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.balance.primary</code>
</span></dt><dd>
     Defines a weight factor for the number of primaries of a specific index
      allocated on a node (float). <code class="literal">0.00f</code>.  Raising this raises the tendency
      to equalize the number of primary shards across all nodes in the cluster. <span class="deprecated">
      [<span class="version">1.3.8</span>]
      <span class="detail">Deprecated in 1.3.8.
</span></span>
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.balance.threshold</code>
</span></dt><dd>
     Minimal optimization value of operations that should be performed (non
      negative float). Defaults to <code class="literal">1.0f</code>.  Raising this will cause the cluster
      to be less aggressive about optimizing the shard balance.
</dd></dl></div><h5><a id="_concurrent_rebalance"></a>Concurrent Rebalance<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">cluster.routing.allocation.cluster_concurrent_rebalance</code>
</span></dt><dd>
       Allow to control how many concurrent rebalancing of shards are
       allowed cluster wide, and default it to <code class="literal">2</code> (integer). <code class="literal">-1</code> for
       unlimited. See also <a class="xref" href="modules-cluster.html" title="Cluster"><em>Cluster</em></a>.
</dd></dl></div><h5><a id="_disable_allocation"></a>Disable allocation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>All the disable allocation settings have been deprecated in favour for
<code class="literal">cluster.routing.allocation.enable</code> setting.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">cluster.routing.allocation.disable_allocation</code>
</span></dt><dd>
     See <a class="xref" href="modules-cluster.html" title="Cluster"><em>Cluster</em></a>.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.disable_replica_allocation</code>
</span></dt><dd>
     See <a class="xref" href="modules-cluster.html" title="Cluster"><em>Cluster</em></a>.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.disable_new_allocation</code>
</span></dt><dd>
     See <a class="xref" href="modules-cluster.html" title="Cluster"><em>Cluster</em></a>.
</dd></dl></div><h5><a id="_enable_allocation"></a>Enable allocation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">cluster.routing.allocation.enable</code>
</span></dt><dd>
     See <a class="xref" href="modules-cluster.html" title="Cluster"><em>Cluster</em></a>.
</dd></dl></div><h5><a id="_throttling_allocation"></a>Throttling allocation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">cluster.routing.allocation.node_initial_primaries_recoveries</code>
</span></dt><dd>
     See <a class="xref" href="modules-cluster.html" title="Cluster"><em>Cluster</em></a>.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.node_concurrent_recoveries</code>
</span></dt><dd>
     See <a class="xref" href="modules-cluster.html" title="Cluster"><em>Cluster</em></a>.
</dd></dl></div><h5><a id="_filter_allocation"></a>Filter allocation<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">cluster.routing.allocation.include.*</code>
</span></dt><dd>
     See <a class="xref" href="modules-cluster.html" title="Cluster"><em>Cluster</em></a>.
</dd><dt><span class="term">
<code class="literal">cluster.routing.allocation.exclude.*</code>
</span></dt><dd>
     See <a class="xref" href="modules-cluster.html" title="Cluster"><em>Cluster</em></a>.
</dd></dl></div><p><code class="literal">cluster.routing.allocation.require.*</code>
     See <a class="xref" href="modules-cluster.html" title="Cluster"><em>Cluster</em></a>.</p><h4><a id="_metadata"></a>Metadata<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">cluster.blocks.read_only</code>
</span></dt><dd>
      Have the whole cluster read only (indices do not accept write operations), metadata is not allowed to be modified (create or delete indices).
</dd></dl></div><h4><a id="_discovery"></a>Discovery<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">discovery.zen.minimum_master_nodes</code>
</span></dt><dd>
     See <a class="xref" href="modules-discovery-zen.html" title="Zen Discovery">Zen Discovery</a>
</dd><dt><span class="term">
<code class="literal">discovery.zen.publish_timeout</code>
</span></dt><dd>
     See <a class="xref" href="modules-discovery-zen.html" title="Zen Discovery">Zen Discovery</a>
</dd></dl></div><h4><a id="_threadpools"></a>Threadpools<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">threadpool.*</code>
</span></dt><dd>
     See <a class="xref" href="modules-threadpool.html" title="Thread Pool"><em>Thread Pool</em></a>
</dd></dl></div><h3><a id="cluster-index-settings"></a>Index settings<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><h4><a id="_index_filter_cache"></a>Index filter cache<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">indices.cache.filter.size</code>
</span></dt><dd>
     See <a class="xref" href="index-modules-cache.html" title="Cache"><em>Cache</em></a>
</dd><dt><span class="term">
<code class="literal">indices.cache.filter.expire</code> (time)
</span></dt><dd>
     See <a class="xref" href="index-modules-cache.html" title="Cache"><em>Cache</em></a>
</dd></dl></div><h4><a id="_ttl_interval"></a>TTL interval<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">indices.ttl.interval</code> (time)
</span></dt><dd>
    See <a class="xref" href="mapping-ttl-field.html" title="_ttl"><code class="literal">_ttl</code></a>
</dd></dl></div><h4><a id="_recovery"></a>Recovery<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">indices.recovery.concurrent_streams</code>
</span></dt><dd>
     See <a class="xref" href="modules-indices.html" title="Indices"><em>Indices</em></a>
</dd><dt><span class="term">
<code class="literal">indices.recovery.concurrent_small_file_streams</code>
</span></dt><dd>
     See <a class="xref" href="modules-indices.html" title="Indices"><em>Indices</em></a>
</dd><dt><span class="term">
<code class="literal">indices.recovery.file_chunk_size</code>
</span></dt><dd>
     See <a class="xref" href="modules-indices.html" title="Indices"><em>Indices</em></a>
</dd><dt><span class="term">
<code class="literal">indices.recovery.translog_ops</code>
</span></dt><dd>
     See <a class="xref" href="modules-indices.html" title="Indices"><em>Indices</em></a>
</dd><dt><span class="term">
<code class="literal">indices.recovery.translog_size</code>
</span></dt><dd>
     See <a class="xref" href="modules-indices.html" title="Indices"><em>Indices</em></a>
</dd><dt><span class="term">
<code class="literal">indices.recovery.compress</code>
</span></dt><dd>
     See <a class="xref" href="modules-indices.html" title="Indices"><em>Indices</em></a>
</dd><dt><span class="term">
<code class="literal">indices.recovery.max_bytes_per_sec</code>
</span></dt><dd>
     See <a class="xref" href="modules-indices.html" title="Indices"><em>Indices</em></a>
</dd></dl></div><h4><a id="_store_level_throttling"></a>Store level throttling<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">indices.store.throttle.type</code>
</span></dt><dd>
      See <a class="xref" href="index-modules-store.html" title="Store"><em>Store</em></a>
</dd><dt><span class="term">
<code class="literal">indices.store.throttle.max_bytes_per_sec</code>
</span></dt><dd>
      See <a class="xref" href="index-modules-store.html" title="Store"><em>Store</em></a>
</dd></dl></div><h3><a id="logger"></a>Logger<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Logger values can also be updated by setting <code class="literal">logger.</code> prefix. More
settings will be allowed to be updated.</p><h3><a id="_field_data_circuit_breaker"></a>Field data circuit breaker<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/update-settings.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">indices.breaker.fielddata.limit</code>
</span></dt><dd>
     See <a class="xref" href="index-modules-fielddata.html" title="Field data"><em>Field data</em></a>
</dd><dt><span class="term">
<code class="literal">indices.breaker.fielddata.overhead</code>
</span></dt><dd>
     See <a class="xref" href="index-modules-fielddata.html" title="Field data"><em>Field data</em></a>
</dd></dl></div></div><div class="navfooter"><span class="prev"><a href="cluster-reroute.html">
              «&nbsp;
              Cluster Reroute</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-nodes-stats.html">Nodes Stats
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cluster.html">Cluster APIs</a></span> » <span class="breadcrumb-node">Nodes Stats</span></div><div class="navheader"><span class="prev"><a href="cluster-update-settings.html">
              «&nbsp;
              Cluster Update Settings</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-nodes-info.html">Nodes Info
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-nodes-stats"></a>Nodes Stats<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/nodes-stats.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><h3><a id="_nodes_statistics"></a>Nodes statistics<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/nodes-stats.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The cluster nodes stats API allows to retrieve one or more (or all) of
the cluster nodes statistics.</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/_nodes/stats'
curl -XGET 'http://localhost:9200/_nodes/nodeId1,nodeId2/stats'</pre></div><p>The first command retrieves stats of all the nodes in the cluster. The
second command selectively retrieves nodes stats of only <code class="literal">nodeId1</code> and
<code class="literal">nodeId2</code>. All the nodes selective options are explained
<a class="link" href="cluster.html#cluster-nodes" title="Node specificationedit">here</a>.</p><p>By default, all stats are returned. You can limit this by combining any
of <code class="literal">indices</code>, <code class="literal">os</code>, <code class="literal">process</code>, <code class="literal">jvm</code>, <code class="literal">network</code>, <code class="literal">transport</code>, <code class="literal">http</code>,
<code class="literal">fs</code>, <code class="literal">breaker</code> and <code class="literal">thread_pool</code>. For example:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">indices</code>
</p>
</td><td class="entry" valign="top">
<p>
        Indices stats about size, document count, indexing and
        deletion times, search times, field cache size , merges and flushes
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">fs</code>
</p>
</td><td class="entry" valign="top">
<p>
        File system information, data path, free disk space, read/write
        stats
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">http</code>
</p>
</td><td class="entry" valign="top">
<p>
        HTTP connection information
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">jvm</code>
</p>
</td><td class="entry" valign="top">
<p>
        JVM stats, memory pool information, garbage collection, buffer
        pools
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">network</code>
</p>
</td><td class="entry" valign="top">
<p>
        TCP information
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">os</code>
</p>
</td><td class="entry" valign="top">
<p>
        Operating system stats, load average, cpu, mem, swap
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">process</code>
</p>
</td><td class="entry" valign="top">
<p>
        Process statistics, memory consumption, cpu usage, open
        file descriptors
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">thread_pool</code>
</p>
</td><td class="entry" valign="top">
<p>
        Statistics about each thread pool, including current
        size, queue and rejected tasks
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">transport</code>
</p>
</td><td class="entry" valign="top">
<p>
        Transport statistics about sent and received bytes in
        cluster communication
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">breaker</code>
</p>
</td><td class="entry" valign="top">
<p>
        Statistics about the field data circuit breaker
</p>
</td></tr></tbody></table></div><div class="pre_wrapper"><pre class="programlisting"># return indices and os
curl -XGET 'http://localhost:9200/_nodes/stats/os'
# return just os and process
curl -XGET 'http://localhost:9200/_nodes/stats/os,process'
# specific type endpoint
curl -XGET 'http://localhost:9200/_nodes/stats/process'
curl -XGET 'http://localhost:9200/_nodes/10.0.0.1/stats/process'</pre></div><p>All stats can be explicitly requested via <code class="literal">/_nodes/stats/_all</code> or <code class="literal">/_nodes/stats?metric=_all</code>.</p><h3><a id="field-data"></a>Field data statistics<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/nodes-stats.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>You can get information about field data memory usage on node
level or on index level.</p><div class="pre_wrapper"><pre class="programlisting"># Node Stats
curl -XGET 'http://localhost:9200/_nodes/stats/indices/?fields=field1,field2&amp;pretty'

# Indices Stat
curl -XGET 'http://localhost:9200/_stats/fielddata/?fields=field1,field2&amp;pretty'

# You can use wildcards for field names
curl -XGET 'http://localhost:9200/_stats/fielddata/?fields=field*&amp;pretty'
curl -XGET 'http://localhost:9200/_nodes/stats/indices/?fields=field*&amp;pretty'</pre></div><h3><a id="search-groups"></a>Search groups<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/nodes-stats.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>You can get statistics about search groups for searches executed
on this node.</p><div class="pre_wrapper"><pre class="programlisting"># All groups with all stats
curl -XGET 'http://localhost:9200/_nodes/stats?pretty&amp;groups=_all'

# Some groups from just the indices stats
curl -XGET 'http://localhost:9200/_nodes/stats/indices?pretty&amp;groups=foo,bar'</pre></div></div><div class="navfooter"><span class="prev"><a href="cluster-update-settings.html">
              «&nbsp;
              Cluster Update Settings</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-nodes-info.html">Nodes Info
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cluster.html">Cluster APIs</a></span> » <span class="breadcrumb-node">Nodes Info</span></div><div class="navheader"><span class="prev"><a href="cluster-nodes-stats.html">
              «&nbsp;
              Nodes Stats</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-nodes-hot-threads.html">Nodes hot_threads
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-nodes-info"></a>Nodes Info<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/nodes-info.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The cluster nodes info API allows to retrieve one or more (or all) of
the cluster nodes information.</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/_nodes'
curl -XGET 'http://localhost:9200/_nodes/nodeId1,nodeId2'</pre></div><p>The first command retrieves information of all the nodes in the cluster.
The second command selectively retrieves nodes information of only
<code class="literal">nodeId1</code> and <code class="literal">nodeId2</code>. All the nodes selective options are explained
<a class="link" href="cluster.html#cluster-nodes" title="Node specificationedit">here</a>.</p><p>By default, it just returns all attributes and core settings for a node.
It also allows to get only information on <code class="literal">settings</code>, <code class="literal">os</code>, <code class="literal">process</code>, <code class="literal">jvm</code>,
<code class="literal">thread_pool</code>, <code class="literal">network</code>, <code class="literal">transport</code>, <code class="literal">http</code> and <code class="literal">plugins</code>:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET 'http://localhost:9200/_nodes/process'
curl -XGET 'http://localhost:9200/_nodes/_all/process'
curl -XGET 'http://localhost:9200/_nodes/nodeId1,nodeId2/jvm,process'
# same as above
curl -XGET 'http://localhost:9200/_nodes/nodeId1,nodeId2/info/jvm,process'

curl -XGET 'http://localhost:9200/_nodes/nodeId1,nodeId2/_all</pre></div><p>The <code class="literal">_all</code> flag can be set to return all the information - or you can simply omit it.</p><p><code class="literal">plugins</code> - if set, the result will contain details about the loaded
plugins per node:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">name</code>: plugin name
</li><li class="listitem">
<code class="literal">description</code>: plugin description if any
</li><li class="listitem">
<code class="literal">site</code>: <code class="literal">true</code> if the plugin is a site plugin
</li><li class="listitem">
<code class="literal">jvm</code>: <code class="literal">true</code> if the plugin is a plugin running in the JVM
</li><li class="listitem">
<code class="literal">url</code>: URL if the plugin is a site plugin
</li></ul></div><p>The result will look similar to:</p><div class="pre_wrapper"><pre class="programlisting">{
  "cluster_name" : "test-cluster-MacBook-Air-de-David.local",
  "nodes" : {
    "hJLXmY_NTrCytiIMbX4_1g" : {
      "name" : "node4",
      "transport_address" : "inet[/172.18.58.139:9303]",
      "hostname" : "MacBook-Air-de-David.local",
      "version" : "0.90.0.Beta2-SNAPSHOT",
      "http_address" : "inet[/172.18.58.139:9203]",
      "plugins" : [ {
        "name" : "test-plugin",
        "description" : "test-plugin description",
        "site" : true,
        "jvm" : false
      }, {
        "name" : "test-no-version-plugin",
        "description" : "test-no-version-plugin description",
        "site" : true,
        "jvm" : false
      }, {
        "name" : "dummy",
        "description" : "No description found for dummy.",
        "url" : "/_plugin/dummy/",
        "site" : false,
        "jvm" : true
      } ]
    }
  }
}</pre></div><p>if your <code class="literal">plugin</code> data is subject to change use
<code class="literal">plugins.info_refresh_interval</code> to change or disable the caching
interval:</p><div class="pre_wrapper"><pre class="programlisting"># Change cache to 20 seconds
plugins.info_refresh_interval: 20s

# Infinite cache
plugins.info_refresh_interval: -1

# Disable cache
plugins.info_refresh_interval: 0</pre></div></div><div class="navfooter"><span class="prev"><a href="cluster-nodes-stats.html">
              «&nbsp;
              Nodes Stats</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-nodes-hot-threads.html">Nodes hot_threads
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cluster.html">Cluster APIs</a></span> » <span class="breadcrumb-node">Nodes hot_threads</span></div><div class="navheader"><span class="prev"><a href="cluster-nodes-info.html">
              «&nbsp;
              Nodes Info</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-nodes-shutdown.html">Nodes Shutdown
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-nodes-hot-threads"></a>Nodes hot_threads<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/nodes-hot-threads.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>An API allowing to get the current hot threads on each node in the
cluster. Endpoints are <code class="literal">/_nodes/hot_threads</code>, and
<code class="literal">/_nodes/{nodesIds}/hot_threads</code>.</p><p>The output is plain text with a breakdown of each node’s top hot
threads. Parameters allowed are:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">threads</code>
</p>
</td><td class="entry" valign="top">
<p>
number of hot threads to provide, defaults to 3.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">interval</code>
</p>
</td><td class="entry" valign="top">
<p>
the interval to do the second sampling of threads.
                                Defaults to 500ms.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">type</code>
</p>
</td><td class="entry" valign="top">
<p>
The type to sample, defaults to cpu, but supports wait and
                                block to see hot threads that are in wait or block state.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">ignore_idle_threads</code>
</p>
</td><td class="entry" valign="top">
<p>
If true, known idle threads (e.g. waiting in a socket select, or to
                           get a task from an empty queue) are filtered out.  Defaults to true.
</p>
</td></tr></tbody></table></div></div><div class="navfooter"><span class="prev"><a href="cluster-nodes-info.html">
              «&nbsp;
              Nodes Info</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="cluster-nodes-shutdown.html">Nodes Shutdown
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="cluster.html">Cluster APIs</a></span> » <span class="breadcrumb-node">Nodes Shutdown</span></div><div class="navheader"><span class="prev"><a href="cluster-nodes-hot-threads.html">
              «&nbsp;
              Nodes hot_threads</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl.html">Query DSL
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cluster-nodes-shutdown"></a>Nodes Shutdown<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/nodes-shutdown.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><h3>Deprecated in 1.6.0. </h3>
 The _shutdown API will be removed in v2.0.0
</div></div><p>The nodes shutdown API allows to shutdown one or more (or all) nodes in
the cluster. Here is an example of shutting the <code class="literal">_local</code> node the
request is directed to:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPOST 'http://localhost:9200/_cluster/nodes/_local/_shutdown'</pre></div><p>Specific node(s) can be shutdown as well using their respective node ids
(or other selective options as explained
<a class="link" href="cluster.html#cluster-nodes" title="Node specificationedit">here</a> .):</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPOST 'http://localhost:9200/_cluster/nodes/nodeId1,nodeId2/_shutdown'</pre></div><p>The master (of the cluster) can also be shutdown using:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPOST 'http://localhost:9200/_cluster/nodes/_master/_shutdown'</pre></div><p>Finally, all nodes can be shutdown using one of the options below:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPOST 'http://localhost:9200/_shutdown'

$ curl -XPOST 'http://localhost:9200/_cluster/nodes/_shutdown'

$ curl -XPOST 'http://localhost:9200/_cluster/nodes/_all/_shutdown'</pre></div><h3><a id="delay"></a>Delay<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/nodes-shutdown.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>By default, the shutdown will be executed after a 1 second delay (<code class="literal">1s</code>).
The delay can be customized by setting the <code class="literal">delay</code> parameter in a time
value format. For example:</p><div class="pre_wrapper"><pre class="programlisting">$ curl -XPOST 'http://localhost:9200/_cluster/nodes/_local/_shutdown?delay=10s'</pre></div><h3><a id="_disable_shutdown"></a>Disable Shutdown<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/cluster/nodes-shutdown.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The shutdown API can be disabled by setting <code class="literal">action.disable_shutdown</code> in
the node configuration.</p></div><div class="navfooter"><span class="prev"><a href="cluster-nodes-hot-threads.html">
              «&nbsp;
              Nodes hot_threads</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl.html">Query DSL
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-node">Query DSL</span></div><div class="navheader"><span class="prev"><a href="cluster-nodes-shutdown.html">
              «&nbsp;
              Nodes Shutdown</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-queries.html">Queries
              &nbsp;»
            </a></span></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="query-dsl"></a>Query DSL<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><div class="partintro"><div></div><p><span class="strong emphasis"><strong>elasticsearch</strong></span> provides a full Query DSL based on JSON to define
queries. In general, there are basic queries such as
<a class="link" href="query-dsl-term-query.html" title="Term Query">term</a> or
<a class="link" href="query-dsl-prefix-query.html" title="Prefix Query">prefix</a>. There are
also compound queries like the
<a class="link" href="query-dsl-bool-query.html" title="Bool Query">bool</a> query. Queries can
also have filters associated with them such as the
<a class="link" href="query-dsl-filtered-query.html" title="Filtered Query">filtered</a> or
<a class="link" href="query-dsl-constant-score-query.html" title="Constant Score Query">constant_score</a>
queries, with specific filter queries.</p><p>Think of the Query DSL as an AST of queries. Certain queries can contain
other queries (like the
<a class="link" href="query-dsl-bool-query.html" title="Bool Query">bool</a> query), others can
contain filters (like the
<a class="link" href="query-dsl-constant-score-query.html" title="Constant Score Query">constant_score</a>),
and some can contain both a query and a filter (like the
<a class="link" href="query-dsl-filtered-query.html" title="Filtered Query">filtered</a>). Each of
those can contain <span class="strong emphasis"><strong>any</strong></span> query of the list of queries or <span class="strong emphasis"><strong>any</strong></span> filter
from the list of filters, resulting in the ability to build quite
complex (and interesting) queries.</p><p>Both queries and filters can be used in different APIs. For example,
within a <a class="link" href="search-request-query.html" title="Query">search query</a>, or
as a <a class="link" href="search-facets.html" title="Facets">facet filter</a>. This
section explains the components (queries and filters) that can form the
AST one can use.</p><p>Filters are very handy since they perform an order of magnitude better
than plain queries since no scoring is performed and they are
automatically cached.</p></div></div><div class="navfooter"><span class="prev"><a href="cluster-nodes-shutdown.html">
              «&nbsp;
              Nodes Shutdown</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-queries.html">Queries
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-node">Queries</span></div><div class="navheader"><span class="prev"><a href="query-dsl.html">
              «&nbsp;
              Query DSL</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-match-query.html">Match Query
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-queries"></a>Queries<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>As a general rule, queries should be used instead of filters:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
for full text search
</li><li class="listitem">
where the result depends on a relevance score
</li></ul></div></div><div class="navfooter"><span class="prev"><a href="query-dsl.html">
              «&nbsp;
              Query DSL</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-match-query.html">Match Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Match Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-queries.html">
              «&nbsp;
              Queries</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-multi-match-query.html">Multi Match Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-match-query"></a>Match Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/match-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A family of <code class="literal">match</code> queries that accepts text/numerics/dates, analyzes
them, and constructs a query. For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "match" : {
        "message" : "this is a test"
    }
}</pre></div><p>Note, <code class="literal">message</code> is the name of a field, you can substitute the name of
any field (including <code class="literal">_all</code>) instead.</p><h4><a id="_types_of_match_queries"></a>Types of Match Queries<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/match-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><h5><a id="_boolean"></a>boolean<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/match-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>The default <code class="literal">match</code> query is of type <code class="literal">boolean</code>. It means that the text
provided is analyzed and the analysis process constructs a boolean query
from the provided text. The <code class="literal">operator</code> flag can be set to <code class="literal">or</code> or <code class="literal">and</code>
to control the boolean clauses (defaults to <code class="literal">or</code>). The minimum number of
optional <code class="literal">should</code> clauses to match can be set using the
<a class="link" href="query-dsl-minimum-should-match.html" title="Minimum Should Match"><code class="literal">minimum_should_match</code></a>
parameter.</p><p>The <code class="literal">analyzer</code> can be set to control which analyzer will perform the
analysis process on the text. It defaults to the field explicit mapping
definition, or the default search analyzer.</p><p><code class="literal">fuzziness</code> allows <span class="emphasis"><em>fuzzy matching</em></span> based on the type of field being queried.
See <a class="xref" href="common-options.html#fuzziness" title="Fuzzinessedit">the section called “Fuzziness</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>” for allowed settings.</p><p>The <code class="literal">prefix_length</code> and
<code class="literal">max_expansions</code> can be set in this case to control the fuzzy process.
If the fuzzy option is set the query will use <code class="literal">constant_score_rewrite</code>
as its <a class="link" href="query-dsl-multi-term-rewrite.html" title="Multi Term Query Rewrite">rewrite method</a> the <code class="literal">fuzzy_rewrite</code> parameter allows to control how the query will get
rewritten.</p><p>Here is an example when providing additional parameters (note the slight
change in structure, <code class="literal">message</code> is the field name):</p><div class="pre_wrapper"><pre class="programlisting">{
    "match" : {
        "message" : {
            "query" : "this is a test",
            "operator" : "and"
        }
    }
}</pre></div><p class="formalpara"><strong>zero_terms_query.&nbsp;</strong>If the analyzer used removes all tokens in a query like a <code class="literal">stop</code> filter
does, the default behavior is to match no documents at all. In order to
change that the <code class="literal">zero_terms_query</code> option can be used, which accepts
<code class="literal">none</code> (default) and <code class="literal">all</code> which corresponds to a <code class="literal">match_all</code> query.</p><div class="pre_wrapper"><pre class="programlisting">{
    "match" : {
        "message" : {
            "query" : "to be or not to be",
            "operator" : "and",
            "zero_terms_query": "all"
        }
    }
}</pre></div><p class="formalpara"><strong>cutoff_frequency.&nbsp;</strong>The match query supports a <code class="literal">cutoff_frequency</code> that allows
specifying an absolute or relative document frequency where high
frequency terms are moved into an optional subquery and are only scored
if one of the low frequency (below the cutoff) terms in the case of an
<code class="literal">or</code> operator or all of the low frequency terms in the case of an <code class="literal">and</code>
operator match.</p><p>This query allows handling <code class="literal">stopwords</code> dynamically at runtime, is domain
independent and doesn’t require a stopword file. It prevents scoring /
iterating high frequency terms and only takes the terms into account if a
more significant / lower frequency term matches a document. Yet, if all
of the query terms are above the given <code class="literal">cutoff_frequency</code> the query is
automatically transformed into a pure conjunction (<code class="literal">and</code>) query to
ensure fast execution.</p><p>The <code class="literal">cutoff_frequency</code> can either be relative to the total number of
documents if in the range <code class="literal">[0..1)</code> or absolute if greater or equal to
<code class="literal">1.0</code>.</p><p>Here is an example showing a query composed of stopwords exclusively:</p><div class="pre_wrapper"><pre class="programlisting">{
    "match" : {
        "message" : {
            "query" : "to be or not to be",
            "cutoff_frequency" : 0.001
        }
    }
}</pre></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png"></div><div class="admon_content"><p>The <code class="literal">cutoff_frequency</code> option operates on a per-shard-level. This means
that when trying it out on test indexes with low document numbers you
should follow the advice in <a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/guide/current/relevance-is-broken.html" target="_top">Relevance is broken</a>.</p></div></div><h5><a id="_phrase"></a>phrase<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/match-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>The <code class="literal">match_phrase</code> query analyzes the text and creates a <code class="literal">phrase</code> query
out of the analyzed text. For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "match_phrase" : {
        "message" : "this is a test"
    }
}</pre></div><p>Since <code class="literal">match_phrase</code> is only a <code class="literal">type</code> of a <code class="literal">match</code> query, it can also be
used in the following manner:</p><div class="pre_wrapper"><pre class="programlisting">{
    "match" : {
        "message" : {
            "query" : "this is a test",
            "type" : "phrase"
        }
    }
}</pre></div><p>A phrase query matches terms up to a configurable <code class="literal">slop</code>
(which defaults to 0) in any order. Transposed terms have a slop of 2.</p><p>The <code class="literal">analyzer</code> can be set to control which analyzer will perform the
analysis process on the text. It defaults to the field explicit mapping
definition, or the default search analyzer, for example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "match_phrase" : {
        "message" : {
            "query" : "this is a test",
            "analyzer" : "my_analyzer"
        }
    }
}</pre></div><h5><a id="_match_phrase_prefix"></a>match_phrase_prefix<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/match-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>The <code class="literal">match_phrase_prefix</code> is the same as <code class="literal">match_phrase</code>, except that it
allows for prefix matches on the last term in the text. For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "match_phrase_prefix" : {
        "message" : "this is a test"
    }
}</pre></div><p>Or:</p><div class="pre_wrapper"><pre class="programlisting">{
    "match" : {
        "message" : {
            "query" : "this is a test",
            "type" : "phrase_prefix"
        }
    }
}</pre></div><p>It accepts the same parameters as the phrase type. In addition, it also
accepts a <code class="literal">max_expansions</code> parameter that can control to how many
prefixes the last term will be expanded. It is highly recommended to set
it to an acceptable value to control the execution time of the query.
For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "match_phrase_prefix" : {
        "message" : {
            "query" : "this is a test",
            "max_expansions" : 10
        }
    }
}</pre></div><h4><a id="_comparison_to_query_string_field"></a>Comparison to query_string / field<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/match-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The match family of queries does not go through a "query parsing"
process. It does not support field name prefixes, wildcard characters,
or other "advanced" features. For this reason, chances of it failing are
very small / non existent, and it provides an excellent behavior when it
comes to just analyze and run that text as a query behavior (which is
usually what a text search box does). Also, the <code class="literal">phrase_prefix</code> type can
provide a great "as you type" behavior to automatically load search
results.</p><h4><a id="_other_options_2"></a>Other options<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/match-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">lenient</code> - If set to true will cause format based failures (like
providing text to a numeric field) to be ignored. Defaults to false.
</li></ul></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-queries.html">
              «&nbsp;
              Queries</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-multi-match-query.html">Multi Match Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Multi Match Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-match-query.html">
              «&nbsp;
              Match Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-bool-query.html">Bool Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-multi-match-query"></a>Multi Match Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/multi-match-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">multi_match</code> query builds on the <a class="link" href="query-dsl-match-query.html" title="Match Query"><code class="literal">match</code> query</a>
to allow multi-field queries:</p><div class="pre_wrapper"><pre class="programlisting">{
  "multi_match" : {
    "query":    "this is a test", <a id="CO52-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
    "fields": [ "subject", "message" ] <a id="CO52-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO52-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The query string.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO52-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The fields to be queried.
</p></td></tr></tbody></table></div><h3><a id="_literal_fields_literal_and_per_field_boosting"></a><code class="literal">fields</code> and per-field boosting<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/multi-match-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Fields can be specified with wildcards, eg:</p><div class="pre_wrapper"><pre class="programlisting">{
  "multi_match" : {
    "query":    "Will Smith",
    "fields": [ "title", "*_name" ] <a id="CO53-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO53-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Query the <code class="literal">title</code>, <code class="literal">first_name</code> and <code class="literal">last_name</code> fields.
</p></td></tr></tbody></table></div><p>Individual fields can be boosted with the caret (<code class="literal">^</code>) notation:</p><div class="pre_wrapper"><pre class="programlisting">{
  "multi_match" : {
    "query" : "this is a test",
    "fields" : [ "subject^3", "message" ] <a id="CO54-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO54-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">subject</code> field is three times as important as the <code class="literal">message</code> field.
</p></td></tr></tbody></table></div><h3><a id="_literal_use_dis_max_literal"></a><code class="literal">use_dis_max</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/multi-match-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>By default, the <code class="literal">multi_match</code> query generates a <code class="literal">match</code> clause per field, then wraps them
in a <code class="literal">dis_max</code> query.  By setting <code class="literal">use_dis_max</code> to <code class="literal">false</code>, they will be wrapped in a
<code class="literal">bool</code> query instead.</p><h3><a id="multi-match-types"></a>Types of <code class="literal">multi_match</code> query:<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/multi-match-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The way the <code class="literal">multi_match</code> query is executed internally depends on the <code class="literal">type</code>
parameter, which can be set to:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">best_fields</code>
</p>
</td><td class="entry" valign="top">
<p>
(<span class="strong emphasis"><strong>default</strong></span>) Finds documents which match any field, but
                    uses the  <code class="literal">_score</code> from the best field.  See <a class="xref" href="query-dsl-multi-match-query.html#type-best-fields" title="best_fields"><code class="literal">best_fields</code></a>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">most_fields</code>
</p>
</td><td class="entry" valign="top">
<p>
Finds documents which match any field and combines
                    the <code class="literal">_score</code> from each field.  See <a class="xref" href="query-dsl-multi-match-query.html#type-most-fields" title="most_fields"><code class="literal">most_fields</code></a>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">cross_fields</code>
</p>
</td><td class="entry" valign="top">
<p>
Treats fields with the same <code class="literal">analyzer</code> as though they
                    were one big field. Looks for each word in <span class="strong emphasis"><strong>any</strong></span>
                    field. See <a class="xref" href="query-dsl-multi-match-query.html#type-cross-fields" title="cross_fields"><code class="literal">cross_fields</code></a>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">phrase</code>
</p>
</td><td class="entry" valign="top">
<p>
Runs a <code class="literal">match_phrase</code> query on each field and combines
                    the <code class="literal">_score</code> from each field.  See <a class="xref" href="query-dsl-multi-match-query.html#type-phrase" title="phrase and phrase_prefix"><code class="literal">phrase</code> and <code class="literal">phrase_prefix</code></a>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">phrase_prefix</code>
</p>
</td><td class="entry" valign="top">
<p>
Runs a <code class="literal">match_phrase_prefix</code> query on each field and
                    combines the <code class="literal">_score</code> from each field.  See <a class="xref" href="query-dsl-multi-match-query.html#type-phrase" title="phrase and phrase_prefix"><code class="literal">phrase</code> and <code class="literal">phrase_prefix</code></a>.
</p>
</td></tr></tbody></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="type-best-fields"></a><code class="literal">best_fields</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/multi-match-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">best_fields</code> type is most useful when you are searching for multiple
words best found in the same field. For instance “brown fox” in a single
field is more meaningful than “brown” in one field and “fox” in the other.</p><p>The <code class="literal">best_fields</code> type generates a <a class="link" href="query-dsl-match-query.html" title="Match Query"><code class="literal">match</code> query</a> for
each field and wraps them in a <a class="link" href="query-dsl-dis-max-query.html" title="Dis Max Query"><code class="literal">dis_max</code></a> query, to
find the single best matching field.  For instance, this query:</p><div class="pre_wrapper"><pre class="programlisting">{
  "multi_match" : {
    "query":      "brown fox",
    "type":       "best_fields",
    "fields":     [ "subject", "message" ],
    "tie_breaker": 0.3
  }
}</pre></div><p>would be executed as:</p><div class="pre_wrapper"><pre class="programlisting">{
  "dis_max": {
    "queries": [
      { "match": { "subject": "brown fox" }},
      { "match": { "message": "brown fox" }}
    ],
    "tie_breaker": 0.3
  }
}</pre></div><p>Normally the <code class="literal">best_fields</code> type uses the score of the <span class="strong emphasis"><strong>single</strong></span> best matching
field, but if <code class="literal">tie_breaker</code> is specified, then it calculates the score as
follows:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
the score from the best matching field
</li><li class="listitem">
plus <code class="literal">tie_breaker * _score</code> for all other matching fields
</li></ul></div><p>Also, accepts <code class="literal">analyzer</code>, <code class="literal">boost</code>, <code class="literal">operator</code>, <code class="literal">minimum_should_match</code>,
<code class="literal">fuzziness</code>, <code class="literal">prefix_length</code>, <code class="literal">max_expansions</code>, <code class="literal">rewrite</code>, <code class="literal">zero_terms_query</code>
and <code class="literal">cutoff_frequency</code>, as explained in <a class="link" href="query-dsl-match-query.html" title="Match Query">match query</a>.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png"></div><div class="admon_content"><h3><code class="literal">operator</code> and <code class="literal">minimum_should_match</code><a id="operator-min"></a></h3><p>The <code class="literal">best_fields</code> and <code class="literal">most_fields</code> types are <span class="emphasis"><em>field-centric</em></span> — they generate
a <code class="literal">match</code> query <span class="strong emphasis"><strong>per field</strong></span>.  This means that the <code class="literal">operator</code> and
<code class="literal">minimum_should_match</code> parameters are applied to each field individually,
which is probably not what you want.</p><p>Take this query for example:</p><div class="pre_wrapper"><pre class="programlisting">{
  "multi_match" : {
    "query":      "Will Smith",
    "type":       "best_fields",
    "fields":     [ "first_name", "last_name" ],
    "operator":   "and" <a id="CO55-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO55-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
All terms must be present.
</p></td></tr></tbody></table></div><p>This query is executed as:</p><pre class="literallayout">  (+first_name:will +first_name:smith)
| (+last_name:will  +last_name:smith)</pre><p>In other words, <span class="strong emphasis"><strong>all terms</strong></span> must be present <span class="strong emphasis"><strong>in a single field</strong></span> for a document
to match.</p><p>See <a class="xref" href="query-dsl-multi-match-query.html#type-cross-fields" title="cross_fields"><code class="literal">cross_fields</code></a> for a better solution.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="type-most-fields"></a><code class="literal">most_fields</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/multi-match-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">most_fields</code> type is most useful when querying multiple fields that
contain the same text analyzed in different ways.  For instance, the main
field may contain synonyms, stemming and terms without diacritics. A second
field may contain the original terms, and a third field might contain
shingles. By combining scores from all three fields we can match as many
documents as possible with the main field, but use the second and third fields
to push the most similar results to the top of the list.</p><p>This query:</p><div class="pre_wrapper"><pre class="programlisting">{
  "multi_match" : {
    "query":      "quick brown fox",
    "type":       "most_fields",
    "fields":     [ "title", "title.original", "title.shingles" ]
  }
}</pre></div><p>would be executed as:</p><div class="pre_wrapper"><pre class="programlisting">{
  "bool": {
    "should": [
      { "match": { "title":          "quick brown fox" }},
      { "match": { "title.original": "quick brown fox" }},
      { "match": { "title.shingles": "quick brown fox" }}
    ]
  }
}</pre></div><p>The score from each <code class="literal">match</code> clause is added together, then divided by the
number of <code class="literal">match</code> clauses.</p><p>Also, accepts <code class="literal">analyzer</code>, <code class="literal">boost</code>, <code class="literal">operator</code>, <code class="literal">minimum_should_match</code>,
<code class="literal">fuzziness</code>, <code class="literal">prefix_length</code>, <code class="literal">max_expansions</code>, <code class="literal">rewrite</code>, <code class="literal">zero_terms_query</code>
and <code class="literal">cutoff_frequency</code>, as explained in <a class="link" href="query-dsl-match-query.html" title="Match Query">match query</a>, but
<span class="strong emphasis"><strong>see <a class="xref" href="query-dsl-multi-match-query.html#operator-min" title="operator and minimum_should_match"><code class="literal">operator</code> and <code class="literal">minimum_should_match</code></a></strong></span>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="type-phrase"></a><code class="literal">phrase</code> and <code class="literal">phrase_prefix</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/multi-match-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">phrase</code> and <code class="literal">phrase_prefix</code> types behave just like <a class="xref" href="query-dsl-multi-match-query.html#type-best-fields" title="best_fields"><code class="literal">best_fields</code></a>,
but they use a <code class="literal">match_phrase</code> or <code class="literal">match_phrase_prefix</code> query instead of a
<code class="literal">match</code> query.</p><p>This query:</p><div class="pre_wrapper"><pre class="programlisting">{
  "multi_match" : {
    "query":      "quick brown f",
    "type":       "phrase_prefix",
    "fields":     [ "subject", "message" ]
  }
}</pre></div><p>would be executed as:</p><div class="pre_wrapper"><pre class="programlisting">{
  "dis_max": {
    "queries": [
      { "match_phrase_prefix": { "subject": "quick brown f" }},
      { "match_phrase_prefix": { "message": "quick brown f" }}
    ]
  }
}</pre></div><p>Also, accepts <code class="literal">analyzer</code>, <code class="literal">boost</code>, <code class="literal">slop</code> and <code class="literal">zero_terms_query</code>  as explained
in <a class="xref" href="query-dsl-match-query.html" title="Match Query">Match Query</a>.  Type <code class="literal">phrase_prefix</code> additionally accepts
<code class="literal">max_expansions</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="type-cross-fields"></a><code class="literal">cross_fields</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/multi-match-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">cross_fields</code> type is particularly useful with structured documents where
multiple fields <span class="strong emphasis"><strong>should</strong></span> match.  For instance, when querying the <code class="literal">first_name</code>
and <code class="literal">last_name</code> fields for “Will Smith”, the best match is likely to have
“Will” in one field and “Smith” in the other.</p><div class="sidebar"><div class="titlepage"></div><p>This sounds like a job for <a class="xref" href="query-dsl-multi-match-query.html#type-most-fields" title="most_fields"><code class="literal">most_fields</code></a> but there are two problems
with that approach. The first problem is that <code class="literal">operator</code> and
<code class="literal">minimum_should_match</code> are applied per-field, instead of per-term (see
<a class="link" href="query-dsl-multi-match-query.html#operator-min" title="operator and minimum_should_match">explanation above</a>).</p><p>The second problem is to do with relevance: the different term frequencies in
the <code class="literal">first_name</code> and <code class="literal">last_name</code> fields   can produce unexpected results.</p><p>For instance, imagine we have two people: “Will Smith” and “Smith Jones”.
“Smith” as a last name is very common (and so is of low importance) but
“Smith” as a first name is very uncommon (and so is of great importance).</p><p>If we do a search for “Will Smith”, the “Smith Jones” document will
probably appear above the better matching “Will Smith” because the score of
<code class="literal">first_name:smith</code> has trumped the combined scores of <code class="literal">first_name:will</code> plus
<code class="literal">last_name:smith</code>.</p></div><p>One way of dealing with these types of queries is simply to index the
<code class="literal">first_name</code> and <code class="literal">last_name</code> fields into a single <code class="literal">full_name</code> field.  Of
course, this can only be done at index time.</p><p>The <code class="literal">cross_field</code> type tries to solve these problems at query time by taking a
<span class="emphasis"><em>term-centric</em></span> approach.  It first analyzes the query string into individual
terms, then looks for each term in any of the fields, as though they were one
big field.</p><p>A query like:</p><div class="pre_wrapper"><pre class="programlisting">{
  "multi_match" : {
    "query":      "Will Smith",
    "type":       "cross_fields",
    "fields":     [ "first_name", "last_name" ],
    "operator":   "and"
  }
}</pre></div><p>is executed as:</p><pre class="literallayout">+(first_name:will  last_name:will)
+(first_name:smith last_name:smith)</pre><p>In other words, <span class="strong emphasis"><strong>all terms</strong></span> must be present <span class="strong emphasis"><strong>in at least one field</strong></span> for a
document to match.  (Compare this to
<a class="link" href="query-dsl-multi-match-query.html#operator-min" title="operator and minimum_should_match">the logic used for <code class="literal">best_fields</code> and <code class="literal">most_fields</code></a>.)</p><p>That solves one of the two problems. The problem of differing term frequencies
is solved by <span class="emphasis"><em>blending</em></span> the term frequencies for all fields in order to even
out the differences.</p><p>In practice, <code class="literal">first_name:smith</code> will be treated as though it has the same
frequencies as <code class="literal">last_name:smith</code>, plus one. This will make matches on
<code class="literal">first_name</code> and <code class="literal">last_name</code> have comparable scores, with a tiny advantage
for <code class="literal">last_name</code> since it is the most likely field that contains <code class="literal">smith</code>.</p><p>Note that <code class="literal">cross_fields</code> is usually only useful on short string fields
that all have a <code class="literal">boost</code> of <code class="literal">1</code>. Otherwise boosts, term freqs and length
normalization contribute to the score in such a way that the blending of term
statistics is not meaningful anymore.</p><p>If you run the above query through the <a class="xref" href="search-validate.html" title="Validate API"><em>Validate API</em></a>, it returns this
explanation:</p><pre class="literallayout">+blended("will",  fields: [first_name, last_name])
+blended("smith", fields: [first_name, last_name])</pre><p>Also, accepts <code class="literal">analyzer</code>, <code class="literal">boost</code>, <code class="literal">operator</code>, <code class="literal">minimum_should_match</code>,
<code class="literal">zero_terms_query</code> and <code class="literal">cutoff_frequency</code>, as explained in
<a class="link" href="query-dsl-match-query.html" title="Match Query">match query</a>.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_literal_cross_field_literal_and_analysis"></a><code class="literal">cross_field</code> and analysis<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/multi-match-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The <code class="literal">cross_field</code> type can only work in term-centric mode on fields that have
the same analyzer. Fields with the same analyzer are grouped together as in
the example above.  If there are multiple groups, they are combined with a
<code class="literal">bool</code> query.</p><p>For instance, if we have a <code class="literal">first</code> and <code class="literal">last</code> field which have
the same analyzer, plus a <code class="literal">first.edge</code> and <code class="literal">last.edge</code> which
both use an <code class="literal">edge_ngram</code> analyzer, this query:</p><div class="pre_wrapper"><pre class="programlisting">{
  "multi_match" : {
    "query":      "Jon",
    "type":       "cross_fields",
    "fields":     [
        "first", "first.edge",
        "last",  "last.edge"
    ]
  }
}</pre></div><p>would be executed as:</p><pre class="literallayout">    blended("jon", fields: [first, last])
| (
    blended("j",   fields: [first.edge, last.edge])
    blended("jo",  fields: [first.edge, last.edge])
    blended("jon", fields: [first.edge, last.edge])
)</pre><p>In other words, <code class="literal">first</code> and <code class="literal">last</code> would be grouped together and
treated as a single field, and <code class="literal">first.edge</code> and <code class="literal">last.edge</code> would be
grouped together and treated as a single field.</p><p>Having multiple groups is fine, but when combined with <code class="literal">operator</code> or
<code class="literal">minimum_should_match</code>, it can suffer from the <a class="link" href="query-dsl-multi-match-query.html#operator-min" title="operator and minimum_should_match">same problem</a>
as <code class="literal">most_fields</code> or <code class="literal">best_fields</code>.</p><p>You can easily rewrite this query yourself as two separate <code class="literal">cross_fields</code>
queries combined with a <code class="literal">bool</code> query, and apply the <code class="literal">minimum_should_match</code>
parameter to just one of them:</p><div class="pre_wrapper"><pre class="programlisting">{
    "bool": {
        "should": [
            {
              "multi_match" : {
                "query":      "Will Smith",
                "type":       "cross_fields",
                "fields":     [ "first", "last" ],
                "minimum_should_match": "50%" <a id="CO56-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
              }
            },
            {
              "multi_match" : {
                "query":      "Will Smith",
                "type":       "cross_fields",
                "fields":     [ "*.edge" ]
              }
            }
        ]
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO56-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Either <code class="literal">will</code> or <code class="literal">smith</code> must be present in either of the <code class="literal">first</code>
    or <code class="literal">last</code> fields
</p></td></tr></tbody></table></div><p>You can force all fields into the same group by specifying the <code class="literal">analyzer</code>
parameter in the query.</p><div class="pre_wrapper"><pre class="programlisting">{
  "multi_match" : {
    "query":      "Jon",
    "type":       "cross_fields",
    "analyzer":   "standard", <a id="CO57-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
    "fields":     [ "first", "last", "*.edge" ]
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO57-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Use the <code class="literal">standard</code> analyzer for all fields.
</p></td></tr></tbody></table></div><p>which will be executed as:</p><pre class="literallayout">blended("will",  fields: [first, first.edge, last.edge, last])
blended("smith", fields: [first, first.edge, last.edge, last])</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_literal_tie_breaker_literal"></a><code class="literal">tie_breaker</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/multi-match-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>By default, each per-term <code class="literal">blended</code> query will use the best score returned by
any field in a group, then these scores are added together to give the final
score. The <code class="literal">tie_breaker</code> parameter can change the default behaviour of the
per-term <code class="literal">blended</code> queries. It accepts:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">0.0</code>
</p>
</td><td class="entry" valign="top">
<p>
Take the single best score out of (eg) <code class="literal">first_name:will</code>
                    and <code class="literal">last_name:will</code> (<span class="strong emphasis"><strong>default</strong></span>)
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">1.0</code>
</p>
</td><td class="entry" valign="top">
<p>
Add together the scores for (eg) <code class="literal">first_name:will</code> and
                    <code class="literal">last_name:will</code>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">0.0 &lt; n &lt; 1.0</code>
</p>
</td><td class="entry" valign="top">
<p>
Take the single best score plus <code class="literal">tie_breaker</code> multiplied
                    by each of the scores from other matching fields.
</p>
</td></tr></tbody></table></div></div></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-match-query.html">
              «&nbsp;
              Match Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-bool-query.html">Bool Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Bool Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-multi-match-query.html">
              «&nbsp;
              Multi Match Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-boosting-query.html">Boosting Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-bool-query"></a>Bool Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/bool-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A query that matches documents matching boolean combinations of other
queries. The bool query maps to Lucene <code class="literal">BooleanQuery</code>. It is built using
one or more boolean clauses, each clause with a typed occurrence. The
occurrence types are:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th class="entry" align="left" valign="top">Occur </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">must</code></p></td><td class="entry" align="left" valign="top"><p>The clause (query) must appear in matching documents.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">should</code></p></td><td class="entry" align="left" valign="top"><p>The clause (query) should appear in the matching document. In
a boolean query with no <code class="literal">must</code> clauses, one or more <code class="literal">should</code> clauses
must match a document. The minimum number of should clauses to match can
be set using the
<a class="link" href="query-dsl-minimum-should-match.html" title="Minimum Should Match"><code class="literal">minimum_should_match</code></a>
parameter.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">must_not</code></p></td><td class="entry" align="left" valign="top"><p>The clause (query) must not appear in the matching
documents.</p></td></tr></tbody></table></div><p>The bool query also supports <code class="literal">disable_coord</code> parameter (defaults to
<code class="literal">false</code>). Basically the coord similarity computes a score factor based
on the fraction of all query terms that a document contains. See Lucene
<code class="literal">BooleanQuery</code> for more details.</p><p>The <code class="literal">bool</code> query takes a <span class="emphasis"><em>more-matches-is-better</em></span> approach, so the score from
each matching <code class="literal">must</code> or <code class="literal">should</code> clause will be added together to provide the
final <code class="literal">_score</code> for each document.</p><div class="pre_wrapper"><pre class="programlisting">{
    "bool" : {
        "must" : {
            "term" : { "user" : "kimchy" }
        },
        "must_not" : {
            "range" : {
                "age" : { "from" : 10, "to" : 20 }
            }
        },
        "should" : [
            {
                "term" : { "tag" : "wow" }
            },
            {
                "term" : { "tag" : "elasticsearch" }
            }
        ],
        "minimum_should_match" : 1,
        "boost" : 1.0
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-multi-match-query.html">
              «&nbsp;
              Multi Match Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-boosting-query.html">Boosting Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Boosting Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-bool-query.html">
              «&nbsp;
              Bool Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-common-terms-query.html">Common Terms Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-boosting-query"></a>Boosting Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/boosting-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">boosting</code> query can be used to effectively demote results that
match a given query. Unlike the "NOT" clause in bool query, this still
selects documents that contain undesirable terms, but reduces their
overall score.</p><div class="pre_wrapper"><pre class="programlisting">{
    "boosting" : {
        "positive" : {
            "term" : {
                "field1" : "value1"
            }
        },
        "negative" : {
            "term" : {
                "field2" : "value2"
            }
        },
        "negative_boost" : 0.2
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-bool-query.html">
              «&nbsp;
              Bool Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-common-terms-query.html">Common Terms Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Common Terms Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-boosting-query.html">
              «&nbsp;
              Boosting Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-constant-score-query.html">Constant Score Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-common-terms-query"></a>Common Terms Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/common-terms-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">common</code> terms query is a modern alternative to stopwords which
improves the precision and recall of search results (by taking stopwords
into account), without sacrificing performance.</p><h4><a id="_the_problem"></a>The problem<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/common-terms-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Every term in a query has a cost. A search for <code class="literal">"The brown fox"</code>
requires three term queries, one for each of <code class="literal">"the"</code>, <code class="literal">"brown"</code> and
<code class="literal">"fox"</code>, all of which are executed against all documents in the index.
The query for <code class="literal">"the"</code> is likely to match many documents and thus has a
much smaller impact on relevance than the other two terms.</p><p>Previously, the solution to this problem was to ignore terms with high
frequency. By treating <code class="literal">"the"</code> as a <span class="emphasis"><em>stopword</em></span>, we reduce the index size
and reduce the number of term queries that need to be executed.</p><p>The problem with this approach is that, while stopwords have a small
impact on relevance, they are still important. If we remove stopwords,
we lose precision, (eg we are unable to distinguish between <code class="literal">"happy"</code>
and <code class="literal">"not happy"</code>) and we lose recall (eg text like <code class="literal">"The The"</code> or
<code class="literal">"To be or not to be"</code> would simply not exist in the index).</p><h4><a id="_the_solution"></a>The solution<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/common-terms-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">common</code> terms query divides the query terms into two groups: more
important (ie <span class="emphasis"><em>low frequency</em></span> terms) and less important (ie <span class="emphasis"><em>high
frequency</em></span> terms which would previously have been stopwords).</p><p>First it searches for documents which match the more important terms.
These are the terms which appear in fewer documents and have a greater
impact on relevance.</p><p>Then, it executes a second query for the less important terms — terms
which appear frequently and have a low impact on relevance. But instead
of calculating the relevance score for <span class="strong emphasis"><strong>all</strong></span> matching documents, it only
calculates the <code class="literal">_score</code> for documents already matched by the first
query. In this way the high frequency terms can improve the relevance
calculation without paying the cost of poor performance.</p><p>If a query consists only of high frequency terms, then a single query is
executed as an <code class="literal">AND</code> (conjunction) query, in other words all terms are
required. Even though each individual term will match many documents,
the combination of terms narrows down the resultset to only the most
relevant. The single query can also be executed as an <code class="literal">OR</code> with a
specific
<a class="link" href="query-dsl-minimum-should-match.html" title="Minimum Should Match"><code class="literal">minimum_should_match</code></a>,
in this case a high enough value should probably be used.</p><p>Terms are allocated to the high or low frequency groups based on the
<code class="literal">cutoff_frequency</code>, which can be specified as an absolute frequency
(<code class="literal">&gt;=1</code>) or as a relative frequency (<code class="literal">0.0 .. 1.0</code>). (Remember that document
frequencies are computed on a per shard level as explained in the blog post
<a class="ulink" href="https://www.elastic.co/guide/en/elasticsearch/guide/current/relevance-is-broken.html" target="_top">Relevance is broken</a>.)</p><p>Perhaps the most interesting property of this query is that it adapts to
domain specific stopwords automatically. For example, on a video hosting
site, common terms like <code class="literal">"clip"</code> or <code class="literal">"video"</code> will automatically behave
as stopwords without the need to maintain a manual list.</p><h4><a id="_examples_3"></a>Examples<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/common-terms-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>In this example, words that have a document frequency greater than 0.1%
(eg <code class="literal">"this"</code> and <code class="literal">"is"</code>) will be treated as <span class="emphasis"><em>common terms</em></span>.</p><div class="pre_wrapper"><pre class="programlisting">{
  "common": {
    "body": {
      "query": "this is bonsai cool",
      "cutoff_frequency": 0.001
    }
  }
}</pre></div><p>The number of terms which should match can be controlled with the
<a class="link" href="query-dsl-minimum-should-match.html" title="Minimum Should Match"><code class="literal">minimum_should_match</code></a>
(<code class="literal">high_freq</code>, <code class="literal">low_freq</code>), <code class="literal">low_freq_operator</code> (default <code class="literal">"or"</code>) and
<code class="literal">high_freq_operator</code> (default <code class="literal">"or"</code>) parameters.</p><p>For low frequency terms, set the <code class="literal">low_freq_operator</code> to <code class="literal">"and"</code> to make
all terms required:</p><div class="pre_wrapper"><pre class="programlisting">{
  "common": {
    "body": {
      "query": "nelly the elephant as a cartoon",
      "cutoff_frequency": 0.001,
      "low_freq_operator": "and"
    }
  }
}</pre></div><p>which is roughly equivalent to:</p><div class="pre_wrapper"><pre class="programlisting">{
  "bool": {
    "must": [
      { "term": { "body": "nelly"}},
      { "term": { "body": "elephant"}},
      { "term": { "body": "cartoon"}}
    ],
    "should": [
      { "term": { "body": "the"}}
      { "term": { "body": "as"}}
      { "term": { "body": "a"}}
    ]
  }
}</pre></div><p>Alternatively use
<a class="link" href="query-dsl-minimum-should-match.html" title="Minimum Should Match"><code class="literal">minimum_should_match</code></a>
to specify a minimum number or percentage of low frequency terms which
must be present, for instance:</p><div class="pre_wrapper"><pre class="programlisting">{
  "common": {
    "body": {
      "query": "nelly the elephant as a cartoon",
      "cutoff_frequency": 0.001,
      "minimum_should_match": 2
    }
  }
}</pre></div><p>which is roughly equivalent to:</p><div class="pre_wrapper"><pre class="programlisting">{
  "bool": {
    "must": {
      "bool": {
        "should": [
          { "term": { "body": "nelly"}},
          { "term": { "body": "elephant"}},
          { "term": { "body": "cartoon"}}
        ],
        "minimum_should_match": 2
      }
    },
    "should": [
      { "term": { "body": "the"}}
      { "term": { "body": "as"}}
      { "term": { "body": "a"}}
    ]
  }
}</pre></div><p>minimum_should_match</p><p>A different
<a class="link" href="query-dsl-minimum-should-match.html" title="Minimum Should Match"><code class="literal">minimum_should_match</code></a>
can be applied for low and high frequency terms with the additional
<code class="literal">low_freq</code> and <code class="literal">high_freq</code> parameters. Here is an example when providing
additional parameters (note the change in structure):</p><div class="pre_wrapper"><pre class="programlisting">{
  "common": {
    "body": {
      "query": "nelly the elephant not as a cartoon",
      "cutoff_frequency": 0.001,
      "minimum_should_match": {
          "low_freq" : 2,
          "high_freq" : 3
       }
    }
  }
}</pre></div><p>which is roughly equivalent to:</p><div class="pre_wrapper"><pre class="programlisting">{
  "bool": {
    "must": {
      "bool": {
        "should": [
          { "term": { "body": "nelly"}},
          { "term": { "body": "elephant"}},
          { "term": { "body": "cartoon"}}
        ],
        "minimum_should_match": 2
      }
    },
    "should": {
      "bool": {
        "should": [
          { "term": { "body": "the"}},
          { "term": { "body": "not"}},
          { "term": { "body": "as"}},
          { "term": { "body": "a"}}
        ],
        "minimum_should_match": 3
      }
    }
  }
}</pre></div><p>In this case it means the high frequency terms have only an impact on
relevance when there are at least three of them. But the most
interesting use of the
<a class="link" href="query-dsl-minimum-should-match.html" title="Minimum Should Match"><code class="literal">minimum_should_match</code></a>
for high frequency terms is when there are only high frequency terms:</p><div class="pre_wrapper"><pre class="programlisting">{
  "common": {
    "body": {
      "query": "how not to be",
      "cutoff_frequency": 0.001,
      "minimum_should_match": {
          "low_freq" : 2,
          "high_freq" : 3
       }
    }
  }
}</pre></div><p>which is roughly equivalent to:</p><div class="pre_wrapper"><pre class="programlisting">{
  "bool": {
    "should": [
      { "term": { "body": "how"}},
      { "term": { "body": "not"}},
      { "term": { "body": "to"}},
      { "term": { "body": "be"}}
    ],
    "minimum_should_match": "3&lt;50%"
  }
}</pre></div><p>The high frequency generated query is then slightly less restrictive
than with an <code class="literal">AND</code>.</p><p>The <code class="literal">common</code> terms query also supports <code class="literal">boost</code>, <code class="literal">analyzer</code> and
<code class="literal">disable_coord</code> as parameters.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-boosting-query.html">
              «&nbsp;
              Boosting Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-constant-score-query.html">Constant Score Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Constant Score Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-common-terms-query.html">
              «&nbsp;
              Common Terms Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-dis-max-query.html">Dis Max Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-constant-score-query"></a>Constant Score Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/constant-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A query that wraps a filter or another query and simply returns a
constant score equal to the query boost for every document in the
filter. Maps to Lucene <code class="literal">ConstantScoreQuery</code>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "constant_score" : {
        "filter" : {
            "term" : { "user" : "kimchy"}
        },
        "boost" : 1.2
    }
}</pre></div><p>The filter object can hold only filter elements, not queries. Filters
can be much faster compared to queries since they don’t perform any
scoring, especially when they are cached.</p><p>A query can also be wrapped in a <code class="literal">constant_score</code> query:</p><div class="pre_wrapper"><pre class="programlisting">{
    "constant_score" : {
        "query" : {
            "term" : { "user" : "kimchy"}
        },
        "boost" : 1.2
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-common-terms-query.html">
              «&nbsp;
              Common Terms Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-dis-max-query.html">Dis Max Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Dis Max Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-constant-score-query.html">
              «&nbsp;
              Constant Score Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-filtered-query.html">Filtered Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-dis-max-query"></a>Dis Max Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/dis-max-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A query that generates the union of documents produced by its
subqueries, and that scores each document with the maximum score for
that document as produced by any subquery, plus a tie breaking increment
for any additional matching subqueries.</p><p>This is useful when searching for a word in multiple fields with
different boost factors (so that the fields cannot be combined
equivalently into a single search field). We want the primary score to
be the one associated with the highest boost, not the sum of the field
scores (as Boolean Query would give). If the query is "albino elephant"
this ensures that "albino" matching one field and "elephant" matching
another gets a higher score than "albino" matching both fields. To get
this result, use both Boolean Query and DisjunctionMax Query: for each
term a DisjunctionMaxQuery searches for it in each field, while the set
of these DisjunctionMaxQuery’s is combined into a BooleanQuery.</p><p>The tie breaker capability allows results that include the same term in
multiple fields to be judged better than results that include this term
in only the best of those multiple fields, without confusing this with
the better case of two different terms in the multiple fields.The
default <code class="literal">tie_breaker</code> is <code class="literal">0.0</code>.</p><p>This query maps to Lucene <code class="literal">DisjunctionMaxQuery</code>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "dis_max" : {
        "tie_breaker" : 0.7,
        "boost" : 1.2,
        "queries" : [
            {
                "term" : { "age" : 34 }
            },
            {
                "term" : { "age" : 35 }
            }
        ]
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-constant-score-query.html">
              «&nbsp;
              Constant Score Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-filtered-query.html">Filtered Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Filtered Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-dis-max-query.html">
              «&nbsp;
              Dis Max Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-flt-query.html">Fuzzy Like This Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-filtered-query"></a>Filtered Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/filtered-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">filtered</code> query is used to combine another query with any
<a class="link" href="query-dsl-filters.html" title="Filters">filter</a>. Filters are usually faster than queries because:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
they don’t have to calculate the relevance <code class="literal">_score</code> for each document —     the answer is just a boolean “Yes, the document matches the filter” or
    “No, the document does not match the filter”.
</li><li class="listitem">
the results from most filters can be cached in memory, making subsequent
    executions faster.
</li></ul></div><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p>Exclude as many document as you can with a filter, then query just the
documents that remain.</p></div></div><div class="pre_wrapper"><pre class="programlisting">{
  "filtered": {
    "query": {
      "match": { "tweet": "full text search" }
    },
    "filter": {
      "range": { "created": { "gte": "now-1d/d" }}
    }
  }
}</pre></div><p>The <code class="literal">filtered</code> query can be used wherever a <code class="literal">query</code> is expected, for instance,
to use the above example in search request:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET localhost:9200/_search -d '
{
  "query": {
    "filtered": { <a id="CO58-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
      "query": {
        "match": { "tweet": "full text search" }
      },
      "filter": {
        "range": { "created": { "gte": "now-1d/d" }}
      }
    }
  }
}
'</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO58-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">filtered</code> query is passed as the value of the <code class="literal">query</code>
    parameter in the search request.
</p></td></tr></tbody></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_filtering_without_a_query"></a>Filtering without a query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/filtered-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>If a <code class="literal">query</code> is not specified, it defaults to the
<a class="link" href="query-dsl-match-all-query.html" title="Match All Query"><code class="literal">match_all</code> query</a>.  This means that the
<code class="literal">filtered</code> query can be used to wrap just a filter, so that it can be used
wherever a query is expected.</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET localhost:9200/_search -d '
{
  "query": {
    "filtered": { <a id="CO59-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
      "filter": {
        "range": { "created": { "gte": "now-1d/d" }}
      }
    }
  }
}
'</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO59-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
No <code class="literal">query</code> has been specified, so this request applies just the filter,
   returning all documents created since yesterday.
</p></td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_multiple_filters"></a>Multiple filters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/filtered-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Multiple filters can be applied by wrapping them in a
<a class="link" href="query-dsl-bool-filter.html" title="Bool Filter"><code class="literal">bool</code> filter</a>, for example:</p><div class="pre_wrapper"><pre class="programlisting">{
  "filtered": {
    "query": { "match": { "tweet": "full text search" }},
    "filter": {
      "bool": {
        "must": { "range": { "created": { "gte": "now-1d/d" }}},
        "should": [
          { "term": { "featured": true }},
          { "term": { "starred":  true }}
        ],
        "must_not": { "term": { "deleted": false }}
      }
    }
  }
}</pre></div><p>Similarly, multiple queries can be combined with a
<a class="link" href="query-dsl-bool-query.html" title="Bool Query"><code class="literal">bool</code> query</a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_filter_strategy"></a>Filter strategy<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/filtered-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>You can control how the filter and query are executed with the <code class="literal">strategy</code>
parameter:</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" :   { ... },
        "filter" :  { ... },
        "strategy": "leap_frog"
    }
}</pre></div><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png"></div><div class="admon_content"><p>This is an <span class="emphasis"><em>expert-level</em></span> setting.  Most users can simply ignore it.</p></div></div><p>The <code class="literal">strategy</code> parameter accepts the following options:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">leap_frog_query_first</code>
</p>
</td><td class="entry" valign="top">
<p>
        Look for the first document matching the query, and then alternatively
        advance the query and the filter to find common matches.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">leap_frog_filter_first</code>
</p>
</td><td class="entry" valign="top">
<p>
    Look for the first document matching the filter, and then alternatively
    advance the query and the filter to find common matches.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">leap_frog</code>
</p>
</td><td class="entry" valign="top">
<p>
    Same as <code class="literal">leap_frog_query_first</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">query_first</code>
</p>
</td><td class="entry" valign="top">
<p>
    If the filter supports random access, then search for documents using the
    query, and then consult the filter to check whether there is a match.
    Otherwise fall back to <code class="literal">leap_frog_query_first</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">random_access_${threshold}</code>
</p>
</td><td class="entry" valign="top">
<p>
    If the filter supports random access and if there is at least one matching
    document among the first <code class="literal">threshold</code> ones, then apply the filter first.
    Otherwise fall back to <code class="literal">leap_frog_query_first</code>. <code class="literal">${threshold}</code> must be
    greater than or equal to <code class="literal">1</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">random_access_always</code>
</p>
</td><td class="entry" valign="top">
<p>
    Apply the filter first if it supports random access. Otherwise fall back
    to <code class="literal">leap_frog_query_first</code>.
</p>
</td></tr></tbody></table></div><p>The default strategy is to use <code class="literal">query_first</code> on filters that are not
advanceable such as geo filters and script filters, and <code class="literal">random_access_100</code> on
other filters.</p></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-dis-max-query.html">
              «&nbsp;
              Dis Max Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-flt-query.html">Fuzzy Like This Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Fuzzy Like This Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-filtered-query.html">
              «&nbsp;
              Filtered Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-flt-field-query.html">Fuzzy Like This Field Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-flt-query"></a>Fuzzy Like This Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/flt-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><h3>Deprecated in 1.6.0. </h3>
 This query will be removed in Elasticsearch 2.0
</div></div><p>Fuzzy like this query find documents that are "like" provided text by
running it against one or more fields.</p><div class="pre_wrapper"><pre class="programlisting">{
    "fuzzy_like_this" : {
        "fields" : ["name.first", "name.last"],
        "like_text" : "text like this one",
        "max_query_terms" : 12
    }
}</pre></div><p><code class="literal">fuzzy_like_this</code> can be shortened to <code class="literal">flt</code>.</p><p>The <code class="literal">fuzzy_like_this</code> top level parameters include:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th class="entry" align="left" valign="top">Parameter </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">fields</code></p></td><td class="entry" align="left" valign="top"><p>A list of the fields to run the more like this query against.
Defaults to the <code class="literal">_all</code> field.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">like_text</code></p></td><td class="entry" align="left" valign="top"><p>The text to find documents like it, <span class="strong emphasis"><strong>required</strong></span>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">ignore_tf</code></p></td><td class="entry" align="left" valign="top"><p>Should term frequency be ignored. Defaults to <code class="literal">false</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">max_query_terms</code></p></td><td class="entry" align="left" valign="top"><p>The maximum number of query terms that will be
included in any generated query. Defaults to <code class="literal">25</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">fuzziness</code></p></td><td class="entry" align="left" valign="top"><p>The minimum similarity of the term variants. Defaults
to <code class="literal">0.5</code>. See  <a class="xref" href="common-options.html#fuzziness" title="Fuzzinessedit">the section called “Fuzziness</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>”.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">prefix_length</code></p></td><td class="entry" align="left" valign="top"><p>Length of required common prefix on variant terms.
Defaults to <code class="literal">0</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">boost</code></p></td><td class="entry" align="left" valign="top"><p>Sets the boost value of the query. Defaults to <code class="literal">1.0</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td class="entry" align="left" valign="top"><p>The analyzer that will be used to analyze the text.
Defaults to the analyzer associated with the field.</p></td></tr></tbody></table></div><h4><a id="_how_it_works"></a>How it Works<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/flt-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Fuzzifies ALL terms provided as strings and then picks the best n
differentiating terms. In effect this mixes the behaviour of FuzzyQuery
and MoreLikeThis but with special consideration of fuzzy scoring
factors. This generally produces good results for queries where users
may provide details in a number of fields and have no knowledge of
boolean query syntax and also want a degree of fuzzy matching and a fast
query.</p><p>For each source term the fuzzy variants are held in a BooleanQuery with
no coord factor (because we are not looking for matches on multiple
variants in any one doc). Additionally, a specialized TermQuery is used
for variants and does not use that variant term’s IDF because this would
favor rarer terms, such as misspellings. Instead, all variants use the
same IDF ranking (the one for the source query term) and this is
factored into the variant’s boost. If the source query term does not
exist in the index the average IDF of the variants is used.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-filtered-query.html">
              «&nbsp;
              Filtered Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-flt-field-query.html">Fuzzy Like This Field Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Fuzzy Like This Field Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-flt-query.html">
              «&nbsp;
              Fuzzy Like This Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-function-score-query.html">Function Score Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-flt-field-query"></a>Fuzzy Like This Field Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/flt-field-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><h3>Deprecated in 1.6.0. </h3>
 This query will be removed in Elasticsearch 2.0
</div></div><p>The <code class="literal">fuzzy_like_this_field</code> query is the same as the <code class="literal">fuzzy_like_this</code>
query, except that it runs against a single field. It provides nicer
query DSL over the generic <code class="literal">fuzzy_like_this</code> query, and support typed
fields query (automatically wraps typed fields with type filter to match
only on the specific type).</p><div class="pre_wrapper"><pre class="programlisting">{
    "fuzzy_like_this_field" : {
        "name.first" : {
            "like_text" : "text like this one",
            "max_query_terms" : 12
        }
    }
}</pre></div><p><code class="literal">fuzzy_like_this_field</code> can be shortened to <code class="literal">flt_field</code>.</p><p>The <code class="literal">fuzzy_like_this_field</code> top level parameters include:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th class="entry" align="left" valign="top">Parameter </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">like_text</code></p></td><td class="entry" align="left" valign="top"><p>The text to find documents like it, <span class="strong emphasis"><strong>required</strong></span>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">ignore_tf</code></p></td><td class="entry" align="left" valign="top"><p>Should term frequency be ignored. Defaults to <code class="literal">false</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">max_query_terms</code></p></td><td class="entry" align="left" valign="top"><p>The maximum number of query terms that will be
included in any generated query. Defaults to <code class="literal">25</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">fuzziness</code></p></td><td class="entry" align="left" valign="top"><p>The fuzziness of the term variants. Defaults
to <code class="literal">0.5</code>. See  <a class="xref" href="common-options.html#fuzziness" title="Fuzzinessedit">the section called “Fuzziness</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>”.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">prefix_length</code></p></td><td class="entry" align="left" valign="top"><p>Length of required common prefix on variant terms.
Defaults to <code class="literal">0</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">boost</code></p></td><td class="entry" align="left" valign="top"><p>Sets the boost value of the query. Defaults to <code class="literal">1.0</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td class="entry" align="left" valign="top"><p>The analyzer that will be used to analyze the text.
Defaults to the analyzer associated with the field.</p></td></tr></tbody></table></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-flt-query.html">
              «&nbsp;
              Fuzzy Like This Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-function-score-query.html">Function Score Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Function Score Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-flt-field-query.html">
              «&nbsp;
              Fuzzy Like This Field Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-fuzzy-query.html">Fuzzy Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-function-score-query"></a>Function Score Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/function-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">function_score</code> allows you to modify the score of documents that are
retrieved by a query. This can be useful if, for example, a score
function is computationally expensive and it is sufficient to compute
the score on a filtered set of documents.</p><p><code class="literal">function_score</code> provides the same functionality that
<code class="literal">custom_boost_factor</code>, <code class="literal">custom_score</code> and
<code class="literal">custom_filters_score</code> provided
but with additional capabilities such as distance and recency scoring (see description below).</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_using_function_score"></a>Using function score<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/function-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>To use <code class="literal">function_score</code>, the user has to define a query and one or
several functions, that compute a new score for each document returned
by the query.</p><p><code class="literal">function_score</code> can be used with only one function like this:</p><div class="pre_wrapper"><pre class="programlisting">"function_score": {
    "(query|filter)": {},
    "boost": "boost for the whole query",
    "FUNCTION": {},  <a id="CO60-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
    "boost_mode":"(multiply|replace|...)"
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO60-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
See <a class="xref" href="query-dsl-function-score-query.html#score-functions" title="Score functions">Score functions</a> for a list of supported functions.
</p></td></tr></tbody></table></div><p>Furthermore, several functions can be combined. In this case one can
optionally choose to apply the function only if a document matches a
given filter:</p><div class="pre_wrapper"><pre class="programlisting">"function_score": {
    "(query|filter)": {},
    "boost": "boost for the whole query",
    "functions": [
        {
            "filter": {},
            "FUNCTION": {}, <a id="CO61-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
            "weight": number
        },
        {
            "FUNCTION": {} <a id="CO61-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
        },
        {
            "filter": {},
            "weight": number
        }
    ],
    "max_boost": number,
    "score_mode": "(multiply|max|...)",
    "boost_mode": "(multiply|replace|...)",
    "min_score" : number
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO61-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> <a href="#CO61-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
See <a class="xref" href="query-dsl-function-score-query.html#score-functions" title="Score functions">Score functions</a> for a list of supported functions.
</p></td></tr></tbody></table></div><p>If no filter is given with a function this is equivalent to specifying
<code class="literal">"match_all": {}</code></p><p>First, each document is scored by the defined functions. The parameter
<code class="literal">score_mode</code> specifies how the computed scores are combined:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">multiply</code>
</p>
</td><td class="entry" valign="top">
<p>
scores are multiplied (default)
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">sum</code>
</p>
</td><td class="entry" valign="top">
<p>
scores are summed
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">avg</code>
</p>
</td><td class="entry" valign="top">
<p>
scores are averaged
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">first</code>
</p>
</td><td class="entry" valign="top">
<p>
the first function that has a matching filter
                is applied
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">max</code>
</p>
</td><td class="entry" valign="top">
<p>
maximum score is used
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">min</code>
</p>
</td><td class="entry" valign="top">
<p>
minimum score is used
</p>
</td></tr></tbody></table></div><p>Because scores can be on different scales (for example, between 0 and 1 for decay functions but arbitrary for <code class="literal">field_value_factor</code>) and also because sometimes a different impact of functions on the score is desirable, the score of each function can be adjusted with a user defined <code class="literal">weight</code> (). The <code class="literal">weight</code> can be defined per function in the <code class="literal">functions</code> array (example above) and is multiplied with the score computed by the respective function.
If weight is given without any other function declaration, <code class="literal">weight</code> acts as a function that simply returns the <code class="literal">weight</code>.</p><p>The new score can be restricted to not exceed a certain limit by setting
the <code class="literal">max_boost</code> parameter. The default for <code class="literal">max_boost</code> is FLT_MAX.</p><p>The newly computed score is combined with the score of the
query. The parameter <code class="literal">boost_mode</code> defines how:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">multiply</code>
</p>
</td><td class="entry" valign="top">
<p>
query score and function score is multiplied (default)
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">replace</code>
</p>
</td><td class="entry" valign="top">
<p>
only function score is used, the query score is ignored
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">sum</code>
</p>
</td><td class="entry" valign="top">
<p>
query score and function score are added
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">avg</code>
</p>
</td><td class="entry" valign="top">
<p>
average
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">max</code>
</p>
</td><td class="entry" valign="top">
<p>
max of query score and function score
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">min</code>
</p>
</td><td class="entry" valign="top">
<p>
min of query score and function score
</p>
</td></tr></tbody></table></div><p>By default, modifying the score does not change which documents match. To exclude
documents that do not meet a certain score threshold the <code class="literal">min_score</code> parameter can be set to the desired score threshold.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="score-functions"></a>Score functions<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/function-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">function_score</code> query provides several types of score functions:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<a class="link" href="query-dsl-function-score-query.html#function-script-score" title="Script score"><code class="literal">script_score</code></a>
</li><li class="listitem">
<a class="link" href="query-dsl-function-score-query.html#function-weight" title="Weight"><code class="literal">weight</code></a>
</li><li class="listitem">
<a class="link" href="query-dsl-function-score-query.html#function-random" title="Random"><code class="literal">random_score</code></a>
</li><li class="listitem">
<a class="link" href="query-dsl-function-score-query.html#function-field-value-factor" title="Field Value factor"><code class="literal">field_value_factor</code></a>
</li><li class="listitem">
<a class="link" href="query-dsl-function-score-query.html#function-decay" title="Decay functions">decay functions</a>: <code class="literal">gauss</code>, <code class="literal">linear</code>, <code class="literal">exp</code>
</li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="function-script-score"></a>Script score<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/function-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">script_score</code> function allows you to wrap another query and customize
the scoring of it optionally with a computation derived from other numeric
field values in the doc using a script expression. Here is a
simple sample:</p><div class="pre_wrapper"><pre class="programlisting">"script_score" : {
    "script" : "_score * doc['my_numeric_field'].value"
}</pre></div><p>On top of the different scripting field values and expression, the
<code class="literal">_score</code> script parameter can be used to retrieve the score based on the
wrapped query.</p><p>Scripts are cached for faster execution. If the script has parameters
that it needs to take into account, it is preferable to reuse the same
script, and provide parameters to it:</p><div class="pre_wrapper"><pre class="programlisting">"script_score": {
    "lang": "lang",
    "params": {
        "param1": value1,
        "param2": value2
     },
    "script": "_score * doc['my_numeric_field'].value / pow(param1, param2)"
}</pre></div><p>Note that unlike the <code class="literal">custom_score</code> query, the
score of the query is multiplied with the result of the script scoring. If
you wish to inhibit this, set <code class="literal">"boost_mode": "replace"</code></p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="function-weight"></a>Weight<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/function-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">weight</code> score allows you to multiply the score by the provided
<code class="literal">weight</code>. This can sometimes be desired since boost value set on
specific queries gets normalized, while for this score function it does
not.</p><div class="pre_wrapper"><pre class="programlisting">"weight" : number</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="function-random"></a>Random<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/function-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The <code class="literal">random_score</code> generates scores using a hash of the <code class="literal">_uid</code> field,
with a <code class="literal">seed</code> for variation. If <code class="literal">seed</code> is not specified, the current
time is used.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Using this feature will load field data for <code class="literal">_uid</code>, which can
be a memory intensive operation since the values are unique.</p></div></div><div class="pre_wrapper"><pre class="programlisting">"random_score": {
    "seed" : number
}</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="function-field-value-factor"></a>Field Value factor<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/function-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">field_value_factor</code> function allows you to use a field from a document to
influence the score. It’s similar to using the <code class="literal">script_score</code> function, however,
it avoids the overhead of scripting. If used on a multi-valued field, only the
first value of the field is used in calculations.</p><p>As an example, imagine you have a document indexed with a numeric <code class="literal">popularity</code>
field and wish to influence the score of a document with this field, an example
doing so would look like:</p><div class="pre_wrapper"><pre class="programlisting">"field_value_factor": {
  "field": "popularity",
  "factor": 1.2,
  "modifier": "sqrt",
  "missing": 1
}</pre></div><p>Which will translate into the following formula for scoring:</p><p><code class="literal">sqrt(1.2 * doc['popularity'].value)</code></p><p>There are a number of options for the <code class="literal">field_value_factor</code> function:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">field</code>
</p>
</td><td class="entry" valign="top">
<p>
    Field to be extracted from the document.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">factor</code>
</p>
</td><td class="entry" valign="top">
<p>
    Optional factor to multiply the field value with, defaults to <code class="literal">1</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">modifier</code>
</p>
</td><td class="entry" valign="top">
<p>
    Modifier to apply to the field value, can be one of: <code class="literal">none</code>, <code class="literal">log</code>,
    <code class="literal">log1p</code>, <code class="literal">log2p</code>, <code class="literal">ln</code>, <code class="literal">ln1p</code>, <code class="literal">ln2p</code>, <code class="literal">square</code>, <code class="literal">sqrt</code>, or <code class="literal">reciprocal</code>.
    Defaults to <code class="literal">none</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">missing</code>
</p>
</td><td class="entry" valign="top">
<p>
    Value used if the document doesn’t have that field. The modifier
    and factor are still applied to it as though it were read from the document.
</p>
</td></tr></tbody></table></div><p>Keep in mind that taking the log() of 0, or the square root of a negative number
is an illegal operation, and an exception will be thrown. Be sure to limit the
values of the field with a range filter to avoid this, or use <code class="literal">log1p</code> and
<code class="literal">ln1p</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="function-decay"></a>Decay functions<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/function-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Decay functions score a document with a function that decays depending
on the distance of a numeric field value of the document from a user
given origin. This is similar to a range query, but with smooth edges
instead of boxes.</p><p>To use distance scoring on a query that has numerical fields, the user
has to define an <code class="literal">origin</code> and a <code class="literal">scale</code> for each field. The <code class="literal">origin</code>
is needed to define the “central point” from which the distance
is calculated, and the <code class="literal">scale</code> to define the rate of decay. The
decay function is specified as</p><div class="pre_wrapper"><pre class="programlisting">"DECAY_FUNCTION": { <a id="CO62-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
    "FIELD_NAME": { <a id="CO62-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
          "origin": "11, 12",
          "scale": "2km",
          "offset": "0km",
          "decay": 0.33
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO62-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">DECAY_FUNCTION</code> should be one of <code class="literal">linear</code>, <code class="literal">exp</code>, or <code class="literal">gauss</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO62-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The specified field must be a numeric field.
</p></td></tr></tbody></table></div><p>In the above example, the field is a <a class="xref" href="mapping-geo-point-type.html" title="Geo Point Type">Geo Point Type</a> and origin can be provided in geo format. <code class="literal">scale</code> and <code class="literal">offset</code> must be given with a unit in this case. If your field is a date field, you can set <code class="literal">scale</code> and <code class="literal">offset</code> as days, weeks, and so on. Example:</p><div class="pre_wrapper"><pre class="programlisting">    "gauss": {
        "date": {
              "origin": "2013-09-17", <a id="CO63-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
              "scale": "10d",
              "offset": "5d", <a id="CO63-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
              "decay" : 0.5 <a id="CO63-3"></a><span><img src="images/icons/callouts/3.png" alt=""></span>
        }
    }</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO63-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The date format of the origin depends on the <a class="xref" href="mapping-date-format.html" title="Date Format"><em>Date Format</em></a> defined in
    your mapping. If you do not define the origin, the current time is used.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO63-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> <a href="#CO63-3"><span><img src="images/icons/callouts/3.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">offset</code> and <code class="literal">decay</code> parameters are optional.
</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">offset</code>
</p>
</td><td class="entry" valign="top">
<p>
    If an <code class="literal">offset</code> is defined, the decay function will only compute the
    decay function for documents with a distance greater that the defined
    <code class="literal">offset</code>. The default is 0.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">decay</code>
</p>
</td><td class="entry" valign="top">
<p>
    The <code class="literal">decay</code> parameter defines how documents are scored at the distance
    given at <code class="literal">scale</code>. If no <code class="literal">decay</code> is defined, documents at the distance
    <code class="literal">scale</code> will be scored 0.5.
</p>
</td></tr></tbody></table></div></td></tr></tbody></table></div><p>In the first example, your documents might represents hotels and contain a geo
location field. You want to compute a decay function depending on how
far the hotel is from a given location. You might not immediately see
what scale to choose for the gauss function, but you can say something
like: "At a distance of 2km from the desired location, the score should
be reduced by one third."
The parameter "scale" will then be adjusted automatically to assure that
the score function computes a score of 0.5 for hotels that are 2km away
from the desired location.</p><p>In the second example, documents with a field value between 2013-09-12 and 2013-09-22 would get a weight of 1.0 and documents which are 15 days from that date a weight of 0.5.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_supported_decay_functions"></a>Supported decay functions<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/function-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>The <code class="literal">DECAY_FUNCTION</code> determines the shape of the decay:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">gauss</code>
</span></dt><dd><p class="simpara">Normal decay, computed as:</p><p class="simpara"><span class="inlinemediaobject"><img src="images/Gaussian.png" alt="images/Gaussian.png"></span></p><p class="simpara">where <span class="inlinemediaobject"><img src="images/sigma.png" alt="images/sigma.png"></span> is computed to assure that the score takes the value <code class="literal">decay</code> at distance <code class="literal">scale</code> from <code class="literal">origin</code>+-<code class="literal">offset</code></p><p class="simpara"><span class="inlinemediaobject"><img src="images/sigma_calc.png" alt="images/sigma_calc.png"></span></p><p class="simpara">See <a class="xref" href="query-dsl-function-score-query.html#gauss-decay" title="Normal decay, keyword gauss">Normal decay, keyword <code class="literal">gauss</code></a> for graphs demonstrating the curve generated by the <code class="literal">gauss</code> function.</p></dd><dt><span class="term">
<code class="literal">exp</code>
</span></dt><dd><p class="simpara">Exponential decay, computed as:</p><p class="simpara"><span class="inlinemediaobject"><img src="images/Exponential.png" alt="images/Exponential.png"></span></p><p class="simpara">where again the parameter <span class="inlinemediaobject"><img src="images/lambda.png" alt="images/lambda.png"></span> is computed to assure that the score takes the value <code class="literal">decay</code> at distance <code class="literal">scale</code> from <code class="literal">origin</code>+-<code class="literal">offset</code></p><p class="simpara"><span class="inlinemediaobject"><img src="images/lambda_calc.png" alt="images/lambda_calc.png"></span></p><p class="simpara">See <a class="xref" href="query-dsl-function-score-query.html#exp-decay" title="Exponential decay, keyword exp">Exponential decay, keyword <code class="literal">exp</code></a> for graphs demonstrating the curve generated by the <code class="literal">exp</code> function.</p></dd><dt><span class="term">
<code class="literal">linear</code>
</span></dt><dd><p class="simpara">Linear decay, computed as:</p><p class="simpara"><span class="inlinemediaobject"><img src="images/Linear.png" alt="images/Linear.png"></span>.</p><p class="simpara">where again the parameter <code class="literal">s</code> is computed to assure that the score takes the value <code class="literal">decay</code> at distance <code class="literal">scale</code> from <code class="literal">origin</code>+-<code class="literal">offset</code></p><p class="simpara"><span class="inlinemediaobject"><img src="images/s_calc.png" alt="images/s_calc.png"></span></p><p class="simpara">In contrast to the normal and exponential decay, this function actually
sets the score to 0 if the field value exceeds twice the user given
scale value.</p><p class="simpara">See <a class="xref" href="query-dsl-function-score-query.html#linear-decay" title="Linear decay, keyword linear">Linear decay, keyword <code class="literal">linear</code></a> for graphs demonstrating the curve generated by the <code class="literal">linear</code> function.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_multi_value_fields"></a>Multi-value fields:<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/function-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>If a field used for computing the decay contains multiple values, per default the value closest to the origin is chosen for determining the distance.
This can be changed by setting <code class="literal">multi_value_mode</code>.</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">min</code>
</p>
</td><td class="entry" valign="top">
<p>
Distance is the minimum distance
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">max</code>
</p>
</td><td class="entry" valign="top">
<p>
Distance is the maximum distance
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">avg</code>
</p>
</td><td class="entry" valign="top">
<p>
Distance is the average distance
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">sum</code>
</p>
</td><td class="entry" valign="top">
<p>
Distance is the sum of all distances
</p>
</td></tr></tbody></table></div><p>Example:</p><div class="pre_wrapper"><pre class="programlisting">    "DECAY_FUNCTION": {
        "FIELD_NAME": {
              "origin": ...,
              "scale": ...
        },
        "multi_value_mode": "avg"
    }</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_detailed_example"></a>Detailed example<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/function-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Suppose you are searching for a hotel in a certain town. Your budget is
limited. Also, you would like the hotel to be close to the town center,
so the farther the hotel is from the desired location the less likely
you are to check in.</p><p>You would like the query results that match your criterion (for
example, "hotel, Nancy, non-smoker") to be scored with respect to
distance to the town center and also the price.</p><p>Intuitively, you would like to define the town center as the origin and
maybe you are willing to walk 2km to the town center from the hotel.
In this case your <span class="strong emphasis"><strong>origin</strong></span> for the location field is the town center
and the <span class="strong emphasis"><strong>scale</strong></span> is ~2km.</p><p>If your budget is low, you would probably prefer something cheap above
something expensive.  For the price field, the <span class="strong emphasis"><strong>origin</strong></span> would be 0 Euros
and the <span class="strong emphasis"><strong>scale</strong></span> depends on how much you are willing to pay, for example 20 Euros.</p><p>In this example, the fields might be called "price" for the price of the
hotel and "location" for the coordinates of this hotel.</p><p>The function for <code class="literal">price</code> in this case would be</p><div class="pre_wrapper"><pre class="programlisting">"gauss": { <a id="CO64-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
    "price": {
          "origin": "0",
          "scale": "20"
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO64-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The decay function could also be <code class="literal">linear</code> or <code class="literal">exp</code>.
</p></td></tr></tbody></table></div><p>and for <code class="literal">location</code>:</p><div class="pre_wrapper"><pre class="programlisting">"gauss": { <a id="CO65-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
    "location": {
          "origin": "11, 12",
          "scale": "2km"
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO65-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The decay function could also be <code class="literal">linear</code> or <code class="literal">exp</code>.
</p></td></tr></tbody></table></div><p>Suppose you want to multiply these two functions on the original score,
the request would look like this:</p><div class="pre_wrapper"><pre class="programlisting">GET /hotels/_search/
{
  "query": {
    "function_score": {
      "functions": [
        {
          "gauss": {
            "price": {
              "origin": "0",
              "scale": "20"
            }
          }
        },
        {
          "gauss": {
            "location": {
              "origin": "11, 12",
              "scale": "2km"
            }
          }
        }
      ],
      "query": {
        "match": {
          "properties": "balcony"
        }
      },
      "score_mode": "multiply"
    }
  }
}</pre></div><div class="sense_widget" data-snippet="snippets/query-dsl-function-score-query/1.json"></div><p>Next, we show how the computed score looks like for each of the three
possible decay functions.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="gauss-decay"></a>Normal decay, keyword <code class="literal">gauss</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/function-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>When choosing <code class="literal">gauss</code> as the decay function in the above example, the
contour and surface plot of the multiplier looks like this:</p><div class="informalfigure"><div class="mediaobject"><img src="https://f.cloud.github.com/assets/4320215/768157/cd0e18a6-e898-11e2-9b3c-f0145078bd6f.png" width="700" alt="https://f.cloud.github.com/assets/4320215/768157/cd0e18a6-e898-11e2-9b3c-f0145078bd6f.png"></div></div><div class="informalfigure"><div class="mediaobject"><img src="https://f.cloud.github.com/assets/4320215/768160/ec43c928-e898-11e2-8e0d-f3c4519dbd89.png" width="700" alt="https://f.cloud.github.com/assets/4320215/768160/ec43c928-e898-11e2-8e0d-f3c4519dbd89.png"></div></div><p>Suppose your original search results matches three hotels :</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
"Backback Nap"
</li><li class="listitem">
"Drink n Drive"
</li><li class="listitem">
"BnB Bellevue".
</li></ul></div><p>"Drink n Drive" is pretty far from your defined location (nearly 2 km)
and is not too cheap (about 13 Euros) so it gets a low factor a factor
of 0.56. "BnB Bellevue" and "Backback Nap" are both pretty close to the
defined location but "BnB Bellevue" is cheaper, so it gets a multiplier
of 0.86 whereas "Backpack Nap" gets a value of 0.66.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="exp-decay"></a>Exponential decay, keyword <code class="literal">exp</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/function-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>When choosing <code class="literal">exp</code> as the decay function in the above example, the
contour and surface plot of the multiplier looks like this:</p><div class="informalfigure"><div class="mediaobject"><img src="https://f.cloud.github.com/assets/4320215/768161/082975c0-e899-11e2-86f7-174c3a729d64.png" width="700" alt="https://f.cloud.github.com/assets/4320215/768161/082975c0-e899-11e2-86f7-174c3a729d64.png"></div></div><div class="informalfigure"><div class="mediaobject"><img src="https://f.cloud.github.com/assets/4320215/768162/0b606884-e899-11e2-907b-aefc77eefef6.png" width="700" alt="https://f.cloud.github.com/assets/4320215/768162/0b606884-e899-11e2-907b-aefc77eefef6.png"></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="linear-decay"></a>Linear decay, keyword <code class="literal">linear</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/function-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>When choosing <code class="literal">linear</code> as the decay function in the above example, the
contour and surface plot of the multiplier looks like this:</p><div class="informalfigure"><div class="mediaobject"><img src="https://f.cloud.github.com/assets/4320215/768164/1775b0ca-e899-11e2-9f4a-776b406305c6.png" width="700" alt="https://f.cloud.github.com/assets/4320215/768164/1775b0ca-e899-11e2-9f4a-776b406305c6.png"></div></div><div class="informalfigure"><div class="mediaobject"><img src="https://f.cloud.github.com/assets/4320215/768165/19d8b1aa-e899-11e2-91bc-6b0553e8d722.png" width="700" alt="https://f.cloud.github.com/assets/4320215/768165/19d8b1aa-e899-11e2-91bc-6b0553e8d722.png"></div></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_supported_fields_for_decay_functions"></a>Supported fields for decay functions<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/function-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Only numeric, date, and geo-point fields are supported.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_what_if_a_field_is_missing"></a>What if a field is missing?<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/function-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>If the numeric field is missing in the document, the function will
return 1.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_relation_to_literal_custom_boost_literal_literal_custom_score_literal_and_literal_custom_filters_score_literal"></a>Relation to <code class="literal">custom_boost</code>, <code class="literal">custom_score</code> and <code class="literal">custom_filters_score</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/function-score-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">custom_boost_factor</code> query</p><div class="pre_wrapper"><pre class="programlisting">"custom_boost_factor": {
    "boost_factor": 5.2,
    "query": {...}
}</pre></div><p>becomes</p><div class="pre_wrapper"><pre class="programlisting">"function_score": {
    "weight": 5.2,
    "query": {...}
}</pre></div><p>The <code class="literal">custom_score</code> query</p><div class="pre_wrapper"><pre class="programlisting">"custom_score": {
    "params": {
        "param1": 2,
        "param2": 3.1
    },
    "query": {...},
    "script": "_score * doc['my_numeric_field'].value / pow(param1, param2)"
}</pre></div><p>becomes</p><div class="pre_wrapper"><pre class="programlisting">"function_score": {
    "boost_mode": "replace",
    "query": {...},
    "script_score": {
        "params": {
            "param1": 2,
            "param2": 3.1
        },
        "script": "_score * doc['my_numeric_field'].value / pow(param1, param2)"
    }
}</pre></div><p>and the <code class="literal">custom_filters_score</code></p><div class="pre_wrapper"><pre class="programlisting">"custom_filters_score": {
    "filters": [
        {
            "boost": "3",
            "filter": {...}
        },
        {
            "filter": {...},
            "script": "_score * doc['my_numeric_field'].value / pow(param1, param2)"
        }
    ],
    "params": {
        "param1": 2,
        "param2": 3.1
    },
    "query": {...},
    "score_mode": "first"
}</pre></div><p>becomes:</p><div class="pre_wrapper"><pre class="programlisting">"function_score": {
    "functions": [
        {
            "weight": "3",
            "filter": {...}
        },
        {
            "filter": {...},
            "script_score": {
                "params": {
                    "param1": 2,
                    "param2": 3.1
                },
                "script": "_score * doc['my_numeric_field'].value / pow(param1, param2)"
            }
        }
    ],
    "query": {...},
    "score_mode": "first"
}</pre></div></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-flt-field-query.html">
              «&nbsp;
              Fuzzy Like This Field Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-fuzzy-query.html">Fuzzy Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Fuzzy Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-function-score-query.html">
              «&nbsp;
              Function Score Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-geo-shape-query.html">GeoShape Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-fuzzy-query"></a>Fuzzy Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/fuzzy-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The fuzzy query uses similarity based on Levenshtein edit distance for
<code class="literal">string</code> fields, and a <code class="literal">+/-</code> margin on numeric and date fields.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_string_fields_2"></a>String fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/fuzzy-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <code class="literal">fuzzy</code> query generates all possible matching terms that are within  the
maximum edit distance specified in <code class="literal">fuzziness</code> and then checks the term
dictionary to find out which of those generated terms actually exist in the
index.</p><p>Here is a simple example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "fuzzy" : { "user" : "ki" }
}</pre></div><p>Or with more advanced settings:</p><div class="pre_wrapper"><pre class="programlisting">{
    "fuzzy" : {
        "user" : {
            "value" :         "ki",
            "boost" :         1.0,
            "fuzziness" :     2,
            "prefix_length" : 0,
            "max_expansions": 100
        }
    }
}</pre></div><h5><a id="_parameters_7"></a>Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/fuzzy-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">fuzziness</code>
</p>
</td><td class="entry" valign="top">
<p>
    The maximum edit distance. Defaults to <code class="literal">AUTO</code>. See <a class="xref" href="common-options.html#fuzziness" title="Fuzzinessedit">the section called “Fuzziness</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>”.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">prefix_length</code>
</p>
</td><td class="entry" valign="top">
<p>
    The number of initial characters which will not be “fuzzified”. This
    helps to reduce the number of terms which must be examined. Defaults
    to <code class="literal">0</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">max_expansions</code>
</p>
</td><td class="entry" valign="top">
<p>
    The maximum number of terms that the <code class="literal">fuzzy</code> query will expand to.
    Defaults to <code class="literal">50</code>.
</p>
</td></tr></tbody></table></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>this query can be very heavy if <code class="literal">prefix_length</code> and <code class="literal">max_expansions</code>
are both set to <code class="literal">0</code>. This could cause every term in the index to be examined!</p></div></div><h4><a id="_numeric_and_date_fields"></a>Numeric and date fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/fuzzy-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Performs a <a class="xref" href="query-dsl-range-query.html" title="Range Query">Range Query</a> “around” the value using the
<code class="literal">fuzziness</code> value as a <code class="literal">+/-</code> range, where:</p><pre class="literallayout">-fuzziness &lt;= field value &lt;= +fuzziness</pre><p>For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "fuzzy" : {
        "price" : {
            "value" : 12,
            "fuzziness" : 2
        }
    }
}</pre></div><p>Will result in a range query between 10 and 14. Date fields support
<a class="link" href="common-options.html#time-units" title="Time unitsedit">time values</a>, eg:</p><div class="pre_wrapper"><pre class="programlisting">{
    "fuzzy" : {
        "created" : {
            "value" : "2010-02-05T12:05:07",
            "fuzziness" : "1d"
        }
    }
}</pre></div><p>See <a class="xref" href="common-options.html#fuzziness" title="Fuzzinessedit">the section called “Fuzziness</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>” for more details about accepted values.</p></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-function-score-query.html">
              «&nbsp;
              Function Score Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-geo-shape-query.html">GeoShape Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">GeoShape Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-fuzzy-query.html">
              «&nbsp;
              Fuzzy Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-has-child-query.html">Has Child Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-geo-shape-query"></a>GeoShape Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/geo-shape-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Query version of the
<a class="link" href="query-dsl-geo-shape-filter.html" title="GeoShape Filter">geo_shape Filter</a>.</p><p>Requires the <a class="link" href="mapping-geo-shape-type.html" title="Geo Shape Type">geo_shape Mapping</a>.</p><p>Given a document that looks like this:</p><div class="pre_wrapper"><pre class="programlisting">{
    "name": "Wind &amp; Wetter, Berlin, Germany",
    "location": {
        "type": "Point",
        "coordinates": [13.400544, 52.530286]
    }
}</pre></div><p>The following query will find the point:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query": {
        "geo_shape": {
            "location": {
                "shape": {
                    "type": "envelope",
                    "coordinates": [[13, 53],[14, 52]]
                }
            }
        }
    }
}</pre></div><p>See the Filter’s documentation for more information.</p><h4><a id="_relevancy_and_score"></a>Relevancy and Score<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/geo-shape-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Currently Elasticsearch does not have any notion of geo shape relevancy,
consequently the Query internally uses a <code class="literal">constant_score</code> Query which
wraps a <a class="link" href="query-dsl-geo-shape-filter.html" title="GeoShape Filter">geo_shape filter</a>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_spatial_relations"></a>Spatial Relations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/geo-shape-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The <a class="link" href="mapping-geo-shape-type.html#spatial-strategy" title="Spatial strategiesedit">geo_shape strategy</a> mapping parameter determines
which spatial relation operators may be used at search time.</p><p>The following is a complete list of spatial relation operators available:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">INTERSECTS</code> - (default) Return all documents whose <code class="literal">geo_shape</code> field
intersects the query geometry.
</li><li class="listitem">
<code class="literal">DISJOINT</code> - Return all documents whose <code class="literal">geo_shape</code> field
has nothing in common with the query geometry.
</li><li class="listitem">
<code class="literal">WITHIN</code> - Return all documents whose <code class="literal">geo_shape</code> field
is within the query geometry.
</li></ul></div></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-fuzzy-query.html">
              «&nbsp;
              Fuzzy Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-has-child-query.html">Has Child Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Has Child Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-geo-shape-query.html">
              «&nbsp;
              GeoShape Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-has-parent-query.html">Has Parent Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-has-child-query"></a>Has Child Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/has-child-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">has_child</code> query works the same as the
<a class="link" href="query-dsl-has-child-filter.html" title="Has Child Filter">has_child</a> filter,
by automatically wrapping the filter with a
<a class="link" href="query-dsl-constant-score-query.html" title="Constant Score Query">constant_score</a>
(when using the default score type). It has the same syntax as the
<a class="link" href="query-dsl-has-child-filter.html" title="Has Child Filter">has_child</a> filter:</p><div class="pre_wrapper"><pre class="programlisting">{
    "has_child" : {
        "type" : "blog_tag",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</pre></div><p>An important difference with the <code class="literal">top_children</code> query is that this query
is always executed in two iterations whereas the <code class="literal">top_children</code> query
can be executed in one or more iteration. When using the <code class="literal">has_child</code>
query the <code class="literal">total_hits</code> is always correct.</p><h4><a id="_scoring_capabilities"></a>Scoring capabilities<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/has-child-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">has_child</code> also has scoring support. The
supported score types are <code class="literal">min</code>, <code class="literal">max</code>, <code class="literal">sum</code>, <code class="literal">avg</code> or <code class="literal">none</code>. The default is
<code class="literal">none</code> and yields the same behaviour as in previous versions. If the
score type is set to another value than <code class="literal">none</code>, the scores of all the
matching child documents are aggregated into the associated parent
documents. The score type can be specified with the <code class="literal">score_mode</code> field
inside the <code class="literal">has_child</code> query:</p><div class="pre_wrapper"><pre class="programlisting">{
    "has_child" : {
        "type" : "blog_tag",
        "score_mode" : "sum",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</pre></div><h4><a id="_min_max_children"></a>Min/Max Children<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/has-child-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">has_child</code> query allows you to specify that a minimum and/or maximum
number of children are required to match for the parent doc to be considered
a match:</p><div class="pre_wrapper"><pre class="programlisting">{
    "has_child" : {
        "type" : "blog_tag",
        "score_mode" : "sum",
        "min_children": 2, <a id="CO66-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
        "max_children": 10, <a id="CO66-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO66-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> <a href="#CO66-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Both <code class="literal">min_children</code> and <code class="literal">max_children</code> are optional.
</p></td></tr></tbody></table></div><p>The  <code class="literal">min_children</code> and <code class="literal">max_children</code> parameters can be combined with
the <code class="literal">score_mode</code> parameter.</p><h4><a id="_memory_considerations_5"></a>Memory Considerations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/has-child-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>In order to support parent-child joins, all of the (string) parent IDs
must be resident in memory (in the <a class="link" href="index-modules-fielddata.html" title="Field data">field data cache</a>.
Additionally, every child document is mapped to its parent using a long
value (approximately). It is advisable to keep the string parent ID short
in order to reduce memory usage.</p><p>You can check how much memory is being used by the ID cache using the
<a class="link" href="indices-stats.html" title="Indices Stats">indices stats</a> or <a class="link" href="cluster-nodes-stats.html" title="Nodes Stats">nodes stats</a>
APIS, eg:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET "http://localhost:9200/_stats/id_cache?pretty&amp;human"</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-geo-shape-query.html">
              «&nbsp;
              GeoShape Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-has-parent-query.html">Has Parent Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Has Parent Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-has-child-query.html">
              «&nbsp;
              Has Child Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-ids-query.html">Ids Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-has-parent-query"></a>Has Parent Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/has-parent-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">has_parent</code> query works the same as the
<a class="link" href="query-dsl-has-parent-filter.html" title="Has Parent Filter">has_parent</a>
filter, by automatically wrapping the filter with a constant_score (when
using the default score type). It has the same syntax as the
<a class="link" href="query-dsl-has-parent-filter.html" title="Has Parent Filter">has_parent</a>
filter.</p><div class="pre_wrapper"><pre class="programlisting">{
    "has_parent" : {
        "parent_type" : "blog",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</pre></div><h4><a id="_scoring_capabilities_2"></a>Scoring capabilities<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/has-parent-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">has_parent</code> also has scoring support. The
supported score types are <code class="literal">score</code> or <code class="literal">none</code>. The default is <code class="literal">none</code> and
this ignores the score from the parent document. The score is in this
case equal to the boost on the <code class="literal">has_parent</code> query (Defaults to 1). If
the score type is set to <code class="literal">score</code>, then the score of the matching parent
document is aggregated into the child documents belonging to the
matching parent document. The score type can be specified with the
<code class="literal">score_mode</code> field inside the <code class="literal">has_parent</code> query:</p><div class="pre_wrapper"><pre class="programlisting">{
    "has_parent" : {
        "parent_type" : "blog",
        "score_mode" : "score",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</pre></div><h4><a id="_memory_considerations_6"></a>Memory Considerations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/has-parent-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>In order to support parent-child joins, all of the (string) parent IDs
must be resident in memory (in the <a class="link" href="index-modules-fielddata.html" title="Field data">field data cache</a>.
Additionally, every child document is mapped to its parent using a long
value (approximately). It is advisable to keep the string parent ID short
in order to reduce memory usage.</p><p>You can check how much memory is being used by the ID cache using the
<a class="link" href="indices-stats.html" title="Indices Stats">indices stats</a> or <a class="link" href="cluster-nodes-stats.html" title="Nodes Stats">nodes stats</a>
APIS, eg:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET "http://localhost:9200/_stats/id_cache?pretty&amp;human"</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-has-child-query.html">
              «&nbsp;
              Has Child Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-ids-query.html">Ids Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Ids Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-has-parent-query.html">
              «&nbsp;
              Has Parent Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-indices-query.html">Indices Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-ids-query"></a>Ids Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/ids-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Filters documents that only have the provided ids. Note, this filter
does not require the <a class="link" href="mapping-id-field.html" title="_id">_id</a>
field to be indexed since it works using the
<a class="link" href="mapping-uid-field.html" title="_uid">_uid</a> field.</p><div class="pre_wrapper"><pre class="programlisting">{
    "ids" : {
        "type" : "my_type",
        "values" : ["1", "4", "100"]
    }
}</pre></div><p>The <code class="literal">type</code> is optional and can be omitted, and can also accept an array
of values.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-has-parent-query.html">
              «&nbsp;
              Has Parent Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-indices-query.html">Indices Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Indices Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-ids-query.html">
              «&nbsp;
              Ids Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-match-all-query.html">Match All Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-indices-query"></a>Indices Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/indices-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">indices</code> query can be used when executed across multiple indices,
allowing to have a query that executes only when executed on an index
that matches a specific list of indices, and another query that executes
when it is executed on an index that does not match the listed indices.</p><div class="pre_wrapper"><pre class="programlisting">{
    "indices" : {
        "indices" : ["index1", "index2"],
        "query" : {
            "term" : { "tag" : "wow" }
        },
        "no_match_query" : {
            "term" : { "tag" : "kow" }
        }
    }
}</pre></div><p>You can use the <code class="literal">index</code> field to provide a single index.</p><p><code class="literal">no_match_query</code> can also have "string" value of <code class="literal">none</code> (to match no
documents), and <code class="literal">all</code> (to match all). Defaults to <code class="literal">all</code>.</p><p><code class="literal">query</code> is mandatory, as well as <code class="literal">indices</code> (or <code class="literal">index</code>).</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p>The fields order is important: if the <code class="literal">indices</code> are provided before <code class="literal">query</code>
or <code class="literal">no_match_query</code>, the related queries get parsed only against the indices
that they are going to be executed on. This is useful to avoid parsing queries
when it is not necessary and prevent potential mapping errors.</p></div></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-ids-query.html">
              «&nbsp;
              Ids Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-match-all-query.html">Match All Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Match All Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-indices-query.html">
              «&nbsp;
              Indices Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-mlt-query.html">More Like This Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-match-all-query"></a>Match All Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/match-all-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A query that matches all documents. Maps to Lucene <code class="literal">MatchAllDocsQuery</code>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "match_all" : { }
}</pre></div><p>Which can also have boost associated with it:</p><div class="pre_wrapper"><pre class="programlisting">{
    "match_all" : { "boost" : 1.2 }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-indices-query.html">
              «&nbsp;
              Indices Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-mlt-query.html">More Like This Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">More Like This Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-match-all-query.html">
              «&nbsp;
              Match All Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-nested-query.html">Nested Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-mlt-query"></a>More Like This Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/mlt-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The More Like This Query (MLT Query) finds documents that are "like" a given
set of documents. In order to do so, MLT selects a set of representative terms
of these input documents, forms a query using these terms, executes the query
and returns the results. The user controls the input documents, how the terms
should be selected and how the query is formed. <code class="literal">more_like_this</code> can be
shortened to <code class="literal">mlt</code>.</p><p>The simplest use case consists of asking for documents that are similar to a
provided piece of text. Here, we are asking for all movies that have some text
similar to "Once upon a time" in their "title" and in their "description"
fields, limiting the number of selected terms to 12.</p><div class="pre_wrapper"><pre class="programlisting">{
    "more_like_this" : {
        "fields" : ["title", "description"],
        "like_text" : "Once upon a time",
        "min_term_freq" : 1,
        "max_query_terms" : 12
    }
}</pre></div><p>Another use case consists of asking for similar documents to ones already
existing in the index. In this case, the syntax to specify a document is
similar to the one used in the <a class="link" href="docs-multi-get.html" title="Multi Get API">Multi GET API</a>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "more_like_this" : {
        "fields" : ["title", "description"],
        "docs" : [
        {
            "_index" : "imdb",
            "_type" : "movies",
            "_id" : "1"
        },
        {
            "_index" : "imdb",
            "_type" : "movies",
            "_id" : "2"
        }],
        "min_term_freq" : 1,
        "max_query_terms" : 12
    }
}</pre></div><p>Finally, users can also provide documents not necessarily
present in the index using a syntax is similar to
<a class="link" href="docs-termvectors.html#docs-termvectors-artificial-doc" title="Example 3edit">artificial documents</a>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "more_like_this" : {
        "fields" : ["name.first", "name.last"],
        "docs" : [
        {
            "_index" : "marvel",
            "_type" : "quotes",
            "doc" : {
                "name": {
                    "first": "Ben",
                    "last": "Grimm"
                },
                "tweet": "You got no idea what I'd... what I'd give to be invisible."
              }
            }
        },
        {
            "_index" : "marvel",
            "_type" : "quotes",
            "_id" : "2"
        }
        ],
        "min_term_freq" : 1,
        "max_query_terms" : 12
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_how_it_works_2"></a>How it Works<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/mlt-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Suppose we wanted to find all documents similar to a given input document.
Obviously, the input document itself should be its best match for that type of
query. And the reason would be mostly, according to
<a class="ulink" href="https://lucene.apache.org/core/4_9_0/core/org/apache/lucene/search/similarities/TFIDFSimilarity.html" target="_top">Lucene scoring formula</a>,
due to the terms with the highest tf-idf. Therefore, the terms of the input
document that have the highest tf-idf are good representatives of that
document, and could be used within a disjunctive query (or <code class="literal">OR</code>) to retrieve
similar documents. The MLT query simply extracts the text from the input
document, analyzes it, usually using the same analyzer as the field, then
selects the top K terms with highest tf-idf to form a disjunctive query of
these terms.</p><div class="important admon"><div class="icon"><img alt="Important" src="images/icons/important.png"></div><div class="admon_content"><p>The fields on which to perform MLT must be indexed and of type
<code class="literal">string</code>. Additionally, when using <code class="literal">like</code> with documents, either <code class="literal">_source</code>
must be enabled or the fields must be <code class="literal">stored</code> or have <code class="literal">term_vector</code> enabled.
In order to speed up analysis, it could help to store term vectors at index
time, but at the expense of disk usage.</p></div></div><p>For example, if we wish to perform MLT on the "title" and "tags.raw" fields,
we can explicitly store their <code class="literal">term_vector</code> at index time. We can still
perform MLT on the "description" and "tags" fields, as <code class="literal">_source</code> is enabled by
default, but there will be no speed up on analysis for these fields.</p><div class="pre_wrapper"><pre class="programlisting">curl -s -XPUT 'http://localhost:9200/imdb/' -d '{
  "mappings": {
    "movies": {
      "properties": {
        "title": {
          "type": "string",
          "term_vector": "yes"
         },
         "description": {
          "type": "string"
        },
        "tags": {
          "type": "string",
          "fields" : {
            "raw": {
              "type" : "string",
              "index" : "not_analyzed",
              "term_vector" : "yes"
            }
          }
        }
      }
    }
  }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_parameters_8"></a>Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/mlt-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The only required parameters are either <code class="literal">docs</code>, <code class="literal">ids</code> or <code class="literal">like_text</code>, all
other parameters have sensible defaults. There are three types of parameters:
one to specify the document input, the other one for term selection and for
query formation.</p><h4><a id="_document_input_parameters"></a>Document Input Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/mlt-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">docs</code>
</p>
</td><td class="entry" valign="top">
<p>
The list of documents to find documents like it. The syntax to specify
documents is similar to the one used by the <a class="link" href="docs-multi-get.html" title="Multi Get API">Multi GET API</a>.
The text is fetched from <code class="literal">fields</code> unless overridden in each document request.
The text is analyzed by the analyzer at the field, but could also be
overridden. The syntax to override the analyzer at the field follows a similar
syntax to the <code class="literal">per_field_analyzer</code> parameter of the
<a class="link" href="docs-termvectors.html#docs-termvectors-per-field-analyzer" title="Example 4edit">Term Vectors API</a>. Additionally, to
provide documents not necessarily present in the index,
<a class="link" href="docs-termvectors.html#docs-termvectors-artificial-doc" title="Example 3edit">artificial documents</a> are also supported.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">ids</code>
</p>
</td><td class="entry" valign="top">
<p>
A list of document ids, shortcut to <code class="literal">docs</code> if <code class="literal">_index</code> and <code class="literal">_type</code> are the
same as the request.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">like_text</code>
</p>
</td><td class="entry" valign="top">
<p>
The text to find documents like it. <span class="strong emphasis"><strong>required</strong></span> if <code class="literal">ids</code> or <code class="literal">docs</code> are not
specified.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">fields</code>
</p>
</td><td class="entry" valign="top">
<p>
A list of the fields to run the more like this query against. Defaults to the
<code class="literal">_all</code> field for <code class="literal">like_text</code> and to all possible fields for <code class="literal">ids</code> or <code class="literal">docs</code>.
</p>
</td></tr></tbody></table></div><h4><a id="_term_selection_parameters"></a>Term Selection Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/mlt-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">max_query_terms</code>
</p>
</td><td class="entry" valign="top">
<p>
The maximum number of query terms that will be selected. Increasing this value
gives greater accuracy at the expense of query execution speed. Defaults to
<code class="literal">25</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">min_term_freq</code>
</p>
</td><td class="entry" valign="top">
<p>
The minimum term frequency below which the terms will be ignored from the
input document. Defaults to <code class="literal">2</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">min_doc_freq</code>
</p>
</td><td class="entry" valign="top">
<p>
The minimum document frequency below which the terms will be ignored from the
input document. Defaults to <code class="literal">5</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">max_doc_freq</code>
</p>
</td><td class="entry" valign="top">
<p>
The maximum document frequency above which the terms will be ignored from the
input document. This could be useful in order to ignore highly frequent words
such as stop words. Defaults to unbounded (<code class="literal">0</code>).
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">min_word_length</code>
</p>
</td><td class="entry" valign="top">
<p>
The minimum word length below which the terms will be ignored. Defaults to <code class="literal">0</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">max_word_length</code>
</p>
</td><td class="entry" valign="top">
<p>
The maximum word length above which the terms will be ignored. Defaults to unbounded (<code class="literal">0</code>).
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">stop_words</code>
</p>
</td><td class="entry" valign="top">
<p>
An array of stop words. Any word in this set is considered "uninteresting" and
ignored. If the analyzer allows for stop words, you might want to tell MLT to
explicitly ignore them, as for the purposes of document similarity it seems
reasonable to assume that "a stop word is never interesting".
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">analyzer</code>
</p>
</td><td class="entry" valign="top">
<p>
The analyzer that is used to analyze the free form text. Defaults to the
analyzer associated with the first field in <code class="literal">fields</code>.
</p>
</td></tr></tbody></table></div><h4><a id="_query_formation_parameters"></a>Query Formation Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/mlt-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">minimum_should_match</code>
</p>
</td><td class="entry" valign="top">
<p>
After the disjunctive query has been formed, this parameter controls the
number of terms that must match. The syntax is the same as the
<a class="link" href="query-dsl-minimum-should-match.html" title="Minimum Should Match">minimum should match</a>. (Defaults to <code class="literal">"30%"</code>).
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">percent_terms_to_match</code>
</p>
</td><td class="entry" valign="top">
<p>
<span class="deprecated">
      [<span class="version">1.5.0</span>]
      <span class="detail">Deprecated in 1.5.0.
Replaced by <code class="literal">minimum_should_match</code>
</span></span>
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">boost_terms</code>
</p>
</td><td class="entry" valign="top">
<p>
Each term in the formed query could be further boosted by their tf-idf score.
This sets the boost factor to use when using this feature. Defaults to
deactivated (<code class="literal">0</code>). Any other positive value activates terms boosting with the
given boost factor.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">include</code>
</p>
</td><td class="entry" valign="top">
<p>
Specifies whether the input documents should also be included in the search
results returned. Defaults to <code class="literal">false</code>.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">boost</code>
</p>
</td><td class="entry" valign="top">
<p>
Sets the boost value of the whole query. Defaults to <code class="literal">1.0</code>.
</p>
</td></tr></tbody></table></div></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-match-all-query.html">
              «&nbsp;
              Match All Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-nested-query.html">Nested Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Nested Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-mlt-query.html">
              «&nbsp;
              More Like This Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-prefix-query.html">Prefix Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-nested-query"></a>Nested Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/nested-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Nested query allows to query nested objects / docs (see
<a class="link" href="mapping-nested-type.html" title="Nested Type">nested mapping</a>). The
query is executed against the nested objects / docs as if they were
indexed as separate docs (they are, internally) and resulting in the
root parent doc (or parent nested mapping). Here is a sample mapping we
will work with:</p><div class="pre_wrapper"><pre class="programlisting">{
    "type1" : {
        "properties" : {
            "obj1" : {
                "type" : "nested"
            }
        }
    }
}</pre></div><p>And here is a sample nested query usage:</p><div class="pre_wrapper"><pre class="programlisting">{
    "nested" : {
        "path" : "obj1",
        "score_mode" : "avg",
        "query" : {
            "bool" : {
                "must" : [
                    {
                        "match" : {"obj1.name" : "blue"}
                    },
                    {
                        "range" : {"obj1.count" : {"gt" : 5}}
                    }
                ]
            }
        }
    }
}</pre></div><p>The query <code class="literal">path</code> points to the nested object path, and the <code class="literal">query</code> (or
<code class="literal">filter</code>) includes the query that will run on the nested docs matching
the direct path, and joining with the root parent docs. Note that any
fields referenced inside the query must use the complete path (fully
qualified).</p><p>The <code class="literal">score_mode</code> allows to set how inner children matching affects
scoring of parent. It defaults to <code class="literal">avg</code>, but can be <code class="literal">sum</code>, <code class="literal">max</code> and
<code class="literal">none</code>.</p><p>Multi level nesting is automatically supported, and detected, resulting
in an inner nested query to automatically match the relevant nesting
level (and not root) if it exists within another nested query.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-mlt-query.html">
              «&nbsp;
              More Like This Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-prefix-query.html">Prefix Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Prefix Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-nested-query.html">
              «&nbsp;
              Nested Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-query-string-query.html">Query String Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-prefix-query"></a>Prefix Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/prefix-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Matches documents that have fields containing terms with a specified
prefix (<span class="strong emphasis"><strong>not analyzed</strong></span>). The prefix query maps to Lucene <code class="literal">PrefixQuery</code>.
The following matches documents where the user field contains a term
that starts with <code class="literal">ki</code>:</p><div class="pre_wrapper"><pre class="programlisting">{
    "prefix" : { "user" : "ki" }
}</pre></div><p>A boost can also be associated with the query:</p><div class="pre_wrapper"><pre class="programlisting">{
    "prefix" : { "user" :  { "value" : "ki", "boost" : 2.0 } }
}</pre></div><p>Or :</p><div class="pre_wrapper"><pre class="programlisting">{
    "prefix" : { "user" :  { "prefix" : "ki", "boost" : 2.0 } }
}</pre></div><p>This multi term query allows you to control how it gets rewritten using the
<a class="link" href="query-dsl-multi-term-rewrite.html" title="Multi Term Query Rewrite">rewrite</a>
parameter.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-nested-query.html">
              «&nbsp;
              Nested Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-query-string-query.html">Query String Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Query String Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-prefix-query.html">
              «&nbsp;
              Prefix Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-simple-query-string-query.html">Simple Query String Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-query-string-query"></a>Query String Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/query-string-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A query that uses a query parser in order to parse its content. Here is
an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query_string" : {
        "default_field" : "content",
        "query" : "this AND that OR thus"
    }
}</pre></div><p>The <code class="literal">query_string</code> top level parameters include:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th class="entry" align="left" valign="top">Parameter </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">query</code></p></td><td class="entry" align="left" valign="top"><p>The actual query to be parsed. See <a class="xref" href="query-dsl-query-string-query.html#query-string-syntax" title="Query string syntax">Query string syntax</a>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">default_field</code></p></td><td class="entry" align="left" valign="top"><p>The default field for query terms if no prefix field
is specified. Defaults to the <code class="literal">index.query.default_field</code> index
settings, which in turn defaults to <code class="literal">_all</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">default_operator</code></p></td><td class="entry" align="left" valign="top"><p>The default operator used if no explicit operator
is specified. For example, with a default operator of <code class="literal">OR</code>, the query
<code class="literal">capital of Hungary</code> is translated to <code class="literal">capital OR of OR Hungary</code>, and
with default operator of <code class="literal">AND</code>, the same query is translated to
<code class="literal">capital AND of AND Hungary</code>. The default value is <code class="literal">OR</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td class="entry" align="left" valign="top"><p>The analyzer name used to analyze the query string.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">allow_leading_wildcard</code></p></td><td class="entry" align="left" valign="top"><p>When set, <code class="literal">*</code> or <code class="literal">?</code> are allowed as the first
character. Defaults to <code class="literal">true</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">lowercase_expanded_terms</code></p></td><td class="entry" align="left" valign="top"><p>Whether terms of wildcard, prefix, fuzzy,
and range queries are to be automatically lower-cased or not (since they
are not analyzed). Default it <code class="literal">true</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">enable_position_increments</code></p></td><td class="entry" align="left" valign="top"><p>Set to <code class="literal">true</code> to enable position
increments in result queries. Defaults to <code class="literal">true</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">fuzzy_max_expansions</code></p></td><td class="entry" align="left" valign="top"><p>Controls the number of terms fuzzy queries will
expand to. Defaults to <code class="literal">50</code></p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">fuzziness</code></p></td><td class="entry" align="left" valign="top"><p>Set the fuzziness for fuzzy queries. Defaults
to <code class="literal">AUTO</code>. See  <a class="xref" href="common-options.html#fuzziness" title="Fuzzinessedit">the section called “Fuzziness</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>” for allowed settings.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">fuzzy_prefix_length</code></p></td><td class="entry" align="left" valign="top"><p>Set the prefix length for fuzzy queries. Default
is <code class="literal">0</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">phrase_slop</code></p></td><td class="entry" align="left" valign="top"><p>Sets the default slop for phrases. If zero, then exact
phrase matches are required. Default value is <code class="literal">0</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">boost</code></p></td><td class="entry" align="left" valign="top"><p>Sets the boost value of the query. Defaults to <code class="literal">1.0</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">analyze_wildcard</code></p></td><td class="entry" align="left" valign="top"><p>By default, wildcards terms in a query string are
not analyzed. By setting this value to <code class="literal">true</code>, a best effort will be
made to analyze those as well.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">auto_generate_phrase_queries</code></p></td><td class="entry" align="left" valign="top"><p>Defaults to <code class="literal">false</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">max_determinized_states</code></p></td><td class="entry" align="left" valign="top"><p>Limit on how many automaton states regexp
queries are allowed to create.  This protects against too-difficult
(e.g. exponentially hard) regexps.  Defaults to 10000.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">minimum_should_match</code></p></td><td class="entry" align="left" valign="top"><p>A value controlling how many "should" clauses
in the resulting boolean query should match. It can be an absolute value
(<code class="literal">2</code>), a percentage (<code class="literal">30%</code>) or a
<a class="link" href="query-dsl-minimum-should-match.html" title="Minimum Should Match">combination of both</a>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">lenient</code></p></td><td class="entry" align="left" valign="top"><p>If set to <code class="literal">true</code> will cause format based failures (like
providing text to a numeric field) to be ignored.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">locale</code></p></td><td class="entry" align="left" valign="top"><p>Locale that should be used for string conversions.
Defaults to <code class="literal">ROOT</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">time_zone</code></p></td><td class="entry" align="left" valign="top"><p>Time Zone to be applied to any range query related to dates. See also
<a class="ulink" href="http://www.joda.org/joda-time/apidocs/org/joda/time/DateTimeZone.html" target="_top">JODA timezone</a>.</p></td></tr></tbody></table></div><p>When a multi term query is being generated, one can control how it gets
rewritten using the
<a class="link" href="query-dsl-multi-term-rewrite.html" title="Multi Term Query Rewrite">rewrite</a>
parameter.</p><h4><a id="_default_field"></a>Default Field<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/query-string-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>When not explicitly specifying the field to search on in the query
string syntax, the <code class="literal">index.query.default_field</code> will be used to derive
which field to search on. It defaults to <code class="literal">_all</code> field.</p><p>So, if <code class="literal">_all</code> field is disabled, it might make sense to change it to set
a different default field.</p><h4><a id="_multi_field_2"></a>Multi Field<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/query-string-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">query_string</code> query can also run against multiple fields. Fields can be
provided via the <code class="literal">"fields"</code> parameter (example below).</p><p>The idea of running the <code class="literal">query_string</code> query against multiple fields is to
expand each query term to an OR clause like this:</p><pre class="literallayout">field1:query_term OR field2:query_term | ...</pre><p>For example, the following query</p><div class="pre_wrapper"><pre class="programlisting">{
    "query_string" : {
        "fields" : ["content", "name"],
        "query" : "this AND that"
    }
}</pre></div><p>matches the same words as</p><div class="pre_wrapper"><pre class="programlisting">{
    "query_string": {
      "query": "(content:this OR name:this) AND (content:that OR name:that)"
    }
}</pre></div><p>Since several queries are generated from the individual search terms,
combining them can be automatically done using either a <code class="literal">dis_max</code> query or a
simple <code class="literal">bool</code> query. For example (the <code class="literal">name</code> is boosted by 5 using <code class="literal">^5</code>
notation):</p><div class="pre_wrapper"><pre class="programlisting">{
    "query_string" : {
        "fields" : ["content", "name^5"],
        "query" : "this AND that OR thus",
        "use_dis_max" : true
    }
}</pre></div><p>Simple wildcard can also be used to search "within" specific inner
elements of the document. For example, if we have a <code class="literal">city</code> object with
several fields (or inner object with fields) in it, we can automatically
search on all "city" fields:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query_string" : {
        "fields" : ["city.*"],
        "query" : "this AND that OR thus",
        "use_dis_max" : true
    }
}</pre></div><p>Another option is to provide the wildcard fields search in the query
string itself (properly escaping the <code class="literal">*</code> sign), for example:
<code class="literal">city.\*:something</code>.</p><p>When running the <code class="literal">query_string</code> query against multiple fields, the
following additional parameters are allowed:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th class="entry" align="left" valign="top">Parameter </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">use_dis_max</code></p></td><td class="entry" align="left" valign="top"><p>Should the queries be combined using <code class="literal">dis_max</code> (set it
to <code class="literal">true</code>), or a <code class="literal">bool</code> query (set it to <code class="literal">false</code>). Defaults to <code class="literal">true</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">tie_breaker</code></p></td><td class="entry" align="left" valign="top"><p>When using <code class="literal">dis_max</code>, the disjunction max tie breaker.
Defaults to <code class="literal">0</code>.</p></td></tr></tbody></table></div><p>The fields parameter can also include pattern based field names,
allowing to automatically expand to the relevant fields (dynamically
introduced fields included). For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query_string" : {
        "fields" : ["content", "name.*^5"],
        "query" : "this AND that OR thus",
        "use_dis_max" : true
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="query-string-syntax"></a>Query string syntax<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/query-string-syntax.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>The query string “mini-language” is used by the
<a class="xref" href="query-dsl-query-string-query.html" title="Query String Query">Query String Query</a> and by the
<code class="literal">q</code> query string parameter in the <a class="link" href="search-search.html" title="Search"><code class="literal">search</code> API</a>.</p><p>The query string is parsed into a series of <span class="emphasis"><em>terms</em></span> and <span class="emphasis"><em>operators</em></span>. A
term can be a single word — <code class="literal">quick</code> or <code class="literal">brown</code> — or a phrase, surrounded by
double quotes — <code class="literal">"quick brown"</code> — which searches for all the words in the
phrase, in the same order.</p><p>Operators allow you to customize the search — the available options are
explained below.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_field_names"></a>Field names<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/query-string-syntax.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>As mentioned in <a class="xref" href="query-dsl-query-string-query.html" title="Query String Query">Query String Query</a>, the <code class="literal">default_field</code> is searched for the
search terms, but it is possible to specify other fields in the query syntax:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
where the <code class="literal">status</code> field contains <code class="literal">active</code>
</p><pre class="literallayout">status:active</pre></li><li class="listitem"><p class="simpara">
where the <code class="literal">title</code> field contains <code class="literal">quick</code> or <code class="literal">brown</code>.
  If you omit the OR operator the default operator will be used
</p><pre class="literallayout">title:(quick OR brown)
title:(quick brown)</pre></li><li class="listitem"><p class="simpara">
where the <code class="literal">author</code> field contains the exact phrase <code class="literal">"john smith"</code>
</p><pre class="literallayout">author:"John Smith"</pre></li><li class="listitem"><p class="simpara">
where any of the fields <code class="literal">book.title</code>, <code class="literal">book.content</code> or <code class="literal">book.date</code> contains
  <code class="literal">quick</code> or <code class="literal">brown</code> (note how we need to escape the <code class="literal">*</code> with a backslash):
</p><pre class="literallayout">book.\*:(quick brown)</pre></li><li class="listitem"><p class="simpara">
where the field <code class="literal">title</code> has no value (or is missing):
</p><pre class="literallayout">_missing_:title</pre></li><li class="listitem"><p class="simpara">
where the field <code class="literal">title</code> has any non-null value:
</p><pre class="literallayout">_exists_:title</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_wildcards"></a>Wildcards<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/query-string-syntax.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Wildcard searches can be run on individual terms, using <code class="literal">?</code> to replace
a single character, and <code class="literal">*</code> to replace zero or more characters:</p><pre class="literallayout">qu?ck bro*</pre><p>Be aware that wildcard queries can use an enormous amount of memory and
perform very badly — just think how many terms need to be queried to
match the query string <code class="literal">"a* b* c*"</code>.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Allowing a wildcard at the beginning of a word (eg <code class="literal">"*ing"</code>) is particularly
heavy, because all terms in the index need to be examined, just in case
they match.  Leading wildcards can be disabled by setting
<code class="literal">allow_leading_wildcard</code> to <code class="literal">false</code>.</p></div></div><p>Wildcarded terms are not analyzed by default — they are lowercased
(<code class="literal">lowercase_expanded_terms</code> defaults to <code class="literal">true</code>) but no further analysis
is done, mainly because it is impossible to accurately analyze a word that
is missing some of its letters.  However, by setting <code class="literal">analyze_wildcard</code> to
<code class="literal">true</code>, an attempt will be made to analyze wildcarded words before searching
the term list for matching terms.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_regular_expressions"></a>Regular expressions<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/query-string-syntax.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Regular expression patterns can be embedded in the query string by
wrapping them in forward-slashes (<code class="literal">"/"</code>):</p><pre class="literallayout">name:/joh?n(ath[oa]n)/</pre><p>The supported regular expression syntax is explained in <a class="xref" href="query-dsl-regexp-query.html#regexp-syntax" title="Regular expression syntax">Regular expression syntax</a>.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>The <code class="literal">allow_leading_wildcard</code> parameter does not have any control over
regular expressions.  A query string such as the following would force
Elasticsearch to visit every term in the index:</p><pre class="literallayout">/.*n/</pre><p>Use with caution!</p></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_fuzziness"></a>Fuzziness<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/query-string-syntax.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>We can search for terms that are
similar to, but not exactly like our search terms, using the “fuzzy”
operator:</p><pre class="literallayout">quikc~ brwn~ foks~</pre><p>This uses the
<a class="ulink" href="http://en.wikipedia.org/wiki/Damerau-Levenshtein_distance" target="_top">Damerau-Levenshtein distance</a>
to find all terms with a maximum of
two changes, where a change is the insertion, deletion
or substitution of a single character, or transposition of two adjacent
characters.</p><p>The default <span class="emphasis"><em>edit distance</em></span> is <code class="literal">2</code>, but an edit distance of <code class="literal">1</code> should be
sufficient to catch 80% of all human misspellings. It can be specified as:</p><pre class="literallayout">quikc~1</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_proximity_searches"></a>Proximity searches<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/query-string-syntax.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>While a phrase query (eg <code class="literal">"john smith"</code>) expects all of the terms in exactly
the same order, a proximity query allows the specified words to be further
apart or in a different order.  In the same way that fuzzy queries can
specify a maximum edit distance for characters in a word, a proximity search
allows us to specify a maximum edit distance of words in a phrase:</p><pre class="literallayout">"fox quick"~5</pre><p>The closer the text in a field is to the original order specified in the
query string, the more relevant that document is considered to be. When
compared to the above example query, the phrase <code class="literal">"quick fox"</code> would be
considered more relevant than <code class="literal">"quick brown fox"</code>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_ranges_2"></a>Ranges<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/query-string-syntax.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Ranges can be specified for date, numeric or string fields. Inclusive ranges
are specified with square brackets <code class="literal">[min TO max]</code> and exclusive ranges with
curly brackets <code class="literal">{min TO max}</code>.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
All days in 2012:
</p><pre class="literallayout">date:[2012-01-01 TO 2012-12-31]</pre></li><li class="listitem"><p class="simpara">
Numbers 1..5
</p><pre class="literallayout">count:[1 TO 5]</pre></li><li class="listitem"><p class="simpara">
Tags between <code class="literal">alpha</code> and <code class="literal">omega</code>, excluding <code class="literal">alpha</code> and <code class="literal">omega</code>:
</p><pre class="literallayout">tag:{alpha TO omega}</pre></li><li class="listitem"><p class="simpara">
Numbers from 10 upwards
</p><pre class="literallayout">count:[10 TO *]</pre></li><li class="listitem"><p class="simpara">
Dates before 2012
</p><pre class="literallayout">date:{* TO 2012-01-01}</pre></li></ul></div><p>Curly and square brackets can be combined:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
Numbers from 1 up to but not including 5
</p><pre class="literallayout">count:[1 TO 5}</pre></li></ul></div><p>Ranges with one side unbounded can use the following syntax:</p><pre class="literallayout">age:&gt;10
age:&gt;=10
age:&lt;10
age:&lt;=10</pre><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>To combine an upper and lower bound with the simplified syntax, you
would need to join two clauses with an <code class="literal">AND</code> operator:</p><pre class="literallayout">age:(&gt;=10 AND &lt;20)
age:(+&gt;=10 +&lt;20)</pre></div></div><p>The parsing of ranges in query strings can be complex and error prone. It is
much more reliable to use an explicit <a class="link" href="query-dsl-range-filter.html" title="Range Filter"><code class="literal">range</code> filter</a>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_boosting"></a>Boosting<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/query-string-syntax.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Use the <span class="emphasis"><em>boost</em></span> operator <code class="literal">^</code> to make one term more relevant than another.
For instance, if we want to find all documents about foxes, but we are
especially interested in quick foxes:</p><pre class="literallayout">quick^2 fox</pre><p>The default <code class="literal">boost</code> value is 1, but can be any positive floating point number.
Boosts between 0 and 1 reduce relevance.</p><p>Boosts can also be applied to phrases or to groups:</p><pre class="literallayout">"john smith"^2   (foo bar)^4</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_boolean_operators"></a>Boolean operators<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/query-string-syntax.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>By default, all terms are optional, as long as one term matches.  A search
for <code class="literal">foo bar baz</code> will find any document that contains one or more of
<code class="literal">foo</code> or <code class="literal">bar</code> or <code class="literal">baz</code>.  We have already discussed the <code class="literal">default_operator</code>
above which allows you to force all terms to be required, but there are
also <span class="emphasis"><em>boolean operators</em></span> which can be used in the query string itself
to provide more control.</p><p>The preferred operators are <code class="literal">+</code> (this term <span class="strong emphasis"><strong>must</strong></span> be present) and <code class="literal">-</code>
(this term <span class="strong emphasis"><strong>must not</strong></span> be present). All other terms are optional.
For example, this query:</p><pre class="literallayout">quick brown +fox -news</pre><p>states that:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">fox</code> must be present
</li><li class="listitem">
<code class="literal">news</code> must not be present
</li><li class="listitem">
<code class="literal">quick</code> and <code class="literal">brown</code> are optional — their presence increases the relevance
</li></ul></div><p>The familiar operators <code class="literal">AND</code>, <code class="literal">OR</code> and <code class="literal">NOT</code> (also written <code class="literal">&amp;&amp;</code>, <code class="literal">||</code> and <code class="literal">!</code>)
are also supported.  However, the effects of these operators can be more
complicated than is obvious at first glance.  <code class="literal">NOT</code> takes precedence over
<code class="literal">AND</code>, which takes precedence over <code class="literal">OR</code>.  While the <code class="literal">+</code> and <code class="literal">-</code> only affect
the term to the right of the operator, <code class="literal">AND</code> and <code class="literal">OR</code> can affect the terms to
the left and right.</p><div class="sidebar"><div class="titlepage"></div><p>Rewriting the above query using <code class="literal">AND</code>, <code class="literal">OR</code> and <code class="literal">NOT</code> demonstrates the
complexity:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">quick OR brown AND fox AND NOT news</code>
</span></dt><dd>
This is incorrect, because <code class="literal">brown</code> is now a required term.
</dd><dt><span class="term">
<code class="literal">(quick OR brown) AND fox AND NOT news</code>
</span></dt><dd>
This is incorrect because at least one of <code class="literal">quick</code> or <code class="literal">brown</code> is now required
and the search for those terms would be scored differently from the original
query.
</dd><dt><span class="term">
<code class="literal">((quick AND fox) OR (brown AND fox) OR fox) AND NOT news</code>
</span></dt><dd>
This form now replicates the logic from the original query correctly, but
the relevance scoring bares little resemblance to the original.
</dd></dl></div><p>In contrast, the same query rewritten using the <a class="link" href="query-dsl-match-query.html" title="Match Query"><code class="literal">match</code> query</a>
would look like this:</p><pre class="literallayout">{
    "bool": {
        "must":     { "match": "fox"         },
        "should":   { "match": "quick brown" },
        "must_not": { "match": "news"        }
    }
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_grouping"></a>Grouping<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/query-string-syntax.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>Multiple terms or clauses can be grouped together with parentheses, to form
sub-queries:</p><pre class="literallayout">(quick OR brown) AND fox</pre><p>Groups can be used to target a particular field, or to boost the result
of a sub-query:</p><pre class="literallayout">status:(active OR pending) title:(full text search)^2</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_reserved_characters"></a>Reserved characters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/query-string-syntax.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>If you need to use any of the characters which function as operators in your
query itself (and not as operators), then you should escape them with
a leading backslash. For instance, to search for <code class="literal">(1+1)=2</code>, you would
need to write your query as <code class="literal">\(1\+1\)\=2</code>.</p><p>The reserved characters are:  <code class="literal">+ - = &amp;&amp; || &gt; &lt; ! ( ) { } [ ] ^ " ~ * ? : \ /</code></p><p>Failing to escape these special characters correctly could lead to a syntax
error which prevents your query from running.</p><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Watch this space</strong></p></div></div></div><p>A space may also be a reserved character.  For instance, if you have a
synonym list which converts <code class="literal">"wi fi"</code> to <code class="literal">"wifi"</code>, a <code class="literal">query_string</code> search
for <code class="literal">"wi fi"</code> would fail. The query string parser would interpret your
query as a search for <code class="literal">"wi OR fi"</code>, while the token stored in your
index is actually <code class="literal">"wifi"</code>.  Escaping the space will protect it from
being touched by the query string parser: <code class="literal">"wi\ fi"</code>.</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_empty_query"></a>Empty Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/query-string-syntax.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>If the query string is empty or only contains whitespaces the query will
yield an empty result set.</p></div></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-prefix-query.html">
              «&nbsp;
              Prefix Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-simple-query-string-query.html">Simple Query String Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Simple Query String Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-query-string-query.html">
              «&nbsp;
              Query String Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-range-query.html">Range Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-simple-query-string-query"></a>Simple Query String Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/simple-query-string-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A query that uses the SimpleQueryParser to parse its context. Unlike the
regular <code class="literal">query_string</code> query, the <code class="literal">simple_query_string</code> query will never
throw an exception, and discards invalid parts of the query. Here is
an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "simple_query_string" : {
        "query": "\"fried eggs\" +(eggplant | potato) -frittata",
        "analyzer": "snowball",
        "fields": ["body^5","_all"],
        "default_operator": "and"
    }
}</pre></div><p>The <code class="literal">simple_query_string</code> top level parameters include:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th class="entry" align="left" valign="top">Parameter </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">query</code></p></td><td class="entry" align="left" valign="top"><p>The actual query to be parsed. See below for syntax.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">fields</code></p></td><td class="entry" align="left" valign="top"><p>The fields to perform the parsed query against. Defaults to the
<code class="literal">index.query.default_field</code> index settings, which in turn defaults to <code class="literal">_all</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">default_operator</code></p></td><td class="entry" align="left" valign="top"><p>The default operator used if no explicit operator
is specified. For example, with a default operator of <code class="literal">OR</code>, the query
<code class="literal">capital of Hungary</code> is translated to <code class="literal">capital OR of OR Hungary</code>, and
with default operator of <code class="literal">AND</code>, the same query is translated to
<code class="literal">capital AND of AND Hungary</code>. The default value is <code class="literal">OR</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td class="entry" align="left" valign="top"><p>The analyzer used to analyze each term of the query when
creating composite queries.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">flags</code></p></td><td class="entry" align="left" valign="top"><p>Flags specifying which features of the <code class="literal">simple_query_string</code> to
enable. Defaults to <code class="literal">ALL</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">lowercase_expanded_terms</code></p></td><td class="entry" align="left" valign="top"><p>Whether terms of prefix and fuzzy queries should
be automatically lower-cased or not (since they are not analyzed). Defaults to
<code class="literal">true</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">analyze_wildcard</code></p></td><td class="entry" align="left" valign="top"><p>Whether terms of prefix queries should be automatically
analyzed or not. If <code class="literal">true</code> a best effort will be made to analyze the prefix. However,
some analyzers will be not able to provide a meaningful results
based just on the prefix of a term. Defaults to <code class="literal">false</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">locale</code></p></td><td class="entry" align="left" valign="top"><p>Locale that should be used for string conversions.
Defaults to <code class="literal">ROOT</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">lenient</code></p></td><td class="entry" align="left" valign="top"><p>If set to <code class="literal">true</code> will cause format based failures
(like providing text to a numeric field) to be ignored.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">minimum_should_match</code></p></td><td class="entry" align="left" valign="top"><p>The minimum number of clauses that must match for a
 document to be returned. See the
 <a class="link" href="query-dsl-minimum-should-match.html" title="Minimum Should Match"><code class="literal">minimum_should_match</code></a> documentation for the
 full list of options.</p></td></tr></tbody></table></div><h4><a id="_simple_query_string_syntax"></a>Simple Query String Syntax<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/simple-query-string-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">simple_query_string</code> supports the following special characters:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">+</code> signifies AND operation
</li><li class="listitem">
<code class="literal">|</code> signifies OR operation
</li><li class="listitem">
<code class="literal">-</code> negates a single token
</li><li class="listitem">
<code class="literal">"</code> wraps a number of tokens to signify a phrase for searching
</li><li class="listitem">
<code class="literal">*</code> at the end of a term signifies a prefix query
</li><li class="listitem">
<code class="literal">(</code> and <code class="literal">)</code> signify precedence
</li><li class="listitem">
<code class="literal">~N</code> after a word signifies edit distance (fuzziness)
</li><li class="listitem">
<code class="literal">~N</code> after a phrase signifies slop amount
</li></ul></div><p>In order to search for any of these special characters, they will need to
be escaped with <code class="literal">\</code>.</p><h4><a id="_default_field_2"></a>Default Field<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/simple-query-string-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>When not explicitly specifying the field to search on in the query
string syntax, the <code class="literal">index.query.default_field</code> will be used to derive
which field to search on. It defaults to <code class="literal">_all</code> field.</p><p>So, if <code class="literal">_all</code> field is disabled, it might make sense to change it to set
a different default field.</p><h4><a id="_multi_field_3"></a>Multi Field<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/simple-query-string-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The fields parameter can also include pattern based field names,
allowing to automatically expand to the relevant fields (dynamically
introduced fields included). For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "simple_query_string" : {
        "fields" : ["content", "name.*^5"],
        "query" : "foo bar baz"
    }
}</pre></div><h4><a id="_flags"></a>Flags<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/simple-query-string-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p><code class="literal">simple_query_string</code> support multiple flags to specify which parsing features
should be enabled. It is specified as a <code class="literal">|</code>-delimited string with the
<code class="literal">flags</code> parameter:</p><div class="pre_wrapper"><pre class="programlisting">{
    "simple_query_string" : {
        "query" : "foo | bar + baz*",
        "flags" : "OR|AND|PREFIX"
    }
}</pre></div><p>The available flags are: <code class="literal">ALL</code>, <code class="literal">NONE</code>, <code class="literal">AND</code>, <code class="literal">OR</code>, <code class="literal">NOT</code>, <code class="literal">PREFIX</code>, <code class="literal">PHRASE</code>,
<code class="literal">PRECEDENCE</code>, <code class="literal">ESCAPE</code>, <code class="literal">WHITESPACE</code>, <code class="literal">FUZZY</code>, <code class="literal">NEAR</code>, and <code class="literal">SLOP</code>.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-query-string-query.html">
              «&nbsp;
              Query String Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-range-query.html">Range Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Range Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-simple-query-string-query.html">
              «&nbsp;
              Simple Query String Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-regexp-query.html">Regexp Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-range-query"></a>Range Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/range-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Matches documents with fields that have terms within a certain range.
The type of the Lucene query depends on the field type, for <code class="literal">string</code>
fields, the <code class="literal">TermRangeQuery</code>, while for number/date fields, the query is
a <code class="literal">NumericRangeQuery</code>. The following example returns all documents where
<code class="literal">age</code> is between <code class="literal">10</code> and <code class="literal">20</code>:</p><div class="pre_wrapper"><pre class="programlisting">{
    "range" : {
        "age" : {
            "gte" : 10,
            "lte" : 20,
            "boost" : 2.0
        }
    }
}</pre></div><p>The <code class="literal">range</code> query accepts the following parameters:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">gte</code>
</p>
</td><td class="entry" valign="top">
<p>
Greater-than or equal to
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">gt</code>
</p>
</td><td class="entry" valign="top">
<p>
Greater-than
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">lte</code>
</p>
</td><td class="entry" valign="top">
<p>
Less-than or equal to
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">lt</code>
</p>
</td><td class="entry" valign="top">
<p>
Less-than
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">boost</code>
</p>
</td><td class="entry" valign="top">
<p>
Sets the boost value of the query, defaults to <code class="literal">1.0</code>
</p>
</td></tr></tbody></table></div><h4><a id="_date_options"></a>Date options<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/range-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>When applied on <code class="literal">date</code> fields the <code class="literal">range</code> filter accepts also a <code class="literal">time_zone</code> parameter.
The <code class="literal">time_zone</code> parameter will be applied to your input lower and upper bounds and will
move them to UTC time based date:</p><div class="pre_wrapper"><pre class="programlisting">{
    "range" : {
        "born" : {
            "gte": "2012-01-01",
            "lte": "now",
            "time_zone": "+1:00"
        }
    }
}</pre></div><p>In the above example, <code class="literal">gte</code> will be actually moved to <code class="literal">2011-12-31T23:00:00</code> UTC date.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>if you give a date with a timezone explicitly defined and use the <code class="literal">time_zone</code> parameter, <code class="literal">time_zone</code> will be
ignored. For example, setting <code class="literal">gte</code> to <code class="literal">2012-01-01T00:00:00+01:00</code> with <code class="literal">"time_zone":"+10:00"</code> will still use <code class="literal">+01:00</code> time zone.</p></div></div><p>When applied on <code class="literal">date</code> fields the <code class="literal">range</code> query accepts also a <code class="literal">format</code> parameter.
The <code class="literal">format</code> parameter will help support another date format than the one defined in mapping:</p><div class="pre_wrapper"><pre class="programlisting">{
    "range" : {
        "born" : {
            "gte": "01/01/2012",
            "lte": "2013",
            "format": "dd/MM/yyyy||yyyy"
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-simple-query-string-query.html">
              «&nbsp;
              Simple Query String Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-regexp-query.html">Regexp Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Regexp Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-range-query.html">
              «&nbsp;
              Range Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-span-first-query.html">Span First Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-regexp-query"></a>Regexp Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/regexp-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">regexp</code> query allows you to use regular expression term queries.
See <a class="xref" href="query-dsl-regexp-query.html#regexp-syntax" title="Regular expression syntax">Regular expression syntax</a> for details of the supported regular expression language.
The "term queries" in that first sentence means that Elasticsearch will apply
the regexp to the terms produced by the tokenizer for that field, and not
to the original text of the field.</p><p><span class="strong emphasis"><strong>Note</strong></span>: The performance of a <code class="literal">regexp</code> query heavily depends on the
regular expression chosen. Matching everything like <code class="literal">.*</code> is very slow as
well as using lookaround regular expressions. If possible, you should
try to use a long prefix before your regular expression starts. Wildcard
matchers like <code class="literal">.*?+</code> will mostly lower performance.</p><div class="pre_wrapper"><pre class="programlisting">{
    "regexp":{
        "name.first": "s.*y"
    }
}</pre></div><p>Boosting is also supported</p><div class="pre_wrapper"><pre class="programlisting">{
    "regexp":{
        "name.first":{
            "value":"s.*y",
            "boost":1.2
        }
    }
}</pre></div><p>You can also use special flags</p><div class="pre_wrapper"><pre class="programlisting">{
    "regexp":{
        "name.first": {
            "value": "s.*y",
            "flags" : "INTERSECTION|COMPLEMENT|EMPTY"
        }
    }
}</pre></div><p>Possible flags are <code class="literal">ALL</code> (default), <code class="literal">ANYSTRING</code>, <code class="literal">COMPLEMENT</code>,
<code class="literal">EMPTY</code>, <code class="literal">INTERSECTION</code>, <code class="literal">INTERVAL</code>, or <code class="literal">NONE</code>. Please check the
<a class="ulink" href="http://lucene.apache.org/core/4_9_0/core/org/apache/lucene/util/automaton/RegExp.html" target="_top">Lucene
documentation</a> for their meaning</p><p>Regular expressions are dangerous because it’s easy to accidentally
create an innocuous looking one that requires an exponential number of
internal determinized automaton states (and corresponding RAM and CPU)
for Lucene to execute.  Lucene prevents these using the
<code class="literal">max_determinized_states</code> setting (defaults to 10000).  You can raise
this limit to allow more complex regular expressions to execute.</p><div class="pre_wrapper"><pre class="programlisting">{
    "regexp":{
        "name.first": {
            "value": "s.*y",
            "flags" : "INTERSECTION|COMPLEMENT|EMPTY",
            "max_determinized_states": 20000
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="regexp-syntax"></a>Regular expression syntax<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/regexp-syntax.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Regular expression queries are supported by the <code class="literal">regexp</code> and the <code class="literal">query_string</code>
queries.  The Lucene regular expression engine
is not Perl-compatible but supports a smaller range of operators.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>We will not attempt to explain regular expressions, but
just explain the supported operators.</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_standard_operators"></a>Standard operators<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/regexp-syntax.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Anchoring
</span></dt><dd><p class="simpara">Most regular expression engines allow you to match any part of a string.
If you want the regexp pattern to start at the beginning of the string or
finish at the end of the string, then you have to <span class="emphasis"><em>anchor</em></span> it specifically,
using <code class="literal">^</code> to indicate the beginning or <code class="literal">$</code> to indicate the end.</p><p class="simpara">Lucene’s patterns are always anchored.  The pattern provided must match
the entire string. For string <code class="literal">"abcde"</code>:</p><pre class="literallayout">ab.*     # match
abcd     # no match</pre></dd><dt><span class="term">
Allowed characters
</span></dt><dd><p class="simpara">Any Unicode characters may be used in the pattern, but certain characters
are reserved and must be escaped.  The standard reserved characters are:</p><pre class="literallayout">. ? + * | { } [ ] ( ) " \</pre><p class="simpara">If you enable optional features (see below) then these characters may
also be reserved:</p><pre class="literallayout"># @ &amp; &lt; &gt;  ~</pre><p class="simpara">Any reserved character can be escaped with a backslash <code class="literal">"\*"</code> including
a literal backslash character: <code class="literal">"\\"</code></p><p class="simpara">Additionally, any characters (except double quotes) are interpreted literally
when surrounded by double quotes:</p><pre class="literallayout">john"@smith.com"</pre></dd><dt><span class="term">
Match any character
</span></dt><dd><p class="simpara">The period <code class="literal">"."</code> can be used to represent any character.  For string <code class="literal">"abcde"</code>:</p><pre class="literallayout">ab...   # match
a.c.e   # match</pre></dd><dt><span class="term">
One-or-more
</span></dt><dd><p class="simpara">The plus sign <code class="literal">"+"</code> can be used to repeat the preceding shortest pattern
once or more times. For string <code class="literal">"aaabbb"</code>:</p><pre class="literallayout">a+b+        # match
aa+bb+      # match
a+.+        # match
aa+bbb+     # match</pre></dd><dt><span class="term">
Zero-or-more
</span></dt><dd><p class="simpara">The asterisk <code class="literal">"*"</code> can be used to match the preceding shortest pattern
zero-or-more times.  For string <code class="literal">"aaabbb</code>":</p><pre class="literallayout">a*b*        # match
a*b*c*      # match
.*bbb.*     # match
aaa*bbb*    # match</pre></dd><dt><span class="term">
Zero-or-one
</span></dt><dd><p class="simpara">The question mark <code class="literal">"?"</code> makes the preceding shortest pattern optional. It
matches zero or one times.  For string <code class="literal">"aaabbb"</code>:</p><pre class="literallayout">aaa?bbb?    # match
aaaa?bbbb?  # match
.....?.?    # match
aa?bb?      # no match</pre></dd><dt><span class="term">
Min-to-max
</span></dt><dd><p class="simpara">Curly brackets <code class="literal">"{}"</code> can be used to specify a minimum and (optionally)
a maximum number of times the preceding shortest pattern can repeat.  The
allowed forms are:</p><pre class="literallayout">{5}     # repeat exactly 5 times
{2,5}   # repeat at least twice and at most 5 times
{2,}    # repeat at least twice</pre><p class="simpara">For string <code class="literal">"aaabbb"</code>:</p><pre class="literallayout">a{3}b{3}        # match
a{2,4}b{2,4}    # match
a{2,}b{2,}      # match
.{3}.{3}        # match
a{4}b{4}        # no match
a{4,6}b{4,6}    # no match
a{4,}b{4,}      # no match</pre></dd><dt><span class="term">
Grouping
</span></dt><dd><p class="simpara">Parentheses <code class="literal">"()"</code> can be used to form sub-patterns. The quantity operators
listed above operate on the shortest previous pattern, which can be a group.
For string <code class="literal">"ababab"</code>:</p><pre class="literallayout">(ab)+       # match
ab(ab)+     # match
(..)+       # match
(...)+      # no match
(ab)*       # match
abab(ab)?   # match
ab(ab)?     # no match
(ab){3}     # match
(ab){1,2}   # no match</pre></dd><dt><span class="term">
Alternation
</span></dt><dd><p class="simpara">The pipe symbol <code class="literal">"|"</code> acts as an OR operator. The match will succeed if
the pattern on either the left-hand side OR the right-hand side matches.
The alternation applies to the <span class="emphasis"><em>longest pattern</em></span>, not the shortest.
For string <code class="literal">"aabb"</code>:</p><pre class="literallayout">aabb|bbaa   # match
aacc|bb     # no match
aa(cc|bb)   # match
a+|b+       # no match
a+b+|b+a+   # match
a+(b|c)+    # match</pre></dd><dt><span class="term">
Character classes
</span></dt><dd><p class="simpara">Ranges of potential characters may be represented as character classes
by enclosing them in square brackets <code class="literal">"[]"</code>. A leading <code class="literal">^</code>
negates the character class. The allowed forms are:</p><pre class="literallayout">[abc]   # 'a' or 'b' or 'c'
[a-c]   # 'a' or 'b' or 'c'
[-abc]  # '-' or 'a' or 'b' or 'c'
[abc\-] # '-' or 'a' or 'b' or 'c'
[^abc]  # any character except 'a' or 'b' or 'c'
[^a-c]  # any character except 'a' or 'b' or 'c'
[^-abc]  # any character except '-' or 'a' or 'b' or 'c'
[^abc\-] # any character except '-' or 'a' or 'b' or 'c'</pre><p class="simpara">Note that the dash <code class="literal">"-"</code> indicates a range of characeters, unless it is
the first character or if it is escaped with a backslash.</p><p class="simpara">For string <code class="literal">"abcd"</code>:</p><pre class="literallayout">ab[cd]+     # match
[a-d]+      # match
[^a-d]+     # no match</pre></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="_optional_operators"></a>Optional operators<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/regexp-syntax.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4></div></div></div><p>These operators are available by default as the <code class="literal">flags</code> parameter defaults to <code class="literal">ALL</code>.
Different flag combinations (concatened with <code class="literal">"\"</code>) can be used to enable/disable
specific operators:</p><pre class="literallayout">{
    "regexp": {
        "username": {
            "value": "john~athon&lt;1-5&gt;",
            "flags": "COMPLEMENT|INTERVAL"
        }
    }
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">
Complement
</span></dt><dd><p class="simpara">The complement is probably the most useful option. The shortest pattern that
follows a tilde <code class="literal">"~"</code> is negated.  For the string <code class="literal">"abcdef"</code>:</p><pre class="literallayout">ab~df     # match
ab~cf     # no match
a~(cd)f   # match
a~(bc)f   # no match</pre><p class="simpara">Enabled with the <code class="literal">COMPLEMENT</code> or <code class="literal">ALL</code> flags.</p></dd><dt><span class="term">
Interval
</span></dt><dd><p class="simpara">The interval option enables the use of numeric ranges, enclosed by angle
brackets <code class="literal">"&lt;&gt;"</code>. For string: <code class="literal">"foo80"</code>:</p><pre class="literallayout">foo&lt;1-100&gt;     # match
foo&lt;01-100&gt;    # match
foo&lt;001-100&gt;   # no match</pre><p class="simpara">Enabled with the <code class="literal">INTERVAL</code> or <code class="literal">ALL</code> flags.</p></dd><dt><span class="term">
Intersection
</span></dt><dd><p class="simpara">The ampersand <code class="literal">"&amp;"</code> joins two patterns in a way that both of them have to
match. For string <code class="literal">"aaabbb"</code>:</p><pre class="literallayout">aaa.+&amp;.+bbb     # match
aaa&amp;bbb         # no match</pre><p class="simpara">Using this feature usually means that you should rewrite your regular
expression.</p><p class="simpara">Enabled with the <code class="literal">INTERSECTION</code> or <code class="literal">ALL</code> flags.</p></dd><dt><span class="term">
Any string
</span></dt><dd><p class="simpara">The at sign <code class="literal">"@"</code> matches any string in its entirety.  This could be combined
with the intersection and complement above to express “everything except”.
For instance:</p><pre class="literallayout">@&amp;~(foo.+)      # anything except string beginning with "foo"</pre><p class="simpara">Enabled with the <code class="literal">ANYSTRING</code> or <code class="literal">ALL</code> flags.</p></dd></dl></div></div></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-range-query.html">
              «&nbsp;
              Range Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-span-first-query.html">Span First Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Span First Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-regexp-query.html">
              «&nbsp;
              Regexp Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-span-multi-term-query.html">Span Multi Term Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-span-first-query"></a>Span First Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/span-first-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Matches spans near the beginning of a field. The span first query maps
to Lucene <code class="literal">SpanFirstQuery</code>. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "span_first" : {
        "match" : {
            "span_term" : { "user" : "kimchy" }
        },
        "end" : 3
    }
}</pre></div><p>The <code class="literal">match</code> clause can be any other span type query. The <code class="literal">end</code> controls
the maximum end position permitted in a match.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-regexp-query.html">
              «&nbsp;
              Regexp Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-span-multi-term-query.html">Span Multi Term Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Span Multi Term Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-span-first-query.html">
              «&nbsp;
              Span First Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-span-near-query.html">Span Near Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-span-multi-term-query"></a>Span Multi Term Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/span-multi-term-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">span_multi</code> query allows you to wrap a <code class="literal">multi term query</code> (one of wildcard,
fuzzy, prefix, term, range or regexp query) as a <code class="literal">span query</code>, so
it can be nested. Example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "span_multi":{
        "match":{
            "prefix" : { "user" :  { "value" : "ki" } }
        }
    }
}</pre></div><p>A boost can also be associated with the query:</p><div class="pre_wrapper"><pre class="programlisting">{
    "span_multi":{
        "match":{
            "prefix" : { "user" :  { "value" : "ki", "boost" : 1.08 } }
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-span-first-query.html">
              «&nbsp;
              Span First Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-span-near-query.html">Span Near Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Span Near Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-span-multi-term-query.html">
              «&nbsp;
              Span Multi Term Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-span-not-query.html">Span Not Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-span-near-query"></a>Span Near Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/span-near-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Matches spans which are near one another. One can specify <span class="emphasis"><em>slop</em></span>, the
maximum number of intervening unmatched positions, as well as whether
matches are required to be in-order. The span near query maps to Lucene
<code class="literal">SpanNearQuery</code>. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "span_near" : {
        "clauses" : [
            { "span_term" : { "field" : "value1" } },
            { "span_term" : { "field" : "value2" } },
            { "span_term" : { "field" : "value3" } }
        ],
        "slop" : 12,
        "in_order" : false,
        "collect_payloads" : false
    }
}</pre></div><p>The <code class="literal">clauses</code> element is a list of one or more other span type queries
and the <code class="literal">slop</code> controls the maximum number of intervening unmatched
positions permitted.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-span-multi-term-query.html">
              «&nbsp;
              Span Multi Term Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-span-not-query.html">Span Not Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Span Not Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-span-near-query.html">
              «&nbsp;
              Span Near Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-span-or-query.html">Span Or Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-span-not-query"></a>Span Not Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/span-not-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Removes matches which overlap with another span query. The span not
query maps to Lucene <code class="literal">SpanNotQuery</code>. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "span_not" : {
        "include" : {
            "span_term" : { "field1" : "hoya" }
        },
        "exclude" : {
            "span_near" : {
                "clauses" : [
                    { "span_term" : { "field1" : "la" } },
                    { "span_term" : { "field1" : "hoya" } }
                ],
                "slop" : 0,
                "in_order" : true
            }
        }
    }
}</pre></div><p>The <code class="literal">include</code> and <code class="literal">exclude</code> clauses can be any span type query. The
<code class="literal">include</code> clause is the span query whose matches are filtered, and the
<code class="literal">exclude</code> clause is the span query whose matches must not overlap those
returned.</p><p>In the above example all documents with the term hoya are filtered except the ones that have <span class="emphasis"><em>la</em></span> preceding them.</p><p>Other top level options:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">pre</code>
</p>
</td><td class="entry" valign="top">
<p>
If set the amount of tokens before the include span can’t have overlap with the exclude span.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">post</code>
</p>
</td><td class="entry" valign="top">
<p>
If set the amount of tokens after the include span can’t have overlap with the exclude span.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">dist</code>
</p>
</td><td class="entry" valign="top">
<p>
If set the amount of tokens from within the include span can’t have overlap with the exclude span. Equivalent
            of setting both <code class="literal">pre</code> and <code class="literal">post</code>.
</p>
</td></tr></tbody></table></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-span-near-query.html">
              «&nbsp;
              Span Near Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-span-or-query.html">Span Or Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Span Or Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-span-not-query.html">
              «&nbsp;
              Span Not Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-span-term-query.html">Span Term Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-span-or-query"></a>Span Or Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/span-or-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Matches the union of its span clauses. The span or query maps to Lucene
<code class="literal">SpanOrQuery</code>. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "span_or" : {
        "clauses" : [
            { "span_term" : { "field" : "value1" } },
            { "span_term" : { "field" : "value2" } },
            { "span_term" : { "field" : "value3" } }
        ]
    }
}</pre></div><p>The <code class="literal">clauses</code> element is a list of one or more other span type queries.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-span-not-query.html">
              «&nbsp;
              Span Not Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-span-term-query.html">Span Term Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Span Term Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-span-or-query.html">
              «&nbsp;
              Span Or Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-term-query.html">Term Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-span-term-query"></a>Span Term Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/span-term-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Matches spans containing a term. The span term query maps to Lucene
<code class="literal">SpanTermQuery</code>. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "span_term" : { "user" : "kimchy" }
}</pre></div><p>A boost can also be associated with the query:</p><div class="pre_wrapper"><pre class="programlisting">{
    "span_term" : { "user" : { "value" : "kimchy", "boost" : 2.0 } }
}</pre></div><p>Or :</p><div class="pre_wrapper"><pre class="programlisting">{
    "span_term" : { "user" : { "term" : "kimchy", "boost" : 2.0 } }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-span-or-query.html">
              «&nbsp;
              Span Or Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-term-query.html">Term Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Term Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-span-term-query.html">
              «&nbsp;
              Span Term Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-terms-query.html">Terms Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-term-query"></a>Term Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/term-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">term</code> query finds documents that contain the <span class="strong emphasis"><strong>exact</strong></span> term specified
in the inverted index.  For instance:</p><div class="pre_wrapper"><pre class="programlisting">{
    "term" : { "user" : "Kimchy" } <a id="CO67-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO67-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Finds documents which contain the exact term <code class="literal">Kimchy</code> in the inverted index
    of the <code class="literal">user</code> field.
</p></td></tr></tbody></table></div><p>A <code class="literal">boost</code> parameter can be specified to give this <code class="literal">term</code> query a higher
relevance score than another query, for instance:</p><div class="pre_wrapper"><pre class="programlisting">GET /_search
{
  "query": {
    "bool": {
      "should": [
        {
          "term": {
            "status": {
              "value": "urgent",
              "boost": 2.0 <a id="CO68-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
            }
          }
        },
        {
          "term": {
            "status": "normal" <a id="CO68-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
          }
        }
      ]
    }
  }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO68-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">urgent</code> query clause has a boost of <code class="literal">2.0</code>, meaning it is twice as important
    as the query clause for <code class="literal">normal</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO68-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">normal</code> clause has the default neutral boost of <code class="literal">1.0</code>.
</p></td></tr></tbody></table></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>Why doesn’t the <code class="literal">term</code> query match my document?</strong></p></div></div></div><p>String fields can be <code class="literal">analyzed</code> (treated as full text, like the body of an
email), or <code class="literal">not_analyzed</code> (treated as exact values, like an email address or a
zip code).  Exact values (like numbers, dates, and <code class="literal">not_analyzed</code> strings) have
the exact value specified in the field added to the inverted index in order
to make them searchable.</p><p>By default, however, <code class="literal">string</code> fields are <code class="literal">analyzed</code>. This means that their
values are first passed through an <a class="link" href="analysis.html" title="Analysis">analyzer</a> to produce a list of
terms, which are then added to the inverted index.</p><p>There are many ways to analyze text: the default
<a class="link" href="analysis-standard-analyzer.html" title="Standard Analyzer"><code class="literal">standard</code> analyzer</a> drops most punctuation,
breaks up text into individual words, and lower cases them.    For instance,
the <code class="literal">standard</code> analyzer would turn the string “Quick Brown Fox!” into the
terms [<code class="literal">quick</code>, <code class="literal">brown</code>, <code class="literal">fox</code>].</p><p>This analysis process makes it possible to search for individual words
within a big block of full text.</p><p>The <code class="literal">term</code> query looks for the <span class="strong emphasis"><strong>exact</strong></span> term in the field’s inverted index — it doesn’t know anything about the field’s analyzer.  This makes it useful for
looking up values in <code class="literal">not_analyzed</code> string fields, or in numeric or date
fields.  When querying full text fields, use the
<a class="link" href="query-dsl-match-query.html" title="Match Query"><code class="literal">match</code> query</a> instead, which understands how the field
has been analyzed.</p><p>To demonstrate, try out the example below.  First, create an index, specifying the field mappings, and index a document:</p><div class="pre_wrapper"><pre class="programlisting">PUT my_index
{
  "mappings": {
    "my_type": {
      "properties": {
        "full_text": {
          "type":  "string" <a id="CO69-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
        },
        "exact_value": {
          "type":  "string",
          "index": "not_analyzed" <a id="CO69-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
        }
      }
    }
  }
}

PUT my_index/my_type/1
{
  "full_text":   "Quick Foxes!", <a id="CO69-3"></a><span><img src="images/icons/callouts/3.png" alt=""></span>
  "exact_value": "Quick Foxes!"  <a id="CO69-4"></a><span><img src="images/icons/callouts/4.png" alt=""></span>
}</pre></div><div class="sense_widget" data-snippet="snippets/query-dsl-term-query/1.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO69-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">full_text</code> field is <code class="literal">analyzed</code> by default.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO69-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">exact_value</code> field is set to be <code class="literal">not_analyzed</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO69-3"><span><img src="images/icons/callouts/3.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">full_text</code> inverted index will contain the terms: [<code class="literal">quick</code>, <code class="literal">foxes</code>].
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO69-4"><span><img src="images/icons/callouts/4.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">exact_value</code> inverted index will contain the exact term: [<code class="literal">Quick Foxes!</code>].
</p></td></tr></tbody></table></div><p>Now, compare the results for the <code class="literal">term</code> query and the <code class="literal">match</code> query:</p><div class="pre_wrapper"><pre class="programlisting">GET my_index/my_type/_search
{
  "query": {
    "term": {
      "exact_value": "Quick Foxes!" <a id="CO70-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
    }
  }
}

GET my_index/my_type/_search
{
  "query": {
    "term": {
      "full_text": "Quick Foxes!" <a id="CO70-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
    }
  }
}

GET my_index/my_type/_search
{
  "query": {
    "term": {
      "exact_value": "foxes" <a id="CO70-3"></a><span><img src="images/icons/callouts/3.png" alt=""></span>
    }
  }
}

GET my_index/my_type/_search
{
  "query": {
    "match": {
      "full_text": "Quick Foxes!" <a id="CO70-4"></a><span><img src="images/icons/callouts/4.png" alt=""></span>
    }
  }
}</pre></div><div class="sense_widget" data-snippet="snippets/query-dsl-term-query/2.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO70-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
This query matches because the <code class="literal">exact_value</code> field contains the exact
    term <code class="literal">Quick Foxes!</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO70-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
This query does not match, because the <code class="literal">full_text</code> field only contains
    the terms <code class="literal">quick</code> and <code class="literal">foxes</code>. It does not contain the exact term
    <code class="literal">Quick Foxes!</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO70-3"><span><img src="images/icons/callouts/3.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
A <code class="literal">term</code> query for the term <code class="literal">foxes</code> matches the <code class="literal">full_text</code> field.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO70-4"><span><img src="images/icons/callouts/4.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
This <code class="literal">match</code> query on the <code class="literal">full_text</code> field first analyzes the query string,
    then looks for documents containing <code class="literal">quick</code> or <code class="literal">foxes</code> or both.
</p></td></tr></tbody></table></div></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-span-term-query.html">
              «&nbsp;
              Span Term Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-terms-query.html">Terms Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Terms Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-term-query.html">
              «&nbsp;
              Term Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-top-children-query.html">Top Children Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-terms-query"></a>Terms Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/terms-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A query that match on any (configurable) of the provided terms. This is
a simpler syntax query for using a <code class="literal">bool</code> query with several <code class="literal">term</code>
queries in the <code class="literal">should</code> clauses. For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "terms" : {
        "tags" : [ "blue", "pill" ],
        "minimum_should_match" : 1
    }
}</pre></div><p>The <code class="literal">terms</code> query is also aliased with <code class="literal">in</code> as the query name for
simpler usage.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-term-query.html">
              «&nbsp;
              Term Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-top-children-query.html">Top Children Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Top Children Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-terms-query.html">
              «&nbsp;
              Terms Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-wildcard-query.html">Wildcard Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-top-children-query"></a>Top Children Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/top-children-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><h3>Deprecated in 1.6.0. </h3>
 Use the has_child query instead
</div></div><p>The <code class="literal">top_children</code> query runs the child query with an estimated hits
size, and out of the hit docs, aggregates it into parent docs. If there
aren’t enough parent docs matching the requested from/size search
request, then it is run again with a wider (more hits) search.</p><p>The <code class="literal">top_children</code> also provide scoring capabilities, with the ability
to specify <code class="literal">max</code>, <code class="literal">sum</code> or <code class="literal">avg</code> as the score type.</p><p>One downside of using the <code class="literal">top_children</code> is that if there are more child
docs matching the required hits when executing the child query, then the
<code class="literal">total_hits</code> result of the search response will be incorrect.</p><p>How many hits are asked for in the first child query run is controlled
using the <code class="literal">factor</code> parameter (defaults to <code class="literal">5</code>). For example, when asking
for 10 parent docs (with <code class="literal">from</code> set to 0), then the child query will
execute with 50 hits expected. If not enough parents are found (in our
example 10), and there are still more child docs to query, then the
child search hits are expanded by multiplying by the
<code class="literal">incremental_factor</code> (defaults to <code class="literal">2</code>).</p><p>The required parameters are the <code class="literal">query</code> and <code class="literal">type</code> (the child type to
execute the query on). Here is an example with all different parameters,
including the default values:</p><div class="pre_wrapper"><pre class="programlisting">{
    "top_children" : {
        "type": "blog_tag",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        },
        "score" : "max",
        "factor" : 5,
        "incremental_factor" : 2
    }
}</pre></div><h4><a id="_scope_2"></a>Scope<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/top-children-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>A <code class="literal">_scope</code> can be defined on the query allowing to run facets on the
same scope name that will work against the child documents. For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "top_children" : {
        "_scope" : "my_scope",
        "type": "blog_tag",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</pre></div><h4><a id="_memory_considerations_7"></a>Memory Considerations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/top-children-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>In order to support parent-child joins, all of the (string) parent IDs
must be resident in memory (in the <a class="link" href="index-modules-fielddata.html" title="Field data">field data cache</a>.
Additionally, every child document is mapped to its parent using a long
value (approximately). It is advisable to keep the string parent ID short
in order to reduce memory usage.</p><p>You can check how much memory is being used by the ID cache using the
<a class="link" href="indices-stats.html" title="Indices Stats">indices stats</a> or <a class="link" href="cluster-nodes-stats.html" title="Nodes Stats">nodes stats</a>
APIS, eg:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET "http://localhost:9200/_stats/id_cache?pretty&amp;human"</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-terms-query.html">
              «&nbsp;
              Terms Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-wildcard-query.html">Wildcard Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Wildcard Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-top-children-query.html">
              «&nbsp;
              Top Children Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-minimum-should-match.html">Minimum Should Match
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-wildcard-query"></a>Wildcard Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/wildcard-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Matches documents that have fields matching a wildcard expression (<span class="strong emphasis"><strong>not
analyzed</strong></span>). Supported wildcards are <code class="literal">*</code>, which matches any character
sequence (including the empty one), and <code class="literal">?</code>, which matches any single
character. Note this query can be slow, as it needs to iterate over many
terms. In order to prevent extremely slow wildcard queries, a wildcard
term should not start with one of the wildcards <code class="literal">*</code> or <code class="literal">?</code>. The wildcard
query maps to Lucene <code class="literal">WildcardQuery</code>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "wildcard" : { "user" : "ki*y" }
}</pre></div><p>A boost can also be associated with the query:</p><div class="pre_wrapper"><pre class="programlisting">{
    "wildcard" : { "user" : { "value" : "ki*y", "boost" : 2.0 } }
}</pre></div><p>Or :</p><div class="pre_wrapper"><pre class="programlisting">{
    "wildcard" : { "user" : { "wildcard" : "ki*y", "boost" : 2.0 } }
}</pre></div><p>This multi term query allows to control how it gets rewritten using the
<a class="link" href="query-dsl-multi-term-rewrite.html" title="Multi Term Query Rewrite">rewrite</a>
parameter.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-top-children-query.html">
              «&nbsp;
              Top Children Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-minimum-should-match.html">Minimum Should Match
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Minimum Should Match</span></div><div class="navheader"><span class="prev"><a href="query-dsl-wildcard-query.html">
              «&nbsp;
              Wildcard Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-multi-term-rewrite.html">Multi Term Query Rewrite
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-minimum-should-match"></a>Minimum Should Match<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/minimum-should-match.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">minimum_should_match</code> parameter possible values:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th class="entry" align="left" valign="top">Type </th><th class="entry" align="left" valign="top">Example </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p>Integer</p></td><td class="entry" align="left" valign="top"><p><code class="literal">3</code></p></td><td class="entry" align="left" valign="top"><p>Indicates a fixed value regardless of the number of
optional clauses.</p></td></tr><tr><td class="entry" align="left" valign="top"><p>Negative integer</p></td><td class="entry" align="left" valign="top"><p><code class="literal">-2</code></p></td><td class="entry" align="left" valign="top"><p>Indicates that the total number of optional
clauses, minus this number should be mandatory.</p></td></tr><tr><td class="entry" align="left" valign="top"><p>Percentage</p></td><td class="entry" align="left" valign="top"><p><code class="literal">75%</code></p></td><td class="entry" align="left" valign="top"><p>Indicates that this percent of the total number of
optional clauses are necessary. The number computed from the percentage
is rounded down and used as the minimum.</p></td></tr><tr><td class="entry" align="left" valign="top"><p>Negative percentage</p></td><td class="entry" align="left" valign="top"><p><code class="literal">-25%</code></p></td><td class="entry" align="left" valign="top"><p>Indicates that this percent of the total
number of optional clauses can be missing. The number computed from the
percentage is rounded down, before being subtracted from the total to
determine the minimum.</p></td></tr><tr><td class="entry" align="left" valign="top"><p>Combination</p></td><td class="entry" align="left" valign="top"><p><code class="literal">3&lt;90%</code></p></td><td class="entry" align="left" valign="top"><p>A positive integer, followed by the less-than
symbol, followed by any of the previously mentioned specifiers is a
conditional specification. It indicates that if the number of optional
clauses is equal to (or less than) the integer, they are all required,
but if it’s greater than the integer, the specification applies. In this
example: if there are 1 to 3 clauses they are all required, but for 4 or
more clauses only 90% are required.</p></td></tr><tr><td class="entry" align="left" valign="top"><p>Multiple combinations</p></td><td class="entry" align="left" valign="top"><p><code class="literal">2&lt;-25% 9&lt;-3</code></p></td><td class="entry" align="left" valign="top"><p>Multiple conditional
specifications can be separated by spaces, each one only being valid for
numbers greater than the one before it. In this example: if there are 1
or 2 clauses both are required, if there are 3-9 clauses all but 25% are
required, and if there are more than 9 clauses, all but three are
required.</p></td></tr></tbody></table></div><p><span class="strong emphasis"><strong>NOTE:</strong></span></p><p>When dealing with percentages, negative values can be used to get
different behavior in edge cases. 75% and -25% mean the same thing when
dealing with 4 clauses, but when dealing with 5 clauses 75% means 3 are
required, but -25% means 4 are required.</p><p>If the calculations based on the specification determine that no
optional clauses are needed, the usual rules about BooleanQueries still
apply at search time (a BooleanQuery containing no required clauses must
still match at least one optional clause)</p><p>No matter what number the calculation arrives at, a value greater than
the number of optional clauses, or a value less than 1 will never be
used. (ie: no matter how low or how high the result of the calculation
result is, the minimum number of required matches will never be lower
than 1 or greater than the number of clauses.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-wildcard-query.html">
              «&nbsp;
              Wildcard Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-multi-term-rewrite.html">Multi Term Query Rewrite
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Multi Term Query Rewrite</span></div><div class="navheader"><span class="prev"><a href="query-dsl-minimum-should-match.html">
              «&nbsp;
              Minimum Should Match</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-template-query.html">Template Query
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-multi-term-rewrite"></a>Multi Term Query Rewrite<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/multi-term-rewrite.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Multi term queries, like
<a class="link" href="query-dsl-wildcard-query.html" title="Wildcard Query">wildcard</a> and
<a class="link" href="query-dsl-prefix-query.html" title="Prefix Query">prefix</a> are called
multi term queries and end up going through a process of rewrite. This
also happens on the
<a class="link" href="query-dsl-query-string-query.html" title="Query String Query">query_string</a>.
All of those queries allow to control how they will get rewritten using
the <code class="literal">rewrite</code> parameter:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
When not set, or set to <code class="literal">constant_score_auto</code>, defaults to
automatically choosing either <code class="literal">constant_score_boolean</code> or
<code class="literal">constant_score_filter</code> based on query characteristics.
</li><li class="listitem">
<code class="literal">scoring_boolean</code>: A rewrite method that first translates each term
into a should clause in a boolean query, and keeps the scores as
computed by the query. Note that typically such scores are meaningless
to the user, and require non-trivial CPU to compute, so it’s almost
always better to use <code class="literal">constant_score_auto</code>. This rewrite method will hit
too many clauses failure if it exceeds the boolean query limit (defaults
to <code class="literal">1024</code>).
</li><li class="listitem">
<code class="literal">constant_score_boolean</code>: Similar to <code class="literal">scoring_boolean</code> except scores
are not computed. Instead, each matching document receives a constant
score equal to the query’s boost. This rewrite method will hit too many
clauses failure if it exceeds the boolean query limit (defaults to
<code class="literal">1024</code>).
</li><li class="listitem">
<code class="literal">constant_score_filter</code>: A rewrite method that first creates a private
Filter by visiting each term in sequence and marking all docs for that
term. Matching documents are assigned a constant score equal to the
query’s boost.
</li><li class="listitem">
<code class="literal">top_terms_N</code>: A rewrite method that first translates each term into
should clause in boolean query, and keeps the scores as computed by the
query. This rewrite method only uses the top scoring terms so it will
not overflow boolean max clause count. The <code class="literal">N</code> controls the size of the
top scoring terms to use.
</li><li class="listitem">
<code class="literal">top_terms_boost_N</code>: A rewrite method that first translates each term
into should clause in boolean query, but the scores are only computed as
the boost. This rewrite method only uses the top scoring terms so it
will not overflow the boolean max clause count. The <code class="literal">N</code> controls the
size of the top scoring terms to use.
</li></ul></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-minimum-should-match.html">
              «&nbsp;
              Minimum Should Match</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-template-query.html">Template Query
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-queries.html">Queries</a></span> » <span class="breadcrumb-node">Template Query</span></div><div class="navheader"><span class="prev"><a href="query-dsl-multi-term-rewrite.html">
              «&nbsp;
              Multi Term Query Rewrite</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-filters.html">Filters
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-template-query"></a>Template Query<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/template-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A query that accepts a query template and a map of key/value pairs to fill in
template parameters. Templating is based on Mustache. For simple token substitution all you provide
is a query containing some variable that you want to substitute and the actual
values:</p><div class="pre_wrapper"><pre class="programlisting">GET /_search
{
    "query": {
        "template": {
            "query": { "match": { "text": "{{query_string}}" }},
            "params" : {
                "query_string" : "all about search"
            }
        }
    }
}</pre></div><p>The above request is translated into:</p><div class="pre_wrapper"><pre class="programlisting">GET /_search
{
    "query": {
        "match": {
            "text": "all about search"
        }
    }
}</pre></div><p>Alternatively passing the template as an escaped string works as well:</p><div class="pre_wrapper"><pre class="programlisting">GET /_search
{
    "query": {
        "template": {
            "query": "{ \"match\": { \"text\": \"{{query_string}}\" }}", <a id="CO71-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
            "params" : {
                "query_string" : "all about search"
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO71-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
New line characters (<code class="literal">\n</code>) should be escaped as <code class="literal">\\n</code> or removed,
    and quotes (<code class="literal">"</code>) should be escaped as <code class="literal">\\"</code>.
</p></td></tr></tbody></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_stored_templates"></a>Stored templates<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/queries/template-query.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>You can register a template by storing it in the <code class="literal">config/scripts</code> directory, in a file using the <code class="literal">.mustache</code> extension.
In order to execute the stored template, reference it by name in the <code class="literal">file</code>
parameter:</p><div class="pre_wrapper"><pre class="programlisting">GET /_search
{
    "query": {
        "template": {
            "file": "my_template", <a id="CO72-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
            "params" : {
                "query_string" : "all about search"
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO72-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Name of the the query template in <code class="literal">config/scripts/</code>, i.e., <code class="literal">my_template.mustache</code>.
</p></td></tr></tbody></table></div><p>Alternatively, you can register a query template in the special <code class="literal">.scripts</code> index with:</p><div class="pre_wrapper"><pre class="programlisting">PUT /_search/template/my_template
{
    "template": { "match": { "text": "{{query_string}}" }},
}</pre></div><p>and refer to it in the <code class="literal">template</code> query with the <code class="literal">id</code> parameter:</p><div class="pre_wrapper"><pre class="programlisting">GET /_search
{
    "query": {
        "template": {
            "id": "my_template", <a id="CO73-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
            "params" : {
                "query_string" : "all about search"
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO73-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Name of the the query template in <code class="literal">config/scripts/</code>, i.e., <code class="literal">storedTemplate.mustache</code>.
</p></td></tr></tbody></table></div><p>There is also a dedicated <code class="literal">template</code> endpoint, allows you to template an entire search request.
Please see <a class="xref" href="search-template.html" title="Search Template"><em>Search Template</em></a> for more details.</p></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-multi-term-rewrite.html">
              «&nbsp;
              Multi Term Query Rewrite</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-filters.html">Filters
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-node">Filters</span></div><div class="navheader"><span class="prev"><a href="query-dsl-template-query.html">
              «&nbsp;
              Template Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-and-filter.html">And Filter
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-filters"></a>Filters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>As a general rule, filters should be used instead of queries:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
for binary yes/no searches
</li><li class="listitem">
for queries on exact values
</li></ul></div><h3><a id="caching"></a>Filters and Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Filters can be a great candidate for caching. Caching the result of a
filter does not require a lot of memory, and will cause other queries
executing against the same filter (same parameters) to be blazingly
fast.</p><p>Some filters already produce a result that is easily cacheable, and the
difference between caching and not caching them is the act of placing
the result in the cache or not. These filters, which include the
<a class="link" href="query-dsl-term-filter.html" title="Term Filter">term</a>,
<a class="link" href="query-dsl-terms-filter.html" title="Terms Filter">terms</a>,
<a class="link" href="query-dsl-prefix-filter.html" title="Prefix Filter">prefix</a>, and
<a class="link" href="query-dsl-range-filter.html" title="Range Filter">range</a> filters, are by
default cached and are recommended to use (compared to the equivalent
query version) when the same filter (same parameters) will be used
across multiple different queries (for example, a range filter with age
higher than 10).</p><p>Other filters, usually already working with the field data loaded into
memory, are not cached by default. Those filters are already very fast,
and the process of caching them requires extra processing in order to
allow the filter result to be used with different queries than the one
executed. These filters, including the geo,
and <a class="link" href="query-dsl-script-filter.html" title="Script Filter">script</a> filters
are not cached by default.</p><p>The last type of filters are those working with other filters. The
<a class="link" href="query-dsl-and-filter.html" title="And Filter">and</a>,
<a class="link" href="query-dsl-not-filter.html" title="Not Filter">not</a> and
<a class="link" href="query-dsl-or-filter.html" title="Or Filter">or</a> filters are not
cached as they basically just manipulate the internal filters.</p><p>All filters allow to set <code class="literal">_cache</code> element on them to explicitly control
caching. They also allow to set <code class="literal">_cache_key</code> which will be used as the
caching key for that filter. This can be handy when using very large
filters (like a terms filter with many elements in it).</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-template-query.html">
              «&nbsp;
              Template Query</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-and-filter.html">And Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">And Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-filters.html">
              «&nbsp;
              Filters</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-bool-filter.html">Bool Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-and-filter"></a>And Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/and-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A filter that matches documents using the <code class="literal">AND</code> boolean operator on other
filters. Can be placed within queries that accept a filter.</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "and" : [
                {
                    "range" : {
                        "postDate" : {
                            "from" : "2010-03-01",
                            "to" : "2010-04-01"
                        }
                    }
                },
                {
                    "prefix" : { "name.second" : "ba" }
                }
            ]
        }
    }
}</pre></div><h4><a id="_caching"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/and-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The result of the filter is not cached by default. The <code class="literal">_cache</code> can be
set to <code class="literal">true</code> in order to cache it (though usually not needed). Since
the <code class="literal">_cache</code> element requires to be set on the <code class="literal">and</code> filter itself, the
structure then changes a bit to have the filters provided within a
<code class="literal">filters</code> element:</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "and" : {
                "filters": [
                    {
                        "range" : {
                            "postDate" : {
                                "from" : "2010-03-01",
                                "to" : "2010-04-01"
                            }
                        }
                    },
                    {
                        "prefix" : { "name.second" : "ba" }
                    }
                ],
                "_cache" : true
            }
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-filters.html">
              «&nbsp;
              Filters</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-bool-filter.html">Bool Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Bool Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-and-filter.html">
              «&nbsp;
              And Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-exists-filter.html">Exists Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-bool-filter"></a>Bool Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/bool-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A filter that matches documents matching boolean combinations of other
queries. Similar in concept to
<a class="link" href="query-dsl-bool-query.html" title="Bool Query">Boolean query</a>, except
that the clauses are other filters. Can be placed within queries that
accept a filter.</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "query_string" : {
                "default_field" : "message",
                "query" : "elasticsearch"
            }
        },
        "filter" : {
            "bool" : {
                "must" : {
                    "term" : { "tag" : "wow" }
                },
                "must_not" : {
                    "range" : {
                        "age" : { "gte" : 10, "lt" : 20 }
                    }
                },
                "should" : [
                    {
                        "term" : { "tag" : "sometag" }
                    },
                    {
                        "term" : { "tag" : "sometagtag" }
                    }
                ]
            }
        }
    }
}</pre></div><h4><a id="_caching_2"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/bool-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The result of the <code class="literal">bool</code> filter is not cached by default (though
internal filters might be). The <code class="literal">_cache</code> can be set to <code class="literal">true</code> in order
to enable caching.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-and-filter.html">
              «&nbsp;
              And Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-exists-filter.html">Exists Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Exists Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-bool-filter.html">
              «&nbsp;
              Bool Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-geo-bounding-box-filter.html">Geo Bounding Box Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-exists-filter"></a>Exists Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/exists-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Returns documents that have at least one non-<code class="literal">null</code> value in the original field:</p><div class="pre_wrapper"><pre class="programlisting">{
    "constant_score" : {
        "filter" : {
            "exists" : { "field" : "user" }
        }
    }
}</pre></div><p>For instance, these documents would all match the above filter:</p><div class="pre_wrapper"><pre class="programlisting">{ "user": "jane" }
{ "user": "" } <a id="CO74-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
{ "user": "-" } <a id="CO74-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
{ "user": ["jane"] }
{ "user": ["jane", null ] } <a id="CO74-3"></a><span><img src="images/icons/callouts/3.png" alt=""></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO74-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
An empty string is a non-<code class="literal">null</code> value.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO74-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Even though the <code class="literal">standard</code> analyzer would emit zero tokens, the original field is non-<code class="literal">null</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO74-3"><span><img src="images/icons/callouts/3.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
At least one non-<code class="literal">null</code> value is required.
</p></td></tr></tbody></table></div><p>These documents would <span class="strong emphasis"><strong>not</strong></span> match the above filter:</p><div class="pre_wrapper"><pre class="programlisting">{ "user": null }
{ "user": [] } <a id="CO75-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
{ "user": [null] } <a id="CO75-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
{ "foo":  "bar" } <a id="CO75-3"></a><span><img src="images/icons/callouts/3.png" alt=""></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO75-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
This field has no values.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO75-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
At least one non-<code class="literal">null</code> value is required.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO75-3"><span><img src="images/icons/callouts/3.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">user</code> field is missing completely.
</p></td></tr></tbody></table></div><h4><a id="_literal_null_value_literal_mapping"></a><code class="literal">null_value</code> mapping<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/exists-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>If the field mapping includes the <code class="literal">null_value</code> setting (see <a class="xref" href="mapping-core-types.html" title="Core Types">Core Types</a>)
then explicit <code class="literal">null</code> values are replaced with the specified <code class="literal">null_value</code>.  For
instance, if the <code class="literal">user</code> field were mapped as follows:</p><div class="pre_wrapper"><pre class="programlisting">  "user": {
    "type": "string",
    "null_value": "_null_"
  }</pre></div><p>then explicit <code class="literal">null</code> values would be indexed as the string <code class="literal">_null_</code>, and the
following docs would match the <code class="literal">exists</code> filter:</p><div class="pre_wrapper"><pre class="programlisting">{ "user": null }
{ "user": [null] }</pre></div><p>However, these docs—without explicit <code class="literal">null</code> values—would still have
no values in the <code class="literal">user</code> field and thus would not match the <code class="literal">exists</code> filter:</p><div class="pre_wrapper"><pre class="programlisting">{ "user": [] }
{ "foo": "bar" }</pre></div><h4><a id="_caching_3"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/exists-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The result of the filter is always cached.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-bool-filter.html">
              «&nbsp;
              Bool Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-geo-bounding-box-filter.html">Geo Bounding Box Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Geo Bounding Box Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-exists-filter.html">
              «&nbsp;
              Exists Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-geo-distance-filter.html">Geo Distance Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-geo-bounding-box-filter"></a>Geo Bounding Box Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-bounding-box-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A filter allowing to filter hits based on a point location using a
bounding box. Assuming the following indexed document:</p><div class="pre_wrapper"><pre class="programlisting">{
    "pin" : {
        "location" : {
            "lat" : 40.12,
            "lon" : -71.34
        }
    }
}</pre></div><p>Then the following simple query can be executed with a
<code class="literal">geo_bounding_box</code> filter:</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top_left" : {
                        "lat" : 40.73,
                        "lon" : -74.1
                    },
                    "bottom_right" : {
                        "lat" : 40.01,
                        "lon" : -71.12
                    }
                }
            }
        }
    }
}</pre></div><h4><a id="_accepted_formats_2"></a>Accepted Formats<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-bounding-box-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>In much the same way the geo_point type can accept different
representation of the geo point, the filter can accept it as well:</p><h5><a id="_lat_lon_as_properties_3"></a>Lat Lon As Properties<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-bounding-box-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top_left" : {
                        "lat" : 40.73,
                        "lon" : -74.1
                    },
                    "bottom_right" : {
                        "lat" : 40.01,
                        "lon" : -71.12
                    }
                }
            }
        }
    }
}</pre></div><h5><a id="_lat_lon_as_array_3"></a>Lat Lon As Array<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-bounding-box-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Format in <code class="literal">[lon, lat]</code>, note, the order of lon/lat here in order to
conform with <a class="ulink" href="http://geojson.org/" target="_top">GeoJSON</a>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top_left" : [-74.1, 40.73],
                    "bottom_right" : [-71.12, 40.01]
                }
            }
        }
    }
}</pre></div><h5><a id="_lat_lon_as_string_3"></a>Lat Lon As String<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-bounding-box-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Format in <code class="literal">lat,lon</code>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top_left" : "40.73, -74.1",
                    "bottom_right" : "40.01, -71.12"
                }
            }
        }
    }
}</pre></div><h5><a id="_geohash_3"></a>Geohash<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-bounding-box-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top_left" : "dr5r9ydj2y73",
                    "bottom_right" : "drj7teegpus6"
                }
            }
        }
    }
}</pre></div><h4><a id="_vertices"></a>Vertices<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-bounding-box-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The vertices of the bounding box can either be set by <code class="literal">top_left</code> and
<code class="literal">bottom_right</code> or by <code class="literal">top_right</code> and <code class="literal">bottom_left</code> parameters. More
over the names <code class="literal">topLeft</code>, <code class="literal">bottomRight</code>, <code class="literal">topRight</code> and <code class="literal">bottomLeft</code>
are supported. Instead of setting the values pairwise, one can use
the simple names <code class="literal">top</code>, <code class="literal">left</code>, <code class="literal">bottom</code> and <code class="literal">right</code> to set the
values separately.</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top" : -74.1,
                    "left" : 40.73,
                    "bottom" : -71.12,
                    "right" : 40.01
                }
            }
        }
    }
}</pre></div><h4><a id="_geo_point_type"></a>geo_point Type<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-bounding-box-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The filter <span class="strong emphasis"><strong>requires</strong></span> the <code class="literal">geo_point</code> type to be set on the relevant
field.</p><h4><a id="_multi_location_per_document"></a>Multi Location Per Document<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-bounding-box-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The filter can work with multiple locations / points per document. Once
a single location / point matches the filter, the document will be
included in the filter</p><h4><a id="_type_2"></a>Type<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-bounding-box-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The type of the bounding box execution by default is set to <code class="literal">memory</code>,
which means in memory checks if the doc falls within the bounding box
range. In some cases, an <code class="literal">indexed</code> option will perform faster (but note
that the <code class="literal">geo_point</code> type must have lat and lon indexed in this case).
Note, when using the indexed option, multi locations per document field
are not supported. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_bounding_box" : {
                "pin.location" : {
                    "top_left" : {
                        "lat" : 40.73,
                        "lon" : -74.1
                    },
                    "bottom_right" : {
                        "lat" : 40.10,
                        "lon" : -71.12
                    }
                },
                "type" : "indexed"
            }
        }
    }
}</pre></div><h4><a id="_caching_4"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-bounding-box-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The result of the filter is not cached by default. The <code class="literal">_cache</code> can be
set to <code class="literal">true</code> to cache the <span class="strong emphasis"><strong>result</strong></span> of the filter. This is handy when
the same bounding box parameters are used on several (many) other
queries. Note, the process of caching the first execution is higher when
caching (since it needs to satisfy different queries).</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-exists-filter.html">
              «&nbsp;
              Exists Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-geo-distance-filter.html">Geo Distance Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Geo Distance Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-geo-bounding-box-filter.html">
              «&nbsp;
              Geo Bounding Box Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-geo-distance-range-filter.html">Geo Distance Range Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-geo-distance-filter"></a>Geo Distance Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-distance-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Filters documents that include only hits that exists within a specific
distance from a geo point. Assuming the following indexed json:</p><div class="pre_wrapper"><pre class="programlisting">{
    "pin" : {
        "location" : {
            "lat" : 40.12,
            "lon" : -71.34
        }
    }
}</pre></div><p>Then the following simple query can be executed with a <code class="literal">geo_distance</code>
filter:</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "200km",
                "pin.location" : {
                    "lat" : 40,
                    "lon" : -70
                }
            }
        }
    }
}</pre></div><h4><a id="_accepted_formats_3"></a>Accepted Formats<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-distance-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>In much the same way the <code class="literal">geo_point</code> type can accept different
representation of the geo point, the filter can accept it as well:</p><h5><a id="_lat_lon_as_properties_4"></a>Lat Lon As Properties<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-distance-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "12km",
                "pin.location" : {
                    "lat" : 40,
                    "lon" : -70
                }
            }
        }
    }
}</pre></div><h5><a id="_lat_lon_as_array_4"></a>Lat Lon As Array<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-distance-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Format in <code class="literal">[lon, lat]</code>, note, the order of lon/lat here in order to
conform with <a class="ulink" href="http://geojson.org/" target="_top">GeoJSON</a>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "12km",
                "pin.location" : [-70, 40]
            }
        }
    }
}</pre></div><h5><a id="_lat_lon_as_string_4"></a>Lat Lon As String<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-distance-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Format in <code class="literal">lat,lon</code>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "12km",
                "pin.location" : "40,-70"
            }
        }
    }
}</pre></div><h5><a id="_geohash_4"></a>Geohash<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-distance-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance" : {
                "distance" : "12km",
                "pin.location" : "drm3btev3e86"
            }
        }
    }
}</pre></div><h4><a id="_options_5"></a>Options<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-distance-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The following are options allowed on the filter:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">distance</code>
</p>
</td><td class="entry" valign="top">
<p>
    The radius of the circle centred on the specified location. Points which
    fall into this circle are considered to be matches. The <code class="literal">distance</code> can be
    specified in various units. See <a class="xref" href="common-options.html#distance-units" title="Distance Unitsedit">the section called “Distance Units</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>”.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">distance_type</code>
</p>
</td><td class="entry" valign="top">
<p>
    How to compute the distance. Can either be <code class="literal">sloppy_arc</code> (default), <code class="literal">arc</code> (slightly more precise but significantly slower) or <code class="literal">plane</code> (faster, but inaccurate on long distances and close to the poles).
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">optimize_bbox</code>
</p>
</td><td class="entry" valign="top">
<p>
    Whether to use the optimization of first running a bounding box check
    before the distance check. Defaults to <code class="literal">memory</code> which will do in memory
    checks. Can also have values of <code class="literal">indexed</code> to use indexed value check (make
    sure the <code class="literal">geo_point</code> type index lat lon in this case), or <code class="literal">none</code> which
    disables bounding box optimization.
</p>
</td></tr></tbody></table></div><h4><a id="_geo_point_type_2"></a>geo_point Type<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-distance-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The filter <span class="strong emphasis"><strong>requires</strong></span> the <code class="literal">geo_point</code> type to be set on the relevant
field.</p><h4><a id="_multi_location_per_document_2"></a>Multi Location Per Document<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-distance-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">geo_distance</code> filter can work with multiple locations / points per
document. Once a single location / point matches the filter, the
document will be included in the filter.</p><h4><a id="_caching_5"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-distance-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The result of the filter is not cached by default. The <code class="literal">_cache</code> can be
set to <code class="literal">true</code> to cache the <span class="strong emphasis"><strong>result</strong></span> of the filter. This is handy when
the same point and distance parameters are used on several (many) other
queries. Note, the process of caching the first execution is higher when
caching (since it needs to satisfy different queries).</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-geo-bounding-box-filter.html">
              «&nbsp;
              Geo Bounding Box Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-geo-distance-range-filter.html">Geo Distance Range Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Geo Distance Range Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-geo-distance-filter.html">
              «&nbsp;
              Geo Distance Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-geo-polygon-filter.html">Geo Polygon Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-geo-distance-range-filter"></a>Geo Distance Range Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-distance-range-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Filters documents that exists within a range from a specific point:</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_distance_range" : {
                "from" : "200km",
                "to" : "400km",
                "pin.location" : {
                    "lat" : 40,
                    "lon" : -70
                }
            }
        }
    }
}</pre></div><p>Supports the same point location parameter as the
<a class="link" href="query-dsl-geo-distance-filter.html" title="Geo Distance Filter">geo_distance</a>
filter. And also support the common parameters for range (lt, lte, gt,
gte, from, to, include_upper and include_lower).</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-geo-distance-filter.html">
              «&nbsp;
              Geo Distance Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-geo-polygon-filter.html">Geo Polygon Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Geo Polygon Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-geo-distance-range-filter.html">
              «&nbsp;
              Geo Distance Range Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-geo-shape-filter.html">GeoShape Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-geo-polygon-filter"></a>Geo Polygon Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-polygon-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A filter allowing to include hits that only fall within a polygon of
points. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_polygon" : {
                "person.location" : {
                    "points" : [
                        {"lat" : 40, "lon" : -70},
                        {"lat" : 30, "lon" : -80},
                        {"lat" : 20, "lon" : -90}
                    ]
                }
            }
        }
    }
}</pre></div><h4><a id="_allowed_formats"></a>Allowed Formats<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-polygon-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><h5><a id="_lat_long_as_array"></a>Lat Long as Array<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-polygon-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Format in <code class="literal">[lon, lat]</code>, note, the order of lon/lat here in order to
conform with <a class="ulink" href="http://geojson.org/" target="_top">GeoJSON</a>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_polygon" : {
                "person.location" : {
                    "points" : [
                        [-70, 40],
                        [-80, 30],
                        [-90, 20]
                    ]
                }
            }
        }
    }
}</pre></div><h5><a id="_lat_lon_as_string_5"></a>Lat Lon as String<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-polygon-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Format in <code class="literal">lat,lon</code>.</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_polygon" : {
                "person.location" : {
                    "points" : [
                        "40, -70",
                        "30, -80",
                        "20, -90"
                    ]
                }
            }
        }
    }
}</pre></div><h5><a id="_geohash_5"></a>Geohash<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-polygon-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geo_polygon" : {
                "person.location" : {
                    "points" : [
                        "drn5x1g8cu2y",
                        "30, -80",
                        "20, -90"
                    ]
                }
            }
        }
    }
}</pre></div><h4><a id="_geo_point_type_3"></a>geo_point Type<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-polygon-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The filter <span class="strong emphasis"><strong>requires</strong></span> the
<a class="link" href="mapping-geo-point-type.html" title="Geo Point Type">geo_point</a> type to be
set on the relevant field.</p><h4><a id="_caching_6"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-polygon-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The result of the filter is not cached by default. The <code class="literal">_cache</code> can be
set to <code class="literal">true</code> to cache the <span class="strong emphasis"><strong>result</strong></span> of the filter. This is handy when
the same points parameters are used on several (many) other queries.
Note, the process of caching the first execution is higher when caching
(since it needs to satisfy different queries).</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-geo-distance-range-filter.html">
              «&nbsp;
              Geo Distance Range Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-geo-shape-filter.html">GeoShape Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">GeoShape Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-geo-polygon-filter.html">
              «&nbsp;
              Geo Polygon Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-geohash-cell-filter.html">Geohash Cell Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-geo-shape-filter"></a>GeoShape Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-shape-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Filter documents indexed using the <code class="literal">geo_shape</code> type.</p><p>Requires the <a class="link" href="mapping-geo-shape-type.html" title="Geo Shape Type">geo_shape Mapping</a>.</p><p>You may also use the
<a class="link" href="query-dsl-geo-shape-query.html" title="GeoShape Query">geo_shape Query</a>.</p><p>The <code class="literal">geo_shape</code> Filter uses the same grid square representation as the
geo_shape mapping to find documents that have a shape that intersects
with the query shape. It will also use the same PrefixTree configuration
as defined for the field mapping.</p><h4><a id="_filter_format"></a>Filter Format<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-shape-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The Filter supports two ways of defining the Filter shape, either by
providing a whole shape defintion, or by referencing the name of a shape
pre-indexed in another index. Both formats are defined below with
examples.</p><h5><a id="_provided_shape_definition"></a>Provided Shape Definition<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-shape-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Similar to the <code class="literal">geo_shape</code> type, the <code class="literal">geo_shape</code> Filter uses
<a class="ulink" href="http://www.geojson.org" target="_top">GeoJSON</a> to represent shapes.</p><p>Given a document that looks like this:</p><div class="pre_wrapper"><pre class="programlisting">{
    "name": "Wind &amp; Wetter, Berlin, Germany",
    "location": {
        "type": "Point",
        "coordinates": [13.400544, 52.530286]
    }
}</pre></div><p>The following query will find the point using the Elasticsearch’s
<code class="literal">envelope</code> GeoJSON extension:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query":{
        "filtered": {
            "query": {
                "match_all": {}
            },
            "filter": {
                "geo_shape": {
                    "location": {
                        "shape": {
                            "type": "envelope",
                            "coordinates" : [[13.0, 53.0], [14.0, 52.0]]
                        }
                    }
                }
            }
        }
    }
}</pre></div><h5><a id="_pre_indexed_shape"></a>Pre-Indexed Shape<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-shape-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>The Filter also supports using a shape which has already been indexed in
another index and/or index type. This is particularly useful for when
you have a pre-defined list of shapes which are useful to your
application and you want to reference this using a logical name (for
example <span class="emphasis"><em>New Zealand</em></span>) rather than having to provide their coordinates
each time. In this situation it is only necessary to provide:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<code class="literal">id</code> - The ID of the document that containing the pre-indexed shape.
</li><li class="listitem">
<code class="literal">index</code> - Name of the index where the pre-indexed shape is. Defaults
to <span class="emphasis"><em>shapes</em></span>.
</li><li class="listitem">
<code class="literal">type</code> - Index type where the pre-indexed shape is.
</li><li class="listitem">
<code class="literal">path</code> - The field specified as path containing the pre-indexed shape.
Defaults to <span class="emphasis"><em>shape</em></span>.
</li></ul></div><p>The following is an example of using the Filter with a pre-indexed
shape:</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered": {
        "query": {
            "match_all": {}
        },
        "filter": {
            "geo_shape": {
                "location": {
                    "indexed_shape": {
                        "id": "DEU",
                        "type": "countries",
                        "index": "shapes",
                        "path": "location"
                    }
                }
            }
        }
    }
}</pre></div><h4><a id="_caching_7"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geo-shape-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The result of the Filter is not cached by default. Setting <code class="literal">_cache</code> to
<code class="literal">true</code> will mean the results of the Filter will be cached. Since shapes
can contain 10s-100s of coordinates and any one differing means a new
shape, it may make sense to only using caching when you are sure that
the shapes will remain reasonably static.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-geo-polygon-filter.html">
              «&nbsp;
              Geo Polygon Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-geohash-cell-filter.html">Geohash Cell Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Geohash Cell Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-geo-shape-filter.html">
              «&nbsp;
              GeoShape Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-has-child-filter.html">Has Child Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-geohash-cell-filter"></a>Geohash Cell Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geohash-cell-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">geohash_cell</code> filter provides access to a hierarchy of geohashes.
By defining a geohash cell, only <a class="link" href="mapping-geo-point-type.html" title="Geo Point Type">geopoints</a>
within this cell will match this filter.</p><p>To get this filter work all prefixes of a geohash need to be indexed. In
example a geohash <code class="literal">u30</code> needs to be decomposed into three terms: <code class="literal">u30</code>,
<code class="literal">u3</code> and <code class="literal">u</code>. This decomposition must be enabled in the mapping of the
<a class="link" href="mapping-geo-point-type.html" title="Geo Point Type">geopoint</a> field that’s going to be filtered by
setting the <code class="literal">geohash_prefix</code> option:</p><div class="pre_wrapper"><pre class="programlisting">{
    "mappings" : {
        "location": {
            "properties": {
                "pin": {
                    "type": "geo_point",
                    "geohash": true,
                    "geohash_prefix": true,
                    "geohash_precision": 10
                }
            }
        }
    }
}</pre></div><p>The geohash cell can defined by all formats of <code class="literal">geo_points</code>. If such a cell is
defined by a latitude and longitude pair the size of the cell needs to be
setup. This can be done by the <code class="literal">precision</code> parameter of the filter. This
parameter can be set to an integer value which sets the length of the geohash
prefix. Instead of setting a geohash length directly it is also possible to
define the precision as distance, in example <code class="literal">"precision": "50m"</code>. (See
<a class="xref" href="common-options.html#distance-units" title="Distance Unitsedit">the section called “Distance Units</a><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/api-conventions.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a>”.)</p><p>The <code class="literal">neighbor</code> option of the filter offers the possibility to filter cells
next to the given cell.</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "match_all" : {}
        },
        "filter" : {
            "geohash_cell": {
                "pin": {
                    "lat": 13.4080,
                    "lon": 52.5186
                },
                "precision": 3,
                "neighbors": true
            }
        }
    }
}</pre></div><h4><a id="_caching_8"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/geohash-cell-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The result of the filter is not cached by default. The
<code class="literal">_cache</code> parameter can be set to <code class="literal">true</code> to turn caching on.
By default the filter uses the resulting geohash cells as a cache key.
This can be changed by using the <code class="literal">_cache_key</code> option.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-geo-shape-filter.html">
              «&nbsp;
              GeoShape Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-has-child-filter.html">Has Child Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Has Child Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-geohash-cell-filter.html">
              «&nbsp;
              Geohash Cell Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-has-parent-filter.html">Has Parent Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-has-child-filter"></a>Has Child Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/has-child-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">has_child</code> filter accepts a query and the child type to run
against, and results in parent documents that have child docs matching
the query. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "has_child" : {
        "type" : "blog_tag",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</pre></div><p>The <code class="literal">type</code> is the child type to query against. The parent type to return
is automatically detected based on the mappings.</p><p>The way that the filter is implemented is by first running the child
query, doing the matching up to the parent doc for each document
matched.</p><p>The <code class="literal">has_child</code> filter also accepts a filter instead of a query:</p><div class="pre_wrapper"><pre class="programlisting">{
    "has_child" : {
        "type" : "comment",
        "filter" : {
            "term" : {
                "user" : "john"
            }
        }
    }
}</pre></div><h4><a id="_min_max_children_2"></a>Min/Max Children<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/has-child-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">has_child</code> filter allows you to specify that a minimum and/or maximum
number of children are required to match for the parent doc to be considered
a match:</p><div class="pre_wrapper"><pre class="programlisting">{
    "has_child" : {
        "type" : "comment",
        "min_children": 2, <a id="CO76-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
        "max_children": 10, <a id="CO76-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
        "filter" : {
            "term" : {
                "user" : "john"
            }
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO76-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> <a href="#CO76-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Both <code class="literal">min_children</code> and <code class="literal">max_children</code> are optional.
</p></td></tr></tbody></table></div><p>The execution speed of the <code class="literal">has_child</code> filter is equivalent
to that of the <code class="literal">has_child</code> query when <code class="literal">min_children</code> or <code class="literal">max_children</code>
is specified.</p><h4><a id="_memory_considerations_8"></a>Memory Considerations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/has-child-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>In order to support parent-child joins, all of the (string) parent IDs
must be resident in memory (in the <a class="link" href="index-modules-fielddata.html" title="Field data">field data cache</a>.
Additionally, every child document is mapped to its parent using a long
value (approximately). It is advisable to keep the string parent ID short
in order to reduce memory usage.</p><p>You can check how much memory is being used by the ID cache using the
<a class="link" href="indices-stats.html" title="Indices Stats">indices stats</a> or <a class="link" href="cluster-nodes-stats.html" title="Nodes Stats">nodes stats</a>
APIS, eg:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET "http://localhost:9200/_stats/id_cache?pretty&amp;human"</pre></div><h4><a id="_caching_9"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/has-child-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">has_child</code> filter cannot be cached in the filter cache. The <code class="literal">_cache</code>
and <code class="literal">_cache_key</code> options are a no-op in this filter. Also any filter that
wraps the <code class="literal">has_child</code> filter either directly or indirectly will not be cached.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-geohash-cell-filter.html">
              «&nbsp;
              Geohash Cell Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-has-parent-filter.html">Has Parent Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Has Parent Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-has-child-filter.html">
              «&nbsp;
              Has Child Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-ids-filter.html">Ids Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-has-parent-filter"></a>Has Parent Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/has-parent-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">has_parent</code> filter accepts a query and a parent type. The query is
executed in the parent document space, which is specified by the parent
type. This filter returns child documents which associated parents have
matched. For the rest <code class="literal">has_parent</code> filter has the same options and works
in the same manner as the <code class="literal">has_child</code> filter.</p><h4><a id="_filter_example"></a>Filter example<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/has-parent-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="pre_wrapper"><pre class="programlisting">{
    "has_parent" : {
        "parent_type" : "blog",
        "query" : {
            "term" : {
                "tag" : "something"
            }
        }
    }
}</pre></div><p>The <code class="literal">parent_type</code> field name can also be abbreviated to <code class="literal">type</code>.</p><p>The way that the filter is implemented is by first running the parent
query, doing the matching up to the child doc for each document matched.</p><p>The <code class="literal">has_parent</code> filter also accepts a filter instead of a query:</p><div class="pre_wrapper"><pre class="programlisting">{
    "has_parent" : {
        "type" : "blog",
        "filter" : {
            "term" : {
                "text" : "bonsai three"
            }
        }
    }
}</pre></div><h4><a id="_memory_considerations_9"></a>Memory Considerations<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/has-parent-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>In order to support parent-child joins, all of the (string) parent IDs
must be resident in memory (in the <a class="link" href="index-modules-fielddata.html" title="Field data">field data cache</a>.
Additionally, every child document is mapped to its parent using a long
value (approximately). It is advisable to keep the string parent ID short
in order to reduce memory usage.</p><p>You can check how much memory is being used by the ID cache using the
<a class="link" href="indices-stats.html" title="Indices Stats">indices stats</a> or <a class="link" href="cluster-nodes-stats.html" title="Nodes Stats">nodes stats</a>
APIS, eg:</p><div class="pre_wrapper"><pre class="programlisting">curl -XGET "http://localhost:9200/_stats/id_cache?pretty&amp;human"</pre></div><h4><a id="_caching_10"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/has-parent-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">has_parent</code> filter cannot be cached in the filter cache. The <code class="literal">_cache</code>
and <code class="literal">_cache_key</code> options are a no-op in this filter. Also any filter that
wraps the <code class="literal">has_parent</code> filter either directly or indirectly will not be cached.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-has-child-filter.html">
              «&nbsp;
              Has Child Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-ids-filter.html">Ids Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Ids Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-has-parent-filter.html">
              «&nbsp;
              Has Parent Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-indices-filter.html">Indices Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-ids-filter"></a>Ids Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/ids-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Filters documents that only have the provided ids. Note, this filter
does not require the <a class="link" href="mapping-id-field.html" title="_id">_id</a>
field to be indexed since it works using the
<a class="link" href="mapping-uid-field.html" title="_uid">_uid</a> field.</p><div class="pre_wrapper"><pre class="programlisting">{
    "ids" : {
        "type" : "my_type",
        "values" : ["1", "4", "100"]
    }
}</pre></div><p>The <code class="literal">type</code> is optional and can be omitted, and can also accept an array
of values.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-has-parent-filter.html">
              «&nbsp;
              Has Parent Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-indices-filter.html">Indices Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Indices Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-ids-filter.html">
              «&nbsp;
              Ids Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-limit-filter.html">Limit Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-indices-filter"></a>Indices Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/indices-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">indices</code> filter can be used when executed across multiple indices,
allowing to have a filter that executes only when executed on an index
that matches a specific list of indices, and another filter that executes
when it is executed on an index that does not match the listed indices.</p><div class="pre_wrapper"><pre class="programlisting">{
    "indices" : {
        "indices" : ["index1", "index2"],
        "filter" : {
            "term" : { "tag" : "wow" }
        },
        "no_match_filter" : {
            "term" : { "tag" : "kow" }
        }
    }
}</pre></div><p>You can use the <code class="literal">index</code> field to provide a single index.</p><p><code class="literal">no_match_filter</code> can also have "string" value of <code class="literal">none</code> (to match no
documents), and <code class="literal">all</code> (to match all). Defaults to <code class="literal">all</code>.</p><p><code class="literal">filter</code> is mandatory, as well as <code class="literal">indices</code> (or <code class="literal">index</code>).</p><div class="tip admon"><div class="icon"><img alt="Tip" src="images/icons/tip.png"></div><div class="admon_content"><p>The fields order is important: if the <code class="literal">indices</code> are provided before <code class="literal">filter</code>
or <code class="literal">no_match_filter</code>, the related filters get parsed only against the indices
that they are going to be executed on. This is useful to avoid parsing filters
when it is not necessary and prevent potential mapping errors.</p></div></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-ids-filter.html">
              «&nbsp;
              Ids Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-limit-filter.html">Limit Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Limit Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-indices-filter.html">
              «&nbsp;
              Indices Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-match-all-filter.html">Match All Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-limit-filter"></a>Limit Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/limit-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><h3>Deprecated in 1.6.0. </h3>
 Use terminate_after instead
</div></div><p>A limit filter limits the number of documents (per shard) to execute on.
For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "filter" : {
             "limit" : {"value" : 100}
         },
         "query" : {
            "term" : { "name.first" : "shay" }
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-indices-filter.html">
              «&nbsp;
              Indices Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-match-all-filter.html">Match All Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Match All Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-limit-filter.html">
              «&nbsp;
              Limit Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-missing-filter.html">Missing Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-match-all-filter"></a>Match All Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/match-all-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A filter that matches on all documents:</p><div class="pre_wrapper"><pre class="programlisting">{
    "constant_score" : {
        "filter" : {
            "match_all" : { }
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-limit-filter.html">
              «&nbsp;
              Limit Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-missing-filter.html">Missing Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Missing Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-match-all-filter.html">
              «&nbsp;
              Match All Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-nested-filter.html">Nested Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-missing-filter"></a>Missing Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/missing-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Returns documents that have only <code class="literal">null</code> values or no value in the original field:</p><div class="pre_wrapper"><pre class="programlisting">{
    "constant_score" : {
        "filter" : {
            "missing" : { "field" : "user" }
        }
    }
}</pre></div><p>For instance, the following docs would match the above filter:</p><div class="pre_wrapper"><pre class="programlisting">{ "user": null }
{ "user": [] } <a id="CO77-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
{ "user": [null] } <a id="CO77-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
{ "foo":  "bar" } <a id="CO77-3"></a><span><img src="images/icons/callouts/3.png" alt=""></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO77-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
This field has no values.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO77-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
This field has no non-<code class="literal">null</code> values.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO77-3"><span><img src="images/icons/callouts/3.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The <code class="literal">user</code> field is missing completely.
</p></td></tr></tbody></table></div><p>These documents would <span class="strong emphasis"><strong>not</strong></span> match the above filter:</p><div class="pre_wrapper"><pre class="programlisting">{ "user": "jane" }
{ "user": "" } <a id="CO78-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
{ "user": "-" } <a id="CO78-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
{ "user": ["jane"] }
{ "user": ["jane", null ] } <a id="CO78-3"></a><span><img src="images/icons/callouts/3.png" alt=""></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO78-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
An empty string is a non-<code class="literal">null</code> value.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO78-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Even though the <code class="literal">standard</code> analyzer would emit zero tokens, the original field is non-<code class="literal">null</code>.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO78-3"><span><img src="images/icons/callouts/3.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
This field has one non-<code class="literal">null</code> value.
</p></td></tr></tbody></table></div><h4><a id="_literal_null_value_literal_mapping_2"></a><code class="literal">null_value</code> mapping<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/missing-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>If the field mapping includes a <code class="literal">null_value</code> (see <a class="xref" href="mapping-core-types.html" title="Core Types">Core Types</a>) then explicit <code class="literal">null</code> values
are replaced with the specified <code class="literal">null_value</code>.  For instance, if the <code class="literal">user</code> field were mapped
as follows:</p><div class="pre_wrapper"><pre class="programlisting">  "user": {
    "type": "string",
    "null_value": "_null_"
  }</pre></div><p>then explicit <code class="literal">null</code> values would be indexed as the string <code class="literal">_null_</code>, and the
the following docs would <span class="strong emphasis"><strong>not</strong></span> match the <code class="literal">missing</code> filter:</p><div class="pre_wrapper"><pre class="programlisting">{ "user": null }
{ "user": [null] }</pre></div><p>However, these docs—without explicit <code class="literal">null</code> values—would still have
no values in the <code class="literal">user</code> field and thus would match the <code class="literal">missing</code> filter:</p><div class="pre_wrapper"><pre class="programlisting">{ "user": [] }
{ "foo": "bar" }</pre></div><h5><a id="_literal_existence_literal_and_literal_null_value_literal_parameters"></a><code class="literal">existence</code> and <code class="literal">null_value</code> parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/missing-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>When the field being queried has a <code class="literal">null_value</code> mapping, then the behaviour of
the <code class="literal">missing</code> filter can be altered with the <code class="literal">existence</code> and <code class="literal">null_value</code>
parameters:</p><div class="pre_wrapper"><pre class="programlisting">{
    "constant_score" : {
        "filter" : {
            "missing" : {
                "field" : "user",
                "existence" : true,
                "null_value" : false
            }
        }
    }
}</pre></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">existence</code>
</span></dt><dd><p class="simpara">When the <code class="literal">existence</code> parameter is set to <code class="literal">true</code> (the default), the missing
filter will include documents where the field has <span class="strong emphasis"><strong>no</strong></span> values, ie:</p><div class="pre_wrapper"><pre class="programlisting">{ "user": [] }
{ "foo": "bar" }</pre></div><p class="simpara">When set to <code class="literal">false</code>, these documents will not be included.</p></dd><dt><span class="term">
<code class="literal">null_value</code>
</span></dt><dd><p class="simpara">When the <code class="literal">null_value</code> parameter is set to <code class="literal">true</code>, the missing
filter will include documents where the field contains a <code class="literal">null</code> value, ie:</p><div class="pre_wrapper"><pre class="programlisting">{ "user": null }
{ "user": [null] }
{ "user": ["jane",null] } <a id="CO79-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span></pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO79-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
Matches because the field contains a <code class="literal">null</code> value, even though it also contains a non-<code class="literal">null</code> value.
</p></td></tr></tbody></table></div><p class="simpara">When set to <code class="literal">false</code> (the default), these documents will not be included.</p></dd></dl></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Either <code class="literal">existence</code> or <code class="literal">null_value</code> or both must be set to <code class="literal">true</code>.</p></div></div><h4><a id="_caching_11"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/missing-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The result of the filter is always cached.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-match-all-filter.html">
              «&nbsp;
              Match All Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-nested-filter.html">Nested Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Nested Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-missing-filter.html">
              «&nbsp;
              Missing Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-not-filter.html">Not Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-nested-filter"></a>Nested Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/nested-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A <code class="literal">nested</code> filter works in a similar fashion to the
<a class="link" href="query-dsl-nested-query.html" title="Nested Query">nested</a> query, except it’s
used as a filter. It follows exactly the same structure, but also allows
to cache the results (set <code class="literal">_cache</code> to <code class="literal">true</code>), and have it named (set
the <code class="literal">_name</code> value). For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : { "match_all" : {} },
        "filter" : {
            "nested" : {
                "path" : "obj1",
                "filter" : {
                    "bool" : {
                        "must" : [
                            {
                                "term" : {"obj1.name" : "blue"}
                            },
                            {
                                "range" : {"obj1.count" : {"gt" : 5}}
                            }
                        ]
                    }
                },
                "_cache" : true
            }
        }
    }
}</pre></div><h4><a id="_join_option"></a>Join option<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/nested-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The nested filter also supports a <code class="literal">join</code> option which controls whether to perform the block join or not.
By default, it’s enabled. But when it’s disabled, it emits the hidden nested documents as hits instead of the joined root document.</p><p>This is useful when a <code class="literal">nested</code> filter is used in a facet where nested is enabled, like you can see in the example below:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query" : {
        "nested" : {
            "path" : "offers",
            "query" : {
                "match" : {
                    "offers.color" : "blue"
                }
            }
        }
    },
    "facets" : {
        "size" : {
            "terms" : {
                "field" : "offers.size"
            },
            "facet_filter" : {
                "nested" : {
                    "path" : "offers",
                    "query" : {
                        "match" : {
                            "offers.color" : "blue"
                        }
                    },
                    "join" : false
                }
            },
            "nested" : "offers"
        }
    }
}'</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-missing-filter.html">
              «&nbsp;
              Missing Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-not-filter.html">Not Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Not Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-nested-filter.html">
              «&nbsp;
              Nested Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-or-filter.html">Or Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-not-filter"></a>Not Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/not-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A filter that filters out matched documents using a query. Can be placed
within queries that accept a filter.</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "not" : {
                "range" : {
                    "postDate" : {
                        "from" : "2010-03-01",
                        "to" : "2010-04-01"
                    }
                }
            }
        }
    }
}</pre></div><p>Or, in a longer form with a <code class="literal">filter</code> element:</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "not" : {
                "filter" :  {
                    "range" : {
                        "postDate" : {
                            "from" : "2010-03-01",
                            "to" : "2010-04-01"
                        }
                    }
                }
            }
        }
    }
}</pre></div><h4><a id="_caching_12"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/not-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The result of the filter is not cached by default. The <code class="literal">_cache</code> can be
set to <code class="literal">true</code> in order to cache it (though usually not needed). Here is
an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "not" : {
                "filter" :  {
                    "range" : {
                        "postDate" : {
                            "from" : "2010-03-01",
                            "to" : "2010-04-01"
                        }
                    }
                },
                "_cache" : true
            }
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-nested-filter.html">
              «&nbsp;
              Nested Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-or-filter.html">Or Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Or Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-not-filter.html">
              «&nbsp;
              Not Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-prefix-filter.html">Prefix Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-or-filter"></a>Or Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/or-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A filter that matches documents using the <code class="literal">OR</code> boolean operator on other
filters. Can be placed within queries that accept a filter.</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "or" : [
                {
                    "term" : { "name.second" : "banon" }
                },
                {
                    "term" : { "name.nick" : "kimchy" }
                }
            ]
        }
    }
}</pre></div><h4><a id="_caching_13"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/or-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The result of the filter is not cached by default. The <code class="literal">_cache</code> can be
set to <code class="literal">true</code> in order to cache it (though usually not needed). Since
the <code class="literal">_cache</code> element requires to be set on the <code class="literal">or</code> filter itself, the
structure then changes a bit to have the filters provided within a
<code class="literal">filters</code> element:</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered" : {
        "query" : {
            "term" : { "name.first" : "shay" }
        },
        "filter" : {
            "or" : {
                "filters" : [
                    {
                        "term" : { "name.second" : "banon" }
                    },
                    {
                        "term" : { "name.nick" : "kimchy" }
                    }
                ],
                "_cache" : true
            }
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-not-filter.html">
              «&nbsp;
              Not Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-prefix-filter.html">Prefix Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Prefix Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-or-filter.html">
              «&nbsp;
              Or Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-query-filter.html">Query Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-prefix-filter"></a>Prefix Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/prefix-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Filters documents that have fields containing terms with a specified
prefix (<span class="strong emphasis"><strong>not analyzed</strong></span>). Similar to prefix query, except that it acts as
a filter. Can be placed within queries that accept a filter.</p><div class="pre_wrapper"><pre class="programlisting">{
    "constant_score" : {
        "filter" : {
            "prefix" : { "user" : "ki" }
        }
    }
}</pre></div><h4><a id="_caching_14"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/prefix-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The result of the filter is cached by default. The <code class="literal">_cache</code> can be set
to <code class="literal">false</code> in order not to cache it. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "constant_score" : {
        "filter" : {
            "prefix" : {
                "user" : "ki",
                "_cache" : false
            }
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-or-filter.html">
              «&nbsp;
              Or Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-query-filter.html">Query Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Query Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-prefix-filter.html">
              «&nbsp;
              Prefix Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-range-filter.html">Range Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-query-filter"></a>Query Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/query-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Wraps any query to be used as a filter. Can be placed within queries
that accept a filter.</p><div class="pre_wrapper"><pre class="programlisting">{
    "constantScore" : {
        "filter" : {
            "query" : {
                "query_string" : {
                    "query" : "this AND that OR thus"
                }
            }
        }
    }
}</pre></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Keep in mind that once you wrap a query as a filter, it loses query features like
highlighting and scoring because these are not features supported by filters.</p></div></div><h4><a id="_caching_15"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/query-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The result of the filter is not cached by default. The <code class="literal">_cache</code> can be
set to <code class="literal">true</code> to cache the <span class="strong emphasis"><strong>result</strong></span> of the filter. This is handy when
the same query is used on several (many) other queries. Note, the
process of caching the first execution is higher when not caching (since
it needs to satisfy different queries).</p><p>Setting the <code class="literal">_cache</code> element requires a different format for the
<code class="literal">query</code>:</p><div class="pre_wrapper"><pre class="programlisting">{
    "constantScore" : {
        "filter" : {
            "fquery" : {
                "query" : {
                    "query_string" : {
                        "query" : "this AND that OR thus"
                    }
                },
                "_cache" : true
            }
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-prefix-filter.html">
              «&nbsp;
              Prefix Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-range-filter.html">Range Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Range Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-query-filter.html">
              «&nbsp;
              Query Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-regexp-filter.html">Regexp Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-range-filter"></a>Range Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/range-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Filters documents with fields that have terms within a certain range.
Similar to <a class="link" href="query-dsl-range-query.html" title="Range Query">range query</a>, except that it acts as a filter. Can be placed within queries
that accept a filter.</p><div class="pre_wrapper"><pre class="programlisting">{
    "constant_score" : {
        "filter" : {
            "range" : {
                "age" : {
                    "gte": 10,
                    "lte": 20
                }
            }
        }
    }
}</pre></div><p>The <code class="literal">range</code> filter accepts the following parameters:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">gte</code>
</p>
</td><td class="entry" valign="top">
<p>
Greater-than or equal to
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">gt</code>
</p>
</td><td class="entry" valign="top">
<p>
Greater-than
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">lte</code>
</p>
</td><td class="entry" valign="top">
<p>
Less-than or equal to
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">lt</code>
</p>
</td><td class="entry" valign="top">
<p>
Less-than
</p>
</td></tr></tbody></table></div><h4><a id="_date_options_2"></a>Date options<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/range-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>When applied on <code class="literal">date</code> fields the <code class="literal">range</code> filter accepts also a <code class="literal">time_zone</code> parameter.
The <code class="literal">time_zone</code> parameter will be applied to your input lower and upper bounds and will
move them to UTC time based date:</p><div class="pre_wrapper"><pre class="programlisting">{
    "constant_score": {
        "filter": {
            "range" : {
                "born" : {
                    "gte": "2012-01-01",
                    "lte": "now",
                    "time_zone": "+1:00"
                }
            }
        }
    }
}</pre></div><p>In the above example, <code class="literal">gte</code> will be actually moved to <code class="literal">2011-12-31T23:00:00</code> UTC date.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>if you give a date with a timezone explicitly defined and use the <code class="literal">time_zone</code> parameter, <code class="literal">time_zone</code> will be
ignored. For example, setting <code class="literal">gte</code> to <code class="literal">2012-01-01T00:00:00+01:00</code> with <code class="literal">"time_zone":"+10:00"</code> will still use <code class="literal">+01:00</code> time zone.</p></div></div><p>When applied on <code class="literal">date</code> fields the <code class="literal">range</code> filter accepts also a <code class="literal">format</code> parameter.
The <code class="literal">format</code> parameter will help support another date format than the one defined in mapping:</p><div class="pre_wrapper"><pre class="programlisting">{
    "constant_score": {
        "filter": {
            "range" : {
                "born" : {
                    "gte": "01/01/2012",
                    "lte": "2013",
                    "format": "dd/MM/yyyy||yyyy"
                }
            }
        }
    }
}</pre></div><h4><a id="_execution"></a>Execution<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/range-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">execution</code> option controls how the range filter internally executes. The <code class="literal">execution</code> option accepts the following values:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">index</code>
</p>
</td><td class="entry" valign="top">
<p>
Uses the field’s inverted index in order to determine whether documents fall within the specified range.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">fielddata</code>
</p>
</td><td class="entry" valign="top">
<p>
Uses fielddata in order to determine whether documents fall within the specified range.
</p>
</td></tr></tbody></table></div><p>In general for small ranges the <code class="literal">index</code> execution is faster and for longer ranges the <code class="literal">fielddata</code> execution is faster. Defaults to <code class="literal">index</code>.</p><p>The <code class="literal">fielddata</code> execution, as the name suggests, uses field data and therefore
requires more memory, so make sure you have sufficient memory on your nodes in
order to use this execution mode. It usually makes sense to use it on fields
you’re already aggregating or sorting by.</p><h4><a id="_caching_16"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/range-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The result of the filter is only automatically cached by default if the <code class="literal">execution</code> is set to <code class="literal">index</code>. The
<code class="literal">_cache</code> can be set to <code class="literal">false</code> to turn it off.</p><p>If the <code class="literal">now</code> date math expression is used without rounding then a range filter will never be cached even if <code class="literal">_cache</code> is
set to <code class="literal">true</code>. Also any filter that wraps this filter will never be cached.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-query-filter.html">
              «&nbsp;
              Query Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-regexp-filter.html">Regexp Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Regexp Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-range-filter.html">
              «&nbsp;
              Range Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-script-filter.html">Script Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-regexp-filter"></a>Regexp Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/regexp-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">regexp</code> filter is similar to the
<a class="link" href="query-dsl-regexp-query.html" title="Regexp Query">regexp</a> query, except
that it is cacheable and can speedup performance in case you are reusing
this filter in your queries.</p><p>See <a class="xref" href="query-dsl-regexp-query.html#regexp-syntax" title="Regular expression syntax">Regular expression syntax</a> for details of the supported regular expression language.</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered": {
        "query": {
            "match_all": {}
        },
        "filter": {
            "regexp":{
                "name.first" : "s.*y"
            }
        }
    }
}</pre></div><p>You can also select the cache name and use the same regexp flags in the
filter as in the query.</p><p>Regular expressions are dangerous because it’s easy to accidentally
create an innocuous looking one that requires an exponential number of
internal determinized automaton states (and corresponding RAM and CPU)
for Lucene to execute.  Lucene prevents these using the
<code class="literal">max_determinized_states</code> setting (defaults to 10000).  You can raise
this limit to allow more complex regular expressions to execute.</p><p>You have to enable caching explicitly in order to have the
<code class="literal">regexp</code> filter cached.</p><div class="pre_wrapper"><pre class="programlisting">{
    "filtered": {
        "query": {
            "match_all": {}
        },
        "filter": {
            "regexp":{
                "name.first" : {
                    "value" : "s.*y",
                    "flags" : "INTERSECTION|COMPLEMENT|EMPTY",
                    "max_determinized_states": 20000
                },
                "_name":"test",
                "_cache" : true,
                "_cache_key" : "key"
            }
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-range-filter.html">
              «&nbsp;
              Range Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-script-filter.html">Script Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Script Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-regexp-filter.html">
              «&nbsp;
              Regexp Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-term-filter.html">Term Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-script-filter"></a>Script Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/script-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A filter allowing to define
<a class="link" href="modules-scripting.html" title="Scripting">scripts</a> as filters. For
example:</p><div class="pre_wrapper"><pre class="programlisting">"filtered" : {
    "query" : {
        ...
    },
    "filter" : {
        "script" : {
            "script" : "doc['num1'].value &gt; 1"
        }
    }
}</pre></div><h4><a id="_custom_parameters"></a>Custom Parameters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/script-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Scripts are compiled and cached for faster execution. If the same script
can be used, just with different parameters provider, it is preferable
to use the ability to pass parameters to the script itself, for example:</p><div class="pre_wrapper"><pre class="programlisting">"filtered" : {
    "query" : {
        ...
    },
    "filter" : {
        "script" : {
            "script" : "doc['num1'].value &gt; param1"
            "params" : {
                "param1" : 5
            }
        }
    }
}</pre></div><h4><a id="_caching_17"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/script-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The result of the filter is not cached by default. The <code class="literal">_cache</code> can be
set to <code class="literal">true</code> to cache the <span class="strong emphasis"><strong>result</strong></span> of the filter. This is handy when
the same script and parameters are used on several (many) other queries.
Note, the process of caching the first execution is higher when caching
(since it needs to satisfy different queries).</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-regexp-filter.html">
              «&nbsp;
              Regexp Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-term-filter.html">Term Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Term Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-script-filter.html">
              «&nbsp;
              Script Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-terms-filter.html">Terms Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-term-filter"></a>Term Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/term-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Filters documents that have fields that contain a term (<span class="strong emphasis"><strong>not analyzed</strong></span>).
Similar to <a class="link" href="query-dsl-term-query.html" title="Term Query">term query</a>,
except that it acts as a filter. Can be placed within queries that
accept a filter, for example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "constant_score" : {
        "filter" : {
            "term" : { "user" : "kimchy"}
        }
    }
}</pre></div><h4><a id="_caching_18"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/term-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The result of the filter is automatically cached by default. The
<code class="literal">_cache</code> can be set to <code class="literal">false</code> to turn it off. Here is an example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "constant_score" : {
        "filter" : {
            "term" : {
                "user" : "kimchy",
                "_cache" : false
            }
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-script-filter.html">
              «&nbsp;
              Script Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-terms-filter.html">Terms Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Terms Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-term-filter.html">
              «&nbsp;
              Term Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-type-filter.html">Type Filter
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-terms-filter"></a>Terms Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/terms-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Filters documents that have fields that match any of the provided terms
(<span class="strong emphasis"><strong>not analyzed</strong></span>). For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "constant_score" : {
        "filter" : {
            "terms" : { "user" : ["kimchy", "elasticsearch"]}
        }
    }
}</pre></div><p>The <code class="literal">terms</code> filter is also aliased with <code class="literal">in</code> as the filter name for
simpler usage.</p><h4><a id="_execution_mode"></a>Execution Mode<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/terms-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The way terms filter executes is by iterating over the terms provided
and finding matches docs (loading into a bitset) and caching it.
Sometimes, we want a different execution model that can still be
achieved by building more complex queries in the DSL, but we can support
them in the more compact model that terms filter provides.</p><p>The <code class="literal">execution</code> option now has the following options :</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">plain</code>
</p>
</td><td class="entry" valign="top">
<p>
    The default. Works as today. Iterates over all the terms,
    building a bit set matching it, and filtering. The total filter is
    cached.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">fielddata</code>
</p>
</td><td class="entry" valign="top">
<p>
    Generates a terms filters that uses the fielddata cache to
    compare terms.  This execution mode is great to use when filtering
    on a field that is already loaded into the fielddata cache from
    faceting, sorting, or index warmers.  When filtering on
    a large number of terms, this execution can be considerably faster
    than the other modes.  The total filter is not cached unless
    explicitly configured to do so.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">bool</code>
</p>
</td><td class="entry" valign="top">
<p>
    Generates a term filter (which is cached) for each term, and
    wraps those in a bool filter. The bool filter itself is not cached as it
    can operate very quickly on the cached term filters.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">and</code>
</p>
</td><td class="entry" valign="top">
<p>
    Generates a term filter (which is cached) for each term, and
    wraps those in an and filter. The and filter itself is not cached.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">or</code>
</p>
</td><td class="entry" valign="top">
<p>
    Generates a term filter (which is cached) for each term, and
    wraps those in an or filter. The or filter itself is not cached.
    Generally, the <code class="literal">bool</code> execution mode should be preferred.
</p>
</td></tr></tbody></table></div><p>If you don’t want the generated individual term queries to be cached,
you can use: <code class="literal">bool_nocache</code>, <code class="literal">and_nocache</code> or <code class="literal">or_nocache</code> instead, but
be aware that this will affect performance.</p><p>The "total" terms filter caching can still be explicitly controlled
using the <code class="literal">_cache</code> option. Note the default value for it depends on the
execution value.</p><p>For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "constant_score" : {
        "filter" : {
            "terms" : {
                "user" : ["kimchy", "elasticsearch"],
                "execution" : "bool",
                "_cache": true
            }
        }
    }
}</pre></div><h4><a id="_caching_19"></a>Caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/terms-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The result of the filter is automatically cached by default. The
<code class="literal">_cache</code> can be set to <code class="literal">false</code> to turn it off.</p><h4><a id="_terms_lookup_mechanism"></a>Terms lookup mechanism<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/terms-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>When it’s needed to specify a <code class="literal">terms</code> filter with a lot of terms it can
be beneficial to fetch those term values from a document in an index. A
concrete example would be to filter tweets tweeted by your followers.
Potentially the amount of user ids specified in the terms filter can be
a lot. In this scenario it makes sense to use the terms filter’s terms
lookup mechanism.</p><p>The terms lookup mechanism supports the following options:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">index</code>
</p>
</td><td class="entry" valign="top">
<p>
    The index to fetch the term values from. Defaults to the
    current index.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">type</code>
</p>
</td><td class="entry" valign="top">
<p>
    The type to fetch the term values from.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">id</code>
</p>
</td><td class="entry" valign="top">
<p>
    The id of the document to fetch the term values from.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">path</code>
</p>
</td><td class="entry" valign="top">
<p>
    The field specified as path to fetch the actual values for the
    <code class="literal">terms</code> filter.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">routing</code>
</p>
</td><td class="entry" valign="top">
<p>
    A custom routing value to be used when retrieving the
    external terms doc.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">cache</code>
</p>
</td><td class="entry" valign="top">
<p>
    Whether to cache the filter built from the retrieved document
    (<code class="literal">true</code> - default) or whether to fetch and rebuild the filter on every
    request (<code class="literal">false</code>). See "<a class="link" href="query-dsl-terms-filter.html#query-dsl-terms-filter-lookup-caching" title="Terms lookup cachingedit">Terms lookup caching</a>" below
</p>
</td></tr></tbody></table></div><p>The values for the <code class="literal">terms</code> filter will be fetched from a field in a
document with the specified id in the specified type and index.
Internally a get request is executed to fetch the values from the
specified path. At the moment for this feature to work the <code class="literal">_source</code>
needs to be stored.</p><p>Also, consider using an index with a single shard and fully replicated
across all nodes if the "reference" terms data is not large. The lookup
terms filter will prefer to execute the get request on a local node if
possible, reducing the need for networking.</p><h4><a id="query-dsl-terms-filter-lookup-caching"></a>Terms lookup caching<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/terms-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>There is an additional cache involved, which caches the lookup of the
lookup document to the actual terms. This lookup cache is a LRU cache.
This cache has the following options:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">indices.cache.filter.terms.size</code>
</span></dt><dd>
    The size of the lookup cache. The default is <code class="literal">10mb</code>.
</dd><dt><span class="term">
<code class="literal">indices.cache.filter.terms.expire_after_access</code>
</span></dt><dd>
    The time after the last read an entry should expire. Disabled by default.
</dd><dt><span class="term">
<code class="literal">indices.cache.filter.terms.expire_after_write</code>
</span></dt><dd>
    The time after the last write an entry should expire. Disabled by default.
</dd></dl></div><p>All options for the lookup of the documents cache can only be configured
via the <code class="literal">elasticsearch.yml</code> file.</p><p>When using the terms lookup the <code class="literal">execution</code> option isn’t taken into
account and behaves as if the execution mode was set to <code class="literal">plain</code>.</p><h4><a id="_terms_lookup_twitter_example"></a>Terms lookup twitter example<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/terms-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="pre_wrapper"><pre class="programlisting"># index the information for user with id 2, specifically, its followers
curl -XPUT localhost:9200/users/user/2 -d '{
   "followers" : ["1", "3"]
}'

# index a tweet, from user with id 2
curl -XPUT localhost:9200/tweets/tweet/1 -d '{
   "user" : "2"
}'

# search on all the tweets that match the followers of user 2
curl -XGET localhost:9200/tweets/_search -d '{
  "query" : {
    "filtered" : {
      "filter" : {
        "terms" : {
          "user" : {
            "index" : "users",
            "type" : "user",
            "id" : "2",
            "path" : "followers"
          },
          "_cache_key" : "user_2_friends"
        }
      }
    }
  }
}'</pre></div><p>The above is highly optimized, both in a sense that the list of
followers will not be fetched if the filter is already cached in the
filter cache, and with internal LRU cache for fetching external values
for the terms filter. Also, the entry in the filter cache will not hold
<code class="literal">all</code> the terms reducing the memory required for it.</p><p><code class="literal">_cache_key</code> is recommended to be set, so its simple to clear the cache
associated with it using the clear cache API. For example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPOST 'localhost:9200/tweets/_cache/clear?filter_keys=user_2_friends'</pre></div><p>The structure of the external terms document can also include array of
inner objects, for example:</p><div class="pre_wrapper"><pre class="programlisting">curl -XPUT localhost:9200/users/user/2 -d '{
 "followers" : [
   {
     "id" : "1"
   },
   {
     "id" : "2"
   }
 ]
}'</pre></div><p>In which case, the lookup path will be <code class="literal">followers.id</code>.</p></div><div class="navfooter"><span class="prev"><a href="query-dsl-term-filter.html">
              «&nbsp;
              Term Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="query-dsl-type-filter.html">Type Filter
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="query-dsl.html">Query DSL</a></span> » <span class="breadcrumb-link"><a href="query-dsl-filters.html">Filters</a></span> » <span class="breadcrumb-node">Type Filter</span></div><div class="navheader"><span class="prev"><a href="query-dsl-terms-filter.html">
              «&nbsp;
              Terms Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping.html">Mapping
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="query-dsl-type-filter"></a>Type Filter<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/query-dsl/filters/type-filter.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Filters documents matching the provided document / mapping type. Note,
this filter can work even when the <code class="literal">_type</code> field is not indexed (using
the <a class="link" href="mapping-uid-field.html" title="_uid">_uid</a> field).</p><div class="pre_wrapper"><pre class="programlisting">{
    "type" : {
        "value" : "my_type"
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-terms-filter.html">
              «&nbsp;
              Terms Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping.html">Mapping
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-node">Mapping</span></div><div class="navheader"><span class="prev"><a href="query-dsl-type-filter.html">
              «&nbsp;
              Type Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-fields.html">Fields
              &nbsp;»
            </a></span></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="mapping"></a>Mapping<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h1></div></div></div><div class="partintro"><div></div><p>Mapping is the process of defining how a document should be mapped to
the Search Engine, including its searchable characteristics such as
which fields are searchable and if/how they are tokenized. In
Elasticsearch, an index may store documents of different "mapping
types". Elasticsearch allows one to associate multiple mapping
definitions for each mapping type.</p><p>Explicit mapping is defined on an index/type level. By default, there
isn’t a need to define an explicit mapping, since one is automatically
created and registered when a new type or new field is introduced (with
no performance overhead) and have sensible defaults. Only when the
defaults need to be overridden must a mapping definition be provided.</p><h3><a id="all-mapping-types"></a>Mapping Types<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>Mapping types are a way to divide the documents in an index into logical
groups. Think of it as tables in a database. Though there is separation
between types, it’s not a full separation (all end up as a document
within the same Lucene index).</p><p>Field names with the same name across types are highly recommended to
have the same type and same mapping characteristics (analysis settings
for example). There is an effort to allow to explicitly "choose" which
field to use by using type prefix (<code class="literal">my_type.my_field</code>), but it’s not
complete, and there are places where it will never work (like faceting
on the field).</p><p>In practice though, this restriction is almost never an issue. The field
name usually ends up being a good indication to its "typeness" (e.g.
"first_name" will always be a string). Note also, that this does not
apply to the cross index case.</p><h3><a id="mapping-api"></a>Mapping API<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>To create a mapping, you will need the <a class="link" href="indices-put-mapping.html" title="Put Mapping">Put Mapping API</a>, or you can add multiple mappings when you <a class="link" href="indices-create-index.html" title="Create Index">create an index</a>.</p><h3><a id="mapping-settings"></a>Global Settings<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3><p>The <code class="literal">index.mapping.ignore_malformed</code> global setting can be set on the
index level to allow to ignore malformed content globally across all
mapping types (malformed content example is trying to index a text string
value as a numeric type).</p><p>The <code class="literal">index.mapping.coerce</code> global setting can be set on the
index level to coerce numeric content globally across all
mapping types (The default setting is true and coercions attempted are
to convert strings with numbers into numeric types and also numeric values
with fractions to any integer/short/long values minus the fraction part).
When the permitted conversions fail in their attempts, the value is considered
malformed and the ignore_malformed setting dictates what will happen next.</p></div></div><div class="navfooter"><span class="prev"><a href="query-dsl-type-filter.html">
              «&nbsp;
              Type Filter</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-fields.html">Fields
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-node">Fields</span></div><div class="navheader"><span class="prev"><a href="mapping.html">
              «&nbsp;
              Mapping</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-uid-field.html"><code class="literal">_uid</code>
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-fields"></a>Fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Each mapping has a number of fields associated with it
which can be used to control how the document metadata
(eg <a class="xref" href="mapping-all-field.html" title="_all"><code class="literal">_all</code></a>) is indexed.</p></div><div class="navfooter"><span class="prev"><a href="mapping.html">
              «&nbsp;
              Mapping</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-uid-field.html"><code class="literal">_uid</code>
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-link"><a href="mapping-fields.html">Fields</a></span> » <span class="breadcrumb-node"><code class="literal">_uid</code></span></div><div class="navheader"><span class="prev"><a href="mapping-fields.html">
              «&nbsp;
              Fields</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-id-field.html"><code class="literal">_id</code>
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-uid-field"></a><code class="literal">_uid</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/uid-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Each document indexed is associated with an id and a type, the internal
<code class="literal">_uid</code> field is the unique identifier of a document within an index and
is composed of the type and the id (meaning that different types can
have the same id and still maintain uniqueness).</p><p>The <code class="literal">_uid</code> field is automatically used when <code class="literal">_type</code> is not indexed to
perform type based filtering, and does not require the <code class="literal">_id</code> to be
indexed.</p></div><div class="navfooter"><span class="prev"><a href="mapping-fields.html">
              «&nbsp;
              Fields</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-id-field.html"><code class="literal">_id</code>
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-link"><a href="mapping-fields.html">Fields</a></span> » <span class="breadcrumb-node"><code class="literal">_id</code></span></div><div class="navheader"><span class="prev"><a href="mapping-uid-field.html">
              «&nbsp;
              <code class="literal">_uid</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-type-field.html"><code class="literal">_type</code>
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-id-field"></a><code class="literal">_id</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/id-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Each document indexed is associated with an id and a type. The <code class="literal">_id</code>
field can be used to index just the id, and possible also store it. By
default it is not indexed and not stored (thus, not created).</p><p>Note, even though the <code class="literal">_id</code> is not indexed, all the APIs still work
(since they work with the <code class="literal">_uid</code> field), as well as fetching by ids
using <code class="literal">term</code>, <code class="literal">terms</code> or <code class="literal">prefix</code> queries/filters (including the
specific <code class="literal">ids</code> query/filter).</p><p>The <code class="literal">_id</code> field can be enabled to be indexed, and possibly stored,
using the appropriate mapping attributes:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "_id" : {
            "index" : "not_analyzed",
            "store" : true
        }
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_path"></a>path<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/id-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Deprecated in 1.5.0. </p></div></div><p>The <code class="literal">_id</code> mapping can also be associated with a <code class="literal">path</code> that will be used
to extract the id from a different location in the source document. For
example, having the following mapping:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "_id" : {
            "path" : "post_id"
        }
    }
}</pre></div><p>Will cause <code class="literal">1</code> to be used as the id for:</p><div class="pre_wrapper"><pre class="programlisting">{
    "message" : "You know, for Search",
    "post_id" : "1"
}</pre></div><p>This does require an additional lightweight parsing step while indexing,
in order to extract the id to decide which shard the index operation
will be executed on.</p></div></div><div class="navfooter"><span class="prev"><a href="mapping-uid-field.html">
              «&nbsp;
              <code class="literal">_uid</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-type-field.html"><code class="literal">_type</code>
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-link"><a href="mapping-fields.html">Fields</a></span> » <span class="breadcrumb-node"><code class="literal">_type</code></span></div><div class="navheader"><span class="prev"><a href="mapping-id-field.html">
              «&nbsp;
              <code class="literal">_id</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-source-field.html"><code class="literal">_source</code>
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-type-field"></a><code class="literal">_type</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/type-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Each document indexed is associated with an id and a type. The type,
when indexing, is automatically indexed into a <code class="literal">_type</code> field. By
default, the <code class="literal">_type</code> field is indexed (but <span class="strong emphasis"><strong>not</strong></span> analyzed) and not
stored. This means that the <code class="literal">_type</code> field can be queried.</p><p>The <code class="literal">_type</code> field can be stored as well, for example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "_type" : {"store" : true}
    }
}</pre></div><p>The <code class="literal">_type</code> field can also not be indexed, and all the APIs will still
work except for specific queries (term queries / filters) or faceting
done on the <code class="literal">_type</code> field.</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "_type" : {"index" : "no"}
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="mapping-id-field.html">
              «&nbsp;
              <code class="literal">_id</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-source-field.html"><code class="literal">_source</code>
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-link"><a href="mapping-fields.html">Fields</a></span> » <span class="breadcrumb-node"><code class="literal">_source</code></span></div><div class="navheader"><span class="prev"><a href="mapping-type-field.html">
              «&nbsp;
              <code class="literal">_type</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-all-field.html"><code class="literal">_all</code>
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-source-field"></a><code class="literal">_source</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/source-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">_source</code> field is an automatically generated field that stores the actual
JSON that was used as the indexed document. It is not indexed (searchable),
just stored. When executing "fetch" requests, like <a class="link" href="docs-get.html" title="Get API">get</a> or
<a class="link" href="search-search.html" title="Search">search</a>, the <code class="literal">_source</code> field is returned by default.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_disabling_source"></a>Disabling source<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/source-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Though very handy to have around, the source field does incur storage overhead
within the index. For this reason, it can be disabled as follows:</p><div class="pre_wrapper"><pre class="programlisting">PUT tweets
{
  "mappings": {
    "tweet": {
      "_source": {
        "enabled": false
      }
    }
  }
}</pre></div><div class="sense_widget" data-snippet="snippets/mapping-source-field/1.json"></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><h3>Think before disabling the source field</h3><p>Users often disable the <code class="literal">_source</code> field without thinking about the
consequences, and then live to regret it.  If the <code class="literal">_source</code> field isn’t
available then a number of features are not supported:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
The <a class="link" href="docs-update.html" title="Update API"><code class="literal">update</code> API</a>.
</li><li class="listitem">
On the fly <a class="link" href="search-request-highlighting.html" title="Highlighting">highlighting</a>.
</li><li class="listitem">
The ability to reindex from one Elasticsearch index to another, either
  to change mappings or analysis, or to upgrade an index to a new major
  version.
</li><li class="listitem">
The ability to debug queries or aggregations by viewing the original
  document used at index time.
</li><li class="listitem">
Potentially in the future, the ability to repair index corruption
  automatically.
</li></ul></div></div></div><div class="sidebar"><div class="titlepage"><div><div><p class="title"><strong>The metrics use case</strong></p></div></div></div><p>The <span class="emphasis"><em>metrics</em></span> use case is distinct from other time-based or logging use cases
in that there are many small documents which consist only of numbers, dates,
or keywords.  There are no updates, no highlighting requests, and the data
ages quickly so there is no need to reindex.  Search requests typically use
simple queries to filter the dataset by date or tags, and the results are
returned as aggregations.</p><p>In this case, disabling the <code class="literal">_source</code> field will save space and reduce I/O.
It is also advisable to disable the <a class="link" href="mapping-all-field.html" title="_all"><code class="literal">_all</code> field</a> in the
metrics case.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="include-exclude"></a>Including / Excluding fields from source<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/source-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>An expert-only feature is the ability to prune the contents of the <code class="literal">_source</code>
field after the document has been indexed, but before the <code class="literal">_source</code> field is
stored.  The <code class="literal">includes</code>/<code class="literal">excludes</code> parameters (which also accept wildcards)
can be used as follows:</p><div class="pre_wrapper"><pre class="programlisting">PUT logs
{
  "mappings": {
    "event": {
      "_source": {
        "includes": [
          "*.count",
          "meta.*"
        ],
        "excludes": [
          "meta.description",
          "meta.other.*"
        ]
      }
    }
  }
}

PUT logs/event/1
{
  "requests": {
    "count": 10,
    "foo": "bar" <a id="CO80-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
  },
  "meta": {
    "name": "Some metric",
    "description": "Some metric description", <a id="CO80-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
    "other": {
      "foo": "one", <a id="CO80-3"></a><span><img src="images/icons/callouts/3.png" alt=""></span>
      "baz": "two" <a id="CO80-4"></a><span><img src="images/icons/callouts/4.png" alt=""></span>
    }
  }
}

GET logs/event/_search
{
  "query": {
    "match": {
      "meta.other.foo": "one" <a id="CO80-5"></a><span><img src="images/icons/callouts/5.png" alt=""></span>
    }
  }
}</pre></div><div class="sense_widget" data-snippet="snippets/mapping-source-field/2.json"></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO80-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> <a href="#CO80-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> <a href="#CO80-3"><span><img src="images/icons/callouts/3.png" alt=""></span></a> <a href="#CO80-4"><span><img src="images/icons/callouts/4.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
These fields will be removed from the stored <code class="literal">_source</code> field.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO80-5"><span><img src="images/icons/callouts/5.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
We can still search on this field, even though it is not in the stored <code class="literal">_source</code>.
</p></td></tr></tbody></table></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Removing fields from the <code class="literal">_source</code> has similar downsides to disabling
<code class="literal">_source</code>, especially the fact that you cannot reindex documents from one
Elasticsearch index to another. Consider using
<a class="link" href="search-request-source-filtering.html" title="Source filtering">source filtering</a> or a
<a class="link" href="mapping-transform.html" title="Transform">transform script</a> instead.</p></div></div></div></div><div class="navfooter"><span class="prev"><a href="mapping-type-field.html">
              «&nbsp;
              <code class="literal">_type</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-all-field.html"><code class="literal">_all</code>
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-link"><a href="mapping-fields.html">Fields</a></span> » <span class="breadcrumb-node"><code class="literal">_all</code></span></div><div class="navheader"><span class="prev"><a href="mapping-source-field.html">
              «&nbsp;
              <code class="literal">_source</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-analyzer-field.html"><code class="literal">_analyzer</code>
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-all-field"></a><code class="literal">_all</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/all-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The idea of the <code class="literal">_all</code> field is that it includes the text of one or more
other fields within the document indexed. It can come very handy
especially for search requests, where we want to execute a search query
against the content of a document, without knowing which fields to
search on. This comes at the expense of CPU cycles and index size.</p><p>The <code class="literal">_all</code> fields can be completely disabled. Explicit field mappings and
object mappings can be excluded / included in the <code class="literal">_all</code> field. By
default, it is enabled and all fields are included in it for ease of
use.</p><p>When disabling the <code class="literal">_all</code> field, it is a good practice to set
<code class="literal">index.query.default_field</code> to a different value (for example, if you
have a main "message" field in your data, set it to <code class="literal">message</code>).</p><p>One of the nice features of the <code class="literal">_all</code> field is that it takes into
account specific fields boost levels. Meaning that if a title field is
boosted more than content, the title (part) in the <code class="literal">_all</code> field will
mean more than the content (part) in the <code class="literal">_all</code> field.</p><p>Here is a sample mapping:</p><div class="pre_wrapper"><pre class="programlisting">{
    "person" : {
        "_all" : {"enabled" : true},
        "properties" : {
            "name" : {
                "type" : "object",
                "dynamic" : false,
                "properties" : {
                    "first" : {"type" : "string", "store" : true , "include_in_all" : false},
                    "last" : {"type" : "string", "index" : "not_analyzed"}
                }
            },
            "address" : {
                "type" : "object",
                "include_in_all" : false,
                "properties" : {
                    "first" : {
                        "properties" : {
                            "location" : {"type" : "string", "store" : true}
                        }
                    },
                    "last" : {
                        "properties" : {
                            "location" : {"type" : "string"}
                        }
                    }
                }
            },
            "simple1" : {"type" : "long", "include_in_all" : true},
            "simple2" : {"type" : "long", "include_in_all" : false}
        }
    }
}</pre></div><p>The <code class="literal">_all</code> fields allows for <code class="literal">store</code>, <code class="literal">term_vector</code> and <code class="literal">analyzer</code> (with
specific <code class="literal">index_analyzer</code> and <code class="literal">search_analyzer</code>) to be set.</p><h4><a id="highlighting"></a>Highlighting<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/all-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>For any field to allow
<a class="link" href="search-request-highlighting.html" title="Highlighting">highlighting</a> it has
to be either stored or part of the <code class="literal">_source</code> field. By default the <code class="literal">_all</code>
field does not qualify for either, so highlighting for it does not yield
any data.</p><p>Although it is possible to <code class="literal">store</code> the <code class="literal">_all</code> field, it is basically an
aggregation of all fields, which means more data will be stored, and
highlighting it might produce strange results.</p></div><div class="navfooter"><span class="prev"><a href="mapping-source-field.html">
              «&nbsp;
              <code class="literal">_source</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-analyzer-field.html"><code class="literal">_analyzer</code>
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-link"><a href="mapping-fields.html">Fields</a></span> » <span class="breadcrumb-node"><code class="literal">_analyzer</code></span></div><div class="navheader"><span class="prev"><a href="mapping-all-field.html">
              «&nbsp;
              <code class="literal">_all</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-boost-field.html"><code class="literal">_boost</code>
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-analyzer-field"></a><code class="literal">_analyzer</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/analyzer-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><h3>Deprecated in 1.5.0. </h3>
 Use separate fields with different analyzers
</div></div><p>The <code class="literal">_analyzer</code> mapping allows to use a document field property as the
name of the analyzer that will be used to index the document. The
analyzer will be used for any field that does not explicitly defines an
<code class="literal">analyzer</code> or <code class="literal">index_analyzer</code> when indexing.</p><p>Here is a simple mapping:</p><div class="pre_wrapper"><pre class="programlisting">{
    "type1" : {
        "_analyzer" : {
            "path" : "my_field"
        }
    }
}</pre></div><p>The above will use the value of the <code class="literal">my_field</code> to lookup an analyzer
registered under it. For example, indexing the following doc:</p><div class="pre_wrapper"><pre class="programlisting">{
    "my_field" : "whitespace"
}</pre></div><p>Will cause the <code class="literal">whitespace</code> analyzer to be used as the index analyzer
for all fields without explicit analyzer setting.</p><p>The default path value is <code class="literal">_analyzer</code>, so the analyzer can be driven for
a specific document by setting the <code class="literal">_analyzer</code> field in it. If a custom json
field name is needed, an explicit mapping with a different path should
be set.</p><p>By default, the <code class="literal">_analyzer</code> field is indexed, it can be disabled by
settings <code class="literal">index</code> to <code class="literal">no</code> in the mapping.</p></div><div class="navfooter"><span class="prev"><a href="mapping-all-field.html">
              «&nbsp;
              <code class="literal">_all</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-boost-field.html"><code class="literal">_boost</code>
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-link"><a href="mapping-fields.html">Fields</a></span> » <span class="breadcrumb-node"><code class="literal">_boost</code></span></div><div class="navheader"><span class="prev"><a href="mapping-analyzer-field.html">
              «&nbsp;
              <code class="literal">_analyzer</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-parent-field.html"><code class="literal">_parent</code>
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-boost-field"></a><code class="literal">_boost</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/boost-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><h3>Deprecated in 1.0.0.RC1. </h3>
See Function score instead of boost
</div></div><p>Boosting is the process of enhancing the relevancy of a document or
field. Field level mapping allows to define an explicit boost level on a
specific field. The boost field mapping (applied on the
<a class="link" href="mapping-root-object-type.html" title="Root Object Type">root object</a>) allows
to define a boost field mapping where <span class="strong emphasis"><strong>its content will control the
boost level of the document</strong></span>. For example, consider the following
mapping:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "_boost" : {"name" : "my_boost", "null_value" : 1.0}
    }
}</pre></div><p>The above mapping defines a mapping for a field named <code class="literal">my_boost</code>. If the
<code class="literal">my_boost</code> field exists within the JSON document indexed, its value will
control the boost level of the document indexed. For example, the
following JSON document will be indexed with a boost value of <code class="literal">2.2</code>:</p><div class="pre_wrapper"><pre class="programlisting">{
    "my_boost" : 2.2,
    "message" : "This is a tweet!"
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="function-score-instead-of-boost"></a>Function score instead of boost<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/boost-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Support for document boosting via the <code class="literal">_boost</code> field has been removed
from Lucene and is deprecated in Elasticsearch as of v1.0.0.RC1. The
implementation in Lucene resulted in unpredictable result when
used with multiple fields or multi-value fields.</p><p>Instead, the <a class="xref" href="query-dsl-function-score-query.html" title="Function Score Query">Function Score Query</a> can be used to achieve
the desired functionality by boosting each document by the value in
any field of the document:</p><div class="pre_wrapper"><pre class="programlisting">{
    "query": {
        "function_score": {
            "query": {  <a id="CO81-1"></a><span><img src="images/icons/callouts/1.png" alt=""></span>
                "match": {
                    "title": "your main query"
                }
            },
            "functions": [{
                "field_value_factor": { <a id="CO81-2"></a><span><img src="images/icons/callouts/2.png" alt=""></span>
                    "field": "my_boost_field"
                }
            }],
            "score_mode": "multiply"
        }
    }
}</pre></div><div class="calloutlist"><table border="0" summary="Callout list"><tbody><tr><td width="5%" valign="top" align="left"><p><a href="#CO81-1"><span><img src="images/icons/callouts/1.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
The original query, now wrapped in a <code class="literal">function_score</code> query.
</p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="#CO81-2"><span><img src="images/icons/callouts/2.png" alt=""></span></a> </p></td><td valign="top" align="left"><p class="para">
This function returns the value in <code class="literal">my_boost_field</code>, which is then
    multiplied by the query <code class="literal">_score</code> for each document.
</p></td></tr></tbody></table></div><p>Note, that <code class="literal">field_value_factor</code> is a 1.2.x feature.</p></div></div><div class="navfooter"><span class="prev"><a href="mapping-analyzer-field.html">
              «&nbsp;
              <code class="literal">_analyzer</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-parent-field.html"><code class="literal">_parent</code>
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-link"><a href="mapping-fields.html">Fields</a></span> » <span class="breadcrumb-node"><code class="literal">_parent</code></span></div><div class="navheader"><span class="prev"><a href="mapping-boost-field.html">
              «&nbsp;
              <code class="literal">_boost</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-field-names-field.html"><code class="literal">_field_names</code>
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-parent-field"></a><code class="literal">_parent</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/parent-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The parent field mapping is defined on a child mapping, and points to
the parent type this child relates to. For example, in case of a <code class="literal">blog</code>
type and a <code class="literal">blog_tag</code> type child document, the mapping for <code class="literal">blog_tag</code>
should be:</p><div class="pre_wrapper"><pre class="programlisting">{
    "blog_tag" : {
        "_parent" : {
            "type" : "blog"
        }
    }
}</pre></div><p>The mapping is automatically stored and indexed (meaning it can be
searched on using the <code class="literal">_parent</code> field notation).</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_field_data_loading"></a>Field data loading<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/parent-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h3></div></div></div><p>Contrary to other fields the fielddata loading is not <code class="literal">lazy</code>, but <code class="literal">eager</code>. The reason for this is that when this
field has been enabled it is going to be used in parent/child queries, which heavily relies on field data to perform
efficiently. This can already be observed during indexing after refresh either automatically or manually has been executed.</p></div></div><div class="navfooter"><span class="prev"><a href="mapping-boost-field.html">
              «&nbsp;
              <code class="literal">_boost</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-field-names-field.html"><code class="literal">_field_names</code>
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-link"><a href="mapping-fields.html">Fields</a></span> » <span class="breadcrumb-node"><code class="literal">_field_names</code></span></div><div class="navheader"><span class="prev"><a href="mapping-parent-field.html">
              «&nbsp;
              <code class="literal">_parent</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-routing-field.html"><code class="literal">_routing</code>
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-field-names-field"></a><code class="literal">_field_names</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/field-names-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">_field_names</code> field indexes the field names of a document, which can later
be used to search for documents based on the fields that they contain typically
using the <code class="literal">exists</code> and <code class="literal">missing</code> filters.</p><p><code class="literal">_field_names</code> is indexed by default for indices that have been created after
Elasticsearch 1.3.0.</p></div><div class="navfooter"><span class="prev"><a href="mapping-parent-field.html">
              «&nbsp;
              <code class="literal">_parent</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-routing-field.html"><code class="literal">_routing</code>
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-link"><a href="mapping-fields.html">Fields</a></span> » <span class="breadcrumb-node"><code class="literal">_routing</code></span></div><div class="navheader"><span class="prev"><a href="mapping-field-names-field.html">
              «&nbsp;
              <code class="literal">_field_names</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-index-field.html"><code class="literal">_index</code>
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-routing-field"></a><code class="literal">_routing</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/routing-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The routing field allows to control the <code class="literal">_routing</code> aspect when indexing
data and explicit routing control is required.</p><h4><a id="_store_index"></a>store / index<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/routing-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The first thing the <code class="literal">_routing</code> mapping does is to store the routing
value provided (<code class="literal">store</code> set to <code class="literal">true</code>) and index it (<code class="literal">index</code> set to
<code class="literal">not_analyzed</code>). The reason why the routing is stored by default is so
reindexing data will be possible if the routing value is completely
external and not part of the docs.</p><h4><a id="_required"></a>required<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/routing-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Another aspect of the <code class="literal">_routing</code> mapping is the ability to define it as
required by setting <code class="literal">required</code> to <code class="literal">true</code>. This is very important to set
when using routing features, as it allows different APIs to make use of
it. For example, an index operation will be rejected if no routing value
has been provided (or derived from the doc). A delete operation will be
broadcasted to all shards if no routing value is provided and <code class="literal">_routing</code>
is required.</p><h4><a id="_path_2"></a>path<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/routing-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><p>Deprecated in 1.5.0. </p></div></div><p>The routing value can be provided as an external value when indexing
(and still stored as part of the document, in much the same way
<code class="literal">_source</code> is stored). But, it can also be automatically extracted from
the index doc based on a <code class="literal">path</code>. For example, having the following
mapping:</p><div class="pre_wrapper"><pre class="programlisting">{
    "comment" : {
        "_routing" : {
            "required" : true,
            "path" : "blog.post_id"
        }
    }
}</pre></div><p>Will cause the following doc to be routed based on the <code class="literal">111222</code> value:</p><div class="pre_wrapper"><pre class="programlisting">{
    "text" : "the comment text"
    "blog" : {
        "post_id" : "111222"
    }
}</pre></div><p>Note, using <code class="literal">path</code> without explicit routing value provided required an
additional (though quite fast) parsing phase.</p><h4><a id="_id_uniqueness"></a>id uniqueness<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/routing-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>When indexing documents specifying a custom <code class="literal">_routing</code>, the uniqueness
of the <code class="literal">_id</code> is not guaranteed throughout all the shards that the index
is composed of. In fact, documents with the same <code class="literal">_id</code> might end up in
different shards if indexed with different <code class="literal">_routing</code> values.</p></div><div class="navfooter"><span class="prev"><a href="mapping-field-names-field.html">
              «&nbsp;
              <code class="literal">_field_names</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-index-field.html"><code class="literal">_index</code>
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-link"><a href="mapping-fields.html">Fields</a></span> » <span class="breadcrumb-node"><code class="literal">_index</code></span></div><div class="navheader"><span class="prev"><a href="mapping-routing-field.html">
              «&nbsp;
              <code class="literal">_routing</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-size-field.html"><code class="literal">_size</code>
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-index-field"></a><code class="literal">_index</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/index-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The ability to store in a document the index it belongs to. By default
it is disabled, in order to enable it, the following mapping should be
defined:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "_index" : { "enabled" : true }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="mapping-routing-field.html">
              «&nbsp;
              <code class="literal">_routing</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-size-field.html"><code class="literal">_size</code>
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-link"><a href="mapping-fields.html">Fields</a></span> » <span class="breadcrumb-node"><code class="literal">_size</code></span></div><div class="navheader"><span class="prev"><a href="mapping-index-field.html">
              «&nbsp;
              <code class="literal">_index</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-timestamp-field.html"><code class="literal">_timestamp</code>
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-size-field"></a><code class="literal">_size</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/size-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">_size</code> field allows to automatically index the size of the original
<code class="literal">_source</code> indexed. By default, it’s disabled. In order to enable it, set
the mapping to:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "_size" : {"enabled" : true}
    }
}</pre></div><p>In order to also store it, use:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "_size" : {"enabled" : true, "store" : true }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="mapping-index-field.html">
              «&nbsp;
              <code class="literal">_index</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-timestamp-field.html"><code class="literal">_timestamp</code>
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-link"><a href="mapping-fields.html">Fields</a></span> » <span class="breadcrumb-node"><code class="literal">_timestamp</code></span></div><div class="navheader"><span class="prev"><a href="mapping-size-field.html">
              «&nbsp;
              <code class="literal">_size</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-ttl-field.html"><code class="literal">_ttl</code>
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-timestamp-field"></a><code class="literal">_timestamp</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/timestamp-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The <code class="literal">_timestamp</code> field allows to automatically index the timestamp of a
document. It can be provided externally via the index request or in the
<code class="literal">_source</code>. If it is not provided externally it will be automatically set
to a <a class="link" href="mapping-timestamp-field.html#mapping-timestamp-field-default" title="defaultedit">default date</a>.</p><h4><a id="_enabled"></a>enabled<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/timestamp-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>By default it is disabled. In order to enable it, the following mapping
should be defined:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "_timestamp" : { "enabled" : true }
    }
}</pre></div><h4><a id="_store_index_2"></a>store / index<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/timestamp-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>By default the <code class="literal">_timestamp</code> field has <code class="literal">store</code> set to <code class="literal">false</code> and <code class="literal">index</code>
set to <code class="literal">not_analyzed</code>. It can be queried as a standard date field.</p><h4><a id="_path_3"></a>path<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/timestamp-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">_timestamp</code> value can be provided as an external value when
indexing. But, it can also be automatically extracted from the document
to index based on a <code class="literal">path</code>. For example, having the following mapping:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "_timestamp" : {
            "enabled" : true,
            "path" : "post_date"
        }
    }
}</pre></div><p>Will cause <code class="literal">2009-11-15T14:12:12</code> to be used as the timestamp value for:</p><div class="pre_wrapper"><pre class="programlisting">{
    "message" : "You know, for Search",
    "post_date" : "2009-11-15T14:12:12"
}</pre></div><p>Note, using <code class="literal">path</code> without explicit timestamp value provided requires an
additional (though quite fast) parsing phase.</p><h4><a id="mapping-timestamp-field-format"></a>format<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/timestamp-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>You can define the <a class="link" href="mapping-date-format.html" title="Date Format">date format</a> used to parse the provided timestamp value. For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "_timestamp" : {
            "enabled" : true,
            "path" : "post_date",
            "format" : "YYYY-MM-dd"
        }
    }
}</pre></div><p>Note, the default format is <code class="literal">dateOptionalTime</code>. The timestamp value will
first be parsed as a number and if it fails the format will be tried.</p><h4><a id="mapping-timestamp-field-default"></a>default<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/timestamp-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>You can define a default value for when timestamp is not provided
within the index request or in the <code class="literal">_source</code> document.</p><p>By default, the default value is <code class="literal">now</code> which means the date the document was processed by the indexing chain.</p><p>You can reject documents which do not provide a <code class="literal">timestamp</code> value by setting <code class="literal">ignore_missing</code> to false (default to <code class="literal">true</code>):</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "_timestamp" : {
            "enabled" : true,
            "ignore_missing" : false
        }
    }
}</pre></div><p>You can also set the default value to any date respecting <a class="link" href="mapping-timestamp-field.html#mapping-timestamp-field-format" title="formatedit">timestamp format</a>:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "_timestamp" : {
            "enabled" : true,
            "format" : "YYYY-MM-dd",
            "default" : "1970-01-01"
        }
    }
}</pre></div><p>If you don’t provide any timestamp value, _timestamp will be set to this default value.</p></div><div class="navfooter"><span class="prev"><a href="mapping-size-field.html">
              «&nbsp;
              <code class="literal">_size</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-ttl-field.html"><code class="literal">_ttl</code>
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-link"><a href="mapping-fields.html">Fields</a></span> » <span class="breadcrumb-node"><code class="literal">_ttl</code></span></div><div class="navheader"><span class="prev"><a href="mapping-timestamp-field.html">
              «&nbsp;
              <code class="literal">_timestamp</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-types.html">Types
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-ttl-field"></a><code class="literal">_ttl</code><a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/ttl-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>A lot of documents naturally come with an expiration date. Documents can
therefore have a <code class="literal">_ttl</code> (time to live), which will cause the expired
documents to be deleted automatically.</p><p><code class="literal">_ttl</code> accepts two parameters which are described below, every other setting will be silently ignored.</p><h4><a id="_enabled_2"></a>enabled<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/ttl-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>By default it is disabled, in order to enable it, the following mapping
should be defined:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "_ttl" : { "enabled" : true }
    }
}</pre></div><p><code class="literal">_ttl</code> can only be enabled once and never be disabled again.</p><h4><a id="_default"></a>default<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/ttl-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>You can provide a per index/type default <code class="literal">_ttl</code> value as follows:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "_ttl" : { "enabled" : true, "default" : "1d" }
    }
}</pre></div><p>In this case, if you don’t provide a <code class="literal">_ttl</code> value in your query or in
the <code class="literal">_source</code> all tweets will have a <code class="literal">_ttl</code> of one day.</p><p>In case you do not specify a time unit like <code class="literal">d</code> (days), <code class="literal">m</code> (minutes),
<code class="literal">h</code> (hours), <code class="literal">ms</code> (milliseconds) or <code class="literal">w</code> (weeks), milliseconds is used as
default unit.</p><p>If no <code class="literal">default</code> is set and no <code class="literal">_ttl</code> value is given then the document
has an infinite <code class="literal">_ttl</code> and will not expire.</p><p>You can dynamically update the <code class="literal">default</code> value using the put mapping
API. It won’t change the <code class="literal">_ttl</code> of already indexed documents but will be
used for future documents.</p><h4><a id="_note_on_documents_expiration"></a>Note on documents expiration<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/fields/ttl-field.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Expired documents will be automatically deleted regularly. You can
dynamically set the <code class="literal">indices.ttl.interval</code> to fit your needs. The
default value is <code class="literal">60s</code>.</p><p>The deletion orders are processed by bulk. You can set
<code class="literal">indices.ttl.bulk_size</code> to fit your needs. The default value is <code class="literal">10000</code>.</p><p>Note that the expiration procedure handle versioning properly so if a
document is updated between the collection of documents to expire and
the delete order, the document won’t be deleted.</p></div><div class="navfooter"><span class="prev"><a href="mapping-timestamp-field.html">
              «&nbsp;
              <code class="literal">_timestamp</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-types.html">Types
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-node">Types</span></div><div class="navheader"><span class="prev"><a href="mapping-ttl-field.html">
              «&nbsp;
              <code class="literal">_ttl</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-core-types.html">Core Types
              &nbsp;»
            </a></span></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-types"></a>Types<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/types.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>The datatype for each field in a document (eg strings, numbers,
objects etc) can be controlled via the type mapping.</p></div><div class="navfooter"><span class="prev"><a href="mapping-ttl-field.html">
              «&nbsp;
              <code class="literal">_ttl</code></a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-core-types.html">Core Types
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-link"><a href="mapping-types.html">Types</a></span> » <span class="breadcrumb-node">Core Types</span></div><div class="navheader"><span class="prev"><a href="mapping-types.html">
              «&nbsp;
              Types</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-array-type.html">Array Type
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-core-types"></a>Core Types<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/types/core-types.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>Each JSON field can be mapped to a specific core type. JSON itself
already provides us with some typing, with its support for <code class="literal">string</code>,
<code class="literal">integer</code>/<code class="literal">long</code>, <code class="literal">float</code>/<code class="literal">double</code>, <code class="literal">boolean</code>, and <code class="literal">null</code>.</p><p>The following sample tweet JSON document will be used to explain the
core types:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" {
        "user" : "kimchy",
        "message" : "This is a tweet!",
        "postDate" : "2009-11-15T14:12:12",
        "priority" : 4,
        "rank" : 12.3
    }
}</pre></div><p>Explicit mapping for the above JSON tweet can be:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "properties" : {
            "user" : {"type" : "string", "index" : "not_analyzed"},
            "message" : {"type" : "string", "null_value" : "na"},
            "postDate" : {"type" : "date"},
            "priority" : {"type" : "integer"},
            "rank" : {"type" : "float"}
        }
    }
}</pre></div><h4><a id="string"></a>String<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/types/core-types.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The text based string type is the most basic type, and contains one or
more characters. An example mapping can be:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "properties" : {
            "message" : {
                "type" : "string",
                "store" : true,
                "index" : "analyzed",
                "null_value" : "na"
            },
            "user" : {
                "type" : "string",
                "index" : "not_analyzed",
                "norms" : {
                    "enabled" : false
                }
            }
        }
    }
}</pre></div><p>The above mapping defines a <code class="literal">string</code> <code class="literal">message</code> property/field within the
<code class="literal">tweet</code> type. The field is stored in the index (so it can later be
retrieved using selective loading when searching), and it gets analyzed
(broken down into searchable terms). If the message has a <code class="literal">null</code> value,
then the value that will be stored is <code class="literal">na</code>. There is also a <code class="literal">string</code> <code class="literal">user</code>
which is indexed as-is (not broken down into tokens) and has norms
disabled (so that matching this field is a binary decision, no match is
better than another one).</p><p>The following table lists all the attributes that can be used with the
<code class="literal">string</code> type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th class="entry" align="left" valign="top">Attribute </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">index_name</code></p></td><td class="entry" align="left" valign="top"><p><span class="deprecated">
      [<span class="version">1.5.0</span>]
      <span class="detail">Deprecated in 1.5.0.
Use <a class="link" href="mapping-core-types.html#copy-to" title="Copy to fieldedit"><code class="literal">copy_to</code></a> instead
</span></span> The name of the field that will be stored in the index.
Defaults to the property/field name.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">store</code></p></td><td class="entry" align="left" valign="top"><p>Set to <code class="literal">true</code> to actually store the field in the index, <code class="literal">false</code> to not
store it. Since by default Elasticsearch stores all fields of the source
document in the special <code class="literal">_source</code> field, this option is primarily useful when
the <code class="literal">_source</code> field has been disabled in the type definition. Defaults to
<code class="literal">false</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">index</code></p></td><td class="entry" align="left" valign="top"><p>Set to <code class="literal">analyzed</code> for the field to be indexed and searchable
after being broken down into token using an analyzer. <code class="literal">not_analyzed</code>
means that its still searchable, but does not go through any analysis
process or broken down into tokens. <code class="literal">no</code> means that it won’t be
searchable at all (as an individual field; it may still be included in
<code class="literal">_all</code>). Setting to <code class="literal">no</code> disables <code class="literal">include_in_all</code>. Defaults to
<code class="literal">analyzed</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">doc_values</code></p></td><td class="entry" align="left" valign="top"><p>Set to <code class="literal">true</code> to store field values in a column-stride fashion.
Automatically set to <code class="literal">true</code> when the <a class="link" href="fielddata-formats.html" title="Field data formats"><code class="literal">fielddata</code> format</a> is <code class="literal">doc_values</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">term_vector</code></p></td><td class="entry" align="left" valign="top"><p>Possible values are <code class="literal">no</code>, <code class="literal">yes</code>, <code class="literal">with_offsets</code>,
<code class="literal">with_positions</code>, <code class="literal">with_positions_offsets</code>. Defaults to <code class="literal">no</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">boost</code></p></td><td class="entry" align="left" valign="top"><p>The boost value. Defaults to <code class="literal">1.0</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">null_value</code></p></td><td class="entry" align="left" valign="top"><p>When there is a (JSON) null value for the field, use the
<code class="literal">null_value</code> as the field value. Defaults to not adding the field at
all.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">norms: {enabled: &lt;value&gt;}</code></p></td><td class="entry" align="left" valign="top"><p>Boolean value if norms should be enabled or
not. Defaults to <code class="literal">true</code> for <code class="literal">analyzed</code> fields, and to <code class="literal">false</code> for
<code class="literal">not_analyzed</code> fields. See the <a class="link" href="mapping-core-types.html#norms" title="Normsedit">section about norms</a>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">norms: {loading: &lt;value&gt;}</code></p></td><td class="entry" align="left" valign="top"><p>Describes how norms should be loaded, possible values are
<code class="literal">eager</code> and <code class="literal">lazy</code> (default). It is possible to change the default value to
eager for all fields by configuring the index setting <code class="literal">index.norms.loading</code>
to <code class="literal">eager</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">index_options</code></p></td><td class="entry" align="left" valign="top"><p>Allows to set the indexing
options, possible values are <code class="literal">docs</code> (only doc numbers are indexed),
<code class="literal">freqs</code> (doc numbers and term frequencies), and <code class="literal">positions</code> (doc
numbers, term frequencies and positions). Defaults to <code class="literal">positions</code> for
<code class="literal">analyzed</code> fields, and to <code class="literal">docs</code> for <code class="literal">not_analyzed</code> fields. It
is also possible to set it to <code class="literal">offsets</code> (doc numbers, term
frequencies, positions and offsets).</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">analyzer</code></p></td><td class="entry" align="left" valign="top"><p>The analyzer used to analyze the text contents when
<code class="literal">analyzed</code> during indexing and when searching using a query string.
Defaults to the globally configured analyzer.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">index_analyzer</code></p></td><td class="entry" align="left" valign="top"><p>The analyzer used to analyze the text contents when
<code class="literal">analyzed</code> during indexing.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">search_analyzer</code></p></td><td class="entry" align="left" valign="top"><p>The analyzer used to analyze the field when part of
a query string. Can be updated on an existing field.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">include_in_all</code></p></td><td class="entry" align="left" valign="top"><p>Should the field be included in the <code class="literal">_all</code> field (if
enabled). If <code class="literal">index</code> is set to <code class="literal">no</code> this defaults to <code class="literal">false</code>, otherwise,
defaults to <code class="literal">true</code> or to the parent <code class="literal">object</code> type setting.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">ignore_above</code></p></td><td class="entry" align="left" valign="top"><p>The analyzer will ignore strings larger than this size.
Useful for generic <code class="literal">not_analyzed</code> fields that should ignore long text.</p>
<p>This option is also useful for protecting against Lucene’s term byte-length
limit of <code class="literal">32766</code>. Note: the value for <code class="literal">ignore_above</code> is the <span class="emphasis"><em>character count</em></span>,
but Lucene counts bytes, so if you have UTF-8 text, you may want to set the
limit to <code class="literal">32766 / 3 = 10922</code> since UTF-8 characters may occupy at most 3
bytes.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">position_offset_gap</code></p></td><td class="entry" align="left" valign="top"><p>Position increment gap between field instances
with the same field name. Defaults to 0.</p></td></tr></tbody></table></div><p>The <code class="literal">string</code> type also support custom indexing parameters associated
with the indexed value. For example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "message" : {
        "_value":  "boosted value",
        "_boost":  2.0
    }
}</pre></div><p>The mapping is required to disambiguate the meaning of the document.
Otherwise, the structure would interpret "message" as a value of type
"object". The key <code class="literal">_value</code> (or <code class="literal">value</code>) in the inner document specifies
the real string content that should eventually be indexed. The <code class="literal">_boost</code>
(or <code class="literal">boost</code>) key specifies the per field document boost (here 2.0).</p><h5><a id="norms"></a>Norms<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/types/core-types.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Norms store various normalization factors that are later used (at query time)
in order to compute the score of a document relatively to a query.</p><p>Although useful for scoring, norms also require quite a lot of memory
(typically in the order of one byte per document per field in your index,
even for documents that don’t have this specific field). As a consequence, if
you don’t need scoring on a specific field, it is highly recommended to disable
norms on it. In  particular, this is the case for fields that are used solely
for filtering or aggregations.</p><p>In case you would like to disable norms after the fact, it is possible to do so
by using the <a class="link" href="indices-put-mapping.html" title="Put Mapping">PUT mapping API</a>, like this:</p><div class="pre_wrapper"><pre class="programlisting">PUT my_index/_mapping/my_type
{
  "properties": {
    "title": {
      "type": "string",
      "norms": {
        "enabled": false
      }
    }
  }
}</pre></div><p>Please however note that norms won’t be removed instantly, but will be removed
as old segments are merged into new segments as you continue indexing new documents.
Any score computation on a field that has had
norms removed might return inconsistent results since some documents won’t have
norms anymore while other documents might still have norms.</p><h4><a id="number"></a>Number<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/types/core-types.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>A number based type supporting <code class="literal">float</code>, <code class="literal">double</code>, <code class="literal">byte</code>, <code class="literal">short</code>,
<code class="literal">integer</code>, and <code class="literal">long</code>. It uses specific constructs within Lucene in
order to support numeric values. The number types have the same ranges
as corresponding
<a class="ulink" href="http://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html" target="_top">Java
types</a>. An example mapping can be:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "properties" : {
            "rank" : {
                "type" : "float",
                "null_value" : 1.0
            }
        }
    }
}</pre></div><p>The following table lists all the attributes that can be used with a
numbered type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th class="entry" align="left" valign="top">Attribute </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">type</code></p></td><td class="entry" align="left" valign="top"><p>The type of the number. Can be <code class="literal">float</code>, <code class="literal">double</code>, <code class="literal">integer</code>,
<code class="literal">long</code>, <code class="literal">short</code>, <code class="literal">byte</code>. Required.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">index_name</code></p></td><td class="entry" align="left" valign="top"><p><span class="deprecated">
      [<span class="version">1.5.0</span>]
      <span class="detail">Deprecated in 1.5.0.
Use <a class="link" href="mapping-core-types.html#copy-to" title="Copy to fieldedit"><code class="literal">copy_to</code></a> instead
</span></span> The name of the field that will be stored in the index.
Defaults to the property/field name.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">store</code></p></td><td class="entry" align="left" valign="top"><p>Set to <code class="literal">true</code> to store actual field in the index, <code class="literal">false</code> to not
store it. Defaults to <code class="literal">false</code> (note, the JSON document itself is stored,
and it can be retrieved from it).</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">index</code></p></td><td class="entry" align="left" valign="top"><p>Set to <code class="literal">no</code> if the value should not be indexed. Setting to
<code class="literal">no</code> disables <code class="literal">include_in_all</code>. If set to <code class="literal">no</code> the field should be either stored
in <code class="literal">_source</code>, have <code class="literal">include_in_all</code> enabled, or <code class="literal">store</code> be set to
<code class="literal">true</code> for this to be useful.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">doc_values</code></p></td><td class="entry" align="left" valign="top"><p>Set to <code class="literal">true</code> to store field values in a column-stride fashion.
Automatically set to <code class="literal">true</code> when the fielddata format is <code class="literal">doc_values</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">precision_step</code></p></td><td class="entry" align="left" valign="top"><p>The precision step (influences the number of terms
generated for each number value). Defaults to <code class="literal">16</code> for <code class="literal">long</code>, <code class="literal">double</code>,
<code class="literal">8</code> for <code class="literal">short</code>, <code class="literal">integer</code>, <code class="literal">float</code>, and <code class="literal">2147483647</code> for <code class="literal">byte</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">boost</code></p></td><td class="entry" align="left" valign="top"><p>The boost value. Defaults to <code class="literal">1.0</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">null_value</code></p></td><td class="entry" align="left" valign="top"><p>When there is a (JSON) null value for the field, use the
<code class="literal">null_value</code> as the field value. Defaults to not adding the field at
all.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">include_in_all</code></p></td><td class="entry" align="left" valign="top"><p>Should the field be included in the <code class="literal">_all</code> field (if
enabled). If <code class="literal">index</code> is set to <code class="literal">no</code> this defaults to <code class="literal">false</code>, otherwise,
defaults to <code class="literal">true</code> or to the parent <code class="literal">object</code> type setting.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">ignore_malformed</code></p></td><td class="entry" align="left" valign="top"><p>Ignored a malformed number. Defaults to <code class="literal">false</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">coerce</code></p></td><td class="entry" align="left" valign="top"><p>Try convert strings to numbers and truncate fractions for integers. Defaults to <code class="literal">true</code>.</p></td></tr></tbody></table></div><h4><a id="token_count"></a>Token Count<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/types/core-types.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">token_count</code> type maps to the JSON string type but indexes and stores
the number of tokens in the string rather than the string itself.  For
example:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "properties" : {
            "name" : {
                "type" : "string",
                "fields" : {
                    "word_count": {
                        "type" : "token_count",
                        "store" : "yes",
                        "analyzer" : "standard"
                    }
                }
            }
        }
    }
}</pre></div><p>All the configuration that can be specified for a number can be specified
for a token_count.  The only extra configuration is the required
<code class="literal">analyzer</code> field which specifies which analyzer to use to break the string
into tokens.  For best performance, use an analyzer with no token filters.</p><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Technically the <code class="literal">token_count</code> type sums position increments rather than
counting tokens. This means that even if the analyzer filters out stop
words they are included in the count.</p></div></div><h4><a id="date"></a>Date<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/types/core-types.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The date type is a special type which maps to JSON string type. It
follows a specific format that can be explicitly set. All dates are
<code class="literal">UTC</code>. Internally, a date maps to a number type <code class="literal">long</code>, with the added
parsing stage from string to long and from long to string. An example
mapping:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "properties" : {
            "postDate" : {
                "type" : "date",
                "format" : "YYYY-MM-dd"
            }
        }
    }
}</pre></div><p>The date type will also accept a long number representing UTC
milliseconds since the epoch, regardless of the format it can handle.</p><p>The following table lists all the attributes that can be used with a
date type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th class="entry" align="left" valign="top">Attribute </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">index_name</code></p></td><td class="entry" align="left" valign="top"><p><span class="deprecated">
      [<span class="version">1.5.0</span>]
      <span class="detail">Deprecated in 1.5.0.
Use <a class="link" href="mapping-core-types.html#copy-to" title="Copy to fieldedit"><code class="literal">copy_to</code></a> instead
</span></span> The name of the field that will be stored in the index.
Defaults to the property/field name.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">format</code></p></td><td class="entry" align="left" valign="top"><p>The <a class="link" href="mapping-date-format.html" title="Date Format">date format</a>. Defaults to <code class="literal">dateOptionalTime</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">store</code></p></td><td class="entry" align="left" valign="top"><p>Set to <code class="literal">true</code> to store actual field in the index, <code class="literal">false</code> to not
store it. Defaults to <code class="literal">false</code> (note, the JSON document itself is stored,
and it can be retrieved from it).</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">index</code></p></td><td class="entry" align="left" valign="top"><p>Set to <code class="literal">no</code> if the value should not be indexed. Setting to
<code class="literal">no</code> disables <code class="literal">include_in_all</code>. If set to <code class="literal">no</code> the field should be either stored
in <code class="literal">_source</code>, have <code class="literal">include_in_all</code> enabled, or <code class="literal">store</code> be set to
<code class="literal">true</code> for this to be useful.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">doc_values</code></p></td><td class="entry" align="left" valign="top"><p>Set to <code class="literal">true</code> to store field values in a column-stride fashion.
Automatically set to <code class="literal">true</code> when the fielddata format is <code class="literal">doc_values</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">precision_step</code></p></td><td class="entry" align="left" valign="top"><p>The precision step (influences the number of terms
generated for each number value). Defaults to <code class="literal">16</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">boost</code></p></td><td class="entry" align="left" valign="top"><p>The boost value. Defaults to <code class="literal">1.0</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">null_value</code></p></td><td class="entry" align="left" valign="top"><p>When there is a (JSON) null value for the field, use the
<code class="literal">null_value</code> as the field value. Defaults to not adding the field at
all.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">include_in_all</code></p></td><td class="entry" align="left" valign="top"><p>Should the field be included in the <code class="literal">_all</code> field (if
enabled). If <code class="literal">index</code> is set to <code class="literal">no</code> this defaults to <code class="literal">false</code>, otherwise,
defaults to <code class="literal">true</code> or to the parent <code class="literal">object</code> type setting.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">ignore_malformed</code></p></td><td class="entry" align="left" valign="top"><p>Ignored a malformed number. Defaults to <code class="literal">false</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">numeric_resolution</code></p></td><td class="entry" align="left" valign="top"><p>The unit to use when passed in a numeric values. Possible
values include <code class="literal">seconds</code> and  <code class="literal">milliseconds</code> (default).</p></td></tr></tbody></table></div><h4><a id="boolean"></a>Boolean<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/types/core-types.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The boolean type Maps to the JSON boolean type. It ends up storing
within the index either <code class="literal">T</code> or <code class="literal">F</code>, with automatic translation to <code class="literal">true</code>
and <code class="literal">false</code> respectively.</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "properties" : {
            "has_my_special_tweet" : {
                "type" : "boolean"
            }
        }
    }
}</pre></div><p>The boolean type also supports passing the value as a number or a string
(in this case <code class="literal">0</code>, an empty string, <code class="literal">false</code>, <code class="literal">off</code> and <code class="literal">no</code> are
<code class="literal">false</code>, all other values are <code class="literal">true</code>).</p><p>The following table lists all the attributes that can be used with the
boolean type:</p><div class="informaltable"><table cellpadding="4px" border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th class="entry" align="left" valign="top">Attribute </th><th class="entry" align="left" valign="top">Description</th></tr></thead><tbody><tr><td class="entry" align="left" valign="top"><p><code class="literal">index_name</code></p></td><td class="entry" align="left" valign="top"><p><span class="deprecated">
      [<span class="version">1.5.0</span>]
      <span class="detail">Deprecated in 1.5.0.
Use <a class="link" href="mapping-core-types.html#copy-to" title="Copy to fieldedit"><code class="literal">copy_to</code></a> instead
</span></span> The name of the field that will be stored in the index.
Defaults to the property/field name.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">store</code></p></td><td class="entry" align="left" valign="top"><p>Set to <code class="literal">true</code> to store actual field in the index, <code class="literal">false</code> to not
store it. Defaults to <code class="literal">false</code> (note, the JSON document itself is stored,
and it can be retrieved from it).</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">index</code></p></td><td class="entry" align="left" valign="top"><p>Set to <code class="literal">no</code> if the value should not be indexed. Setting to
<code class="literal">no</code> disables <code class="literal">include_in_all</code>. If set to <code class="literal">no</code> the field should be either stored
in <code class="literal">_source</code>, have <code class="literal">include_in_all</code> enabled, or <code class="literal">store</code> be set to
<code class="literal">true</code> for this to be useful.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">boost</code></p></td><td class="entry" align="left" valign="top"><p>The boost value. Defaults to <code class="literal">1.0</code>.</p></td></tr><tr><td class="entry" align="left" valign="top"><p><code class="literal">null_value</code></p></td><td class="entry" align="left" valign="top"><p>When there is a (JSON) null value for the field, use the
<code class="literal">null_value</code> as the field value. Defaults to not adding the field at
all.</p></td></tr></tbody></table></div><h4><a id="binary"></a>Binary<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/types/core-types.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The binary type is a base64 representation of binary data that can be
stored in the index. The field is not stored by default and not indexed at
all.</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "properties" : {
            "image" : {
                "type" : "binary"
            }
        }
    }
}</pre></div><p>The following table lists all the attributes that can be used with the
binary type:</p><div class="informaltable"><table cellpadding="4px" border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td class="entry" valign="top">
<p>
<code class="literal">index_name</code>
</p>
</td><td class="entry" valign="top">
<p>
    <span class="deprecated">
      [<span class="version">1.5.0</span>]
      <span class="detail">Deprecated in 1.5.0.
Use <a class="link" href="mapping-core-types.html#copy-to" title="Copy to fieldedit"><code class="literal">copy_to</code></a> instead
</span></span> The name of the field that will be stored in the index.
    Defaults to the property/field name.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">store</code>
</p>
</td><td class="entry" valign="top">
<p>
    Set to <code class="literal">true</code> to store actual field in the index, <code class="literal">false</code> to not store it.
    Defaults to <code class="literal">false</code> (note, the JSON document itself is already stored, so
    the binary field can be retrieved from there).
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">doc_values</code>
</p>
</td><td class="entry" valign="top">
<p>
    Set to <code class="literal">true</code> to store field values in a column-stride fashion.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">compress</code>
</p>
</td><td class="entry" valign="top">
<p>
    Set to <code class="literal">true</code> to compress the stored binary value.
</p>
</td></tr><tr><td class="entry" valign="top">
<p>
<code class="literal">compress_threshold</code>
</p>
</td><td class="entry" valign="top">
<p>
    Compression will only be applied to stored binary fields that are greater
    than this size. Defaults to <code class="literal">-1</code>
</p>
</td></tr></tbody></table></div><div class="note admon"><div class="icon"><img alt="Note" src="images/icons/note.png"></div><div class="admon_content"><p>Enabling compression on stored binary fields only makes sense on large
and highly-compressible values. Otherwise per-field compression is usually not
worth doing as the space savings do not compensate for the overhead of the
compression format. Normally, you should not configure any compression and
just rely on the block compression of stored fields (which is enabled by
default and can’t be disabled).</p></div></div><h4><a id="fielddata-filters"></a>Fielddata filters<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/types/core-types.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>It is possible to control which field values are loaded into memory,
which is particularly useful for aggregating on string fields, using
fielddata filters, which are explained in detail in the
<a class="link" href="index-modules-fielddata.html" title="Field data">Fielddata</a> section.</p><p>Fielddata filters can exclude terms which do not match a regex, or which
don’t fall between a <code class="literal">min</code> and <code class="literal">max</code> frequency range:</p><div class="pre_wrapper"><pre class="programlisting">{
    tweet: {
        type:      "string",
        analyzer:  "whitespace"
        fielddata: {
            filter: {
                regex: {
                    "pattern":        "^#.*"
                },
                frequency: {
                    min:              0.001,
                    max:              0.1,
                    min_segment_size: 500
                }
            }
        }
    }
}</pre></div><p>These filters can be updated on an existing field mapping and will take
effect the next time the fielddata for a segment is loaded. Use the
<a class="link" href="indices-clearcache.html" title="Clear Cache">Clear Cache</a> API
to reload the fielddata using the new filters.</p><h4><a id="_similarity"></a>Similarity<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/types/core-types.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>Elasticsearch allows you to configure a similarity (scoring algorithm) per field.
The <code class="literal">similarity</code> setting provides a simple way of choosing a similarity algorithm
other than the default TF/IDF, such as <code class="literal">BM25</code>.</p><p>You can configure similarities via the
<a class="link" href="index-modules-similarity.html" title="Similarity module">similarity module</a></p><h5><a id="_configuring_similarity_per_field"></a>Configuring Similarity per Field<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/types/core-types.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Defining the Similarity for a field is done via the <code class="literal">similarity</code> mapping
property, as this example shows:</p><div class="pre_wrapper"><pre class="programlisting">{
   "book":{
      "properties":{
         "title":{
            "type":"string", "similarity":"BM25"
         }
      }
   }
}</pre></div><p>The following Similarities are configured out-of-box:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">
<code class="literal">default</code>
</span></dt><dd>
        The Default TF/IDF algorithm used by Elasticsearch and
        Lucene in previous versions.
</dd><dt><span class="term">
<code class="literal">BM25</code>
</span></dt><dd>
        The BM25 algorithm.
        <a class="ulink" href="http://en.wikipedia.org/wiki/Okapi_BM25" target="_top">See Okapi_BM25</a> for more
        details.
</dd></dl></div><h5><a id="copy-to"></a>Copy to field<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/types/core-types.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>Adding <code class="literal">copy_to</code> parameter to any field mapping will cause all values of this field to be copied to fields specified in
the parameter. In the following example all values from fields <code class="literal">title</code> and <code class="literal">abstract</code> will be copied to the field
<code class="literal">meta_data</code>.</p><div class="pre_wrapper"><pre class="programlisting">{
  "book" : {
    "properties" : {
      "title" : { "type" : "string", "copy_to" : "meta_data" },
      "abstract" : { "type" : "string", "copy_to" : "meta_data" },
      "meta_data" : { "type" : "string" }
    }
}</pre></div><p>Multiple fields are also supported:</p><div class="pre_wrapper"><pre class="programlisting">{
  "book" : {
    "properties" : {
      "title" : { "type" : "string", "copy_to" : ["meta_data", "article_info"] }
    }
}</pre></div><h5><a id="_multi_fields_3"></a>Multi fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/types/core-types.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h5><p>The <code class="literal">fields</code> options allows to map several core types fields into a single
json source field. This can be useful if a single field need to be
used in different ways. For example a single field is to be used for both
free text search and sorting.</p><div class="pre_wrapper"><pre class="programlisting">{
  "tweet" : {
    "properties" : {
      "name" : {
        "type" : "string",
        "index" : "analyzed",
        "fields" : {
          "raw" : {"type" : "string", "index" : "not_analyzed"}
        }
      }
    }
  }
}</pre></div><p>In the above example the field <code class="literal">name</code> gets processed twice. The first time it gets
processed as an analyzed string and this version is accessible under the field name
<code class="literal">name</code>, this is the main field and is in fact just like any other field. The second time
it gets processed as a not analyzed string and is accessible under the name <code class="literal">name.raw</code>.</p><h4><a id="_include_in_all"></a>Include in All<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/types/core-types.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The <code class="literal">include_in_all</code> setting is ignored on any field that is defined in
the <code class="literal">fields</code> options. Setting the <code class="literal">include_in_all</code> only makes sense on
the main field, since the raw field value is copied to the <code class="literal">_all</code> field,
the tokens aren’t copied.</p><h4><a id="_updating_a_field"></a>Updating a field<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/types/core-types.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>In the essence a field can’t be updated. However multi fields can be
added to existing fields. This allows for example to have a different
<code class="literal">index_analyzer</code> configuration in addition to the already configured
<code class="literal">index_analyzer</code> configuration specified in the main and other multi fields.</p><p>Also the new multi field will only be applied on document that have been
added after the multi field has been added and in fact the new multi field
doesn’t exist in existing documents.</p><p>Another important note is that new multi fields will be merged into the
list of existing multi fields, so when adding new multi fields for a field
previous added multi fields don’t need to be specified.</p><h4><a id="_accessing_fields"></a>Accessing Fields<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/types/core-types.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h4><p>The multi fields defined in the <code class="literal">fields</code> are prefixed with the
name of the main field and can be accessed by their full path using the
navigation notation: <code class="literal">name.raw</code>, or using the typed navigation notation
<code class="literal">tweet.name.raw</code>.</p><div class="warning admon"><div class="icon"><img alt="Warning" src="images/icons/warning.png"></div><div class="admon_content"><h3>Deprecated in 1.0.0. </h3>
The path option below is deprecated.  Use copy_to instead for setting up custom _all fields
</div></div><p>In older releases, the <code class="literal">path</code> option allows to control how fields are accessed.
If the <code class="literal">path</code> option is set to <code class="literal">full</code>, then the full path of the main field
is prefixed, but if the <code class="literal">path</code> option is set to <code class="literal">just_name</code> the actual
multi field name without any prefix is used. The default value for
the <code class="literal">path</code> option is <code class="literal">full</code>.</p><p>The <code class="literal">just_name</code> setting, among other things, allows indexing content of multiple
fields under the same name (commonly used to set up custom _all fields in the past).
In the example below the content of both fields <code class="literal">first_name</code> and <code class="literal">last_name</code>
can be accessed by using <code class="literal">any_name</code> or <code class="literal">tweet.any_name</code>.</p><div class="pre_wrapper"><pre class="programlisting">{
  "tweet" : {
    "properties": {
      "first_name": {
        "type": "string",
        "index": "analyzed",
        "path": "just_name",
        "fields": {
          "any_name": {"type": "string","index": "analyzed"}
        }
      },
      "last_name": {
        "type": "string",
        "index": "analyzed",
        "path": "just_name",
        "fields": {
          "any_name": {"type": "string","index": "analyzed"}
        }
      }
    }
  }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="mapping-types.html">
              «&nbsp;
              Types</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-array-type.html">Array Type
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

      </section>
    </div>

    <div class="main-container">
      <section id="content">
        <div class="content-wrapper">

	<section id="guide" lang="en">
		<div class="container">
			<div class="row">

            <div class="col-xs-12 col-sm-8 col-md-8 guide-section">

<div class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">Elasticsearch Reference
      [1.7]
    </a></span> » <span class="breadcrumb-link"><a href="mapping.html">Mapping</a></span> » <span class="breadcrumb-link"><a href="mapping-types.html">Types</a></span> » <span class="breadcrumb-node">Array Type</span></div><div class="navheader"><span class="prev"><a href="mapping-core-types.html">
              «&nbsp;
              Core Types</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-object-type.html">Object Type
              &nbsp;»
            </a></span></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="mapping-array-type"></a>Array Type<a href="https://github.com/elastic/elasticsearch/edit/1.7/docs/reference/mapping/types/array-type.asciidoc" class="edit_me" title="Edit this page on GitHub" rel="nofollow">edit</a></h2></div></div></div><p>JSON documents allow to define an array (list) of fields or objects.
Mapping array types could not be simpler since arrays gets automatically
detected and mapping them can be done either with
<a class="link" href="mapping-core-types.html" title="Core Types">Core Types</a> or
<a class="link" href="mapping-object-type.html" title="Object Type">Object Type</a> mappings.
For example, the following JSON defines several arrays:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "message" : "some arrays in this tweet...",
        "tags" : ["elasticsearch", "wow"],
        "lists" : [
            {
                "name" : "prog_list",
                "description" : "programming list"
            },
            {
                "name" : "cool_list",
                "description" : "cool stuff list"
            }
        ]
    }
}</pre></div><p>The above JSON has the <code class="literal">tags</code> property defining a list of a simple
<code class="literal">string</code> type, and the <code class="literal">lists</code> property is an <code class="literal">object</code> type array. Here
is a sample explicit mapping:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "properties" : {
            "message" : {"type" : "string"},
            "tags" : {"type" : "string"},
            "lists" : {
                "properties" : {
                    "name" : {"type" : "string"},
                    "description" : {"type" : "string"}
                }
            }
        }
    }
}</pre></div><p>The fact that array types are automatically supported can be shown by
the fact that the following JSON document is perfectly fine:</p><div class="pre_wrapper"><pre class="programlisting">{
    "tweet" : {
        "message" : "some arrays in this tweet...",
        "tags" : "elasticsearch",
        "lists" : {
            "name" : "prog_list",
            "description" : "programming list"
        }
    }
}</pre></div></div><div class="navfooter"><span class="prev"><a href="mapping-core-types.html">
              «&nbsp;
              Core Types</a>
          &nbsp;
        </span><span class="next">
          &nbsp;
          <a href="mapping-object-type.html">Object Type
              &nbsp;»
            </a></span></div>

            </div>

			</div>
		</div>
	</section>

        </div>

</section></div>

</body></html>
